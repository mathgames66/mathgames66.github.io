webpackJsonp([1],{45:function(e){var t=function(){return this}();try{t=t||Function("return this")()||(1,eval)("this")}catch(a){"object"==typeof window&&(t=window)}e.exports=t},50:function(e,t){function a(){}function r(e,t){this.x=e||0,this.y=t||0}function o(e,t,a,n,i,s,d,l,p,c){Object.defineProperty(this,"id",{value:_s++}),this.uuid=vs.generateUUID(),this.name="",this.image=e===void 0?o.DEFAULT_IMAGE:e,this.mipmaps=[],this.mapping=t===void 0?o.DEFAULT_MAPPING:t,this.wrapS=a===void 0?yi:a,this.wrapT=n===void 0?yi:n,this.magFilter=i===void 0?bi:i,this.minFilter=s===void 0?Si:s,this.anisotropy=p===void 0?1:p,this.format=d===void 0?ki:d,this.type=l===void 0?Ei:l,this.offset=new r(0,0),this.repeat=new r(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c===void 0?ps:c,this.version=0,this.onUpdate=null}function n(e,t,a,r){this.x=e||0,this.y=t||0,this.z=a||0,this.w=r===void 0?1:r}function i(e,t,a){this.uuid=vs.generateUUID(),this.width=e,this.height=t,this.scissor=new n(0,0,e,t),this.scissorTest=!1,this.viewport=new n(0,0,e,t),a=a||{},a.minFilter===void 0&&(a.minFilter=bi),this.texture=new o(void 0,void 0,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),this.depthBuffer=!(a.depthBuffer!==void 0)||a.depthBuffer,this.stencilBuffer=!(a.stencilBuffer!==void 0)||a.stencilBuffer,this.depthTexture=a.depthTexture===void 0?null:a.depthTexture}function s(e,t,a){i.call(this,e,t,a),this.activeCubeFace=0,this.activeMipMapLevel=0}function d(e,t,a,r){this._x=e||0,this._y=t||0,this._z=a||0,this._w=r===void 0?1:r}function m(e,t,a){this.x=e||0,this.y=t||0,this.z=a||0}function l(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function p(e,t,a,r,n,i,s,d,l,p,c,u){o.call(this,null,i,s,d,l,p,r,n,c,u),this.image={data:e,width:t,height:a},this.magFilter=l===void 0?xi:l,this.minFilter=p===void 0?xi:p,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function c(e,t,a,r,n,i,s,d,l,p){e=e===void 0?[]:e,t=t===void 0?di:t,o.call(this,e,t,a,r,n,i,s,d,l,p),this.flipY=!1}function u(){this.seq=[],this.map={}}function g(e,t,a){var o=e[0];if(0>=o||0<o)return e;var s=t*a,n=Ss[s];if(void 0===n&&(n=new Float32Array(s),Ss[s]=n),0!==t){o.toArray(n,0);for(var r=1,i=0;r!==t;++r)i+=a,e[r].toArray(n,i)}return n}function h(e,t){var a=Es[t];a===void 0&&(a=new Int32Array(t),Es[t]=a);for(var r=0;r!==t;++r)a[r]=e.allocTextureUnit();return a}function y(e,t){e.uniform1f(this.addr,t)}function f(e,t){e.uniform1i(this.addr,t)}function x(e,t){t.x===void 0?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)}function v(e,t){t.x===void 0?t.r===void 0?e.uniform3fv(this.addr,t):e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3f(this.addr,t.x,t.y,t.z)}function _(e,t){t.x===void 0?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)}function b(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)}function T(e,t){t.elements===void 0?e.uniformMatrix3fv(this.addr,!1,t):(Ps.set(t.elements),e.uniformMatrix3fv(this.addr,!1,Ps))}function S(e,t){t.elements===void 0?e.uniformMatrix4fv(this.addr,!1,t):(Cs.set(t.elements),e.uniformMatrix4fv(this.addr,!1,Cs))}function E(e,t,a){var r=a.allocTextureUnit();e.uniform1i(this.addr,r),a.setTexture2D(t||bs,r)}function C(e,t,a){var r=a.allocTextureUnit();e.uniform1i(this.addr,r),a.setTextureCube(t||Ts,r)}function P(e,t){e.uniform2iv(this.addr,t)}function w(e,t){e.uniform3iv(this.addr,t)}function A(e,t){e.uniform4iv(this.addr,t)}function R(e){return 5126===e?y:35664===e?x:35665===e?v:35666===e?_:35674===e?b:35675===e?T:35676===e?S:35678===e||36198===e?E:35680===e?C:5124===e||35670===e?f:35667===e||35671===e?P:35668===e||35672===e?w:35669===e||35673===e?A:void 0}function M(e,t){e.uniform1fv(this.addr,t)}function L(e,t){e.uniform1iv(this.addr,t)}function B(e,t){e.uniform2fv(this.addr,g(t,this.size,2))}function D(e,t){e.uniform3fv(this.addr,g(t,this.size,3))}function I(e,t){e.uniform4fv(this.addr,g(t,this.size,4))}function F(e,t){e.uniformMatrix2fv(this.addr,!1,g(t,this.size,4))}function O(e,t){e.uniformMatrix3fv(this.addr,!1,g(t,this.size,9))}function U(e,t){e.uniformMatrix4fv(this.addr,!1,g(t,this.size,16))}function k(e,t,a){var r=t.length,o=h(a,r);e.uniform1iv(this.addr,o);for(var n=0;n!==r;++n)a.setTexture2D(t[n]||bs,o[n])}function G(e,t,a){var r=t.length,o=h(a,r);e.uniform1iv(this.addr,o);for(var n=0;n!==r;++n)a.setTextureCube(t[n]||Ts,o[n])}function N(e){return 5126===e?M:35664===e?B:35665===e?D:35666===e?I:35674===e?F:35675===e?O:35676===e?U:35678===e?k:35680===e?G:5124===e||35670===e?L:35667===e||35671===e?P:35668===e||35672===e?w:35669===e||35673===e?A:void 0}function z(e,t,a){this.id=e,this.addr=a,this.setValue=R(t.type)}function W(e,t,a){this.id=e,this.addr=a,this.size=t.size,this.setValue=N(t.type)}function H(e){this.id=e,u.call(this)}function V(e,t){e.seq.push(t),e.map[t.id]=t}function X(e,t,a){var r=e.name,o=r.length;for(ws.lastIndex=0;;){var n=ws.exec(r),i=ws.lastIndex,s=n[1],d="]"===n[2],l=n[3];if(d&&(s|=0),void 0===l||"["===l&&i+2===o){V(a,void 0===l?new z(s,e,t):new W(s,e,t));break}else{var p=a.map,c=p[s];void 0===c&&(c=new H(s),V(a,c)),a=c}}}function j(e,t,a){u.call(this),this.renderer=a;for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),o=0;o<r;++o){var n=e.getActiveUniform(t,o),i=n.name,s=e.getUniformLocation(t,i);X(n,s,this)}}function q(e,t,a){return void 0===t&&void 0===a?this.set(e):this.setRGB(e,t,a)}function Y(e,t){this.min=e===void 0?new r(+Infinity,+Infinity):e,this.max=t===void 0?new r(-Infinity,-Infinity):t}function K(e,t,a,o,n){function s(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),r=new Uint16Array([0,1,2,0,2,3]);d=t.createBuffer(),p=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,p),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW),h=t.createTexture(),y=t.createTexture(),a.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),a.bindTexture(t.TEXTURE_2D,y),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),l={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},c=i(l),u={vertex:t.getAttribLocation(c,"position"),uv:t.getAttribLocation(c,"uv")},g={renderType:t.getUniformLocation(c,"renderType"),map:t.getUniformLocation(c,"map"),occlusionMap:t.getUniformLocation(c,"occlusionMap"),opacity:t.getUniformLocation(c,"opacity"),color:t.getUniformLocation(c,"color"),scale:t.getUniformLocation(c,"scale"),rotation:t.getUniformLocation(c,"rotation"),screenPosition:t.getUniformLocation(c,"screenPosition")}}function i(e){var a=t.createProgram(),r=t.createShader(t.FRAGMENT_SHADER),o=t.createShader(t.VERTEX_SHADER),i="precision "+n.precision+" float;\n";return t.shaderSource(r,i+e.fragmentShader),t.shaderSource(o,i+e.vertexShader),t.compileShader(r),t.compileShader(o),t.attachShader(a,r),t.attachShader(a,o),t.linkProgram(a),a}var d,p,l,c,u,g,h,y;this.render=function(e,n,f,x){if(0!==e.length){var v=new m,_=x.w/x.z,b=.5*x.z,T=.5*x.w,S=16/x.w,E=new r(S*_,S),C=new m(1,1,0),P=new r(1,1),w=new Y;w.min.set(x.x,x.y),w.max.set(x.x+(x.z-16),x.y+(x.w-16)),void 0===c&&s(),a.useProgram(c),a.initAttributes(),a.enableAttribute(u.vertex),a.enableAttribute(u.uv),a.disableUnusedAttributes(),t.uniform1i(g.occlusionMap,0),t.uniform1i(g.map,1),t.bindBuffer(t.ARRAY_BUFFER,d),t.vertexAttribPointer(u.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(u.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,p),a.disable(t.CULL_FACE),a.buffers.depth.setMask(!1);for(var A=0,i=e.length;A<i;A++){S=16/x.w,E.set(S*_,S);var l=e[A];if(v.set(l.matrixWorld.elements[12],l.matrixWorld.elements[13],l.matrixWorld.elements[14]),v.applyMatrix4(f.matrixWorldInverse),v.applyMatrix4(f.projectionMatrix),C.copy(v),P.x=x.x+C.x*b+b-8,P.y=x.y+C.y*T+T-8,!0===w.containsPoint(P)){a.activeTexture(t.TEXTURE0),a.bindTexture(t.TEXTURE_2D,null),a.activeTexture(t.TEXTURE1),a.bindTexture(t.TEXTURE_2D,h),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,P.x,P.y,16,16,0),t.uniform1i(g.renderType,0),t.uniform2f(g.scale,E.x,E.y),t.uniform3f(g.screenPosition,C.x,C.y,C.z),a.disable(t.BLEND),a.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),a.activeTexture(t.TEXTURE0),a.bindTexture(t.TEXTURE_2D,y),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,P.x,P.y,16,16,0),t.uniform1i(g.renderType,1),a.disable(t.DEPTH_TEST),a.activeTexture(t.TEXTURE1),a.bindTexture(t.TEXTURE_2D,h),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),l.positionScreen.copy(C),l.customUpdateCallback?l.customUpdateCallback(l):l.updateLensFlares(),t.uniform1i(g.renderType,2),a.enable(t.BLEND);for(var R=0,M=l.lensFlares.length,L;R<M;R++)L=l.lensFlares[R],.001<L.opacity&&.001<L.scale&&(C.x=L.x,C.y=L.y,C.z=L.z,S=L.size*L.scale/x.w,E.x=S*_,E.y=S,t.uniform3f(g.screenPosition,C.x,C.y,C.z),t.uniform2f(g.scale,E.x,E.y),t.uniform1f(g.rotation,L.rotation),t.uniform1f(g.opacity,L.opacity),t.uniform3f(g.color,L.color.r,L.color.g,L.color.b),a.setBlending(L.blending,L.blendEquation,L.blendSrc,L.blendDst),o.setTexture2D(L.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}}a.enable(t.CULL_FACE),a.enable(t.DEPTH_TEST),a.buffers.depth.setMask(!0),a.reset()}}}function Z(e,t,a,r,n,i,s,d,l){o.call(this,e,t,a,r,n,i,s,d,l),this.needsUpdate=!0}function J(e,t,a,r,o){function n(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),a=new Uint16Array([0,1,2,0,2,3]);u=t.createBuffer(),g=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,g),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a,t.STATIC_DRAW),h=i(),y={position:t.getAttribLocation(h,"position"),uv:t.getAttribLocation(h,"uv")},f={uvOffset:t.getUniformLocation(h,"uvOffset"),uvScale:t.getUniformLocation(h,"uvScale"),rotation:t.getUniformLocation(h,"rotation"),scale:t.getUniformLocation(h,"scale"),color:t.getUniformLocation(h,"color"),map:t.getUniformLocation(h,"map"),opacity:t.getUniformLocation(h,"opacity"),modelViewMatrix:t.getUniformLocation(h,"modelViewMatrix"),projectionMatrix:t.getUniformLocation(h,"projectionMatrix"),fogType:t.getUniformLocation(h,"fogType"),fogDensity:t.getUniformLocation(h,"fogDensity"),fogNear:t.getUniformLocation(h,"fogNear"),fogFar:t.getUniformLocation(h,"fogFar"),fogColor:t.getUniformLocation(h,"fogColor"),alphaTest:t.getUniformLocation(h,"alphaTest")};var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=8,r.height=8;var o=r.getContext("2d");o.fillStyle="white",o.fillRect(0,0,8,8),x=new Z(r)}function i(){var e=t.createProgram(),a=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(a,["precision "+o.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),t.shaderSource(r,["precision "+o.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),t.compileShader(a),t.compileShader(r),t.attachShader(e,a),t.attachShader(e,r),t.linkProgram(e),e}function s(e,t){return e.renderOrder===t.renderOrder?e.z===t.z?t.id-e.id:t.z-e.z:e.renderOrder-t.renderOrder}var l=new m,p=new d,c=new m,u,g,h,y,f,x;this.render=function(o,d,m){if(0!==o.length){void 0===h&&n(),a.useProgram(h),a.initAttributes(),a.enableAttribute(y.position),a.enableAttribute(y.uv),a.disableUnusedAttributes(),a.disable(t.CULL_FACE),a.enable(t.BLEND),t.bindBuffer(t.ARRAY_BUFFER,u),t.vertexAttribPointer(y.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(y.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,g),t.uniformMatrix4fv(f.projectionMatrix,!1,m.projectionMatrix.elements),a.activeTexture(t.TEXTURE0),t.uniform1i(f.map,0);var v=0,_=0,b=d.fog;b?(t.uniform3f(f.fogColor,b.color.r,b.color.g,b.color.b),b.isFog?(t.uniform1f(f.fogNear,b.near),t.uniform1f(f.fogFar,b.far),t.uniform1i(f.fogType,1),v=1,_=1):b.isFogExp2&&(t.uniform1f(f.fogDensity,b.density),t.uniform1i(f.fogType,2),v=2,_=2)):(t.uniform1i(f.fogType,0),v=0,_=0);for(var T=0,i=o.length,S;T<i;T++)S=o[T],S.modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,S.matrixWorld),S.z=-S.modelViewMatrix.elements[14];o.sort(s);for(var E=[],T=0,i=o.length;T<i;T++){var S=o[T],C=S.material;if(!1!==C.visible){S.onBeforeRender(e,d,m,void 0,C,void 0),t.uniform1f(f.alphaTest,C.alphaTest),t.uniformMatrix4fv(f.modelViewMatrix,!1,S.modelViewMatrix.elements),S.matrixWorld.decompose(l,p,c),E[0]=c.x,E[1]=c.y;var P=0;d.fog&&C.fog&&(P=_),v!=P&&(t.uniform1i(f.fogType,P),v=P),null===C.map?(t.uniform2f(f.uvOffset,0,0),t.uniform2f(f.uvScale,1,1)):(t.uniform2f(f.uvOffset,C.map.offset.x,C.map.offset.y),t.uniform2f(f.uvScale,C.map.repeat.x,C.map.repeat.y)),t.uniform1f(f.opacity,C.opacity),t.uniform3f(f.color,C.color.r,C.color.g,C.color.b),t.uniform1f(f.rotation,C.rotation),t.uniform2fv(f.scale,E),a.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst,C.blendEquationAlpha,C.blendSrcAlpha,C.blendDstAlpha,C.premultipliedAlpha),a.buffers.depth.setTest(C.depthTest),a.buffers.depth.setMask(C.depthWrite),r.setTexture2D(C.map||x,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),S.onAfterRender(e,d,m,void 0,C,void 0)}}a.enable(t.CULL_FACE),a.reset()}}}function Q(){Object.defineProperty(this,"id",{value:Ds++}),this.uuid=vs.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=En,this.side=yn,this.flatShading=!1,this.vertexColors=_n,this.opacity=1,this.transparent=!1,this.blendSrc=kn,this.blendDst=Gn,this.blendEquation=Rn,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Yn,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function $(e){Q.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function ee(e){Q.call(this),this.type="MeshDepthMaterial",this.depthPacking=fs,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function te(e){Q.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new m,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function ae(e,t){this.min=e===void 0?new m(+Infinity,+Infinity,+Infinity):e,this.max=t===void 0?new m(-Infinity,-Infinity,-Infinity):t}function re(e,t){this.center=e===void 0?new m:e,this.radius=t===void 0?0:t}function oe(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function ne(e,t){this.normal=e===void 0?new m(1,0,0):e,this.constant=t===void 0?0:t}function ie(e,t,a,r,o,n){this.planes=[e===void 0?new ne:e,t===void 0?new ne:t,a===void 0?new ne:a,r===void 0?new ne:r,o===void 0?new ne:o,n===void 0?new ne:n]}function se(e,t,a){function o(t,a,r,o,n,i){var s=t.geometry,d=null,l=x,p=t.customDepthMaterial;if(r&&(l=v,p=t.customDistanceMaterial),!p){var c=!1;a.morphTargets&&(s&&s.isBufferGeometry?c=s.morphAttributes&&s.morphAttributes.position&&0<s.morphAttributes.position.length:s&&s.isGeometry&&(c=s.morphTargets&&0<s.morphTargets.length)),t.isSkinnedMesh&&!1===a.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var u=t.isSkinnedMesh&&a.skinning,m=0;c&&(m|=y),u&&(m|=f),d=l[m]}else d=p;if(e.localClippingEnabled&&!0===a.clipShadows&&0!==a.clippingPlanes.length){var g=d.uuid,h=a.uuid,b=_[g];void 0===b&&(b={},_[g]=b);var T=b[h];void 0===T&&(T=d.clone(),b[h]=T),d=T}d.visible=a.visible,d.wireframe=a.wireframe;var S=a.side;return R.renderSingleSided&&S==xn&&(S=yn),R.renderReverseSided&&(S===yn?S=fn:S===fn&&(S=yn)),d.side=S,d.clipShadows=a.clipShadows,d.clippingPlanes=a.clippingPlanes,d.clipIntersection=a.clipIntersection,d.wireframeLinewidth=a.wireframeLinewidth,d.linewidth=a.linewidth,r&&d.isMeshDistanceMaterial&&(d.referencePosition.copy(o),d.nearDistance=n,d.farDistance=i),d}function s(a,r,n,p){if(!1!==a.visible){var c=a.layers.test(r.layers);if(c&&(a.isMesh||a.isLine||a.isPoints)&&a.castShadow&&(!a.frustumCulled||d.intersectsObject(a))){a.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,a.matrixWorld);var u=t.update(a),m=a.material;if(Array.isArray(m))for(var g=u.groups,y=0,f=g.length;y<f;y++){var x=g[y],v=m[x.materialIndex];if(v&&v.visible){var _=o(a,v,p,h,n.near,n.far);e.renderBufferDirect(n,null,u,_,a,x)}}else if(m.visible){var _=o(a,m,p,h,n.near,n.far);e.renderBufferDirect(n,null,u,_,a,null)}}for(var b=a.children,T=0,i=b.length;T<i;T++)s(b[T],r,n,p)}}for(var d=new ie,p=new l,c=new r,u=new r(a,a),g=new m,h=new m,y=1,f=2,x=[,,,,],v=[,,,,],_={},b=[new m(1,0,0),new m(-1,0,0),new m(0,0,1),new m(0,0,-1),new m(0,1,0),new m(0,-1,0)],T=[new m(0,1,0),new m(0,1,0),new m(0,1,0),new m(0,1,0),new m(0,0,1),new m(0,0,-1)],S=[new n,new n,new n,new n,new n,new n],E=0;E!==(y|f)+1;++E){var C=0!=(E&y),P=0!=(E&f),w=new ee({depthPacking:xs,morphTargets:C,skinning:P});x[E]=w;var A=new te({morphTargets:C,skinning:P});v[E]=A}var R=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=gn,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(t,a,r){if(!1!==R.enabled&&(!1!==R.autoUpdate||!1!==R.needsUpdate)&&0!==t.length){var o=e.context,n=e.state;n.disable(o.BLEND),n.buffers.color.setClear(1,1,1,1),n.buffers.depth.setTest(!0),n.setScissorTest(!1);for(var l=0,m=t.length,y;l<m;l++){var f=t[l],x=f.shadow,v=f&&f.isPointLight;if(void 0===x){console.warn("THREE.WebGLShadowMap:",f,"has no shadow.");continue}var _=x.camera;if(c.copy(x.mapSize),c.min(u),v){var E=c.x,C=c.y;S[0].set(2*E,C,E,C),S[1].set(0,C,E,C),S[2].set(3*E,C,E,C),S[3].set(E,C,E,C),S[4].set(3*E,0,E,C),S[5].set(E,0,E,C),c.x*=4,c.y*=2}if(null===x.map){x.map=new i(c.x,c.y,{minFilter:xi,magFilter:xi,format:ki}),x.map.texture.name=f.name+".shadowMap",_.updateProjectionMatrix()}x.isSpotLightShadow&&x.update(f);var P=x.map,w=x.matrix;h.setFromMatrixPosition(f.matrixWorld),_.position.copy(h),v?(y=6,w.makeTranslation(-h.x,-h.y,-h.z)):(y=1,g.setFromMatrixPosition(f.target.matrixWorld),_.lookAt(g),_.updateMatrixWorld(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(_.projectionMatrix),w.multiply(_.matrixWorldInverse)),e.setRenderTarget(P),e.clear();for(var A=0;A<y;A++){if(v){g.copy(_.position),g.add(b[A]),_.up.copy(T[A]),_.lookAt(g),_.updateMatrixWorld();var M=S[A];n.viewport(M)}p.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),d.setFromMatrix(p),s(a,r,_,v)}}R.needsUpdate=!1}}}function de(e){function t(t,a){var r=t.array,o=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,n=e.createBuffer();e.bindBuffer(a,n),e.bufferData(a,r,o),t.onUploadCallback();var i=e.FLOAT;return r instanceof Float32Array?i=e.FLOAT:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?i=e.UNSIGNED_SHORT:r instanceof Int16Array?i=e.SHORT:r instanceof Uint32Array?i=e.UNSIGNED_INT:r instanceof Int32Array?i=e.INT:r instanceof Int8Array?i=e.BYTE:r instanceof Uint8Array&&(i=e.UNSIGNED_BYTE),{buffer:n,type:i,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}function a(t,a,r){var o=a.array,n=a.updateRange;e.bindBuffer(r,t),!1===a.dynamic?e.bufferData(r,o,e.STATIC_DRAW):-1===n.count?e.bufferSubData(r,0,o):0===n.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(r,n.offset*o.BYTES_PER_ELEMENT,o.subarray(n.offset,n.offset+n.count)),n.count=-1)}var r={};return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r[e.uuid]},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var a=r[t.uuid];a&&(e.deleteBuffer(a.buffer),delete r[t.uuid])},update:function(e,o){e.isInterleavedBufferAttribute&&(e=e.data);var n=r[e.uuid];n===void 0?r[e.uuid]=t(e,o):n.version<e.version&&(a(n.buffer,e,o),n.version=e.version)}}}function le(e,t,a,r){this._x=e||0,this._y=t||0,this._z=a||0,this._order=r||le.DefaultOrder}function pe(){this.mask=1}function ce(){Object.defineProperty(this,"id",{value:Is++}),this.uuid=vs.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ce.DefaultUp.clone();var e=new m,t=new le,a=new d,r=new m(1,1,1);t.onChange(function(){a.setFromEuler(t,!1)}),a.onChange(function(){t.setFromQuaternion(a,void 0,!1)}),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:a},scale:{enumerable:!0,value:r},modelViewMatrix:{value:new l},normalMatrix:{value:new oe}}),this.matrix=new l,this.matrixWorld=new l,this.matrixAutoUpdate=ce.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new pe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function ue(){ce.call(this),this.type="Camera",this.matrixWorldInverse=new l,this.projectionMatrix=new l}function me(e,t,a,r,o,n){ue.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=a,this.bottom=r,this.near=o===void 0?.1:o,this.far=n===void 0?2e3:n,this.updateProjectionMatrix()}function ge(e,t,a,r){ue.call(this),this.type="PerspectiveCamera",this.fov=e===void 0?50:e,this.zoom=1,this.near=a===void 0?.1:a,this.far=r===void 0?2e3:r,this.focus=10,this.aspect=t===void 0?1:t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function he(e,t,a,r,o,n){this.a=e,this.b=t,this.c=a,this.normal=r&&r.isVector3?r:new m,this.vertexNormals=Array.isArray(r)?r:[],this.color=o&&o.isColor?o:new q,this.vertexColors=Array.isArray(o)?o:[],this.materialIndex=n===void 0?0:n}function ye(){return Fs++}function fe(){Object.defineProperty(this,"id",{value:ye()}),this.uuid=vs.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function xe(e,t,a){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=vs.generateUUID(),this.name="",this.array=e,this.itemSize=t,this.count=e===void 0?0:e.length/t,this.normalized=!0===a,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function ve(e,t){xe.call(this,new Int8Array(e),t)}function _e(e,t){xe.call(this,new Uint8Array(e),t)}function be(e,t){xe.call(this,new Uint8ClampedArray(e),t)}function Te(e,t){xe.call(this,new Int16Array(e),t)}function Se(e,t){xe.call(this,new Uint16Array(e),t)}function Ee(e,t){xe.call(this,new Int32Array(e),t)}function Ce(e,t){xe.call(this,new Uint32Array(e),t)}function Pe(e,t){xe.call(this,new Float32Array(e),t)}function we(e,t){xe.call(this,new Float64Array(e),t)}function Ae(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Re(e){if(0===e.length)return-Infinity;for(var t=e[0],a=1,r=e.length;a<r;++a)e[a]>t&&(t=e[a]);return t}function Me(){Object.defineProperty(this,"id",{value:ye()}),this.uuid=vs.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:Infinity}}function Le(e,t,a,r,o,n){fe.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:a,widthSegments:r,heightSegments:o,depthSegments:n},this.fromBufferGeometry(new Be(e,t,a,r,o,n)),this.mergeVertices()}function Be(e,t,a,r,o,n){function i(e,t,r,o,n,i,u,f,v,_,T){var S=v+1,E=0,C=0,P=new m,w,A;for(A=0;A<_+1;A++){var R=A*(u/_)-u/2;for(w=0;w<S;w++){var y=w*(i/v)-i/2;P[e]=y*o,P[t]=R*n,P[r]=f/2,d.push(P.x,P.y,P.z),P[e]=0,P[t]=0,P[r]=0<f?1:-1,p.push(P.x,P.y,P.z),c.push(w/v),c.push(1-A/_),E+=1}}for(A=0;A<_;A++)for(w=0;w<v;w++){var x=g+w+S*A,a=g+w+S*(A+1),b=g+(w+1)+S*(A+1),M=g+(w+1)+S*A;l.push(x,a,M),l.push(a,b,M),C+=6}s.addGroup(h,C,T),h+=C,g+=E}Me.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:a,widthSegments:r,heightSegments:o,depthSegments:n};var s=this;r=on(r)||1,o=on(o)||1,n=on(n)||1;var l=[],d=[],p=[],c=[],g=0,h=0;i("z","y","x",-1,-1,a,t,e,n,o,0),i("z","y","x",1,-1,a,t,-e,n,o,1),i("x","z","y",1,1,e,a,t,r,n,2),i("x","z","y",1,-1,e,a,-t,r,n,3),i("x","y","z",1,-1,e,t,a,r,o,4),i("x","y","z",-1,-1,e,t,-a,r,o,5),this.setIndex(l),this.addAttribute("position",new Pe(d,3)),this.addAttribute("normal",new Pe(p,3)),this.addAttribute("uv",new Pe(c,2))}function De(e,t,a,r){fe.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:a,heightSegments:r},this.fromBufferGeometry(new Ie(e,t,a,r)),this.mergeVertices()}function Ie(e,t,r,o){Me.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:o};var n=on(r)||1,i=on(o)||1,s=n+1,l=[],p=[],u=[],m=[],g,h;for(h=0;h<i+1;h++){var f=h*(t/i)-t/2;for(g=0;g<s;g++){var v=g*(e/n)-e/2;p.push(v,-f,0),u.push(0,0,1),m.push(g/n),m.push(1-h/i)}}for(h=0;h<i;h++)for(g=0;g<n;g++){var x=g+s*h,a=g+s*(h+1),_=g+1+s*(h+1),c=g+1+s*h;l.push(x,a,c),l.push(a,_,c)}this.setIndex(l),this.addAttribute("position",new Pe(p,3)),this.addAttribute("normal",new Pe(u,3)),this.addAttribute("uv",new Pe(m,2))}function Fe(e){Q.call(this),this.type="MeshBasicMaterial",this.color=new q(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$n,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Oe(e,t){this.origin=e===void 0?new m:e,this.direction=t===void 0?new m:t}function Ue(e,t){this.start=e===void 0?new m:e,this.end=t===void 0?new m:t}function ke(e,t,a){this.a=e===void 0?new m:e,this.b=t===void 0?new m:t,this.c=a===void 0?new m:a}function Ge(e,t){ce.call(this),this.type="Mesh",this.geometry=e===void 0?new Me:e,this.material=t===void 0?new Fe({color:16777215*Math.random()}):t,this.drawMode=ss,this.updateMorphTargets()}function Ne(e,t,a,r){function o(t,r,o,c){var u=r.background;null===u?n(i,s):u&&u.isColor&&(n(u,1),c=!0),(e.autoClear||c)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),u&&u.isCubeTexture?(p===void 0&&(p=new Ge(new Be(1,1,1),new $({uniforms:Bs.cube.uniforms,vertexShader:Bs.cube.vertexShader,fragmentShader:Bs.cube.fragmentShader,side:fn,depthTest:!0,depthWrite:!1,polygonOffset:!0,fog:!1})),p.geometry.removeAttribute("normal"),p.geometry.removeAttribute("uv"),p.onBeforeRender=function(e,t,a){var r=a.far;this.matrixWorld.makeScale(r,r,r),this.matrixWorld.copyPosition(a.matrixWorld),this.material.polygonOffsetUnits=10*r},a.update(p.geometry)),p.material.uniforms.tCube.value=u,t.push(p,p.geometry,p.material,0,null)):u&&u.isTexture&&(d===void 0&&(d=new me(-1,1,1,-1,0,1),l=new Ge(new Ie(2,2),new Fe({depthTest:!1,depthWrite:!1,fog:!1})),a.update(l.geometry)),l.material.map=u,e.renderBufferDirect(d,null,l.geometry,l.material,l,null))}function n(e,a){t.buffers.color.setClear(e.r,e.g,e.b,a,r)}var i=new q(0),s=0,d,l,p;return{getClearColor:function(){return function(){return i}}(),setClearColor:function(){function e(e,t){i.set(e),s=t===void 0?1:t,n(i,s)}return e}(),getClearAlpha:function(){function e(){return s}return e}(),setClearAlpha:function(){function e(e){s=e,n(i,s)}return e}(),render:o}}function ze(e,t){return e.renderOrder===t.renderOrder?e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id===t.material.id?e.z===t.z?e.id-t.id:e.z-t.z:e.material.id-t.material.id:e.renderOrder-t.renderOrder}function We(e,t){return e.renderOrder===t.renderOrder?e.z===t.z?e.id-t.id:t.z-e.z:e.renderOrder-t.renderOrder}function He(){function e(e,n,i,s,d){var l=t[a];l===void 0?(l={id:e.id,object:e,geometry:n,material:i,program:i.program,renderOrder:e.renderOrder,z:s,group:d},t[a]=l):(l.id=e.id,l.object=e,l.geometry=n,l.material=i,l.program=i.program,l.renderOrder=e.renderOrder,l.z=s,l.group=d),(!0===i.transparent?o:r).push(l),a++}var t=[],a=0,r=[],o=[];return{opaque:r,transparent:o,init:function(){a=0,r.length=0,o.length=0},push:e,sort:function(){1<r.length&&r.sort(ze),1<o.length&&o.sort(We)}}}function Ve(){function e(e,a){var r=e.id+","+a.id,o=t[r];return void 0===o&&(o=new He,t[r]=o),o}var t={};return{get:e,dispose:function(){t={}}}}function Xe(e,t){return qo(t[1])-qo(e[1])}function je(e){var t={},a=new Float32Array(8);return{update:function(r,o,n,s){var d=r.morphTargetInfluences,l=d.length,p=t[o.id];if(p===void 0){p=[];for(var c=0;c<l;c++)p[c]=[c,0];t[o.id]=p}for(var i=n.morphTargets&&o.morphAttributes.position,u=n.morphNormals&&o.morphAttributes.normal,c=0,m;c<l;c++)m=p[c],0!==m[1]&&(i&&o.removeAttribute("morphTarget"+c),u&&o.removeAttribute("morphNormal"+c));for(var c=0,m;c<l;c++)m=p[c],m[0]=c,m[1]=d[c];p.sort(Xe);for(var c=0,m;8>c;c++){if(m=p[c],m){var g=m[0],h=m[1];if(h){i&&o.addAttribute("morphTarget"+c,i[g]),u&&o.addAttribute("morphNormal"+c,u[g]),a[c]=h;continue}}a[c]=0}s.getUniforms().setValue(e,"morphTargetInfluences",a)}}}function qe(e,t,a){function r(t,r){e.drawElements(n,r,i,t*s),a.calls++,a.vertices+=r,n===e.TRIANGLES?a.faces+=r/3:n===e.POINTS&&(a.points+=r)}function o(r,o,d){var l=t.get("ANGLE_instanced_arrays");return null===l?void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):void(l.drawElementsInstancedANGLE(n,d,i,o*s,r.maxInstancedCount),a.calls++,a.vertices+=d*r.maxInstancedCount,n===e.TRIANGLES?a.faces+=r.maxInstancedCount*d/3:n===e.POINTS&&(a.points+=r.maxInstancedCount*d))}var n,i,s;this.setMode=function(e){n=e},this.setIndex=function(e){i=e.type,s=e.bytesPerElement},this.render=r,this.renderInstances=o}function Ye(e,t,a){function r(t,r){e.drawArrays(n,t,r),a.calls++,a.vertices+=r,n===e.TRIANGLES?a.faces+=r/3:n===e.POINTS&&(a.points+=r)}function o(r,o,i){var s=t.get("ANGLE_instanced_arrays");if(null===s)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var d=r.attributes.position;d.isInterleavedBufferAttribute?(i=d.data.count,s.drawArraysInstancedANGLE(n,0,i,r.maxInstancedCount)):s.drawArraysInstancedANGLE(n,o,i,r.maxInstancedCount),a.calls++,a.vertices+=i*r.maxInstancedCount,n===e.TRIANGLES?a.faces+=r.maxInstancedCount*i/3:n===e.POINTS&&(a.points+=r.maxInstancedCount*i)}var n;this.setMode=function(e){n=e},this.render=r,this.renderInstances=o}function Ke(e,t,a){function r(e){var i=e.target,s=o[i.id];for(var d in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[d]);i.removeEventListener("dispose",r),delete o[i.id];var l=n[i.id];l&&(t.remove(l),delete n[i.id]),l=n[s.id],l&&(t.remove(l),delete n[s.id]),a.geometries--}var o={},n={};return{get:function(e,t){var n=o[t.id];return n?n:(t.addEventListener("dispose",r),t.isBufferGeometry?n=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=new Me().setFromObject(e)),n=t._bufferGeometry),o[t.id]=n,a.geometries++,n)},update:function(a){var r=a.index,o=a.attributes;for(var n in null!==r&&t.update(r,e.ELEMENT_ARRAY_BUFFER),o)t.update(o[n],e.ARRAY_BUFFER);var s=a.morphAttributes;for(var n in s)for(var d=s[n],p=0,i=d.length;p<i;p++)t.update(d[p],e.ARRAY_BUFFER)},getWireframeAttribute:function(r){var o=n[r.id];if(o)return o;var s=[],d=r.index,p=r.attributes;if(null!==d)for(var u=d.array,m=0,i=u.length;m<i;m+=3){var l=u[m+0],a=u[m+1],g=u[m+2];s.push(l,a,a,g,g,l)}else for(var u=p.position.array,m=0,i=u.length/3-1;m<i;m+=3){var l=m+0,a=m+1,g=m+2;s.push(l,a,a,g,g,l)}return o=new(65535<Re(s)?Ce:Se)(s,1),t.update(o,e.ELEMENT_ARRAY_BUFFER),n[r.id]=o,o}}}function Ze(){var e={};return{get:function(){return function(t){if(void 0!==e[t.id])return e[t.id];var a;switch(t.type){case"DirectionalLight":a={direction:new m,color:new q,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new r};break;case"SpotLight":a={position:new m,direction:new m,color:new q,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new r};break;case"PointLight":a={position:new m,color:new q,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new r,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":a={direction:new m,skyColor:new q,groundColor:new q};break;case"RectAreaLight":a={color:new q,position:new m,halfWidth:new m,halfHeight:new m};}return e[t.id]=a,a}}()}}function Je(){var e=new Ze,t={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},a=new m,r=new l,o=new l;return{setup:function(n,s,d){for(var p=0,c=0,u=0,m=0,g=0,h=0,y=0,f=0,x=d.matrixWorldInverse,v=0,i=n.length;v<i;v++){var l=n[v],_=l.color,b=l.intensity,T=l.distance,S=l.shadow&&l.shadow.map?l.shadow.map.texture:null;if(l.isAmbientLight)p+=_.r*b,c+=_.g*b,u+=_.b*b;else if(l.isDirectionalLight){var E=e.get(l);if(E.color.copy(l.color).multiplyScalar(l.intensity),E.direction.setFromMatrixPosition(l.matrixWorld),a.setFromMatrixPosition(l.target.matrixWorld),E.direction.sub(a),E.direction.transformDirection(x),E.shadow=l.castShadow,l.castShadow){var C=l.shadow;E.shadowBias=C.bias,E.shadowRadius=C.radius,E.shadowMapSize=C.mapSize}t.directionalShadowMap[m]=S,t.directionalShadowMatrix[m]=l.shadow.matrix,t.directional[m]=E,m++}else if(l.isSpotLight){var E=e.get(l);if(E.position.setFromMatrixPosition(l.matrixWorld),E.position.applyMatrix4(x),E.color.copy(_).multiplyScalar(b),E.distance=T,E.direction.setFromMatrixPosition(l.matrixWorld),a.setFromMatrixPosition(l.target.matrixWorld),E.direction.sub(a),E.direction.transformDirection(x),E.coneCos=Xo(l.angle),E.penumbraCos=Xo(l.angle*(1-l.penumbra)),E.decay=0===l.distance?0:l.decay,E.shadow=l.castShadow,l.castShadow){var C=l.shadow;E.shadowBias=C.bias,E.shadowRadius=C.radius,E.shadowMapSize=C.mapSize}t.spotShadowMap[h]=S,t.spotShadowMatrix[h]=l.shadow.matrix,t.spot[h]=E,h++}else if(l.isRectAreaLight){var E=e.get(l);E.color.copy(_).multiplyScalar(b/(l.width*l.height)),E.position.setFromMatrixPosition(l.matrixWorld),E.position.applyMatrix4(x),o.identity(),r.copy(l.matrixWorld),r.premultiply(x),o.extractRotation(r),E.halfWidth.set(.5*l.width,0,0),E.halfHeight.set(0,.5*l.height,0),E.halfWidth.applyMatrix4(o),E.halfHeight.applyMatrix4(o),t.rectArea[y]=E,y++}else if(l.isPointLight){var E=e.get(l);if(E.position.setFromMatrixPosition(l.matrixWorld),E.position.applyMatrix4(x),E.color.copy(l.color).multiplyScalar(l.intensity),E.distance=l.distance,E.decay=0===l.distance?0:l.decay,E.shadow=l.castShadow,l.castShadow){var C=l.shadow;E.shadowBias=C.bias,E.shadowRadius=C.radius,E.shadowMapSize=C.mapSize,E.shadowCameraNear=C.camera.near,E.shadowCameraFar=C.camera.far}t.pointShadowMap[g]=S,t.pointShadowMatrix[g]=l.shadow.matrix,t.point[g]=E,g++}else if(l.isHemisphereLight){var E=e.get(l);E.direction.setFromMatrixPosition(l.matrixWorld),E.direction.transformDirection(x),E.direction.normalize(),E.skyColor.copy(l.color).multiplyScalar(b),E.groundColor.copy(l.groundColor).multiplyScalar(b),t.hemi[f]=E,f++}}t.ambient[0]=p,t.ambient[1]=c,t.ambient[2]=u,t.directional.length=m,t.spot.length=h,t.rectArea.length=y,t.point.length=g,t.hemi.length=f,t.hash=m+","+g+","+h+","+y+","+f+","+s.length},state:t}}function Qe(e,t){function a(a){var o=t.frame,n=a.geometry,i=e.get(a,n);return r[i.id]!==o&&(n.isGeometry&&i.updateFromObject(a),e.update(i),r[i.id]=o),i}var r={};return{update:a,clear:function(){r={}}}}function $e(e){for(var t=e.split("\n"),a=0;a<t.length;a++)t[a]=a+1+": "+t[a];return t.join("\n")}function et(e,t,a){var r=e.createShader(t);return e.shaderSource(r,a),e.compileShader(r),!1===e.getShaderParameter(r,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(r)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(r),$e(a)),r}function tt(e){switch(e){case ps:return["Linear","( value )"];case cs:return["sRGB","( value )"];case ms:return["RGBE","( value )"];case gs:return["RGBM","( value, 7.0 )"];case hs:return["RGBM","( value, 16.0 )"];case ys:return["RGBD","( value, 256.0 )"];case us:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e);}}function at(e,t){var a=tt(t);return"vec4 "+e+"( vec4 value ) { return "+a[0]+"ToLinear"+a[1]+"; }"}function rt(e,t){var a=tt(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+a[0]+a[1]+"; }"}function ot(e,t){var a;switch(t){case ri:a="Linear";break;case oi:a="Reinhard";break;case ni:a="Uncharted2";break;case ii:a="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t);}return"vec3 "+e+"( vec3 color ) { return "+a+"ToneMapping( color ); }"}function nt(e,t,a){e=e||{};var r=[e.derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&a.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&a.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&a.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return r.filter(dt).join("\n")}function it(e){var t=[];for(var a in e){var r=e[a];!1===r||t.push("#define "+a+" "+r)}return t.join("\n")}function st(e,t){for(var a={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<r;o++){var n=e.getActiveAttrib(t,o),i=n.name;a[i]=e.getAttribLocation(t,i)}return a}function dt(e){return""!==e}function lt(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function pt(e){function t(e,t){var a=Ls[t];if(a===void 0)throw new Error("Can not resolve #include <"+t+">");return pt(a)}var a=/^[ \t]*#include +<([\w\d.]+)>/gm;return e.replace(a,t)}function ct(e){var t=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return e.replace(t,function(e,t,a,r){for(var o="",n=parseInt(t);n<parseInt(a);n++)o+=r.replace(/\[ i \]/g,"[ "+n+" ]");return o})}function ut(e,t,a,r,o,n){var i=e.context,s=r.defines,d=o.vertexShader,l=o.fragmentShader,p="SHADOWMAP_TYPE_BASIC";n.shadowMapType===gn?p="SHADOWMAP_TYPE_PCF":n.shadowMapType===hn&&(p="SHADOWMAP_TYPE_PCF_SOFT");var c="ENVMAP_TYPE_CUBE",u="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(n.envMap){switch(r.envMap.mapping){case di:case li:c="ENVMAP_TYPE_CUBE";break;case mi:case gi:c="ENVMAP_TYPE_CUBE_UV";break;case pi:case ci:c="ENVMAP_TYPE_EQUIREC";break;case ui:c="ENVMAP_TYPE_SPHERE";}switch(r.envMap.mapping){case li:case ci:u="ENVMAP_MODE_REFRACTION";}switch(r.combine){case $n:m="ENVMAP_BLENDING_MULTIPLY";break;case ei:m="ENVMAP_BLENDING_MIX";break;case ti:m="ENVMAP_BLENDING_ADD";}}var g=0<e.gammaFactor?e.gammaFactor:1,h=nt(r.extensions,n,t),y=it(s),f=i.createProgram(),x,v;r.isRawShaderMaterial?(x=[y,"\n"].filter(dt).join("\n"),v=[h,y,"\n"].filter(dt).join("\n")):(x=["precision "+n.precision+" float;","precision "+n.precision+" int;","#define SHADER_NAME "+o.name,y,n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+n.numClippingPlanes,n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+p:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(dt).join("\n"),v=[h,"precision "+n.precision+" float;","precision "+n.precision+" int;","#define SHADER_NAME "+o.name,y,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"","#define GAMMA_FACTOR "+g,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+u:"",n.envMap?"#define "+m:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexColors?"#define USE_COLOR":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+n.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(n.numClippingPlanes-n.numClipIntersection),n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+p:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",n.envMap&&t.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",n.toneMapping===ai?"":"#define TONE_MAPPING",n.toneMapping===ai?"":Ls.tonemapping_pars_fragment,n.toneMapping===ai?"":ot("toneMapping",n.toneMapping),n.dithering?"#define DITHERING":"",n.outputEncoding||n.mapEncoding||n.envMapEncoding||n.emissiveMapEncoding?Ls.encodings_pars_fragment:"",n.mapEncoding?at("mapTexelToLinear",n.mapEncoding):"",n.envMapEncoding?at("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?at("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.outputEncoding?rt("linearToOutputTexel",n.outputEncoding):"",n.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(dt).join("\n")),d=pt(d),d=lt(d,n),l=pt(l),l=lt(l,n),r.isShaderMaterial||(d=ct(d),l=ct(l));var _=x+d,b=v+l,T=et(i,i.VERTEX_SHADER,_),S=et(i,i.FRAGMENT_SHADER,b);i.attachShader(f,T),i.attachShader(f,S),void 0===r.index0AttributeName?!0===n.morphTargets&&i.bindAttribLocation(f,0,"position"):i.bindAttribLocation(f,0,r.index0AttributeName),i.linkProgram(f);var E=i.getProgramInfoLog(f),C=i.getShaderInfoLog(T),P=i.getShaderInfoLog(S),w=!0,A=!0;!1===i.getProgramParameter(f,i.LINK_STATUS)?(w=!1,console.error("THREE.WebGLProgram: shader error: ",i.getError(),"gl.VALIDATE_STATUS",i.getProgramParameter(f,i.VALIDATE_STATUS),"gl.getProgramInfoLog",E,C,P)):""===E?(""===C||""===P)&&(A=!1):console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",E),A&&(this.diagnostics={runnable:w,material:r,programLog:E,vertexShader:{log:C,prefix:x},fragmentShader:{log:P,prefix:v}}),i.deleteShader(T),i.deleteShader(S);var R;this.getUniforms=function(){return void 0==R&&(R=new j(i,f,e)),R};var M;return this.getAttributes=function(){return void 0===M&&(M=st(i,f)),M},this.destroy=function(){i.deleteProgram(f),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}}()},attributes:{get:function(){return function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}()}}),this.id=Os++,this.code=a,this.usedTimes=1,this.program=f,this.vertexShader=T,this.fragmentShader=S,this}function mt(e,t,a){function r(e){var t=e.skeleton,r=t.bones;if(a.floatVertexTextures)return 1024;var o=a.maxVertexUniforms,n=on((o-20)/4),i=tn(n,r.length);return i<r.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+r.length+" bones. This GPU supports "+i+"."),0):i}function o(e,t){var a;return e?e.isTexture?a=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),a=e.texture.encoding):a=ps,a===ps&&t&&(a=us),a}var n=[],i={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},s=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];this.getParameters=function(t,n,s,d,l,p,c){var u=i[t.type],m=c.isSkinnedMesh?r(c):0,g=a.precision;null!==t.precision&&(g=a.getMaxPrecision(t.precision),g!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",g,"instead."));var h=e.getRenderTarget(),y={shaderID:u,precision:g,supportsVertexTextures:a.vertexTextures,outputEncoding:o(h?h.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:o(t.map,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:o(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===mi||t.envMap.mapping===gi),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:o(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!d,useFog:t.fog,fogExp:d&&d.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:a.logarithmicDepthBuffer,skinning:t.skinning&&0<m,maxBones:m,useVertexTexture:a.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numClippingPlanes:l,numClipIntersection:p,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.receiveShadow&&0<s.length,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===xn,flipSided:t.side===fn,depthPacking:t.depthPacking!==void 0&&t.depthPacking};return y},this.getProgramCode=function(t,a){var r=[];if(a.shaderID?r.push(a.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var o in t.defines)r.push(o),r.push(t.defines[o]);for(var n=0;n<s.length;n++)r.push(a[s[n]]);return r.push(t.onBeforeCompile.toString()),r.push(e.gammaOutput),r.join()},this.acquireProgram=function(a,r,o,i){for(var s=0,d=n.length,l,p;s<d;s++)if(p=n[s],p.code===i){l=p,++l.usedTimes;break}return void 0===l&&(l=new ut(e,t,i,a,r,o),n.push(l)),l},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n}function gt(e,t,a,r,o,n,s){function d(e,t){if(e.width>t||e.height>t){var a=t/en(e.width,e.height),r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=on(e.width*a),r.height=on(e.height*a);var o=r.getContext("2d");return o.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height,e),r}return e}function l(e){return vs.isPowerOfTwo(e.width)&&vs.isPowerOfTwo(e.height)}function p(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");t.width=vs.nearestPowerOfTwo(e.width),t.height=vs.nearestPowerOfTwo(e.height);var a=t.getContext("2d");return a.drawImage(e,0,0,t.width,t.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}function c(e){return e.wrapS!==yi||e.wrapT!==yi||e.minFilter!==xi&&e.minFilter!==bi}function u(e,t){return e.generateMipmaps&&t&&e.minFilter!==xi&&e.minFilter!==bi}function i(t){return t===xi||t===vi||t===_i?e.NEAREST:e.LINEAR}function m(e){var t=e.target;t.removeEventListener("dispose",m),h(t),s.textures--}function g(e){var t=e.target;t.removeEventListener("dispose",g),y(t),s.textures--}function h(t){var a=r.get(t);if(t.image&&a.__image__webglTextureCube)e.deleteTexture(a.__image__webglTextureCube);else{if(a.__webglInit===void 0)return;e.deleteTexture(a.__webglTexture)}r.remove(t)}function y(t){var a=r.get(t),o=r.get(t.texture);if(t){if(void 0!==o.__webglTexture&&e.deleteTexture(o.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var n=0;6>n;n++)e.deleteFramebuffer(a.__webglFramebuffer[n]),a.__webglDepthbuffer&&e.deleteRenderbuffer(a.__webglDepthbuffer[n]);else e.deleteFramebuffer(a.__webglFramebuffer),a.__webglDepthbuffer&&e.deleteRenderbuffer(a.__webglDepthbuffer);r.remove(t.texture),r.remove(t)}}function f(t,o){var n=r.get(t);if(0<t.version&&n.__version!==t.version){var i=t.image;if(i===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else if(!1===i.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t);else return void v(n,t,o)}a.activeTexture(e.TEXTURE0+o),a.bindTexture(e.TEXTURE_2D,n.__webglTexture)}function x(a,s,d){var l;if(d?(e.texParameteri(a,e.TEXTURE_WRAP_S,n.convert(s.wrapS)),e.texParameteri(a,e.TEXTURE_WRAP_T,n.convert(s.wrapT)),e.texParameteri(a,e.TEXTURE_MAG_FILTER,n.convert(s.magFilter)),e.texParameteri(a,e.TEXTURE_MIN_FILTER,n.convert(s.minFilter))):(e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(s.wrapS!==yi||s.wrapT!==yi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",s),e.texParameteri(a,e.TEXTURE_MAG_FILTER,i(s.magFilter)),e.texParameteri(a,e.TEXTURE_MIN_FILTER,i(s.minFilter)),s.minFilter!==xi&&s.minFilter!==bi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",s)),l=t.get("EXT_texture_filter_anisotropic"),l){if(s.type===Mi&&null===t.get("OES_texture_float_linear"))return;if(s.type===Li&&null===t.get("OES_texture_half_float_linear"))return;(1<s.anisotropy||r.get(s).__currentAnisotropy)&&(e.texParameterf(a,l.TEXTURE_MAX_ANISOTROPY_EXT,tn(s.anisotropy,o.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy)}}function v(t,r,g){t.__webglInit===void 0&&(t.__webglInit=!0,r.addEventListener("dispose",m),t.__webglTexture=e.createTexture(),s.textures++),a.activeTexture(e.TEXTURE0+g),a.bindTexture(e.TEXTURE_2D,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment);var h=d(r.image,o.maxTextureSize);c(r)&&!1===l(h)&&(h=p(h));var y=l(h),f=n.convert(r.format),v=n.convert(r.type);x(e.TEXTURE_2D,r,y);var _=r.mipmaps,b;if(r.isDepthTexture){var T=e.DEPTH_COMPONENT;if(r.type===Mi){if(!E)throw new Error("Float Depth Texture only supported in WebGL2.0");T=e.DEPTH_COMPONENT32F}else E&&(T=e.DEPTH_COMPONENT16);r.format===zi&&T===e.DEPTH_COMPONENT&&r.type!==wi&&r.type!==Ri&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=wi,v=n.convert(r.type)),r.format===Wi&&(T=e.DEPTH_STENCIL,r.type!==Fi&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=Fi,v=n.convert(r.type))),a.texImage2D(e.TEXTURE_2D,0,T,h.width,h.height,0,f,v,null)}else if(r.isDataTexture){if(0<_.length&&y){for(var S=0,i=_.length;S<i;S++)b=_[S],a.texImage2D(e.TEXTURE_2D,S,f,b.width,b.height,0,f,v,b.data);r.generateMipmaps=!1}else a.texImage2D(e.TEXTURE_2D,0,f,h.width,h.height,0,f,v,h.data);}else if(r.isCompressedTexture)for(var S=0,i=_.length;S<i;S++)b=_[S],r.format!==ki&&r.format!==Ui?-1<a.getCompressedTextureFormats().indexOf(f)?a.compressedTexImage2D(e.TEXTURE_2D,S,f,b.width,b.height,0,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):a.texImage2D(e.TEXTURE_2D,S,f,b.width,b.height,0,f,v,b.data);else if(0<_.length&&y){for(var S=0,i=_.length;S<i;S++)b=_[S],a.texImage2D(e.TEXTURE_2D,S,f,f,v,b);r.generateMipmaps=!1}else a.texImage2D(e.TEXTURE_2D,0,f,f,v,h);u(r,y)&&e.generateMipmap(e.TEXTURE_2D),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function _(t,o,i,s){var d=n.convert(o.texture.format),l=n.convert(o.texture.type);a.texImage2D(s,0,d,o.width,o.height,0,d,l,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,i,s,r.get(o.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function b(t,a){e.bindRenderbuffer(e.RENDERBUFFER,t),a.depthBuffer&&!a.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,a.width,a.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):a.depthBuffer&&a.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,a.width,a.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,a.width,a.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}function T(t,a){var o=a&&a.isWebGLRenderTargetCube;if(o)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!(a.depthTexture&&a.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(a.depthTexture).__webglTexture&&a.depthTexture.image.width===a.width&&a.depthTexture.image.height===a.height||(a.depthTexture.image.width=a.width,a.depthTexture.image.height=a.height,a.depthTexture.needsUpdate=!0),f(a.depthTexture,0);var n=r.get(a.depthTexture).__webglTexture;if(a.depthTexture.format===zi)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,n,0);else if(a.depthTexture.format===Wi)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,n,0);else throw new Error("Unknown depthTexture format")}function S(t){var a=r.get(t),o=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(o)throw new Error("target.depthTexture not supported in Cube render targets");T(a.__webglFramebuffer,t)}else if(o){a.__webglDepthbuffer=[];for(var n=0;6>n;n++)e.bindFramebuffer(e.FRAMEBUFFER,a.__webglFramebuffer[n]),a.__webglDepthbuffer[n]=e.createRenderbuffer(),b(a.__webglDepthbuffer[n],t)}else e.bindFramebuffer(e.FRAMEBUFFER,a.__webglFramebuffer),a.__webglDepthbuffer=e.createRenderbuffer(),b(a.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}var E="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext;this.setTexture2D=f,this.setTextureCube=function(t,p){var c=r.get(t);if(6===t.image.length)if(0<t.version&&c.__version!==t.version){c.__image__webglTextureCube||(t.addEventListener("dispose",m),c.__image__webglTextureCube=e.createTexture(),s.textures++),a.activeTexture(e.TEXTURE0+p),a.bindTexture(e.TEXTURE_CUBE_MAP,c.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var g=t&&t.isCompressedTexture,h=t.image[0]&&t.image[0].isDataTexture,y=[],f=0;6>f;f++)y[f]=g||h?h?t.image[f].image:t.image[f]:d(t.image[f],o.maxCubemapSize);var i=y[0],v=l(i),_=n.convert(t.format),b=n.convert(t.type);x(e.TEXTURE_CUBE_MAP,t,v);for(var f=0;6>f;f++)if(!g)h?a.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,_,y[f].width,y[f].height,0,_,b,y[f].data):a.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,_,_,b,y[f]);else for(var T=y[f].mipmaps,S=0,E=T.length,C;S<E;S++)C=T[S],t.format!==ki&&t.format!==Ui?-1<a.getCompressedTextureFormats().indexOf(_)?a.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,S,_,C.width,C.height,0,C.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):a.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+f,S,_,C.width,C.height,0,_,b,C.data);u(t,v)&&e.generateMipmap(e.TEXTURE_CUBE_MAP),c.__version=t.version,t.onUpdate&&t.onUpdate(t)}else a.activeTexture(e.TEXTURE0+p),a.bindTexture(e.TEXTURE_CUBE_MAP,c.__image__webglTextureCube)},this.setTextureCubeDynamic=function(t,o){a.activeTexture(e.TEXTURE0+o),a.bindTexture(e.TEXTURE_CUBE_MAP,r.get(t).__webglTexture)},this.setupRenderTarget=function(t){var o=r.get(t),n=r.get(t.texture);t.addEventListener("dispose",g),n.__webglTexture=e.createTexture(),s.textures++;var d=!0===t.isWebGLRenderTargetCube,p=l(t);if(d){o.__webglFramebuffer=[];for(var c=0;6>c;c++)o.__webglFramebuffer[c]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(d){a.bindTexture(e.TEXTURE_CUBE_MAP,n.__webglTexture),x(e.TEXTURE_CUBE_MAP,t.texture,p);for(var c=0;6>c;c++)_(o.__webglFramebuffer[c],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+c);u(t.texture,p)&&e.generateMipmap(e.TEXTURE_CUBE_MAP),a.bindTexture(e.TEXTURE_CUBE_MAP,null)}else a.bindTexture(e.TEXTURE_2D,n.__webglTexture),x(e.TEXTURE_2D,t.texture,p),_(o.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),u(t.texture,p)&&e.generateMipmap(e.TEXTURE_2D),a.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&S(t)},this.updateRenderTargetMipmap=function(t){var o=t.texture,n=l(t);if(u(o,n)){var i=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=r.get(o).__webglTexture;a.bindTexture(i,s),e.generateMipmap(i),a.bindTexture(i,null)}}}function ht(){function e(e){var t=e.uuid,r=a[t];return void 0===r&&(r={},a[t]=r),r}function t(e){delete a[e.uuid]}var a={};return{get:e,remove:t,clear:function(){a={}}}}function yt(e,t,a){function r(t,a,r){var o=new Uint8Array(4),n=e.createTexture();e.bindTexture(t,n),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var s=0;s<r;s++)e.texImage2D(a+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,o);return n}function o(t){!0!==C[t]&&(e.enable(t),C[t]=!0)}function i(t){!1!==C[t]&&(e.disable(t),C[t]=!1)}function s(){if(null===P&&(P=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")))for(var a=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),r=0;r<a.length;r++)P.push(a[r]);return P}function d(t){return w!==t&&(e.useProgram(t),w=t,!0)}function l(t,r,n,s,d,l,p,c){t===Sn?i(e.BLEND):o(e.BLEND),t===An?(d=d||r,l=l||n,p=p||s,(r!==R||d!==B)&&(e.blendEquationSeparate(a.convert(r),a.convert(d)),R=r,B=d),(n!==M||s!==L||l!==D||p!==I)&&(e.blendFuncSeparate(a.convert(n),a.convert(s),a.convert(l),a.convert(p)),M=n,L=s,D=l,I=p)):((t!==A||c!==F)&&(t===Cn?c?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):t===Pn?c?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):t===wn?c?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):c?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA))),R=null,M=null,L=null,B=null,D=null,I=null),A=t,F=c}function p(t){O!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),O=t)}function c(t){t===pn?i(e.CULL_FACE):(o(e.CULL_FACE),t!==U&&(t===cn?e.cullFace(e.BACK):t===un?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))),U=t}function u(t){t!==k&&(H&&e.lineWidth(t),k=t)}function m(t,a,r){t?(o(e.POLYGON_OFFSET_FILL),(G!==a||N!==r)&&(e.polygonOffset(a,r),G=a,N=r)):i(e.POLYGON_OFFSET_FILL)}function g(t){void 0===t&&(t=e.TEXTURE0+z-1),V!==t&&(e.activeTexture(t),V=t)}function h(t,a){null===V&&g();var r=X[V];void 0===r&&(r={type:void 0,texture:void 0},X[V]=r),(r.type!==t||r.texture!==a)&&(e.bindTexture(t,a||Y[t]),r.type=t,r.texture=a)}function y(t){!1===j.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),j.copy(t))}function f(t){!1===q.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),q.copy(t))}var x=new function(){var t=!1,o=new n,a=null,i=new n(0,0,0,0);return{setMask:function(){function r(r){a===r||t||(e.colorMask(r,r,r,r),a=r)}return r}(),setLocked:function(){return function(e){t=e}}(),setClear:function(){return function(t,r,n,s,a){!0===a&&(t*=s,r*=s,n*=s),o.set(t,r,n,s),!1===i.equals(o)&&(e.clearColor(t,r,n,s),i.copy(o))}}(),reset:function(){return function(){t=!1,a=null,i.set(-1,0,0,0)}}()}},v=new function(){var t=!1,a=null,r=null,n=null;return{setTest:function(){return function(t){t?o(e.DEPTH_TEST):i(e.DEPTH_TEST)}}(),setMask:function(){function r(r){a===r||t||(e.depthMask(r),a=r)}return r}(),setFunc:function(){function t(t){r!==t&&(t?t===Xn?e.depthFunc(e.NEVER):t===jn?e.depthFunc(e.ALWAYS):t===qn?e.depthFunc(e.LESS):t===Yn?e.depthFunc(e.LEQUAL):t===Kn?e.depthFunc(e.EQUAL):t===Zn?e.depthFunc(e.GEQUAL):t===Jn?e.depthFunc(e.GREATER):t===Qn?e.depthFunc(e.NOTEQUAL):e.depthFunc(e.LEQUAL):e.depthFunc(e.LEQUAL),r=t)}return t}(),setLocked:function(){return function(e){t=e}}(),setClear:function(){function t(t){n!==t&&(e.clearDepth(t),n=t)}return t}(),reset:function(){return function(){t=!1,a=null,r=null,n=null}}()}},_=new function(){var t=!1,a=null,r=null,n=null,s=null,d=null,l=null,p=null,c=null;return{setTest:function(){return function(t){t?o(e.STENCIL_TEST):i(e.STENCIL_TEST)}}(),setMask:function(){function r(r){a===r||t||(e.stencilMask(r),a=r)}return r}(),setFunc:function(){function t(t,a,o){(r!==t||n!==a||s!==o)&&(e.stencilFunc(t,a,o),r=t,n=a,s=o)}return t}(),setOp:function(){function t(t,a,r){(d!==t||l!==a||p!==r)&&(e.stencilOp(t,a,r),d=t,l=a,p=r)}return t}(),setLocked:function(){return function(e){t=e}}(),setClear:function(){function t(t){c!==t&&(e.clearStencil(t),c=t)}return t}(),reset:function(){return function(){t=!1,a=null,r=null,n=null,s=null,d=null,l=null,p=null,c=null}}()}},b=e.getParameter(e.MAX_VERTEX_ATTRIBS),T=new Uint8Array(b),S=new Uint8Array(b),E=new Uint8Array(b),C={},P=null,w=null,A=null,R=null,M=null,L=null,B=null,D=null,I=null,F=!1,O=null,U=null,k=null,G=null,N=null,z=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),W=parseFloat(/^WebGL\ ([0-9])/.exec(e.getParameter(e.VERSION))[1]),H=1<=parseFloat(W),V=null,X={},j=new n,q=new n,Y={};return Y[e.TEXTURE_2D]=r(e.TEXTURE_2D,e.TEXTURE_2D,1),Y[e.TEXTURE_CUBE_MAP]=r(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),x.setClear(0,0,0,1),v.setClear(1),_.setClear(0),o(e.DEPTH_TEST),v.setFunc(Yn),p(!1),c(cn),o(e.CULL_FACE),o(e.BLEND),l(En),{buffers:{color:x,depth:v,stencil:_},initAttributes:function(){for(var e=0,t=T.length;e<t;e++)T[e]=0},enableAttribute:function(a){if(T[a]=1,0===S[a]&&(e.enableVertexAttribArray(a),S[a]=1),0!==E[a]){var r=t.get("ANGLE_instanced_arrays");r.vertexAttribDivisorANGLE(a,0),E[a]=0}},enableAttributeAndDivisor:function(a,r){if(T[a]=1,0===S[a]&&(e.enableVertexAttribArray(a),S[a]=1),E[a]!==r){var o=t.get("ANGLE_instanced_arrays");o.vertexAttribDivisorANGLE(a,r),E[a]=r}},disableUnusedAttributes:function(){for(var t=0,a=S.length;t!==a;++t)S[t]!==T[t]&&(e.disableVertexAttribArray(t),S[t]=0)},enable:o,disable:i,getCompressedTextureFormats:s,useProgram:d,setBlending:l,setMaterial:function(t){t.side===xn?i(e.CULL_FACE):o(e.CULL_FACE),p(t.side===fn),!0===t.transparent?l(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):l(Sn),v.setFunc(t.depthFunc),v.setTest(t.depthTest),v.setMask(t.depthWrite),x.setMask(t.colorWrite),m(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:p,setCullFace:c,setLineWidth:u,setPolygonOffset:m,setScissorTest:function(t){t?o(e.SCISSOR_TEST):i(e.SCISSOR_TEST)},activeTexture:g,bindTexture:h,compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:y,viewport:f,reset:function(){for(var t=0;t<S.length;t++)1===S[t]&&(e.disableVertexAttribArray(t),S[t]=0);C={},P=null,V=null,X={},w=null,A=null,O=null,U=null,x.reset(),v.reset(),_.reset()}}}function ft(e,t,a){function r(){if(void 0!==s)return s;var a=t.get("EXT_texture_filter_anisotropic");return s=null===a?0:e.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY_EXT),s}function o(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision)return"highp";t="mediump"}return"mediump"===t&&0<e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision&&0<e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision?"mediump":"lowp"}var n=a.precision===void 0?"highp":a.precision,i=o(n),s;i!==n&&(console.warn("THREE.WebGLRenderer:",n,"not supported, using",i,"instead."),n=i);var d=!0===a.logarithmicDepthBuffer&&!!t.get("EXT_frag_depth"),l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),p=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_TEXTURE_SIZE),u=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),m=e.getParameter(e.MAX_VERTEX_ATTRIBS),g=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),h=e.getParameter(e.MAX_VARYING_VECTORS),y=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),f=0<p,x=!!t.get("OES_texture_float");return{getMaxAnisotropy:r,getMaxPrecision:o,precision:n,logarithmicDepthBuffer:d,maxTextures:l,maxVertexTextures:p,maxTextureSize:c,maxCubemapSize:u,maxAttributes:m,maxVertexUniforms:g,maxVaryings:h,maxFragmentUniforms:y,vertexTextures:f,floatFragmentTextures:x,floatVertexTextures:f&&x}}function xt(e){ge.call(this),this.cameras=e||[]}function vt(e){function t(){if(null!==r&&r.isPresenting){var t=r.getEyeParameters("left"),o=t.renderWidth,n=t.renderHeight;g=e.getPixelRatio(),m=e.getSize(),e.setDrawingBufferSize(2*o,n,1)}else a.enabled&&e.setDrawingBufferSize(m.width,m.height,g)}var a=this,r=null,o=null;"VRFrameData"in window&&(o=new window.VRFrameData);var i=new l,s=new l,d=new l,p=new ge;p.bounds=new n(0,0,.5,1),p.layers.enable(1);var c=new ge;c.bounds=new n(.5,0,.5,1),c.layers.enable(2);var u=new xt([p,c]);u.layers.enable(1),u.layers.enable(2);var m,g;window.addEventListener("vrdisplaypresentchange",t,!1),this.enabled=!1,this.standing=!1,this.getDevice=function(){return r},this.setDevice=function(e){e!==void 0&&(r=e)},this.getCamera=function(e){if(null===r)return e;r.depthNear=e.near,r.depthFar=e.far,r.getFrameData(o);var t=o.pose;null===t.position?e.position.set(0,0,0):e.position.fromArray(t.position),null!==t.orientation&&e.quaternion.fromArray(t.orientation),e.updateMatrixWorld();var a=r.stageParameters;if(this.standing&&a&&(s.fromArray(a.sittingToStandingTransform),d.getInverse(s),e.matrixWorld.multiply(s),e.matrixWorldInverse.multiply(d)),!1===r.isPresenting)return e;p.near=e.near,c.near=e.near,p.far=e.far,c.far=e.far,u.matrixWorld.copy(e.matrixWorld),u.matrixWorldInverse.copy(e.matrixWorldInverse),p.matrixWorldInverse.fromArray(o.leftViewMatrix),c.matrixWorldInverse.fromArray(o.rightViewMatrix),this.standing&&a&&(p.matrixWorldInverse.multiply(d),c.matrixWorldInverse.multiply(d));var n=e.parent;null!==n&&(i.getInverse(n.matrixWorld),p.matrixWorldInverse.multiply(i),c.matrixWorldInverse.multiply(i)),p.matrixWorld.getInverse(p.matrixWorldInverse),c.matrixWorld.getInverse(c.matrixWorldInverse),p.projectionMatrix.fromArray(o.leftProjectionMatrix),c.projectionMatrix.fromArray(o.rightProjectionMatrix),u.projectionMatrix.copy(p.projectionMatrix);var l=r.getLayers();if(l.length){var m=l[0];null!==m.leftBounds&&4===m.leftBounds.length&&p.bounds.fromArray(m.leftBounds),null!==m.rightBounds&&4===m.rightBounds.length&&c.bounds.fromArray(m.rightBounds)}return u},this.getStandingMatrix=function(){return s},this.submitFrame=function(){r&&r.isPresenting&&r.submitFrame()},this.dispose=function(){window.removeEventListener("vrdisplaypresentchange",t)}}function _t(e){var t={};return{get:function(){return function(a){if(void 0!==t[a])return t[a];var r;return r="WEBGL_depth_texture"===a?e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture"):"EXT_texture_filter_anisotropic"===a?e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"):"WEBGL_compressed_texture_s3tc"===a?e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"):"WEBGL_compressed_texture_pvrtc"===a?e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"):"WEBGL_compressed_texture_etc1"===a?e.getExtension("WEBGL_compressed_texture_etc1"):e.getExtension(a),null===r&&console.warn("THREE.WebGLRenderer: "+a+" extension not supported."),t[a]=r,r}}()}}function bt(){function e(){p.value!==r&&(p.value=r,p.needsUpdate=0<o),a.numPlanes=o,a.numIntersection=0}function t(e,t,r,o){var n=null===e?0:e.length,s=null;if(0!==n){if(s=p.value,!0!==o||null===s){var c=r+4*n,u=t.matrixWorldInverse;l.getNormalMatrix(u),(null===s||s.length<c)&&(s=new Float32Array(c));for(var m=0,i=r;m!==n;++m,i+=4)d.copy(e[m]).applyMatrix4(u,l),d.normal.toArray(s,i),s[i+3]=d.constant}p.value=s,p.needsUpdate=!0}return a.numPlanes=n,s}var a=this,r=null,o=0,n=!1,s=!1,d=new ne,l=new oe,p={value:null,needsUpdate:!1};this.uniform=p,this.numPlanes=0,this.numIntersection=0,this.init=function(e,a,i){var s=0!==e.length||a||0!==o||n;return n=a,r=t(e,i,0),o=e.length,s},this.beginShadows=function(){s=!0,t(null)},this.endShadows=function(){s=!1,e()},this.setState=function(a,d,l,c,u,m){if(!n||null===a||0===a.length||s&&!l)s?t(null):e();else{var g=s?0:o,h=4*g,y=u.clippingState||null;p.value=y,y=t(a,c,h,m);for(var f=0;f!==h;++f)y[f]=r[f];u.clippingState=y,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=g}}}function Tt(e,t){return{convert:function(a){var r;if(a===hi)return e.REPEAT;if(a===yi)return e.CLAMP_TO_EDGE;if(a===fi)return e.MIRRORED_REPEAT;if(a===xi)return e.NEAREST;if(a===vi)return e.NEAREST_MIPMAP_NEAREST;if(a===_i)return e.NEAREST_MIPMAP_LINEAR;if(a===bi)return e.LINEAR;if(a===Ti)return e.LINEAR_MIPMAP_NEAREST;if(a===Si)return e.LINEAR_MIPMAP_LINEAR;if(a===Ei)return e.UNSIGNED_BYTE;if(a===Bi)return e.UNSIGNED_SHORT_4_4_4_4;if(a===Di)return e.UNSIGNED_SHORT_5_5_5_1;if(a===Ii)return e.UNSIGNED_SHORT_5_6_5;if(a===Ci)return e.BYTE;if(a===Pi)return e.SHORT;if(a===wi)return e.UNSIGNED_SHORT;if(a===Ai)return e.INT;if(a===Ri)return e.UNSIGNED_INT;if(a===Mi)return e.FLOAT;if(a===Li&&(r=t.get("OES_texture_half_float"),null!==r))return r.HALF_FLOAT_OES;if(a===Oi)return e.ALPHA;if(a===Ui)return e.RGB;if(a===ki)return e.RGBA;if(a===Gi)return e.LUMINANCE;if(a===Ni)return e.LUMINANCE_ALPHA;if(a===zi)return e.DEPTH_COMPONENT;if(a===Wi)return e.DEPTH_STENCIL;if(a===Rn)return e.FUNC_ADD;if(a===Mn)return e.FUNC_SUBTRACT;if(a===Ln)return e.FUNC_REVERSE_SUBTRACT;if(a===In)return e.ZERO;if(a===Fn)return e.ONE;if(a===On)return e.SRC_COLOR;if(a===Un)return e.ONE_MINUS_SRC_COLOR;if(a===kn)return e.SRC_ALPHA;if(a===Gn)return e.ONE_MINUS_SRC_ALPHA;if(a===Nn)return e.DST_ALPHA;if(a===zn)return e.ONE_MINUS_DST_ALPHA;if(a===Wn)return e.DST_COLOR;if(a===Hn)return e.ONE_MINUS_DST_COLOR;if(a===Vn)return e.SRC_ALPHA_SATURATE;if((a===Hi||a===Vi||a===Xi||a===ji)&&(r=t.get("WEBGL_compressed_texture_s3tc"),null!==r)){if(a===Hi)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===Vi)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===Xi)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===ji)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((a===qi||a===Yi||a===Ki||a===Zi)&&(r=t.get("WEBGL_compressed_texture_pvrtc"),null!==r)){if(a===qi)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===Yi)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===Ki)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===Zi)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(a===Ji&&(r=t.get("WEBGL_compressed_texture_etc1"),null!==r))return r.COMPRESSED_RGB_ETC1_WEBGL;if((a===Bn||a===Dn)&&(r=t.get("EXT_blend_minmax"),null!==r)){if(a===Bn)return r.MIN_EXT;if(a===Dn)return r.MAX_EXT}return a===Fi&&(r=t.get("WEBGL_depth_texture"),null!==r)?r.UNSIGNED_INT_24_8_WEBGL:0}}}function St(e){function t(){return null===ee?he:1}function a(){Re=new _t(we),Re.get("WEBGL_depth_texture"),Re.get("OES_texture_float"),Re.get("OES_texture_float_linear"),Re.get("OES_texture_half_float"),Re.get("OES_texture_half_float_linear"),Re.get("OES_standard_derivatives"),Re.get("ANGLE_instanced_arrays"),Re.get("OES_element_index_uint")&&(Me.MaxIndex=4294967296),tt=new Tt(we,Re),Le=new ft(we,Re,e),Be=new yt(we,Re,tt),Be.scissor(pe.copy(fe).multiplyScalar(he)),Be.viewport(le.copy(ye).multiplyScalar(he)),De=new ht,Ie=new gt(we,Re,Be,De,Le,tt,Ce),Fe=new de(we),Oe=new Ke(we,Fe,Ce),Ue=new Qe(Oe,Pe),He=new je(we),Ge=new mt(Q,Re,Le),ke=new Je,ze=new Ve,We=new Ne(Q,Be,Oe,W),Xe=new Ye(we,Re,Pe),Ze=new qe(we,Re,Pe),$e=new K(Q,we,Be,Ie,Le),et=new J(Q,we,Be,Ie,Le),Q.info.programs=Ge.programs,Q.context=we,Q.capabilities=Le,Q.extensions=Re,Q.properties=De,Q.renderLists=ze,Q.state=Be}function r(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),$=!0}function o(){console.log("THREE.WebGLRenderer: Context Restored."),$=!1,a()}function s(e){var t=e.target;t.removeEventListener("dispose",s),i(t)}function i(e){d(e),De.remove(e)}function d(e){var t=De.get(e).program;e.program=void 0,t!==void 0&&Ge.releaseProgram(t)}function c(e,t,a){e.render(function(e){Q.renderBufferImmediate(e,t,a)})}function u(e,t,a,r){if(a&&a.isInstancedBufferGeometry&&null===Re.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");r===void 0&&(r=0),Be.initAttributes();var o=a.attributes,n=t.getAttributes(),i=e.defaultAttributeValues;for(var s in n){var d=n[s];if(0<=d){var l=o[s];if(l!==void 0){var p=l.normalized,c=l.itemSize,u=Fe.get(l);if(u===void 0)continue;var m=u.buffer,g=u.type,h=u.bytesPerElement;if(l.isInterleavedBufferAttribute){var y=l.data,f=y.stride,x=l.offset;y&&y.isInstancedInterleavedBuffer?(Be.enableAttributeAndDivisor(d,y.meshPerAttribute),a.maxInstancedCount===void 0&&(a.maxInstancedCount=y.meshPerAttribute*y.count)):Be.enableAttribute(d),we.bindBuffer(we.ARRAY_BUFFER,m),we.vertexAttribPointer(d,c,g,p,f*h,(r*f+x)*h)}else l.isInstancedBufferAttribute?(Be.enableAttributeAndDivisor(d,l.meshPerAttribute),void 0===a.maxInstancedCount&&(a.maxInstancedCount=l.meshPerAttribute*l.count)):Be.enableAttribute(d),we.bindBuffer(we.ARRAY_BUFFER,m),we.vertexAttribPointer(d,c,g,p,0,r*c*h)}else if(i!==void 0){var v=i[s];if(v!==void 0)switch(v.length){case 2:we.vertexAttrib2fv(d,v);break;case 3:we.vertexAttrib3fv(d,v);break;case 4:we.vertexAttrib4fv(d,v);break;default:we.vertexAttrib1fv(d,v);}}}}Be.disableUnusedAttributes()}function g(){ot||((at.getDevice()||window).requestAnimationFrame(h),ot=!0)}function h(e){null!==nt&&nt(e),(at.getDevice()||window).requestAnimationFrame(h)}function y(e,t,a){if(e.visible){var r=e.layers.test(t.layers);if(r)if(e.isLight)V.push(e),e.castShadow&&X.push(e);else if(e.isSprite)(!e.frustumCulled||ve.intersectsSprite(e))&&Y.push(e);else if(e.isLensFlare)Z.push(e);else if(e.isImmediateRenderObject)a&&Ee.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Se),q.push(e,null,e.material,Ee.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||ve.intersectsObject(e))){a&&Ee.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Se);var o=Ue.update(e),n=e.material;if(Array.isArray(n))for(var s=o.groups,d=0,i=s.length;d<i;d++){var l=s[d],p=n[l.materialIndex];p&&p.visible&&q.push(e,o,p,Ee.z,l)}else n.visible&&q.push(e,o,n,Ee.z,null)}for(var c=e.children,d=0,i=c.length;d<i;d++)y(c[d],t,a)}}function f(e,t,a,r){for(var o=0,n=e.length;o<n;o++){var i=e[o],s=i.object,d=i.geometry,l=r===void 0?i.material:r,p=i.group;if(a.isArrayCamera){ne=a;for(var c=a.cameras,u=0,m=c.length,g;u<m;u++)if(g=c[u],s.layers.test(g.layers)){var h=g.bounds,f=h.x*me,x=h.y*ge,y=h.z*me,_=h.w*ge;Be.viewport(le.set(f,x,y,_).multiplyScalar(he)),v(s,t,g,d,l,p)}}else ne=null,v(s,t,a,d,l,p)}}function v(e,t,a,r,o,n){if(e.onBeforeRender(Q,t,a,r,o,n),e.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){Be.setMaterial(o);var i=_(a,t.fog,o,e);re="",c(e,i,o)}else Q.renderBufferDirect(a,t.fog,r,o,e,n);e.onAfterRender(Q,t,a,r,o,n)}function x(e,t,a){var r=De.get(e),o=Ge.getParameters(e,ke.state,X,t,_e.numPlanes,_e.numIntersection,a),n=Ge.getProgramCode(e,o),l=r.program,p=!0;if(l===void 0)e.addEventListener("dispose",s);else if(l.code!==n)d(e);else{if(o.shaderID!==void 0)return;p=!1}if(p){if(o.shaderID){var c=Bs[o.shaderID];r.shader={name:e.type,uniforms:Ms.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else r.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(r.shader),l=Ge.acquireProgram(e,r.shader,o,n),r.program=l,e.program=l}var u=l.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var m=0;m<Q.maxMorphTargets;m++)0<=u["morphTarget"+m]&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var m=0;m<Q.maxMorphNormals;m++)0<=u["morphNormal"+m]&&e.numSupportedMorphNormals++}var i=r.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=_e.numPlanes,r.numIntersection=_e.numIntersection,i.clippingPlanes=_e.uniform),r.fog=t,r.lightsHash=ke.state.hash,e.lights&&(i.ambientLightColor.value=ke.state.ambient,i.directionalLights.value=ke.state.directional,i.spotLights.value=ke.state.spot,i.rectAreaLights.value=ke.state.rectArea,i.pointLights.value=ke.state.point,i.hemisphereLights.value=ke.state.hemi,i.directionalShadowMap.value=ke.state.directionalShadowMap,i.directionalShadowMatrix.value=ke.state.directionalShadowMatrix,i.spotShadowMap.value=ke.state.spotShadowMap,i.spotShadowMatrix.value=ke.state.spotShadowMatrix,i.pointShadowMap.value=ke.state.pointShadowMap,i.pointShadowMatrix.value=ke.state.pointShadowMatrix);var g=r.program.getUniforms(),h=j.seqWithValue(g.seq,i);r.uniformsList=h}function _(e,t,a,r){ue=0;var o=De.get(a);if(be&&(Te||e!==oe)){var n=e===oe&&a.id===ae;_e.setState(a.clippingPlanes,a.clipIntersection,a.clipShadows,e,o,n)}!1===a.needsUpdate&&(void 0===o.program?a.needsUpdate=!0:a.fog&&o.fog!==t?a.needsUpdate=!0:a.lights&&o.lightsHash!==ke.state.hash?a.needsUpdate=!0:void 0!==o.numClippingPlanes&&(o.numClippingPlanes!==_e.numPlanes||o.numIntersection!==_e.numIntersection)&&(a.needsUpdate=!0)),a.needsUpdate&&(x(a,t,r),a.needsUpdate=!1);var i=!1,s=!1,d=!1,l=o.program,c=l.getUniforms(),u=o.shader.uniforms;if(Be.useProgram(l.program)&&(i=!0,s=!0,d=!0),a.id!==ae&&(ae=a.id,s=!0),i||e!==oe){if(c.setValue(we,"projectionMatrix",e.projectionMatrix),Le.logarithmicDepthBuffer&&c.setValue(we,"logDepthBufFC",2/($o(e.far+1)/Qo)),oe!==(ne||e)&&(oe=ne||e,s=!0,d=!0),a.isShaderMaterial||a.isMeshPhongMaterial||a.isMeshStandardMaterial||a.envMap){var m=c.map.cameraPosition;void 0!==m&&m.setValue(we,Ee.setFromMatrixPosition(e.matrixWorld))}(a.isMeshPhongMaterial||a.isMeshLambertMaterial||a.isMeshBasicMaterial||a.isMeshStandardMaterial||a.isShaderMaterial||a.skinning)&&c.setValue(we,"viewMatrix",e.matrixWorldInverse)}if(a.skinning){c.setOptional(we,r,"bindMatrix"),c.setOptional(we,r,"bindMatrixInverse");var g=r.skeleton;if(g){var h=g.bones;if(Le.floatVertexTextures){if(void 0===g.boneTexture){var y=Yo(4*h.length);y=vs.nextPowerOfTwo(Ko(y)),y=en(y,4);var f=new Float32Array(4*(y*y));f.set(g.boneMatrices);var v=new p(f,y,y,ki,Mi);g.boneMatrices=f,g.boneTexture=v,g.boneTextureSize=y}c.setValue(we,"boneTexture",g.boneTexture),c.setValue(we,"boneTextureSize",g.boneTextureSize)}else c.setOptional(we,g,"boneMatrices")}}return s&&(c.setValue(we,"toneMappingExposure",Q.toneMappingExposure),c.setValue(we,"toneMappingWhitePoint",Q.toneMappingWhitePoint),a.lights&&I(u,d),t&&a.fog&&C(u,t),a.isMeshBasicMaterial?b(u,a):a.isMeshLambertMaterial?(b(u,a),P(u,a)):a.isMeshPhongMaterial?(b(u,a),a.isMeshToonMaterial?A(u,a):w(u,a)):a.isMeshStandardMaterial?(b(u,a),a.isMeshPhysicalMaterial?M(u,a):R(u,a)):a.isMeshDepthMaterial?(b(u,a),L(u,a)):a.isMeshDistanceMaterial?(b(u,a),B(u,a)):a.isMeshNormalMaterial?(b(u,a),D(u,a)):a.isLineBasicMaterial?(T(u,a),a.isLineDashedMaterial&&S(u,a)):a.isPointsMaterial?E(u,a):a.isShadowMaterial&&(u.color.value=a.color,u.opacity.value=a.opacity),void 0!==u.ltcMat&&(u.ltcMat.value=Rs.LTC_MAT_TEXTURE),void 0!==u.ltcMag&&(u.ltcMag.value=Rs.LTC_MAG_TEXTURE),j.upload(we,o.uniformsList,u,Q)),c.setValue(we,"modelViewMatrix",r.modelViewMatrix),c.setValue(we,"normalMatrix",r.normalMatrix),c.setValue(we,"modelMatrix",r.matrixWorld),l}function b(e,t){e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var a;if(t.map?a=t.map:t.specularMap?a=t.specularMap:t.displacementMap?a=t.displacementMap:t.normalMap?a=t.normalMap:t.bumpMap?a=t.bumpMap:t.roughnessMap?a=t.roughnessMap:t.metalnessMap?a=t.metalnessMap:t.alphaMap?a=t.alphaMap:t.emissiveMap&&(a=t.emissiveMap),void 0!==a){a.isWebGLRenderTarget&&(a=a.texture);var r=a.offset,o=a.repeat;e.offsetRepeat.value.set(r.x,r.y,o.x,o.y)}}function T(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function S(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function E(e,t){if(e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*he,e.scale.value=.5*ge,e.map.value=t.map,null!==t.map){var a=t.map.offset,r=t.map.repeat;e.offsetRepeat.value.set(a.x,a.y,r.x,r.y)}}function C(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}function P(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}function w(e,t){e.specular.value=t.specular,e.shininess.value=en(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function A(e,t){w(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}function R(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}function M(e,t){e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness,R(e,t)}function L(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function B(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}function D(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function I(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function F(){var e=ue;return e>=Le.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+Le.maxTextures),ue+=1,e}console.log("THREE.WebGLRenderer",ln),e=e||{};var O=e.canvas===void 0?document.createElementNS("http://www.w3.org/1999/xhtml","canvas"):e.canvas,U=e.context===void 0?null:e.context,k=e.alpha!==void 0&&e.alpha,G=!(e.depth!==void 0)||e.depth,N=!(e.stencil!==void 0)||e.stencil,z=e.antialias!==void 0&&e.antialias,W=!(e.premultipliedAlpha!==void 0)||e.premultipliedAlpha,H=e.preserveDrawingBuffer!==void 0&&e.preserveDrawingBuffer,V=[],X=[],q=null,Y=[],Z=[];this.domElement=O,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=ri,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var Q=this,$=!1,ee=null,te=null,ae=-1,re="",oe=null,ne=null,le=new n,pe=new n,ce=null,ue=0,me=O.width,ge=O.height,he=1,ye=new n(0,0,me,ge),fe=new n(0,0,me,ge),xe=!1,ve=new ie,_e=new bt,be=!1,Te=!1,Se=new l,Ee=new m,Ce={geometries:0,textures:0},Pe={frame:0,calls:0,vertices:0,faces:0,points:0};this.info={render:Pe,memory:Ce,programs:null};var we;try{var Ae={alpha:k,depth:G,stencil:N,antialias:z,premultipliedAlpha:W,preserveDrawingBuffer:H};if(we=U||O.getContext("webgl",Ae)||O.getContext("experimental-webgl",Ae),null===we)if(null!==O.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";else throw"Error creating WebGL context.";void 0===we.getShaderPrecisionFormat&&(we.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),O.addEventListener("webglcontextlost",r,!1),O.addEventListener("webglcontextrestored",o,!1)}catch(e){console.error("THREE.WebGLRenderer: "+e)}var Re,Le,Be,De,Ie,Fe,Oe,Ue,ke,Ge,ze,We,He,Xe,Ze,$e,et,tt;a();var at=new vt(Q);this.vr=at;var rt=new se(Q,Ue,Le.maxTextureSize);this.shadowMap=rt,this.getContext=function(){return we},this.getContextAttributes=function(){return we.getContextAttributes()},this.forceContextLoss=function(){var e=Re.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=Re.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return he},this.setPixelRatio=function(e){void 0===e||(he=e,this.setSize(me,ge,!1))},this.getSize=function(){return{width:me,height:ge}},this.setSize=function(e,t,a){var r=at.getDevice();return r&&r.isPresenting?void console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):void(me=e,ge=t,O.width=e*he,O.height=t*he,!1!==a&&(O.style.width=e+"px",O.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(){return{width:me*he,height:ge*he}},this.setDrawingBufferSize=function(e,t,a){me=e,ge=t,he=a,O.width=e*a,O.height=t*a,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,a,r){ye.set(e,ge-t-r,a,r),Be.viewport(le.copy(ye).multiplyScalar(he))},this.setScissor=function(e,t,a,r){fe.set(e,ge-t-r,a,r),Be.scissor(pe.copy(fe).multiplyScalar(he))},this.setScissorTest=function(e){Be.setScissorTest(xe=e)},this.getClearColor=We.getClearColor,this.setClearColor=We.setClearColor,this.getClearAlpha=We.getClearAlpha,this.setClearAlpha=We.setClearAlpha,this.clear=function(e,t,a){var r=0;(e===void 0||e)&&(r|=we.COLOR_BUFFER_BIT),(t===void 0||t)&&(r|=we.DEPTH_BUFFER_BIT),(a===void 0||a)&&(r|=we.STENCIL_BUFFER_BIT),we.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,a,r){this.setRenderTarget(e),this.clear(t,a,r)},this.dispose=function(){O.removeEventListener("webglcontextlost",r,!1),O.removeEventListener("webglcontextrestored",o,!1),ze.dispose(),at.dispose()},this.renderBufferImmediate=function(e,t,a){Be.initAttributes();var r=De.get(e);e.hasPositions&&!r.position&&(r.position=we.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=we.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=we.createBuffer()),e.hasColors&&!r.color&&(r.color=we.createBuffer());var o=t.getAttributes();if(e.hasPositions&&(we.bindBuffer(we.ARRAY_BUFFER,r.position),we.bufferData(we.ARRAY_BUFFER,e.positionArray,we.DYNAMIC_DRAW),Be.enableAttribute(o.position),we.vertexAttribPointer(o.position,3,we.FLOAT,!1,0,0)),e.hasNormals){if(we.bindBuffer(we.ARRAY_BUFFER,r.normal),!a.isMeshPhongMaterial&&!a.isMeshStandardMaterial&&!a.isMeshNormalMaterial&&!0===a.flatShading)for(var n=0,i=3*e.count;n<i;n+=9){var s=e.normalArray,d=(s[n+0]+s[n+3]+s[n+6])/3,l=(s[n+1]+s[n+4]+s[n+7])/3,p=(s[n+2]+s[n+5]+s[n+8])/3;s[n+0]=d,s[n+1]=l,s[n+2]=p,s[n+3]=d,s[n+4]=l,s[n+5]=p,s[n+6]=d,s[n+7]=l,s[n+8]=p}we.bufferData(we.ARRAY_BUFFER,e.normalArray,we.DYNAMIC_DRAW),Be.enableAttribute(o.normal),we.vertexAttribPointer(o.normal,3,we.FLOAT,!1,0,0)}e.hasUvs&&a.map&&(we.bindBuffer(we.ARRAY_BUFFER,r.uv),we.bufferData(we.ARRAY_BUFFER,e.uvArray,we.DYNAMIC_DRAW),Be.enableAttribute(o.uv),we.vertexAttribPointer(o.uv,2,we.FLOAT,!1,0,0)),e.hasColors&&a.vertexColors!==_n&&(we.bindBuffer(we.ARRAY_BUFFER,r.color),we.bufferData(we.ARRAY_BUFFER,e.colorArray,we.DYNAMIC_DRAW),Be.enableAttribute(o.color),we.vertexAttribPointer(o.color,3,we.FLOAT,!1,0,0)),Be.disableUnusedAttributes(),we.drawArrays(we.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,a,r,o,n,i){Be.setMaterial(o);var s=_(e,a,o,n),d=r.id+"_"+s.id+"_"+(!0===o.wireframe),l=!1;d!=re&&(re=d,l=!0),n.morphTargetInfluences&&(He.update(n,r,o,s),l=!0);var p=r.index,c=r.attributes.position,m=1;!0===o.wireframe&&(p=Oe.getWireframeAttribute(r),m=2);var g=Xe,h;null!==p&&(h=Fe.get(p),g=Ze,g.setIndex(h)),l&&(u(o,s,r),null!==p&&we.bindBuffer(we.ELEMENT_ARRAY_BUFFER,h.buffer));var y=0;null===p?c!==void 0&&(y=c.count):y=p.count;var f=r.drawRange.start*m,x=r.drawRange.count*m,v=null===i?0:i.start*m,b=null===i?Infinity:i.count*m,T=en(f,v),S=tn(y,f+x,v+b)-1,E=en(0,S-T+1);if(0!==E){if(n.isMesh){if(!0===o.wireframe)Be.setLineWidth(o.wireframeLinewidth*t()),g.setMode(we.LINES);else switch(n.drawMode){case ss:g.setMode(we.TRIANGLES);break;case ds:g.setMode(we.TRIANGLE_STRIP);break;case ls:g.setMode(we.TRIANGLE_FAN);}}else if(n.isLine){var C=o.linewidth;void 0===C&&(C=1),Be.setLineWidth(C*t()),n.isLineSegments?g.setMode(we.LINES):n.isLineLoop?g.setMode(we.LINE_LOOP):g.setMode(we.LINE_STRIP)}else n.isPoints&&g.setMode(we.POINTS);r&&r.isInstancedBufferGeometry?0<r.maxInstancedCount&&g.renderInstances(r,T,E):g.render(T,E)}},this.compile=function(e,t){V.length=0,X.length=0,e.traverse(function(e){e.isLight&&(V.push(e),e.castShadow&&X.push(e))}),ke.setup(V,X,t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var a=0;a<t.material.length;a++)x(t.material[a],e.fog,t);else x(t.material,e.fog,t)})};var ot=!1,nt=null;this.animate=function(e){nt=e,g()},this.render=function(e,t,a,r){if(!(t&&t.isCamera))return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!$){re="",ae=-1,oe=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),at.enabled&&(t=at.getCamera(t)),Se.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ve.setFromMatrix(Se),V.length=0,X.length=0,Y.length=0,Z.length=0,Te=this.localClippingEnabled,be=_e.init(this.clippingPlanes,Te,t),q=ze.get(e,t),q.init(),y(e,t,Q.sortObjects),!0===Q.sortObjects&&q.sort(),be&&_e.beginShadows(),rt.render(X,e,t),ke.setup(V,X,t),be&&_e.endShadows(),Pe.frame++,Pe.calls=0,Pe.vertices=0,Pe.faces=0,Pe.points=0,void 0===a&&(a=null),this.setRenderTarget(a),We.render(q,e,t,r);var o=q.opaque,n=q.transparent;if(e.overrideMaterial){var i=e.overrideMaterial;o.length&&f(o,e,t,i),n.length&&f(n,e,t,i)}else o.length&&f(o,e,t),n.length&&f(n,e,t);et.render(Y,e,t),$e.render(Z,e,t,le),a&&Ie.updateRenderTargetMipmap(a),Be.buffers.depth.setTest(!0),Be.buffers.depth.setMask(!0),Be.buffers.color.setMask(!0),Be.setPolygonOffset(!1),at.enabled&&at.submitFrame()}},this.setFaceCulling=function(e,t){Be.setCullFace(e),Be.setFlipSided(t===mn)},this.allocTextureUnit=F,this.setTexture2D=function(){var e=!1;return function(){function t(t,a){t&&t.isWebGLRenderTarget&&(!e&&(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),Ie.setTexture2D(t,a)}return t}()}(),this.setTexture=function(){var e=!1;return function(){function t(t,a){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),Ie.setTexture2D(t,a)}return t}()}(),this.setTextureCube=function(){var e=!1;return function(){function t(t,a){t&&t.isWebGLRenderTargetCube&&(!e&&(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?Ie.setTextureCube(t,a):Ie.setTextureCubeDynamic(t,a)}return t}()}(),this.getRenderTarget=function(){return ee},this.setRenderTarget=function(e){ee=e,e&&void 0===De.get(e).__webglFramebuffer&&Ie.setupRenderTarget(e);var t=null,a=!1;if(e){var r=De.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=r[e.activeCubeFace],a=!0):t=r,le.copy(e.viewport),pe.copy(e.scissor),ce=e.scissorTest}else le.copy(ye).multiplyScalar(he),pe.copy(fe).multiplyScalar(he),ce=xe;if(te!==t&&(we.bindFramebuffer(we.FRAMEBUFFER,t),te=t),Be.viewport(le),Be.scissor(pe),Be.setScissorTest(ce),a){var o=De.get(e.texture);we.framebufferTexture2D(we.FRAMEBUFFER,we.COLOR_ATTACHMENT0,we.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,o.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,a,r,o,n){if(!(e&&e.isWebGLRenderTarget))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");var i=De.get(e).__webglFramebuffer;if(i){var s=!1;i!==te&&(we.bindFramebuffer(we.FRAMEBUFFER,i),s=!0);try{var d=e.texture,l=d.format,p=d.type;if(l!==ki&&tt.convert(l)!==we.getParameter(we.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(p!==Ei&&tt.convert(p)!==we.getParameter(we.IMPLEMENTATION_COLOR_READ_TYPE)&&!(p===Mi&&(Re.get("OES_texture_float")||Re.get("WEBGL_color_buffer_float")))&&!(p===Li&&Re.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");we.checkFramebufferStatus(we.FRAMEBUFFER)===we.FRAMEBUFFER_COMPLETE?0<=t&&t<=e.width-r&&0<=a&&a<=e.height-o&&we.readPixels(t,a,r,o,tt.convert(l),tt.convert(p),n):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&we.bindFramebuffer(we.FRAMEBUFFER,te)}}}}function Et(e,t){this.name="",this.color=new q(e),this.density=t===void 0?25e-5:t}function Ct(e,t,a){this.name="",this.color=new q(e),this.near=t===void 0?1:t,this.far=a===void 0?1e3:a}function Pt(){ce.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function wt(e,t,a,r,o){ce.call(this),this.lensFlares=[],this.positionScreen=new m,this.customUpdateCallback=void 0,e!==void 0&&this.add(e,t,a,r,o)}function At(e){Q.call(this),this.type="SpriteMaterial",this.color=new q(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(e)}function Rt(e){ce.call(this),this.type="Sprite",this.material=e===void 0?new At:e}function Mt(){ce.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Lt(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var a=0,r=this.bones.length;a<r;a++)this.boneInverses.push(new l)}}function Bt(){ce.call(this),this.type="Bone"}function Dt(e,t){Ge.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new l,this.bindMatrixInverse=new l;var a=this.initBones(),r=new Lt(a);this.bind(r,this.matrixWorld),this.normalizeSkinWeights()}function It(e){Q.call(this),this.type="LineBasicMaterial",this.color=new q(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function Ft(e,t,a){return 1===a?(console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new Ot(e,t)):void(ce.call(this),this.type="Line",this.geometry=e===void 0?new Me:e,this.material=t===void 0?new It({color:16777215*Math.random()}):t)}function Ot(e,t){Ft.call(this,e,t),this.type="LineSegments"}function Ut(e,t){Ft.call(this,e,t),this.type="LineLoop"}function kt(e){Q.call(this),this.type="PointsMaterial",this.color=new q(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)}function Gt(e,t){ce.call(this),this.type="Points",this.geometry=e===void 0?new Me:e,this.material=t===void 0?new kt({color:16777215*Math.random()}):t}function Nt(){ce.call(this),this.type="Group"}function zt(e,t,a,r,n,i,s,d,l){function p(){requestAnimationFrame(p),e.readyState>=e.HAVE_CURRENT_DATA&&(c.needsUpdate=!0)}o.call(this,e,t,a,r,n,i,s,d,l),this.generateMipmaps=!1;var c=this;p()}function Wt(e,t,a,r,n,i,s,d,l,p,c,u){o.call(this,null,i,s,d,l,p,r,n,c,u),this.image={width:t,height:a},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Ht(e,t,a,r,n,i,s,d,l,p){if(p=void 0===p?zi:p,p!==zi&&p!==Wi)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===a&&p===zi&&(a=wi),void 0===a&&p===Wi&&(a=Fi),o.call(this,null,r,n,i,s,d,p,a,l),this.image={width:e,height:t},this.magFilter=void 0===s?xi:s,this.minFilter=void 0===d?xi:d,this.flipY=!1,this.generateMipmaps=!1}function Vt(t){Me.call(this),this.type="WireframeGeometry";var a=[],r=[0,0],n={},s=["a","b","c"],d,i,p,l,o,c,e,u,g,h;if(t&&t.isGeometry){var y=t.faces;for(d=0,p=y.length;d<p;d++){var f=y[d];for(i=0;3>i;i++)e=f[s[i]],u=f[s[(i+1)%3]],r[0]=tn(e,u),r[1]=en(e,u),g=r[0]+","+r[1],void 0===n[g]&&(n[g]={index1:r[0],index2:r[1]})}for(g in n)c=n[g],h=t.vertices[c.index1],a.push(h.x,h.y,h.z),h=t.vertices[c.index2],a.push(h.x,h.y,h.z)}else if(t&&t.isBufferGeometry){var x,v,_,b,T,S,E,C;if(h=new m,null!==t.index){for(x=t.attributes.position,v=t.index,_=t.groups,0===_.length&&(_=[{start:0,count:v.count,materialIndex:0}]),(l=0,o=_.length);l<o;++l)for(b=_[l],T=b.start,S=b.count,(d=T,p=T+S);d<p;d+=3)for(i=0;3>i;i++)e=v.getX(d+i),u=v.getX(d+(i+1)%3),r[0]=tn(e,u),r[1]=en(e,u),g=r[0]+","+r[1],void 0===n[g]&&(n[g]={index1:r[0],index2:r[1]});for(g in n)c=n[g],h.fromBufferAttribute(x,c.index1),a.push(h.x,h.y,h.z),h.fromBufferAttribute(x,c.index2),a.push(h.x,h.y,h.z)}else for(x=t.attributes.position,d=0,p=x.count/3;d<p;d++)for(i=0;3>i;i++)E=3*d+i,h.fromBufferAttribute(x,E),a.push(h.x,h.y,h.z),C=3*d+(i+1)%3,h.fromBufferAttribute(x,C),a.push(h.x,h.y,h.z)}this.addAttribute("position",new Pe(a,3))}function Xt(e,t,a){fe.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:a},this.fromBufferGeometry(new jt(e,t,a)),this.mergeVertices()}function jt(e,t,r){Me.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var o=[],n=[],s=[],l=[],p=1e-5,g=new m,h=new m,y=new m,f=new m,x=new m,_=t+1,T,i;for(T=0;T<=r;T++){var S=T/r;for(i=0;i<=t;i++){var v=i/t;h=e(v,S,h),n.push(h.x,h.y,h.z),0<=v-p?(y=e(v-p,S,y),f.subVectors(h,y)):(y=e(v+p,S,y),f.subVectors(y,h)),0<=S-p?(y=e(v,S-p,y),x.subVectors(h,y)):(y=e(v,S+p,y),x.subVectors(y,h)),g.crossVectors(f,x).normalize(),s.push(g.x,g.y,g.z),l.push(v,S)}}for(T=0;T<r;T++)for(i=0;i<t;i++){var u=T*_+i,a=T*_+i+1,b=(T+1)*_+i+1,c=(T+1)*_+i;o.push(u,a,c),o.push(a,b,c)}this.setIndex(o),this.addAttribute("position",new Pe(n,3)),this.addAttribute("normal",new Pe(s,3)),this.addAttribute("uv",new Pe(l,2))}function qt(e,t,a,r){fe.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:a,detail:r},this.fromBufferGeometry(new Yt(e,t,a,r)),this.mergeVertices()}function Yt(e,t,a,o){function n(e){for(var r=new m,a=new m,o=new m,n=0;n<t.length;n+=3)p(t[n+0],r),p(t[n+1],a),p(t[n+2],o),s(r,a,o,e)}function s(e,t,a,r){var o=Zo(2,r),n=[],s,i;for(s=0;s<=o;s++){n[s]=[];var d=e.clone().lerp(a,s/o),p=t.clone().lerp(a,s/o),c=o-s;for(i=0;i<=c;i++)n[s][i]=0===i&&s===o?d:d.clone().lerp(p,i/c)}for(s=0;s<o;s++)for(i=0;i<2*(o-s)-1;i++){var u=on(i/2);0==i%2?(l(n[s][u+1]),l(n[s+1][u]),l(n[s][u])):(l(n[s][u+1]),l(n[s+1][u+1]),l(n[s+1][u]))}}function i(e){for(var t=new m,a=0;a<y.length;a+=3)t.x=y[a+0],t.y=y[a+1],t.z=y[a+2],t.normalize().multiplyScalar(e),y[a+0]=t.x,y[a+1]=t.y,y[a+2]=t.z}function d(){for(var e=0;e<f.length;e+=6){var t=f[e+0],a=f[e+2],r=f[e+4],o=en(t,a,r),n=tn(t,a,r);.9<o&&.1>n&&(.2>t&&(f[e+0]+=1),.2>a&&(f[e+2]+=1),.2>r&&(f[e+4]+=1))}}function l(e){y.push(e.x,e.y,e.z)}function p(t,a){var r=3*t;a.x=e[r+0],a.y=e[r+1],a.z=e[r+2]}function c(){for(var e=new m,t=new m,a=new m,o=new m,n=new r,s=new r,d=new r,l=0,i=0;l<y.length;l+=9,i+=6){e.set(y[l+0],y[l+1],y[l+2]),t.set(y[l+3],y[l+4],y[l+5]),a.set(y[l+6],y[l+7],y[l+8]),n.set(f[i+0],f[i+1]),s.set(f[i+2],f[i+3]),d.set(f[i+4],f[i+5]),o.copy(e).add(t).add(a).divideScalar(3);var p=g(o);u(n,i+0,e,p),u(s,i+2,t,p),u(d,i+4,a,p)}}function u(e,t,a,r){0>r&&1===e.x&&(f[t]=e.x-1),0===a.x&&0===a.z&&(f[t]=r/2/an+.5)}function g(e){return jo(e.z,-e.x)}function h(e){return jo(-e.y,Yo(e.x*e.x+e.z*e.z))}Me.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:a,detail:o},a=a||1,o=o||0;var y=[],f=[];n(o),i(a),function(){for(var e=new m,t=0;t<y.length;t+=3){e.x=y[t+0],e.y=y[t+1],e.z=y[t+2];var a=g(e)/2/an+.5,r=h(e)/an+.5;f.push(a,1-r)}c(),d()}(),this.addAttribute("position",new Pe(y,3)),this.addAttribute("normal",new Pe(y.slice(),3)),this.addAttribute("uv",new Pe(f,2)),0===o?this.computeVertexNormals():this.normalizeNormals()}function Kt(e,t){fe.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Zt(e,t)),this.mergeVertices()}function Zt(e,t){Yt.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Jt(e,t){fe.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Qt(e,t)),this.mergeVertices()}function Qt(e,t){Yt.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function $t(e,t){fe.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ea(e,t)),this.mergeVertices()}function ea(e,a){var r=(1+2.23606797749979)/2;Yt.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,a),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:a}}function ta(e,t){fe.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new aa(e,t)),this.mergeVertices()}function aa(e,a){var o=(1+2.23606797749979)/2,n=1/o;Yt.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-o,0,-n,o,0,n,-o,0,n,o,-n,-o,0,-n,o,0,n,-o,0,n,o,0,-o,0,-n,o,0,-n,-o,0,n,o,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,a),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:a}}function ra(e,t,a,r,o,n){fe.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:a,radialSegments:r,closed:o},n!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");var i=new oa(e,t,a,r,o);this.tangents=i.tangents,this.normals=i.normals,this.binormals=i.binormals,this.fromBufferGeometry(i),this.mergeVertices()}function oa(e,t,a,o,n){function s(){for(_=0;_<t;_++)d(_);d(!1===n?t:0),p(),l()}function d(r){var n=e.getPointAt(r/t),s=c.normals[r],d=c.binormals[r];for(i=0;i<=o;i++){var l=2*(i/o*an),p=Vo(l),m=-Xo(l);g.x=m*s.x+p*d.x,g.y=m*s.y+p*d.y,g.z=m*s.z+p*d.z,g.normalize(),f.push(g.x,g.y,g.z),u.x=n.x+a*g.x,u.y=n.y+a*g.y,u.z=n.z+a*g.z,y.push(u.x,u.y,u.z)}}function l(){for(i=1;i<=t;i++)for(_=1;_<=o;_++){var e=(o+1)*(i-1)+(_-1),a=(o+1)*i+(_-1),r=(o+1)*i+_,n=(o+1)*(i-1)+_;v.push(e,a,n),v.push(a,r,n)}}function p(){for(_=0;_<=t;_++)for(i=0;i<=o;i++)h.x=_/t,h.y=i/o,x.push(h.x,h.y)}Me.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:a,radialSegments:o,closed:n},t=t||64,a=a||1,o=o||8,n=n||!1;var c=e.computeFrenetFrames(t,n);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;var u=new m,g=new m,h=new r,y=[],f=[],x=[],v=[],_,i;s(),this.setIndex(v),this.addAttribute("position",new Pe(y,3)),this.addAttribute("normal",new Pe(f,3)),this.addAttribute("uv",new Pe(x,2))}function na(e,t,a,r,o,n,i){fe.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:a,radialSegments:r,p:o,q:n},i!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new ia(e,t,a,r,o,n)),this.mergeVertices()}function ia(e,t,r,o,n,s){function l(e,t,a,r,o){var n=Xo(e),i=Vo(e),s=a/t*e,d=Xo(s);o.x=.5*(r*(2+d))*n,o.y=.5*(r*(2+d)*i),o.z=.5*(r*Vo(s))}Me.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:o,p:n,q:s},e=e||100,t=t||40,r=on(r)||64,o=on(o)||8,n=n||2,s=s||3;var g=[],h=[],y=[],f=[],x=new m,_=new m,S=new m,E=new m,C=new m,P=new m,T=new m,w,i;for(w=0;w<=r;++w){var A=2*(w/r*n*an);for(l(A,n,s,e,S),l(A+.01,n,s,e,E),P.subVectors(E,S),T.addVectors(E,S),C.crossVectors(P,T),T.crossVectors(C,P),C.normalize(),T.normalize(),i=0;i<=o;++i){var u=2*(i/o*an),v=-t*Xo(u),R=t*Vo(u);x.x=S.x+(v*T.x+R*C.x),x.y=S.y+(v*T.y+R*C.y),x.z=S.z+(v*T.z+R*C.z),h.push(x.x,x.y,x.z),_.subVectors(x,S).normalize(),y.push(_.x,_.y,_.z),f.push(w/r),f.push(i/o)}}for(i=1;i<=r;i++)for(w=1;w<=o;w++){var M=(o+1)*(i-1)+(w-1),a=(o+1)*i+(w-1),b=(o+1)*i+w,c=(o+1)*(i-1)+w;g.push(M,a,c),g.push(a,b,c)}this.setIndex(g),this.addAttribute("position",new Pe(h,3)),this.addAttribute("normal",new Pe(y,3)),this.addAttribute("uv",new Pe(f,2))}function sa(e,t,a,r,o){fe.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:a,tubularSegments:r,arc:o},this.fromBufferGeometry(new da(e,t,a,r,o)),this.mergeVertices()}function da(e,t,r,o,n){Me.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:o,arc:n},e=e||100,t=t||40,r=on(r)||8,o=on(o)||6,n=n||2*an;var s=[],l=[],p=[],g=[],h=new m,y=new m,f=new m,x,_;for(x=0;x<=r;x++)for(_=0;_<=o;_++){var i=_/o*n,u=2*(x/r*an);y.x=(e+t*Xo(u))*Xo(i),y.y=(e+t*Xo(u))*Vo(i),y.z=t*Vo(u),l.push(y.x,y.y,y.z),h.x=e*Xo(i),h.y=e*Vo(i),f.subVectors(y,h).normalize(),p.push(f.x,f.y,f.z),g.push(_/o),g.push(x/r)}for(x=1;x<=r;x++)for(_=1;_<=o;_++){var v=(o+1)*x+_-1,a=(o+1)*(x-1)+_-1,b=(o+1)*(x-1)+_,c=(o+1)*x+_;s.push(v,a,c),s.push(a,b,c)}this.setIndex(s),this.addAttribute("position",new Pe(l,3)),this.addAttribute("normal",new Pe(p,3)),this.addAttribute("uv",new Pe(g,2))}function la(e,t){fe.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new pa(e,t)),this.mergeVertices()}function pa(e,t){"undefined"==typeof e||(Me.call(this),this.type="ExtrudeBufferGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeVertexNormals())}function ca(e,t){fe.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new ua(e,t)),this.mergeVertices()}function ua(e,t){t=t||{};var a=t.font;if(!(a&&a.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new fe;var r=a.generateShapes(e,t.size,t.curveSegments);t.amount=t.height===void 0?50:t.height,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),pa.call(this,r,t),this.type="TextBufferGeometry"}function ma(e,t,a,r,o,n,i){fe.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:a,phiStart:r,phiLength:o,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new ga(e,t,a,r,o,n,i)),this.mergeVertices()}function ga(e,t,r,o,n,i,s){Me.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:o,phiLength:n,thetaStart:i,thetaLength:s},e=e||50,t=en(3,on(t)||8),r=en(2,on(r)||6),o=o===void 0?0:o,n=n===void 0?2*an:n,i=i===void 0?0:i,s=s===void 0?an:s;var l=i+s,p=0,g=[],h=new m,y=new m,f=[],x=[],_=[],T=[],S,E;for(E=0;E<=r;E++){var C=[],P=E/r;for(S=0;S<=t;S++){var v=S/t;h.x=-e*Xo(o+v*n)*Vo(i+P*s),h.y=e*Xo(i+P*s),h.z=e*Vo(o+v*n)*Vo(i+P*s),x.push(h.x,h.y,h.z),y.set(h.x,h.y,h.z).normalize(),_.push(y.x,y.y,y.z),T.push(v,1-P),C.push(p++)}g.push(C)}for(E=0;E<r;E++)for(S=0;S<t;S++){var u=g[E][S+1],a=g[E][S],b=g[E+1][S],c=g[E+1][S+1];(0!==E||0<i)&&f.push(u,a,c),(E!==r-1||l<an)&&f.push(a,b,c)}this.setIndex(f),this.addAttribute("position",new Pe(x,3)),this.addAttribute("normal",new Pe(_,3)),this.addAttribute("uv",new Pe(T,2))}function ha(e,t,a,r,o,n){fe.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:a,phiSegments:r,thetaStart:o,thetaLength:n},this.fromBufferGeometry(new ya(e,t,a,r,o,n)),this.mergeVertices()}function ya(e,t,o,n,s,l){Me.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:o,phiSegments:n,thetaStart:s,thetaLength:l},e=e||20,t=t||50,s=s===void 0?0:s,l=l===void 0?2*an:l,o=o===void 0?8:en(3,o),n=n===void 0?1:en(1,n);var p=[],u=[],g=[],h=[],y=e,f=(t-e)/n,x=new m,v=new r,_,T,S;for(T=0;T<=n;T++){for(S=0;S<=o;S++)_=s+S/o*l,x.x=y*Xo(_),x.y=y*Vo(_),u.push(x.x,x.y,x.z),g.push(0,0,1),v.x=(x.x/t+1)/2,v.y=(x.y/t+1)/2,h.push(v.x,v.y);y+=f}for(T=0;T<n;T++){var i=T*(o+1);for(S=0;S<o;S++){_=S+i;var E=_,a=_+o+1,b=_+o+2,c=_+1;p.push(E,a,c),p.push(a,b,c)}}this.setIndex(p),this.addAttribute("position",new Pe(u,3)),this.addAttribute("normal",new Pe(g,3)),this.addAttribute("uv",new Pe(h,2))}function fa(e,t,a,r){fe.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:a,phiLength:r},this.fromBufferGeometry(new xa(e,t,a,r)),this.mergeVertices()}function xa(e,t,o,s){Me.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:o,phiLength:s},t=on(t)||12,o=o||0,s=s||2*an,s=vs.clamp(s,0,2*an);var l=[],p=[],u=[],g=1/t,h=new m,y=new r,f,x,i;for(x=0;x<=t;x++){var v=o+x*g*s,_=Vo(v),T=Xo(v);for(i=0;i<=e.length-1;i++)h.x=e[i].x*_,h.y=e[i].y,h.z=e[i].x*T,p.push(h.x,h.y,h.z),y.x=x/t,y.y=i/(e.length-1),u.push(y.x,y.y)}for(x=0;x<t;x++)for(i=0;i<e.length-1;i++){f=i+x*e.length;var S=f,a=f+e.length,b=f+e.length+1,c=f+1;l.push(S,a,c),l.push(a,b,c)}if(this.setIndex(l),this.addAttribute("position",new Pe(p,3)),this.addAttribute("uv",new Pe(u,2)),this.computeVertexNormals(),s===2*an){var d=this.attributes.normal.array,E=new m,C=new m,P=new m;for(f=3*(t*e.length),x=0,i=0;x<e.length;x++,i+=3)E.x=d[i+0],E.y=d[i+1],E.z=d[i+2],C.x=d[f+i+0],C.y=d[f+i+1],C.z=d[f+i+2],P.addVectors(E,C).normalize(),d[i+0]=d[f+i+0]=P.x,d[i+1]=d[f+i+1]=P.y,d[i+2]=d[f+i+2]=P.z}}function va(e,t){fe.call(this),this.type="ShapeGeometry","object"===("undefined"==typeof t?"undefined":dn(t))&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new _a(e,t)),this.mergeVertices()}function _a(e,t){function a(e){var d=o.length/3,p=e.extractPoints(t),u=p.shape,m=p.holes,g,i,h;if(!1===Us.isClockWise(u))for(u=u.reverse(),g=0,i=m.length;g<i;g++)h=m[g],!0===Us.isClockWise(h)&&(m[g]=h.reverse());var y=Us.triangulateShape(u,m);for(g=0,i=m.length;g<i;g++)h=m[g],u=u.concat(h);for(g=0,i=u.length;g<i;g++){var f=u[g];o.push(f.x,f.y,0),n.push(0,0,1),s.push(f.x,f.y)}for(g=0,i=y.length;g<i;g++){var x=y[g],v=x[0]+d,a=x[1]+d,_=x[2]+d;r.push(v,a,_),l+=3}}Me.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],o=[],n=[],s=[],d=0,l=0;if(!1===Array.isArray(e))a(e);else for(var p=0;p<e.length;p++)a(e[p]),this.addGroup(d,l,p),d+=l,l=0;this.setIndex(r),this.addAttribute("position",new Pe(o,3)),this.addAttribute("normal",new Pe(n,3)),this.addAttribute("uv",new Pe(s,2))}function ba(t,a){Me.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:a},a=a===void 0?1:a;var r=[],o=Xo(vs.DEG2RAD*a),n=[0,0],s={},d=["a","b","c"],p,c,u,m;t.isBufferGeometry?(m=new fe,m.fromBufferGeometry(t)):m=t.clone(),m.mergeVertices(),m.computeFaceNormals();for(var g=m.vertices,h=m.faces,y=0,f=h.length,l;y<f;y++){l=h[y];for(var x=0;3>x;x++)p=l[d[x]],c=l[d[(x+1)%3]],n[0]=tn(p,c),n[1]=en(p,c),u=n[0]+","+n[1],void 0===s[u]?s[u]={index1:n[0],index2:n[1],face1:y,face2:void 0}:s[u].face2=y}for(u in s){var v=s[u];if(v.face2===void 0||h[v.face1].normal.dot(h[v.face2].normal)<=o){var e=g[v.index1];r.push(e.x,e.y,e.z),e=g[v.index2],r.push(e.x,e.y,e.z)}}this.addAttribute("position",new Pe(r,3))}function Ta(e,t,a,r,o,n,i,s){fe.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:a,radialSegments:r,heightSegments:o,openEnded:n,thetaStart:i,thetaLength:s},this.fromBufferGeometry(new Sa(e,t,a,r,o,n,i,s)),this.mergeVertices()}function Sa(e,t,o,n,i,a,s,d){function l(){var r=new m,l=new m,p=0,S=(t-e)/o,E,x;for(x=0;x<=i;x++){var C=[],P=x/i,w=P*(t-e)+e;for(E=0;E<=n;E++){var A=E/n,R=A*d+s,M=Vo(R),L=Xo(R);l.x=w*M,l.y=-P*o+b,l.z=w*L,c.push(l.x,l.y,l.z),r.set(M,S,L).normalize(),h.push(r.x,r.y,r.z),y.push(A,1-P),C.push(f++)}_.push(C)}for(E=0;E<n;E++)for(x=0;x<i;x++){var B=_[x][E],a=_[x+1][E],D=_[x+1][E+1],I=_[x][E+1];u.push(B,a,I),u.push(a,D,I),p+=6}g.addGroup(T,p,0),T+=p}function p(a){var o=new r,l=new m,p=0,v=!0===a?e:t,_=!0===a?1:-1,S,x,E;for(x=f,S=1;S<=n;S++)c.push(0,b*_,0),h.push(0,_,0),y.push(.5,.5),f++;for(E=f,S=0;S<=n;S++){var C=S/n,P=C*d+s,w=Xo(P),A=Vo(P);l.x=v*A,l.y=b*_,l.z=v*w,c.push(l.x,l.y,l.z),h.push(0,_,0),o.x=.5*w+.5,o.y=.5*A*_+.5,y.push(o.x,o.y),f++}for(S=0;S<n;S++){var R=x+S,M=E+S;!0===a?u.push(M,M+1,R):u.push(M+1,M,R),p+=3}g.addGroup(T,p,!0===a?1:2),T+=p}Me.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:o,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:s,thetaLength:d};var g=this;e=e===void 0?20:e,t=t===void 0?20:t,o=o===void 0?100:o,n=on(n)||8,i=on(i)||1,a=a!==void 0&&a,s=s===void 0?0:s,d=d===void 0?2*an:d;var u=[],c=[],h=[],y=[],f=0,_=[],b=o/2,T=0;l(),!1===a&&(0<e&&p(!0),0<t&&p(!1)),this.setIndex(u),this.addAttribute("position",new Pe(c,3)),this.addAttribute("normal",new Pe(h,3)),this.addAttribute("uv",new Pe(y,2))}function Ea(e,t,a,r,o,n,i){Ta.call(this,0,e,t,a,r,o,n,i),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:a,heightSegments:r,openEnded:o,thetaStart:n,thetaLength:i}}function Ca(e,t,a,r,o,n,i){Sa.call(this,0,e,t,a,r,o,n,i),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:a,heightSegments:r,openEnded:o,thetaStart:n,thetaLength:i}}function Pa(e,t,a,r){fe.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:a,thetaLength:r},this.fromBufferGeometry(new wa(e,t,a,r)),this.mergeVertices()}function wa(e,t,a,o){Me.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:a,thetaLength:o},e=e||50,t=t===void 0?8:en(3,t),a=a===void 0?0:a,o=o===void 0?2*an:o;var n=[],d=[],l=[],p=[],c=new m,u=new r,g,i;for(d.push(0,0,0),l.push(0,0,1),p.push(.5,.5),(i=0,g=3);i<=t;i++,g+=3){var s=a+i/t*o;c.x=e*Xo(s),c.y=e*Vo(s),d.push(c.x,c.y,c.z),l.push(0,0,1),u.x=(d[g]/e+1)/2,u.y=(d[g+1]/e+1)/2,p.push(u.x,u.y)}for(g=1;g<=t;g++)n.push(g,g+1,0);this.setIndex(n),this.addAttribute("position",new Pe(d,3)),this.addAttribute("normal",new Pe(l,3)),this.addAttribute("uv",new Pe(p,2))}function Aa(e){Q.call(this),this.type="ShadowMaterial",this.color=new q(0),this.opacity=1,this.lights=!0,this.transparent=!0,this.setValues(e)}function Ra(e){$.call(this,e),this.type="RawShaderMaterial"}function Ma(e){Q.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new q(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new q(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function La(e){Ma.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function Ba(e){Q.call(this),this.type="MeshPhongMaterial",this.color=new q(16777215),this.specular=new q(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new q(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$n,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Da(e){Ba.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function Ia(e){Q.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new r(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Fa(e){Q.call(this),this.type="MeshLambertMaterial",this.color=new q(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new q(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=$n,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Oa(e){It.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function Ua(e,t,a){var r=this,o=!1,n=0,i=0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=a,this.itemStart=function(e){i++,!1==o&&r.onStart!==void 0&&r.onStart(e,n,i),o=!0},this.itemEnd=function(e){n++,r.onProgress!==void 0&&r.onProgress(e,n,i),n==i&&(o=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(e){r.onError!==void 0&&r.onError(e)}}function ka(e){this.manager=e===void 0?zs:e}function Ga(e){this.manager=e===void 0?zs:e,this._parser=null}function Na(e){this.manager=e===void 0?zs:e,this._parser=null}function za(e){this.manager=e===void 0?zs:e}function Wa(e){this.manager=e===void 0?zs:e}function Ha(e){this.manager=e===void 0?zs:e}function Va(e,t){ce.call(this),this.type="Light",this.color=new q(e),this.intensity=t===void 0?1:t,this.receiveShadow=void 0}function Xa(e,t,a){Va.call(this,e,a),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ce.DefaultUp),this.updateMatrix(),this.groundColor=new q(t)}function ja(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new r(512,512),this.map=null,this.matrix=new l}function qa(){ja.call(this,new ge(50,1,.5,500))}function Ya(e,t,a,r,o,n){Va.call(this,e,t),this.type="SpotLight",this.position.copy(ce.DefaultUp),this.updateMatrix(),this.target=new ce,Object.defineProperty(this,"power",{get:function(){return function(){return this.intensity*an}}(),set:function(){return function(e){this.intensity=e/an}}()}),this.distance=a===void 0?0:a,this.angle=r===void 0?an/3:r,this.penumbra=o===void 0?0:o,this.decay=n===void 0?1:n,this.shadow=new qa}function Ka(e,t,a,r){Va.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return function(){return 4*this.intensity*an}}(),set:function(){return function(e){this.intensity=e/(4*an)}}()}),this.distance=a===void 0?0:a,this.decay=r===void 0?1:r,this.shadow=new ja(new ge(90,1,.5,500))}function Za(){ja.call(this,new me(-5,5,5,-5,.5,500))}function Ja(e,t){Va.call(this,e,t),this.type="DirectionalLight",this.position.copy(ce.DefaultUp),this.updateMatrix(),this.target=new ce,this.shadow=new Za}function Qa(e,t){Va.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function $a(e,t,a,r){Va.call(this,e,t),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=a===void 0?10:a,this.height=r===void 0?10:r}function er(e,t,a,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r===void 0?new t.constructor(a):r,this.sampleValues=t,this.valueSize=a}function tr(e,t,a,r){er.call(this,e,t,a,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function ar(e,t,a,r){er.call(this,e,t,a,r)}function rr(e,t,a,r){er.call(this,e,t,a,r)}function or(e,t,a,r){if(e===void 0)throw new Error("track name is undefined");if(void 0===t||0===t.length)throw new Error("no keyframes in track named "+e);this.name=e,this.times=Ws.convertArray(t,this.TimeBufferType),this.values=Ws.convertArray(a,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation),this.validate(),this.optimize()}function nr(e,t,a,r){or.call(this,e,t,a,r)}function ir(e,t,a,r){er.call(this,e,t,a,r)}function sr(e,t,a,r){or.call(this,e,t,a,r)}function dr(e,t,a,r){or.call(this,e,t,a,r)}function lr(e,t,a,r){or.call(this,e,t,a,r)}function pr(e,t,a){or.call(this,e,t,a)}function cr(e,t,a,r){or.call(this,e,t,a,r)}function ur(){or.apply(this,arguments)}function mr(e,t,a){this.name=e,this.tracks=a,this.duration=t===void 0?-1:t,this.uuid=vs.generateUUID(),0>this.duration&&this.resetDuration(),this.optimize()}function gr(e){this.manager=e===void 0?zs:e,this.textures={}}function hr(e){this.manager=e===void 0?zs:e}function yr(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function fr(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=e===void 0?zs:e,this.withCredentials=!1}function xr(e){this.manager=e===void 0?zs:e,this.texturePath=""}function vr(e,t,a,r,o){var n=.5*(r-t),i=.5*(o-a),s=e*e;return(2*a-2*r+n+i)*(e*s)+(-3*a+3*r-2*n-i)*s+n*e+a}function _r(e,t){var a=1-e;return a*a*t}function br(e,t){return 2*(1-e)*e*t}function Tr(e,t){return e*e*t}function Sr(e,t,a,r){return _r(e,t)+br(e,a)+Tr(e,r)}function Er(e,t){var a=1-e;return a*a*a*t}function Cr(e,t){var a=1-e;return 3*a*a*e*t}function Pr(e,t){return 3*(1-e)*e*e*t}function wr(e,t){return e*e*e*t}function Ar(e,t,a,r,o){return Er(e,t)+Cr(e,a)+Pr(e,r)+wr(e,o)}function Rr(){this.arcLengthDivisions=200}function Mr(e,t){Rr.call(this),this.v1=e,this.v2=t}function Lr(){Rr.call(this),this.curves=[],this.autoClose=!1}function Br(e,t,a,r,o,n,i,s){Rr.call(this),this.aX=e,this.aY=t,this.xRadius=a,this.yRadius=r,this.aStartAngle=o,this.aEndAngle=n,this.aClockwise=i,this.aRotation=s||0}function Dr(e){Rr.call(this),this.points=e===void 0?[]:e}function Ir(e,t,a,r){Rr.call(this),this.v0=e,this.v1=t,this.v2=a,this.v3=r}function Fr(e,t,a){Rr.call(this),this.v0=e,this.v1=t,this.v2=a}function Or(e){Lr.call(this),this.currentPoint=new r,e&&this.fromPoints(e)}function Ur(){Or.apply(this,arguments),this.holes=[]}function kr(){this.subPaths=[],this.currentPath=null}function Gr(e){this.data=e}function Nr(e){this.manager=e===void 0?zs:e}function zr(e){this.manager=e===void 0?zs:e}function Wr(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ge,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ge,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function Hr(e,t,a){ce.call(this),this.type="CubeCamera";var r=90,o=1,n=new ge(r,o,e,t);n.up.set(0,-1,0),n.lookAt(new m(1,0,0)),this.add(n);var i=new ge(r,o,e,t);i.up.set(0,-1,0),i.lookAt(new m(-1,0,0)),this.add(i);var d=new ge(r,o,e,t);d.up.set(0,0,1),d.lookAt(new m(0,1,0)),this.add(d);var l=new ge(r,o,e,t);l.up.set(0,0,-1),l.lookAt(new m(0,-1,0)),this.add(l);var p=new ge(r,o,e,t);p.up.set(0,-1,0),p.lookAt(new m(0,0,1)),this.add(p);var c=new ge(r,o,e,t);c.up.set(0,-1,0),c.lookAt(new m(0,0,-1)),this.add(c);this.renderTarget=new s(a,a,{format:Ui,magFilter:bi,minFilter:bi}),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var a=this.renderTarget,r=a.texture.generateMipmaps;a.texture.generateMipmaps=!1,a.activeCubeFace=0,e.render(t,n,a),a.activeCubeFace=1,e.render(t,i,a),a.activeCubeFace=2,e.render(t,d,a),a.activeCubeFace=3,e.render(t,l,a),a.activeCubeFace=4,e.render(t,p,a),a.texture.generateMipmaps=r,a.activeCubeFace=5,e.render(t,c,a),e.setRenderTarget(null)},this.clear=function(e,t,a,r){for(var o=this.renderTarget,n=0;6>n;n++)o.activeCubeFace=n,e.setRenderTarget(o),e.clear(t,a,r);e.setRenderTarget(null)}}function Vr(){ce.call(this),this.type="AudioListener",this.context=Ks.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Xr(e){ce.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function jr(e){Xr.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function qr(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t===void 0?2048:t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Yr(e,t,a){this.binding=e,this.valueSize=a;var r=Float64Array,o;"quaternion"===t?o=this._slerp:"string"===t||"bool"===t?(r=Array,o=this._select):o=this._lerp;this.buffer=new r(4*a),this._mixBufferRegion=o,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function Kr(e,t,a){var r=a||Zr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function Zr(e,t,a){this.path=t,this.parsedPath=a||Zr.parseTrackName(t),this.node=Zr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Jr(){this.uuid=vs.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,a=arguments.length;t!==a;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function Qr(e,t,a){this._mixer=e,this._clip=t,this._localRoot=a||null;for(var r=t.tracks,o=r.length,n=Array(o),s={endingStart:os,endingEnd:os},d=0,i;d!==o;++d)i=r[d].createInterpolant(null),n[d]=i,i.settings=s;this._interpolantSettings=s,this._interpolants=n,this._propertyBindings=Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=$i,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=Infinity,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function $r(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function eo(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function to(){Me.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function ao(e,t,a,r){this.uuid=vs.generateUUID(),this.data=e,this.itemSize=t,this.offset=a,this.normalized=!0===r}function ro(e,t){this.uuid=vs.generateUUID(),this.array=e,this.stride=t,this.count=e===void 0?0:e.length/t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function oo(e,t,a){ro.call(this,e,t),this.meshPerAttribute=a||1}function no(e,t,a){xe.call(this,e,t),this.meshPerAttribute=a||1}function io(e,t,a,r){this.ray=new Oe(e,t),this.near=a||0,this.far=r||Infinity,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}()}})}function so(e,t){return e.distance-t.distance}function lo(e,t,a,r){if(!1!==e.visible&&(e.raycast(t,a),!0===r))for(var o=e.children,n=0,i=o.length;n<i;n++)lo(o[n],t,a,!0)}function po(e){this.autoStart=!(e!==void 0)||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function co(e,t,a){return this.radius=void 0===e?1:e,this.phi=void 0===t?0:t,this.theta=void 0===a?0:a,this}function uo(e,t,a){return this.radius=void 0===e?1:e,this.theta=void 0===t?0:t,this.y=void 0===a?0:a,this}function mo(e){ce.call(this),this.material=e,this.render=function(){}}function go(e,t,a,r){this.object=e,this.size=t===void 0?1:t;var o=a===void 0?16711680:a,n=r===void 0?1:r,i=0,s=this.object.geometry;s&&s.isGeometry?i=3*s.faces.length:s&&s.isBufferGeometry&&(i=s.attributes.normal.count);var d=new Me,l=new Pe(3*(2*i),3);d.addAttribute("position",l),Ot.call(this,d,new It({color:o,linewidth:n})),this.matrixAutoUpdate=!1,this.update()}function ho(e,t){ce.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var a=new Me,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],o=0,n=1,i=32;o<i;o++,n++){var s=2*(o/i*an),d=2*(n/i*an);r.push(Xo(s),Vo(s),1,Xo(d),Vo(d),1)}a.addAttribute("position",new Pe(r,3));var l=new It({fog:!1});this.cone=new Ot(a,l),this.add(this.cone),this.update()}function yo(e){var t=[];e&&e.isBone&&t.push(e);for(var a=0;a<e.children.length;a++)t.push.apply(t,yo(e.children[a]));return t}function fo(e){for(var t=yo(e),a=new Me,r=[],o=[],n=new q(0,0,1),s=new q(0,1,0),d=0,i;d<t.length;d++)i=t[d],i.parent&&i.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),o.push(n.r,n.g,n.b),o.push(s.r,s.g,s.b));a.addAttribute("position",new Pe(r,3)),a.addAttribute("color",new Pe(o,3));var l=new It({vertexColors:Tn,depthTest:!1,depthWrite:!1,transparent:!0});Ot.call(this,a,l),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.onBeforeRender()}function xo(e,t,a){this.light=e,this.light.updateMatrixWorld(),this.color=a;var r=new ga(t,4,2),o=new Fe({wireframe:!0,fog:!1});Ge.call(this,r,o),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function vo(e,t){ce.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var a=new It({fog:!1}),r=new Me;r.addAttribute("position",new xe(new Float32Array(15),3)),this.line=new Ft(r,a),this.add(this.line),this.update()}function _o(e,t,a){ce.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=a;var r=new Qt(t);r.rotateY(.5*an),this.material=new Fe({wireframe:!0,fog:!1}),this.color===void 0&&(this.material.vertexColors=Tn);var o=r.getAttribute("position"),n=new Float32Array(3*o.count);r.addAttribute("color",new xe(n,3)),this.add(new Ge(r,this.material)),this.update()}function bo(e,t,a,r){e=e||10,t=t||10,a=new q(a===void 0?4473924:a),r=new q(r===void 0?8947848:r);for(var o=t/2,n=e/t,s=e/2,d=[],l=[],p=0,i=0,c=-s;p<=t;p++,c+=n){d.push(-s,0,c,s,0,c),d.push(c,0,-s,c,0,s);var u=p===o?a:r;u.toArray(l,i),i+=3,u.toArray(l,i),i+=3,u.toArray(l,i),i+=3,u.toArray(l,i),i+=3}var m=new Me;m.addAttribute("position",new Pe(d,3)),m.addAttribute("color",new Pe(l,3));var g=new It({vertexColors:Tn});Ot.call(this,m,g)}function To(e,t,a,o,n,s){e=e||10,t=t||16,a=a||8,o=o||64,n=new q(n===void 0?4473924:n),s=new q(s===void 0?8947848:s);var d=[],l=[],p,c,u,m,i,g,r;for(m=0;m<=t;m++)u=m/t*(2*an),p=Vo(u)*e,c=Xo(u)*e,d.push(0,0,0),d.push(p,0,c),r=1&m?n:s,l.push(r.r,r.g,r.b),l.push(r.r,r.g,r.b);for(m=0;m<=a;m++)for(r=1&m?n:s,g=e-e/a*m,i=0;i<o;i++)u=i/o*(2*an),p=Vo(u)*g,c=Xo(u)*g,d.push(p,0,c),l.push(r.r,r.g,r.b),u=(i+1)/o*(2*an),p=Vo(u)*g,c=Xo(u)*g,d.push(p,0,c),l.push(r.r,r.g,r.b);var h=new Me;h.addAttribute("position",new Pe(d,3)),h.addAttribute("color",new Pe(l,3));var y=new It({vertexColors:Tn});Ot.call(this,h,y)}function So(e,t,a,r){this.object=e,this.size=t===void 0?1:t;var o=a===void 0?16776960:a,n=r===void 0?1:r,i=0,s=this.object.geometry;s&&s.isGeometry?i=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var d=new Me,l=new Pe(3*(2*i),3);d.addAttribute("position",l),Ot.call(this,d,new It({color:o,linewidth:n})),this.matrixAutoUpdate=!1,this.update()}function Eo(e,t,a){ce.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=a,t===void 0&&(t=1);var r=new Me;r.addAttribute("position",new Pe([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var o=new It({fog:!1});this.lightPlane=new Ft(r,o),this.add(this.lightPlane),r=new Me,r.addAttribute("position",new Pe([0,0,0,0,0,1],3)),this.targetLine=new Ft(r,o),this.add(this.targetLine),this.update()}function Co(e){function t(e,t,a){r(e,a),r(t,a)}function r(e,t){n.push(0,0,0),i.push(t.r,t.g,t.b),s[e]===void 0&&(s[e]=[]),s[e].push(n.length/3-1)}var a=new Me,o=new It({color:16777215,vertexColors:bn}),n=[],i=[],s={},d=new q(16755200),l=new q(16711680),p=new q(43775),c=new q(16777215),u=new q(3355443);t("n1","n2",d),t("n2","n4",d),t("n4","n3",d),t("n3","n1",d),t("f1","f2",d),t("f2","f4",d),t("f4","f3",d),t("f3","f1",d),t("n1","f1",d),t("n2","f2",d),t("n3","f3",d),t("n4","f4",d),t("p","n1",l),t("p","n2",l),t("p","n3",l),t("p","n4",l),t("u1","u2",p),t("u2","u3",p),t("u3","u1",p),t("c","t",c),t("p","c",u),t("cn1","cn2",u),t("cn3","cn4",u),t("cf1","cf2",u),t("cf3","cf4",u),a.addAttribute("position",new Pe(n,3)),a.addAttribute("color",new Pe(i,3)),Ot.call(this,a,o),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function Po(e,t){this.object=e,t===void 0&&(t=16776960);var a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),o=new Me;o.setIndex(new xe(a,1)),o.addAttribute("position",new xe(r,3)),Ot.call(this,o,new It({color:t})),this.matrixAutoUpdate=!1,this.update()}function wo(e,t){this.type="Box3Helper",this.box=e;var a=t===void 0?16776960:t,r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Me;o.setIndex(new xe(r,1)),o.addAttribute("position",new Pe([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Ot.call(this,o,new It({color:a})),this.geometry.computeBoundingSphere(),this.onBeforeRender()}function Ao(e,t,a){this.type="PlaneHelper",this.plane=e,this.size=t===void 0?1:t;var r=a===void 0?16776960:a,o=new Me;o.addAttribute("position",new Pe([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),o.computeBoundingSphere(),Ft.call(this,o,new It({color:r}));var n=new Me;n.addAttribute("position",new Pe([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),n.computeBoundingSphere(),this.add(new Ge(n,new Fe({color:r,opacity:.2,transparent:!0,depthWrite:!1}))),this.onBeforeRender()}function Ro(e,t,a,r,o,n){ce.call(this),r===void 0&&(r=16776960),a===void 0&&(a=1),o===void 0&&(o=.2*a),n===void 0&&(n=.2*o),Js===void 0&&(Js=new Me,Js.addAttribute("position",new Pe([0,0,0,0,1,0],3)),Qs=new Sa(0,.5,1,5,1),Qs.translate(0,-.5,0)),this.position.copy(t),this.line=new Ft(Js,new It({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ge(Qs,new Fe({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(a,o,n)}function Mo(e){e=e||1;var t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],a=new Me;a.addAttribute("position",new Pe(t,3)),a.addAttribute("color",new Pe([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new It({vertexColors:Tn});Ot.call(this,a,r)}function Lo(){function e(e,t,i,s){a=e,r=i,o=-3*e+3*t-2*i-s,n=2*e-2*t+i+s}var a=0,r=0,o=0,n=0;return{initCatmullRom:function(){return function(t,a,r,o,n){e(a,r,n*(r-t),n*(o-a))}}(),initNonuniformCatmullRom:function(){return function(t,a,r,o,n,i,s){var d=(a-t)/n-(r-t)/(n+i)+(r-a)/i,l=(r-a)/i-(o-a)/(i+s)+(o-r)/s;d*=i,l*=i,e(a,r,d,l)}}(),calc:function(){function e(e){var t=e*e;return a+r*e+o*t+n*(t*e)}return e}()}}function Bo(e){Rr.call(this),2>e.length&&console.warn("THREE.CatmullRomCurve3: Points array needs at least two entries."),this.points=e||[],this.closed=!1}function Do(e,t,a,r){Rr.call(this),this.v0=e,this.v1=t,this.v2=a,this.v3=r}function Io(e,t,a){Rr.call(this),this.v0=e,this.v1=t,this.v2=a}function Fo(e,t){Rr.call(this),this.v1=e,this.v2=t}function Oo(e,t,a,r,o,n){Br.call(this,e,t,a,a,r,o,n)}function Uo(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Bo.call(this,e),this.type="catmullrom",this.closed=!0}function ko(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Bo.call(this,e),this.type="catmullrom"}function Go(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Bo.call(this,e),this.type="catmullrom"}var No=Math.tan,zo=Math.atan,Wo=Math.asin,Ho=Math.acos,Vo=Math.sin,Xo=Math.cos,jo=Math.atan2,qo=Math.abs,Yo=Math.sqrt,Ko=Math.ceil,Zo=Math.pow,Jo=Math.round,Qo=Math.LN2,$o=Math.log,en=Math.max,tn=Math.min,an=Math.PI,rn=Math.sign,on=Math.floor,nn=Number.isInteger,sn=Number.EPSILON;Object.defineProperty(t,"__esModule",{value:!0});var dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};sn===void 0&&(sn=2.220446049250313e-16),nn===void 0&&(nn=function(e){return"number"==typeof e&&isFinite(e)&&on(e)===e}),rn===void 0&&(rn=function(e){return 0>e?-1:0<e?1:+e}),Function.prototype.name===void 0&&Object.defineProperty(Function.prototype,"name",{get:function(){return function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}()}),Object.assign===void 0&&function(){Object.assign=function(e){"use strict";if(e===void 0||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),a=1,r;a<arguments.length;a++)if(r=arguments[a],void 0!==r&&null!==r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t}}(),Object.assign(a.prototype,{addEventListener:function(){return function(e,t){this._listeners===void 0&&(this._listeners={});var a=this._listeners;a[e]===void 0&&(a[e]=[]),-1===a[e].indexOf(t)&&a[e].push(t)}}(),hasEventListener:function(){return function(e,t){if(this._listeners===void 0)return!1;var a=this._listeners;return a[e]!==void 0&&-1!==a[e].indexOf(t)}}(),removeEventListener:function(){return function(e,t){if(void 0!==this._listeners){var a=this._listeners,r=a[e];if(void 0!==r){var o=r.indexOf(t);-1!==o&&r.splice(o,1)}}}}(),dispatchEvent:function(){return function(e){if(void 0!==this._listeners){var t=this._listeners,a=t[e.type];if(void 0!==a){e.target=this;for(var r=a.slice(0),o=0,n=r.length;o<n;o++)r[o].call(this,e)}}}}()});var ln="87",pn=0,cn=1,un=2,mn=0,gn=1,hn=2,yn=0,fn=1,xn=2,vn=1,_n=0,bn=1,Tn=2,Sn=0,En=1,Cn=2,Pn=3,wn=4,An=5,Rn=100,Mn=101,Ln=102,Bn=103,Dn=104,In=200,Fn=201,On=202,Un=203,kn=204,Gn=205,Nn=206,zn=207,Wn=208,Hn=209,Vn=210,Xn=0,jn=1,qn=2,Yn=3,Kn=4,Zn=5,Jn=6,Qn=7,$n=0,ei=1,ti=2,ai=0,ri=1,oi=2,ni=3,ii=4,si=300,di=301,li=302,pi=303,ci=304,ui=305,mi=306,gi=307,hi=1e3,yi=1001,fi=1002,xi=1003,vi=1004,_i=1005,bi=1006,Ti=1007,Si=1008,Ei=1009,Ci=1010,Pi=1011,wi=1012,Ai=1013,Ri=1014,Mi=1015,Li=1016,Bi=1017,Di=1018,Ii=1019,Fi=1020,Oi=1021,Ui=1022,ki=1023,Gi=1024,Ni=1025,zi=1026,Wi=1027,Hi=2001,Vi=2002,Xi=2003,ji=2004,qi=2100,Yi=2101,Ki=2102,Zi=2103,Ji=2151,Qi=2200,$i=2201,es=2202,ts=2300,as=2301,rs=2302,os=2400,ns=2401,is=2402,ss=0,ds=1,ls=2,ps=3e3,cs=3001,us=3007,ms=3002,gs=3004,hs=3005,ys=3006,fs=3200,xs=3201,vs={DEG2RAD:an/180,RAD2DEG:180/an,generateUUID:function(){var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],t=Array(36),a=0,o;return function(){function r(){for(var r=0;36>r;r++)8===r||13===r||18===r||23===r?t[r]="-":14===r?t[r]="4":(2>=a&&(a=0|33554432+16777216*Math.random()),o=15&a,a>>=4,t[r]=e[19===r?8|3&o:o]);return t.join("")}return r}()}(),clamp:function(){return function(e,t,a){return en(t,tn(a,e))}}(),euclideanModulo:function(){return function(e,t){return(e%t+t)%t}}(),mapLinear:function(){return function(e,t,a,r,o){return r+(e-t)*(o-r)/(a-t)}}(),lerp:function(){return function(e,a,r){return(1-r)*e+r*a}}(),smoothstep:function(){return function(e,t,a){return e<=t?0:e>=a?1:(e=(e-t)/(a-t),e*e*(3-2*e))}}(),smootherstep:function(){return function(e,t,a){return e<=t?0:e>=a?1:(e=(e-t)/(a-t),e*e*e*(e*(6*e-15)+10))}}(),randInt:function(){return function(e,t){return e+on(Math.random()*(t-e+1))}}(),randFloat:function(){return function(e,t){return e+Math.random()*(t-e)}}(),randFloatSpread:function(){return function(e){return e*(.5-Math.random())}}(),degToRad:function(){return function(e){return e*vs.DEG2RAD}}(),radToDeg:function(){return function(e){return e*vs.RAD2DEG}}(),isPowerOfTwo:function(){return function(e){return 0==(e&e-1)&&0!==e}}(),nearestPowerOfTwo:function(){return function(e){return Zo(2,Jo($o(e)/Qo))}}(),nextPowerOfTwo:function(){return function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}}()};Object.defineProperties(r.prototype,{width:{get:function(){return function(){return this.x}}(),set:function(){return function(e){this.x=e}}()},height:{get:function(){return function(){return this.y}}(),set:function(){return function(e){this.y=e}}()}}),Object.assign(r.prototype,{isVector2:!0,set:function(){return function(e,t){return this.x=e,this.y=t,this}}(),setScalar:function(){return function(e){return this.x=e,this.y=e,this}}(),setX:function(){return function(e){return this.x=e,this}}(),setY:function(){return function(e){return this.y=e,this}}(),setComponent:function(){return function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e);}return this}}(),getComponent:function(){return function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e);}}}(),clone:function(){return function(){return new this.constructor(this.x,this.y)}}(),copy:function(){return function(e){return this.x=e.x,this.y=e.y,this}}(),add:function(){return function(e,t){return void 0===t?(this.x+=e.x,this.y+=e.y,this):(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t))}}(),addScalar:function(){return function(e){return this.x+=e,this.y+=e,this}}(),addVectors:function(){return function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}}(),addScaledVector:function(){return function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}}(),sub:function(){return function(e,t){return void 0===t?(this.x-=e.x,this.y-=e.y,this):(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t))}}(),subScalar:function(){return function(e){return this.x-=e,this.y-=e,this}}(),subVectors:function(){return function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}}(),multiply:function(){return function(e){return this.x*=e.x,this.y*=e.y,this}}(),multiplyScalar:function(){return function(e){return this.x*=e,this.y*=e,this}}(),divide:function(){return function(e){return this.x/=e.x,this.y/=e.y,this}}(),divideScalar:function(){return function(e){return this.multiplyScalar(1/e)}}(),min:function(){return function(e){return this.x=tn(this.x,e.x),this.y=tn(this.y,e.y),this}}(),max:function(){return function(e){return this.x=en(this.x,e.x),this.y=en(this.y,e.y),this}}(),clamp:function(){return function(e,t){return this.x=en(e.x,tn(t.x,this.x)),this.y=en(e.y,tn(t.y,this.y)),this}}(),clampScalar:function(){var e=new r,t=new r;return function(){return function(a,r){return e.set(a,a),t.set(r,r),this.clamp(e,t)}}()}(),clampLength:function(){return function(e,t){var a=this.length();return this.divideScalar(a||1).multiplyScalar(en(e,tn(t,a)))}}(),floor:function(){return function(){return this.x=on(this.x),this.y=on(this.y),this}}(),ceil:function(){return function(){return this.x=Ko(this.x),this.y=Ko(this.y),this}}(),round:function(){return function(){return this.x=Jo(this.x),this.y=Jo(this.y),this}}(),roundToZero:function(){return function(){return this.x=0>this.x?Ko(this.x):on(this.x),this.y=0>this.y?Ko(this.y):on(this.y),this}}(),negate:function(){return function(){return this.x=-this.x,this.y=-this.y,this}}(),dot:function(){return function(e){return this.x*e.x+this.y*e.y}}(),lengthSq:function(){return function(){return this.x*this.x+this.y*this.y}}(),length:function(){return function(){return Yo(this.x*this.x+this.y*this.y)}}(),lengthManhattan:function(){return function(){return qo(this.x)+qo(this.y)}}(),normalize:function(){return function(){return this.divideScalar(this.length()||1)}}(),angle:function(){function e(){var e=jo(this.y,this.x);return 0>e&&(e+=2*an),e}return e}(),distanceTo:function(){return function(e){return Yo(this.distanceToSquared(e))}}(),distanceToSquared:function(){return function(e){var t=this.x-e.x,a=this.y-e.y;return t*t+a*a}}(),distanceToManhattan:function(){return function(e){return qo(this.x-e.x)+qo(this.y-e.y)}}(),setLength:function(){return function(e){return this.normalize().multiplyScalar(e)}}(),lerp:function(){return function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}}(),lerpVectors:function(){return function(e,t,a){return this.subVectors(t,e).multiplyScalar(a).add(e)}}(),equals:function(){return function(e){return e.x===this.x&&e.y===this.y}}(),fromArray:function(){return function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}}(),toArray:function(){return function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e}}(),fromBufferAttribute:function(){return function(e,t,a){return void 0!==a&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}}(),rotateAround:function(){return function(e,t){var a=Xo(t),r=Vo(t),o=this.x-e.x,n=this.y-e.y;return this.x=o*a-n*r+e.x,this.y=o*r+n*a+e.y,this}}()});var _s=0;o.DEFAULT_IMAGE=void 0,o.DEFAULT_MAPPING=si,Object.defineProperty(o.prototype,"needsUpdate",{set:function(){return function(e){!0===e&&this.version++}}()}),Object.assign(o.prototype,a.prototype,{constructor:o,isTexture:!0,clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}}(),toJSON:function(){return function(e){function t(e){var t;if(e instanceof HTMLCanvasElement)t=e;else{t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),t.width=e.width,t.height=e.height;var a=t.getContext("2d");e instanceof ImageData?a.putImageData(e,0,0):a.drawImage(e,0,0,e.width,e.height)}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}if(void 0!==e.textures[this.uuid])return e.textures[this.uuid];var a={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var r=this.image;void 0===r.uuid&&(r.uuid=vs.generateUUID()),void 0===e.images[r.uuid]&&(e.images[r.uuid]={uuid:r.uuid,url:t(r)}),a.image=r.uuid}return e.textures[this.uuid]=a,a}}(),dispose:function(){return function(){this.dispatchEvent({type:"dispose"})}}(),transformUv:function(){return function(e){if(this.mapping===si){if(e.multiply(this.repeat),e.add(this.offset),0>e.x||1<e.x)switch(this.wrapS){case hi:e.x-=on(e.x);break;case yi:e.x=0>e.x?0:1;break;case fi:1===qo(on(e.x)%2)?e.x=Ko(e.x)-e.x:e.x-=on(e.x);}if(0>e.y||1<e.y)switch(this.wrapT){case hi:e.y-=on(e.y);break;case yi:e.y=0>e.y?0:1;break;case fi:1===qo(on(e.y)%2)?e.y=Ko(e.y)-e.y:e.y-=on(e.y);}this.flipY&&(e.y=1-e.y)}}}()}),Object.assign(n.prototype,{isVector4:!0,set:function(){return function(e,t,a,r){return this.x=e,this.y=t,this.z=a,this.w=r,this}}(),setScalar:function(){return function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}}(),setX:function(){return function(e){return this.x=e,this}}(),setY:function(){return function(e){return this.y=e,this}}(),setZ:function(){return function(e){return this.z=e,this}}(),setW:function(){return function(e){return this.w=e,this}}(),setComponent:function(){return function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e);}return this}}(),getComponent:function(){return function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e);}}}(),clone:function(){return function(){return new this.constructor(this.x,this.y,this.z,this.w)}}(),copy:function(){return function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0===e.w?1:e.w,this}}(),add:function(){return function(e,t){return void 0===t?(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this):(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t))}}(),addScalar:function(){return function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}}(),addVectors:function(){return function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}}(),addScaledVector:function(){return function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}}(),sub:function(){return function(e,t){return void 0===t?(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this):(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t))}}(),subScalar:function(){return function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}}(),subVectors:function(){return function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}}(),multiplyScalar:function(){return function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}}(),applyMatrix4:function(){return function(t){var a=this.x,r=this.y,o=this.z,n=this.w,i=t.elements;return this.x=i[0]*a+i[4]*r+i[8]*o+i[12]*n,this.y=i[1]*a+i[5]*r+i[9]*o+i[13]*n,this.z=i[2]*a+i[6]*r+i[10]*o+i[14]*n,this.w=i[3]*a+i[7]*r+i[11]*o+i[15]*n,this}}(),divideScalar:function(){return function(e){return this.multiplyScalar(1/e)}}(),setAxisAngleFromQuaternion:function(){return function(e){this.w=2*Ho(e.w);var t=Yo(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}}(),setAxisAngleFromRotationMatrix:function(){return function(e){var t=.01,a=.1,r=e.elements,o=r[0],n=r[4],i=r[8],d=r[1],l=r[5],p=r[9],c=r[2],u=r[6],m=r[10],g,h,f,y;if(qo(n-d)<t&&qo(i-c)<t&&qo(p-u)<t){if(qo(n+d)<a&&qo(i+c)<a&&qo(p+u)<a&&qo(o+l+m-3)<a)return this.set(1,0,0,0),this;g=an;var x=(o+1)/2,v=(l+1)/2,_=(m+1)/2,b=(n+d)/4,T=(i+c)/4,S=(p+u)/4;return x>v&&x>_?x<t?(h=0,f=.707106781,y=.707106781):(h=Yo(x),f=b/h,y=T/h):v>_?v<t?(h=.707106781,f=0,y=.707106781):(f=Yo(v),h=b/f,y=S/f):_<t?(h=.707106781,f=.707106781,y=0):(y=Yo(_),h=T/y,f=S/y),this.set(h,f,y,g),this}var E=Yo((u-p)*(u-p)+(i-c)*(i-c)+(d-n)*(d-n));return .001>qo(E)&&(E=1),this.x=(u-p)/E,this.y=(i-c)/E,this.z=(d-n)/E,this.w=Ho((o+l+m-1)/2),this}}(),min:function(){return function(e){return this.x=tn(this.x,e.x),this.y=tn(this.y,e.y),this.z=tn(this.z,e.z),this.w=tn(this.w,e.w),this}}(),max:function(){return function(e){return this.x=en(this.x,e.x),this.y=en(this.y,e.y),this.z=en(this.z,e.z),this.w=en(this.w,e.w),this}}(),clamp:function(){return function(e,t){return this.x=en(e.x,tn(t.x,this.x)),this.y=en(e.y,tn(t.y,this.y)),this.z=en(e.z,tn(t.z,this.z)),this.w=en(e.w,tn(t.w,this.w)),this}}(),clampScalar:function(){var e,t;return function(){function a(a,r){return void 0==e&&(e=new n,t=new n),e.set(a,a,a,a),t.set(r,r,r,r),this.clamp(e,t)}return a}()}(),clampLength:function(){return function(e,t){var a=this.length();return this.divideScalar(a||1).multiplyScalar(en(e,tn(t,a)))}}(),floor:function(){return function(){return this.x=on(this.x),this.y=on(this.y),this.z=on(this.z),this.w=on(this.w),this}}(),ceil:function(){return function(){return this.x=Ko(this.x),this.y=Ko(this.y),this.z=Ko(this.z),this.w=Ko(this.w),this}}(),round:function(){return function(){return this.x=Jo(this.x),this.y=Jo(this.y),this.z=Jo(this.z),this.w=Jo(this.w),this}}(),roundToZero:function(){return function(){return this.x=0>this.x?Ko(this.x):on(this.x),this.y=0>this.y?Ko(this.y):on(this.y),this.z=0>this.z?Ko(this.z):on(this.z),this.w=0>this.w?Ko(this.w):on(this.w),this}}(),negate:function(){return function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}}(),dot:function(){return function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}}(),lengthSq:function(){return function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}}(),length:function(){return function(){return Yo(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}}(),lengthManhattan:function(){return function(){return qo(this.x)+qo(this.y)+qo(this.z)+qo(this.w)}}(),normalize:function(){return function(){return this.divideScalar(this.length()||1)}}(),setLength:function(){return function(e){return this.normalize().multiplyScalar(e)}}(),lerp:function(){return function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}}(),lerpVectors:function(){return function(e,t,a){return this.subVectors(t,e).multiplyScalar(a).add(e)}}(),equals:function(){return function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}(),fromArray:function(){return function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}}(),toArray:function(){return function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}}(),fromBufferAttribute:function(){return function(e,t,a){return void 0!==a&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}()}),Object.assign(i.prototype,a.prototype,{isWebGLRenderTarget:!0,setSize:function(){return function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}}(),dispose:function(){return function(){this.dispatchEvent({type:"dispose"})}}()}),s.prototype=Object.create(i.prototype),s.prototype.constructor=s,s.prototype.isWebGLRenderTargetCube=!0,Object.assign(d,{slerp:function(){return function(e,a,r,o){return r.copy(e).slerp(a,o)}}(),slerpFlat:function(){function e(e,a,r,o,n,i,d){var t=r[o+0],l=r[o+1],p=r[o+2],c=r[o+3],u=n[i+0],m=n[i+1],g=n[i+2],h=n[i+3];if(c!==h||t!==u||l!==m||p!==g){var y=1-d,s=t*u+l*m+p*g+c*h,x=0<=s?1:-1,v=1-s*s;if(v>sn){var _=Yo(v),b=jo(_,s*x);y=Vo(y*b)/_,d=Vo(d*b)/_}var T=d*x;if(t=t*y+u*T,l=l*y+m*T,p=p*y+g*T,c=c*y+h*T,y==1-d){var S=1/Yo(t*t+l*l+p*p+c*c);t*=S,l*=S,p*=S,c*=S}}e[a]=t,e[a+1]=l,e[a+2]=p,e[a+3]=c}return e}()}),Object.defineProperties(d.prototype,{x:{get:function(){return function(){return this._x}}(),set:function(){return function(e){this._x=e,this.onChangeCallback()}}()},y:{get:function(){return function(){return this._y}}(),set:function(){return function(e){this._y=e,this.onChangeCallback()}}()},z:{get:function(){return function(){return this._z}}(),set:function(){return function(e){this._z=e,this.onChangeCallback()}}()},w:{get:function(){return function(){return this._w}}(),set:function(){return function(e){this._w=e,this.onChangeCallback()}}()}}),Object.assign(d.prototype,{set:function(){return function(e,t,a,r){return this._x=e,this._y=t,this._z=a,this._w=r,this.onChangeCallback(),this}}(),clone:function(){return function(){return new this.constructor(this._x,this._y,this._z,this._w)}}(),copy:function(){return function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this}}(),setFromEuler:function(){return function(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var a=e._x,r=e._y,o=e._z,n=e.order,i=Xo,s=Vo,d=i(a/2),l=i(r/2),p=i(o/2),c=s(a/2),u=s(r/2),m=s(o/2);return"XYZ"===n?(this._x=c*l*p+d*u*m,this._y=d*u*p-c*l*m,this._z=d*l*m+c*u*p,this._w=d*l*p-c*u*m):"YXZ"===n?(this._x=c*l*p+d*u*m,this._y=d*u*p-c*l*m,this._z=d*l*m-c*u*p,this._w=d*l*p+c*u*m):"ZXY"===n?(this._x=c*l*p-d*u*m,this._y=d*u*p+c*l*m,this._z=d*l*m+c*u*p,this._w=d*l*p-c*u*m):"ZYX"===n?(this._x=c*l*p-d*u*m,this._y=d*u*p+c*l*m,this._z=d*l*m-c*u*p,this._w=d*l*p+c*u*m):"YZX"===n?(this._x=c*l*p+d*u*m,this._y=d*u*p+c*l*m,this._z=d*l*m-c*u*p,this._w=d*l*p-c*u*m):"XZY"===n&&(this._x=c*l*p-d*u*m,this._y=d*u*p-c*l*m,this._z=d*l*m+c*u*p,this._w=d*l*p+c*u*m),!1!==t&&this.onChangeCallback(),this}}(),setFromAxisAngle:function(){return function(e,t){var a=t/2,r=Vo(a);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Xo(a),this.onChangeCallback(),this}}(),setFromRotationMatrix:function(){return function(e){var t=e.elements,a=t[0],r=t[4],o=t[8],n=t[1],i=t[5],d=t[9],l=t[2],p=t[6],c=t[10],u=a+i+c,m;return 0<u?(m=.5/Yo(u+1),this._w=.25/m,this._x=(p-d)*m,this._y=(o-l)*m,this._z=(n-r)*m):a>i&&a>c?(m=2*Yo(1+a-i-c),this._w=(p-d)/m,this._x=.25*m,this._y=(r+n)/m,this._z=(o+l)/m):i>c?(m=2*Yo(1+i-a-c),this._w=(o-l)/m,this._x=(r+n)/m,this._y=.25*m,this._z=(d+p)/m):(m=2*Yo(1+c-a-i),this._w=(n-r)/m,this._x=(o+l)/m,this._y=(d+p)/m,this._z=.25*m),this.onChangeCallback(),this}}(),setFromUnitVectors:function(){var e=new m,t;return function(){function a(a,r){return void 0===e&&(e=new m),t=a.dot(r)+1,t<1e-6?(t=0,qo(a.x)>qo(a.z)?e.set(-a.y,a.x,0):e.set(0,-a.z,a.y)):e.crossVectors(a,r),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}return a}()}(),inverse:function(){return function(){return this.conjugate().normalize()}}(),conjugate:function(){return function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}}(),dot:function(){return function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}}(),lengthSq:function(){return function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}}(),length:function(){return function(){return Yo(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}}(),normalize:function(){return function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this.onChangeCallback(),this}}(),multiply:function(){return function(e,t){return void 0===t?this.multiplyQuaternions(this,e):(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t))}}(),premultiply:function(){return function(e){return this.multiplyQuaternions(e,this)}}(),multiplyQuaternions:function(){return function(e,t){var a=e._x,r=e._y,o=e._z,n=e._w,i=t._x,s=t._y,d=t._z,l=t._w;return this._x=a*l+n*i+r*d-o*s,this._y=r*l+n*s+o*i-a*d,this._z=o*l+n*d+a*s-r*i,this._w=n*l-a*i-r*s-o*d,this.onChangeCallback(),this}}(),slerp:function(){return function(e,a){if(0===a)return this;if(1===a)return this.copy(e);var t=this._x,r=this._y,o=this._z,n=this._w,i=n*e._w+t*e._x+r*e._y+o*e._z;if(0>i?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,i=-i):this.copy(e),1<=i)return this._w=n,this._x=t,this._y=r,this._z=o,this;var s=Yo(1-i*i);if(.001>qo(s))return this._w=.5*(n+this._w),this._x=.5*(t+this._x),this._y=.5*(r+this._y),this._z=.5*(o+this._z),this;var d=jo(s,i),l=Vo((1-a)*d)/s,p=Vo(a*d)/s;return this._w=n*l+this._w*p,this._x=t*l+this._x*p,this._y=r*l+this._y*p,this._z=o*l+this._z*p,this.onChangeCallback(),this}}(),equals:function(){return function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}}(),fromArray:function(){return function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this}}(),toArray:function(){return function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}}(),onChange:function(){return function(e){return this.onChangeCallback=e,this}}(),onChangeCallback:function(){return function(){}}()}),Object.assign(m.prototype,{isVector3:!0,set:function(){return function(e,t,a){return this.x=e,this.y=t,this.z=a,this}}(),setScalar:function(){return function(e){return this.x=e,this.y=e,this.z=e,this}}(),setX:function(){return function(e){return this.x=e,this}}(),setY:function(){return function(e){return this.y=e,this}}(),setZ:function(){return function(e){return this.z=e,this}}(),setComponent:function(){return function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e);}return this}}(),getComponent:function(){return function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e);}}}(),clone:function(){return function(){return new this.constructor(this.x,this.y,this.z)}}(),copy:function(){return function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}}(),add:function(){return function(e,t){return void 0===t?(this.x+=e.x,this.y+=e.y,this.z+=e.z,this):(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t))}}(),addScalar:function(){return function(e){return this.x+=e,this.y+=e,this.z+=e,this}}(),addVectors:function(){return function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}}(),addScaledVector:function(){return function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}}(),sub:function(){return function(e,t){return void 0===t?(this.x-=e.x,this.y-=e.y,this.z-=e.z,this):(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t))}}(),subScalar:function(){return function(e){return this.x-=e,this.y-=e,this.z-=e,this}}(),subVectors:function(){return function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}}(),multiply:function(){return function(e,t){return void 0===t?(this.x*=e.x,this.y*=e.y,this.z*=e.z,this):(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t))}}(),multiplyScalar:function(){return function(e){return this.x*=e,this.y*=e,this.z*=e,this}}(),multiplyVectors:function(){return function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}}(),applyEuler:function(){var e=new d;return function(){return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}()}(),applyAxisAngle:function(){var e=new d;return function(){return function(t,a){return this.applyQuaternion(e.setFromAxisAngle(t,a))}}()}(),applyMatrix3:function(){return function(t){var a=this.x,r=this.y,o=this.z,n=t.elements;return this.x=n[0]*a+n[3]*r+n[6]*o,this.y=n[1]*a+n[4]*r+n[7]*o,this.z=n[2]*a+n[5]*r+n[8]*o,this}}(),applyMatrix4:function(){return function(t){var a=this.x,r=this.y,o=this.z,n=t.elements,e=1/(n[3]*a+n[7]*r+n[11]*o+n[15]);return this.x=(n[0]*a+n[4]*r+n[8]*o+n[12])*e,this.y=(n[1]*a+n[5]*r+n[9]*o+n[13])*e,this.z=(n[2]*a+n[6]*r+n[10]*o+n[14])*e,this}}(),applyQuaternion:function(){return function(e){var t=this.x,a=this.y,r=this.z,o=e.x,n=e.y,i=e.z,s=e.w,d=s*t+n*r-i*a,l=s*a+i*t-o*r,p=s*r+o*a-n*t,c=-o*t-n*a-i*r;return this.x=d*s+c*-o+l*-i-p*-n,this.y=l*s+c*-n+p*-o-d*-i,this.z=p*s+c*-i+d*-n-l*-o,this}}(),project:function(){var e=new l;return function(){return function(t){return e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyMatrix4(e)}}()}(),unproject:function(){var e=new l;return function(){return function(t){return e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyMatrix4(e)}}()}(),transformDirection:function(){return function(t){var a=this.x,r=this.y,o=this.z,n=t.elements;return this.x=n[0]*a+n[4]*r+n[8]*o,this.y=n[1]*a+n[5]*r+n[9]*o,this.z=n[2]*a+n[6]*r+n[10]*o,this.normalize()}}(),divide:function(){return function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}}(),divideScalar:function(){return function(e){return this.multiplyScalar(1/e)}}(),min:function(){return function(e){return this.x=tn(this.x,e.x),this.y=tn(this.y,e.y),this.z=tn(this.z,e.z),this}}(),max:function(){return function(e){return this.x=en(this.x,e.x),this.y=en(this.y,e.y),this.z=en(this.z,e.z),this}}(),clamp:function(){return function(e,t){return this.x=en(e.x,tn(t.x,this.x)),this.y=en(e.y,tn(t.y,this.y)),this.z=en(e.z,tn(t.z,this.z)),this}}(),clampScalar:function(){var e=new m,t=new m;return function(){return function(a,r){return e.set(a,a,a),t.set(r,r,r),this.clamp(e,t)}}()}(),clampLength:function(){return function(e,t){var a=this.length();return this.divideScalar(a||1).multiplyScalar(en(e,tn(t,a)))}}(),floor:function(){return function(){return this.x=on(this.x),this.y=on(this.y),this.z=on(this.z),this}}(),ceil:function(){return function(){return this.x=Ko(this.x),this.y=Ko(this.y),this.z=Ko(this.z),this}}(),round:function(){return function(){return this.x=Jo(this.x),this.y=Jo(this.y),this.z=Jo(this.z),this}}(),roundToZero:function(){return function(){return this.x=0>this.x?Ko(this.x):on(this.x),this.y=0>this.y?Ko(this.y):on(this.y),this.z=0>this.z?Ko(this.z):on(this.z),this}}(),negate:function(){return function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}}(),dot:function(){return function(e){return this.x*e.x+this.y*e.y+this.z*e.z}}(),lengthSq:function(){return function(){return this.x*this.x+this.y*this.y+this.z*this.z}}(),length:function(){return function(){return Yo(this.x*this.x+this.y*this.y+this.z*this.z)}}(),lengthManhattan:function(){return function(){return qo(this.x)+qo(this.y)+qo(this.z)}}(),normalize:function(){return function(){return this.divideScalar(this.length()||1)}}(),setLength:function(){return function(e){return this.normalize().multiplyScalar(e)}}(),lerp:function(){return function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}}(),lerpVectors:function(){return function(e,t,a){return this.subVectors(t,e).multiplyScalar(a).add(e)}}(),cross:function(){return function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var a=this.x,r=this.y,o=this.z;return this.x=r*e.z-o*e.y,this.y=o*e.x-a*e.z,this.z=a*e.y-r*e.x,this}}(),crossVectors:function(){return function(e,t){var a=e.x,r=e.y,o=e.z,n=t.x,i=t.y,s=t.z;return this.x=r*s-o*i,this.y=o*n-a*s,this.z=a*i-r*n,this}}(),projectOnVector:function(){return function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e=new m;return function(){return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}()}(),reflect:function(){var e=new m;return function(){return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}()}(),angleTo:function(){return function(e){var t=this.dot(e)/Yo(this.lengthSq()*e.lengthSq());return Ho(vs.clamp(t,-1,1))}}(),distanceTo:function(){return function(e){return Yo(this.distanceToSquared(e))}}(),distanceToSquared:function(){return function(e){var t=this.x-e.x,a=this.y-e.y,r=this.z-e.z;return t*t+a*a+r*r}}(),distanceToManhattan:function(){return function(e){return qo(this.x-e.x)+qo(this.y-e.y)+qo(this.z-e.z)}}(),setFromSpherical:function(){return function(e){var t=Vo(e.phi)*e.radius;return this.x=t*Vo(e.theta),this.y=Xo(e.phi)*e.radius,this.z=t*Xo(e.theta),this}}(),setFromCylindrical:function(){return function(e){return this.x=e.radius*Vo(e.theta),this.y=e.y,this.z=e.radius*Xo(e.theta),this}}(),setFromMatrixPosition:function(){return function(t){var a=t.elements;return this.x=a[12],this.y=a[13],this.z=a[14],this}}(),setFromMatrixScale:function(){return function(e){var t=this.setFromMatrixColumn(e,0).length(),a=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=a,this.z=r,this}}(),setFromMatrixColumn:function(){return function(e,t){return this.fromArray(e.elements,4*t)}}(),equals:function(){return function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}}(),fromArray:function(){return function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}}(),toArray:function(){return function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}}(),fromBufferAttribute:function(){return function(e,t,a){return void 0!==a&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}()}),Object.assign(l.prototype,{isMatrix4:!0,set:function(){return function(e,t,a,r,o,n,i,s,d,l,p,c,u,m,g,h){var y=this.elements;return y[0]=e,y[4]=t,y[8]=a,y[12]=r,y[1]=o,y[5]=n,y[9]=i,y[13]=s,y[2]=d,y[6]=l,y[10]=p,y[14]=c,y[3]=u,y[7]=m,y[11]=g,y[15]=h,this}}(),identity:function(){return function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}}(),clone:function(){return function(){return new l().fromArray(this.elements)}}(),copy:function(){return function(e){var t=this.elements,a=e.elements;return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],this}}(),copyPosition:function(){return function(e){var t=this.elements,a=e.elements;return t[12]=a[12],t[13]=a[13],t[14]=a[14],this}}(),extractBasis:function(){return function(e,t,a){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),a.setFromMatrixColumn(this,2),this}}(),makeBasis:function(){return function(e,t,a){return this.set(e.x,t.x,a.x,0,e.y,t.y,a.y,0,e.z,t.z,a.z,0,0,0,0,1),this}}(),extractRotation:function(){var e=new m;return function(){return function(t){var a=this.elements,r=t.elements,o=1/e.setFromMatrixColumn(t,0).length(),n=1/e.setFromMatrixColumn(t,1).length(),i=1/e.setFromMatrixColumn(t,2).length();return a[0]=r[0]*o,a[1]=r[1]*o,a[2]=r[2]*o,a[4]=r[4]*n,a[5]=r[5]*n,a[6]=r[6]*n,a[8]=r[8]*i,a[9]=r[9]*i,a[10]=r[10]*i,this}}()}(),makeRotationFromEuler:function(){return function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=this.elements,o=t.x,n=t.y,i=t.z,s=Xo(o),l=Vo(o),p=Xo(n),u=Vo(n),m=Xo(i),e=Vo(i);if("XYZ"===t.order){var g=s*m,h=s*e,y=l*m,x=l*e;r[0]=p*m,r[4]=-p*e,r[8]=u,r[1]=h+y*u,r[5]=g-x*u,r[9]=-l*p,r[2]=x-g*u,r[6]=y+h*u,r[10]=s*p}else if("YXZ"===t.order){var v=p*m,_=p*e,T=u*m,S=u*e;r[0]=v+S*l,r[4]=T*l-_,r[8]=s*u,r[1]=s*e,r[5]=s*m,r[9]=-l,r[2]=_*l-T,r[6]=S+v*l,r[10]=s*p}else if("ZXY"===t.order){var v=p*m,_=p*e,T=u*m,S=u*e;r[0]=v-S*l,r[4]=-s*e,r[8]=T+_*l,r[1]=_+T*l,r[5]=s*m,r[9]=S-v*l,r[2]=-s*u,r[6]=l,r[10]=s*p}else if("ZYX"===t.order){var g=s*m,h=s*e,y=l*m,x=l*e;r[0]=p*m,r[4]=y*u-h,r[8]=g*u+x,r[1]=p*e,r[5]=x*u+g,r[9]=h*u-y,r[2]=-u,r[6]=l*p,r[10]=s*p}else if("YZX"===t.order){var E=s*p,C=s*u,P=l*p,w=l*u;r[0]=p*m,r[4]=w-E*e,r[8]=P*e+C,r[1]=e,r[5]=s*m,r[9]=-l*m,r[2]=-u*m,r[6]=C*e+P,r[10]=E-w*e}else if("XZY"===t.order){var E=s*p,C=s*u,P=l*p,w=l*u;r[0]=p*m,r[4]=-e,r[8]=u*m,r[1]=E*e+w,r[5]=s*m,r[9]=C*e-P,r[2]=P*e-C,r[6]=l*m,r[10]=w*e+E}return r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this}}(),makeRotationFromQuaternion:function(){return function(e){var t=this.elements,a=e._x,r=e._y,o=e._z,n=e._w,i=a+a,s=r+r,d=o+o,l=a*i,p=a*s,c=a*d,u=r*s,m=r*d,g=o*d,h=n*i,y=n*s,f=n*d;return t[0]=1-(u+g),t[4]=p-f,t[8]=c+y,t[1]=p+f,t[5]=1-(l+g),t[9]=m-h,t[2]=c-y,t[6]=m+h,t[10]=1-(l+u),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}}(),lookAt:function(){var e=new m,t=new m,a=new m;return function(){return function(r,o,n){var i=this.elements;return a.subVectors(r,o),0===a.lengthSq()&&(a.z=1),a.normalize(),e.crossVectors(n,a),0===e.lengthSq()&&(1===qo(n.z)?a.x+=1e-4:a.z+=1e-4,a.normalize(),e.crossVectors(n,a)),e.normalize(),t.crossVectors(a,e),i[0]=e.x,i[4]=t.x,i[8]=a.x,i[1]=e.y,i[5]=t.y,i[9]=a.y,i[2]=e.z,i[6]=t.z,i[10]=a.z,this}}()}(),multiply:function(){return function(e,t){return void 0===t?this.multiplyMatrices(this,e):(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t))}}(),premultiply:function(){return function(e){return this.multiplyMatrices(e,this)}}(),multiplyMatrices:function(){return function(e,t){var a=e.elements,r=t.elements,o=this.elements,n=a[0],i=a[4],s=a[8],d=a[12],l=a[1],p=a[5],c=a[9],u=a[13],m=a[2],g=a[6],h=a[10],y=a[14],f=a[3],x=a[7],v=a[11],_=a[15],b=r[0],T=r[4],S=r[8],E=r[12],C=r[1],P=r[5],w=r[9],A=r[13],R=r[2],M=r[6],L=r[10],B=r[14],D=r[3],I=r[7],F=r[11],O=r[15];return o[0]=n*b+i*C+s*R+d*D,o[4]=n*T+i*P+s*M+d*I,o[8]=n*S+i*w+s*L+d*F,o[12]=n*E+i*A+s*B+d*O,o[1]=l*b+p*C+c*R+u*D,o[5]=l*T+p*P+c*M+u*I,o[9]=l*S+p*w+c*L+u*F,o[13]=l*E+p*A+c*B+u*O,o[2]=m*b+g*C+h*R+y*D,o[6]=m*T+g*P+h*M+y*I,o[10]=m*S+g*w+h*L+y*F,o[14]=m*E+g*A+h*B+y*O,o[3]=f*b+x*C+v*R+_*D,o[7]=f*T+x*P+v*M+_*I,o[11]=f*S+x*w+v*L+_*F,o[15]=f*E+x*A+v*B+_*O,this}}(),multiplyScalar:function(){return function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}}(),applyToBufferAttribute:function(){var e=new m;return function(){return function(t){for(var a=0,r=t.count;a<r;a++)e.x=t.getX(a),e.y=t.getY(a),e.z=t.getZ(a),e.applyMatrix4(this),t.setXYZ(a,e.x,e.y,e.z);return t}}()}(),determinant:function(){return function(){var e=this.elements,t=e[0],a=e[4],r=e[8],o=e[12],n=e[1],i=e[5],s=e[9],d=e[13],l=e[2],p=e[6],c=e[10],u=e[14],m=e[3],g=e[7],h=e[11],y=e[15];return m*(+o*s*p-r*d*p-o*i*c+a*d*c+r*i*u-a*s*u)+g*(+t*s*u-t*d*c+o*n*c-r*n*u+r*d*l-o*s*l)+h*(+t*d*p-t*i*u-o*n*p+a*n*u+o*i*l-a*d*l)+y*(-r*i*l-t*s*p+t*i*c+r*n*p-a*n*c+a*s*l)}}(),transpose:function(){return function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}}(),setPosition:function(){return function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}}(),getInverse:function(){return function(e,t){var a=this.elements,r=e.elements,o=r[0],n=r[1],i=r[2],s=r[3],d=r[4],l=r[5],p=r[6],c=r[7],u=r[8],m=r[9],g=r[10],h=r[11],y=r[12],f=r[13],x=r[14],v=r[15],_=m*x*c-f*g*c+f*p*h-l*x*h-m*p*v+l*g*v,b=y*g*c-u*x*c-y*p*h+d*x*h+u*p*v-d*g*v,T=u*f*c-y*m*c+y*l*h-d*f*h-u*l*v+d*m*v,S=y*m*p-u*f*p-y*l*g+d*f*g+u*l*x-d*m*x,E=o*_+n*b+i*T+s*S;if(0==E){var C="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(C);else console.warn(C);return this.identity()}var P=1/E;return a[0]=_*P,a[1]=(f*g*s-m*x*s-f*i*h+n*x*h+m*i*v-n*g*v)*P,a[2]=(l*x*s-f*p*s+f*i*c-n*x*c-l*i*v+n*p*v)*P,a[3]=(m*p*s-l*g*s-m*i*c+n*g*c+l*i*h-n*p*h)*P,a[4]=b*P,a[5]=(u*x*s-y*g*s+y*i*h-o*x*h-u*i*v+o*g*v)*P,a[6]=(y*p*s-d*x*s-y*i*c+o*x*c+d*i*v-o*p*v)*P,a[7]=(d*g*s-u*p*s+u*i*c-o*g*c-d*i*h+o*p*h)*P,a[8]=T*P,a[9]=(y*m*s-u*f*s-y*n*h+o*f*h+u*n*v-o*m*v)*P,a[10]=(d*f*s-y*l*s+y*n*c-o*f*c-d*n*v+o*l*v)*P,a[11]=(u*l*s-d*m*s-u*n*c+o*m*c+d*n*h-o*l*h)*P,a[12]=S*P,a[13]=(u*f*i-y*m*i+y*n*g-o*f*g-u*n*x+o*m*x)*P,a[14]=(y*l*i-d*f*i-y*n*p+o*f*p+d*n*x-o*l*x)*P,a[15]=(d*m*i-u*l*i+u*n*p-o*m*p-d*n*g+o*l*g)*P,this}}(),scale:function(){return function(e){var t=this.elements,a=e.x,r=e.y,o=e.z;return t[0]*=a,t[4]*=r,t[8]*=o,t[1]*=a,t[5]*=r,t[9]*=o,t[2]*=a,t[6]*=r,t[10]*=o,t[3]*=a,t[7]*=r,t[11]*=o,this}}(),getMaxScaleOnAxis:function(){return function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],a=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Yo(en(t,a,r))}}(),makeTranslation:function(){return function(e,t,a){return this.set(1,0,0,e,0,1,0,t,0,0,1,a,0,0,0,1),this}}(),makeRotationX:function(){return function(e){var t=Xo(e),a=Vo(e);return this.set(1,0,0,0,0,t,-a,0,0,a,t,0,0,0,0,1),this}}(),makeRotationY:function(){return function(e){var t=Xo(e),a=Vo(e);return this.set(t,0,a,0,0,1,0,0,-a,0,t,0,0,0,0,1),this}}(),makeRotationZ:function(){return function(e){var t=Xo(e),a=Vo(e);return this.set(t,-a,0,0,a,t,0,0,0,0,1,0,0,0,0,1),this}}(),makeRotationAxis:function(){return function(e,a){var r=Xo(a),o=Vo(a),n=1-r,t=e.x,i=e.y,s=e.z,d=n*t,l=n*i;return this.set(d*t+r,d*i-o*s,d*s+o*i,0,d*i+o*s,l*i+r,l*s-o*t,0,d*s-o*i,l*s+o*t,n*s*s+r,0,0,0,0,1),this}}(),makeScale:function(){return function(e,t,a){return this.set(e,0,0,0,0,t,0,0,0,0,a,0,0,0,0,1),this}}(),makeShear:function(){return function(e,t,a){return this.set(1,t,a,0,e,1,a,0,e,t,1,0,0,0,0,1),this}}(),compose:function(){return function(e,t,a){return this.makeRotationFromQuaternion(t),this.scale(a),this.setPosition(e),this}}(),decompose:function(){var e=new m,t=new l;return function(){return function(a,r,o){var n=this.elements,i=e.set(n[0],n[1],n[2]).length(),s=e.set(n[4],n[5],n[6]).length(),d=e.set(n[8],n[9],n[10]).length(),l=this.determinant();0>l&&(i=-i),a.x=n[12],a.y=n[13],a.z=n[14],t.copy(this);var p=1/i,c=1/s,u=1/d;return t.elements[0]*=p,t.elements[1]*=p,t.elements[2]*=p,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=u,t.elements[9]*=u,t.elements[10]*=u,r.setFromRotationMatrix(t),o.x=i,o.y=s,o.z=d,this}}()}(),makePerspective:function(){return function(e,t,a,r,o,n){void 0===n&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var i=this.elements;return i[0]=2*o/(t-e),i[4]=0,i[8]=(t+e)/(t-e),i[12]=0,i[1]=0,i[5]=2*o/(a-r),i[9]=(a+r)/(a-r),i[13]=0,i[2]=0,i[6]=0,i[10]=-(n+o)/(n-o),i[14]=-2*n*o/(n-o),i[3]=0,i[7]=0,i[11]=-1,i[15]=0,this}}(),makeOrthographic:function(){return function(e,t,a,r,o,n){var i=this.elements,s=1/(t-e),d=1/(a-r),l=1/(n-o);return i[0]=2*s,i[4]=0,i[8]=0,i[12]=-((t+e)*s),i[1]=0,i[5]=2*d,i[9]=0,i[13]=-((a+r)*d),i[2]=0,i[6]=0,i[10]=-2*l,i[14]=-((n+o)*l),i[3]=0,i[7]=0,i[11]=0,i[15]=1,this}}(),equals:function(){return function(e){for(var t=this.elements,a=e.elements,r=0;16>r;r++)if(t[r]!==a[r])return!1;return!0}}(),fromArray:function(){return function(e,t){t===void 0&&(t=0);for(var a=0;16>a;a++)this.elements[a]=e[a+t];return this}}(),toArray:function(){return function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var a=this.elements;return e[t]=a[0],e[t+1]=a[1],e[t+2]=a[2],e[t+3]=a[3],e[t+4]=a[4],e[t+5]=a[5],e[t+6]=a[6],e[t+7]=a[7],e[t+8]=a[8],e[t+9]=a[9],e[t+10]=a[10],e[t+11]=a[11],e[t+12]=a[12],e[t+13]=a[13],e[t+14]=a[14],e[t+15]=a[15],e}}()}),p.prototype=Object.create(o.prototype),p.prototype.constructor=p,p.prototype.isDataTexture=!0,c.prototype=Object.create(o.prototype),c.prototype.constructor=c,c.prototype.isCubeTexture=!0,Object.defineProperty(c.prototype,"images",{get:function(){return function(){return this.image}}(),set:function(){return function(e){this.image=e}}()});var bs=new o,Ts=new c,Ss=[],Es=[],Cs=new Float32Array(16),Ps=new Float32Array(9);H.prototype.setValue=function(e,t){for(var a=this.seq,r=0,o=a.length,n;r!==o;++r)n=a[r],n.setValue(e,t[n.id])};var ws=/([\w\d_]+)(\])?(\[|\.)?/g;j.prototype.setValue=function(e,t,a){var r=this.map[t];r!==void 0&&r.setValue(e,a,this.renderer)},j.prototype.setOptional=function(e,t,a){var r=t[a];r!==void 0&&this.setValue(e,a,r)},j.upload=function(e,t,a,r){for(var o=0,i=t.length;o!==i;++o){var n=t[o],s=a[n.id];!1!==s.needsUpdate&&n.setValue(e,s.value,r)}},j.seqWithValue=function(e,t){for(var a=[],r=0,o=e.length,n;r!==o;++r)n=e[r],n.id in t&&a.push(n);return a};var As={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(q.prototype,{isColor:!0,r:1,g:1,b:1,set:function(){return function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}}(),setScalar:function(){return function(e){return this.r=e,this.g=e,this.b=e,this}}(),setHex:function(){return function(e){return e=on(e),this.r=(255&e>>16)/255,this.g=(255&e>>8)/255,this.b=(255&e)/255,this}}(),setRGB:function(){return function(e,t,a){return this.r=e,this.g=t,this.b=a,this}}(),setHSL:function(){function e(e,a,r){return 0>r&&(r+=1),1<r&&(r-=1),r<1/6?e+6*(a-e)*r:r<1/2?a:r<2/3?e+6*(a-e)*(2/3-r):e}return function(){return function(t,a,r){if(t=vs.euclideanModulo(t,1),a=vs.clamp(a,0,1),r=vs.clamp(r,0,1),0===a)this.r=this.g=this.b=r;else{var o=.5>=r?r*(1+a):r+a-r*a,n=2*r-o;this.r=e(n,o,t+1/3),this.g=e(n,o,t),this.b=e(n,o,t-1/3)}return this}}()}(),setStyle:function(){return function(e){function t(t){void 0===t||1>parseFloat(t)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var a;if(a=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r=a[1],o=a[2],n;switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=tn(255,parseInt(n[1],10))/255,this.g=tn(255,parseInt(n[2],10))/255,this.b=tn(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=tn(100,parseInt(n[1],10))/100,this.g=tn(100,parseInt(n[2],10))/100,this.b=tn(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var i=parseFloat(n[1])/360,d=parseInt(n[2],10)/100,s=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(i,d,s)}}}else if(a=/^\#([A-Fa-f0-9]+)$/.exec(e)){var l=a[1],p=l.length;if(3===p)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===p)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}if(e&&0<e.length){var l=As[e];void 0===l?console.warn("THREE.Color: Unknown color "+e):this.setHex(l)}return this}}(),clone:function(){return function(){return new this.constructor(this.r,this.g,this.b)}}(),copy:function(){return function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}}(),copyGammaToLinear:function(){return function(e,t){return void 0===t&&(t=2),this.r=Zo(e.r,t),this.g=Zo(e.g,t),this.b=Zo(e.b,t),this}}(),copyLinearToGamma:function(){return function(e,t){void 0===t&&(t=2);var a=0<t?1/t:1;return this.r=Zo(e.r,a),this.g=Zo(e.g,a),this.b=Zo(e.b,a),this}}(),convertGammaToLinear:function(){return function(){var e=this.r,t=this.g,a=this.b;return this.r=e*e,this.g=t*t,this.b=a*a,this}}(),convertLinearToGamma:function(){return function(){return this.r=Yo(this.r),this.g=Yo(this.g),this.b=Yo(this.b),this}}(),getHex:function(){return function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}}(),getHexString:function(){return function(){return("000000"+this.getHex().toString(16)).slice(-6)}}(),getHSL:function(){return function(e){var t=e||{h:0,s:0,l:0},a=this.r,r=this.g,o=this.b,n=en(a,r,o),i=tn(a,r,o),s=(i+n)/2,d,l;if(i===n)d=0,l=0;else{var p=n-i;l=.5>=s?p/(n+i):p/(2-n-i),n===a?d=(r-o)/p+(r<o?6:0):n===r?d=(o-a)/p+2:n===o?d=(a-r)/p+4:void 0,d/=6}return t.h=d,t.s=l,t.l=s,t}}(),getStyle:function(){return function(){return"rgb("+(0|255*this.r)+","+(0|255*this.g)+","+(0|255*this.b)+")"}}(),offsetHSL:function(){return function(e,t,a){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=a,this.setHSL(r.h,r.s,r.l),this}}(),add:function(){return function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}}(),addColors:function(){return function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}}(),addScalar:function(){return function(e){return this.r+=e,this.g+=e,this.b+=e,this}}(),sub:function(){return function(e){return this.r=en(0,this.r-e.r),this.g=en(0,this.g-e.g),this.b=en(0,this.b-e.b),this}}(),multiply:function(){return function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}}(),multiplyScalar:function(){return function(e){return this.r*=e,this.g*=e,this.b*=e,this}}(),lerp:function(){return function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}}(),equals:function(){return function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}}(),fromArray:function(){return function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}}(),toArray:function(){return function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}}(),toJSON:function(){return function(){return this.getHex()}}()});var Rs={common:{diffuse:{value:new q(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new n(0,0,1,1)},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new r(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new q(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new q(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new n(0,0,1,1)}}},Ms={merge:function(){return function(e){for(var t={},a=0,r;a<e.length;a++)for(var o in r=this.clone(e[a]),r)t[o]=r[o];return t}}(),clone:function(){return function(e){var t={};for(var a in e)for(var r in t[a]={},e[a]){var o=e[a][r];t[a][r]=o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture)?o.clone():Array.isArray(o)?o.slice():o}return t}}()},Ls={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.86267 + (0.49788 + 0.01436 * y ) * y;\n\tfloat b = 3.45068 + (4.18814 + y) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt( 1.0 - x * x ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transpose( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tvec3 result = vec3( LTC_ClippedSphereFormFactor( vectorFormFactor ) );\n\treturn result;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tfloat norm = texture2D( ltcMag, uv ).a;\n\t\tvec4 t = texture2D( ltcMat, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3(   1,   0, t.y ),\n\t\t\tvec3(   0, t.z,   0 ),\n\t\t\tvec3( t.w,   0, t.x )\n\t\t);\n\t\treflectedLight.directSpecular += lightColor * material.specularColor * norm * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"},Bs={basic:{uniforms:Ms.merge([Rs.common,Rs.specularmap,Rs.envmap,Rs.aomap,Rs.lightmap,Rs.fog]),vertexShader:Ls.meshbasic_vert,fragmentShader:Ls.meshbasic_frag},lambert:{uniforms:Ms.merge([Rs.common,Rs.specularmap,Rs.envmap,Rs.aomap,Rs.lightmap,Rs.emissivemap,Rs.fog,Rs.lights,{emissive:{value:new q(0)}}]),vertexShader:Ls.meshlambert_vert,fragmentShader:Ls.meshlambert_frag},phong:{uniforms:Ms.merge([Rs.common,Rs.specularmap,Rs.envmap,Rs.aomap,Rs.lightmap,Rs.emissivemap,Rs.bumpmap,Rs.normalmap,Rs.displacementmap,Rs.gradientmap,Rs.fog,Rs.lights,{emissive:{value:new q(0)},specular:{value:new q(1118481)},shininess:{value:30}}]),vertexShader:Ls.meshphong_vert,fragmentShader:Ls.meshphong_frag},standard:{uniforms:Ms.merge([Rs.common,Rs.envmap,Rs.aomap,Rs.lightmap,Rs.emissivemap,Rs.bumpmap,Rs.normalmap,Rs.displacementmap,Rs.roughnessmap,Rs.metalnessmap,Rs.fog,Rs.lights,{emissive:{value:new q(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Ls.meshphysical_vert,fragmentShader:Ls.meshphysical_frag},points:{uniforms:Ms.merge([Rs.points,Rs.fog]),vertexShader:Ls.points_vert,fragmentShader:Ls.points_frag},dashed:{uniforms:Ms.merge([Rs.common,Rs.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ls.linedashed_vert,fragmentShader:Ls.linedashed_frag},depth:{uniforms:Ms.merge([Rs.common,Rs.displacementmap]),vertexShader:Ls.depth_vert,fragmentShader:Ls.depth_frag},normal:{uniforms:Ms.merge([Rs.common,Rs.bumpmap,Rs.normalmap,Rs.displacementmap,{opacity:{value:1}}]),vertexShader:Ls.normal_vert,fragmentShader:Ls.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ls.cube_vert,fragmentShader:Ls.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ls.equirect_vert,fragmentShader:Ls.equirect_frag},distanceRGBA:{uniforms:Ms.merge([Rs.common,Rs.displacementmap,{referencePosition:{value:new m},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ls.distanceRGBA_vert,fragmentShader:Ls.distanceRGBA_frag},shadow:{uniforms:Ms.merge([Rs.lights,{color:{value:new q(0)},opacity:{value:1}}]),vertexShader:Ls.shadow_vert,fragmentShader:Ls.shadow_frag}};Bs.physical={uniforms:Ms.merge([Bs.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Ls.meshphysical_vert,fragmentShader:Ls.meshphysical_frag},Object.assign(Y.prototype,{set:function(){return function(e,t){return this.min.copy(e),this.max.copy(t),this}}(),setFromPoints:function(){return function(e){this.makeEmpty();for(var t=0,a=e.length;t<a;t++)this.expandByPoint(e[t]);return this}}(),setFromCenterAndSize:function(){var e=new r;return function(){return function(t,a){var r=e.copy(a).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}()}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){return this.min.copy(e.min),this.max.copy(e.max),this}}(),makeEmpty:function(){return function(){return this.min.x=this.min.y=+Infinity,this.max.x=this.max.y=-Infinity,this}}(),isEmpty:function(){return function(){return this.max.x<this.min.x||this.max.y<this.min.y}}(),getCenter:function(){return function(e){var t=e||new r;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}}(),getSize:function(){return function(e){var t=e||new r;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}}(),expandByPoint:function(){return function(e){return this.min.min(e),this.max.max(e),this}}(),expandByVector:function(){return function(e){return this.min.sub(e),this.max.add(e),this}}(),expandByScalar:function(){return function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}}(),containsPoint:function(){return function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}}(),containsBox:function(){return function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}}(),getParameter:function(){return function(e,t){var a=t||new r;return a.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}}(),intersectsBox:function(){return function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}}(),clampPoint:function(){return function(e,t){var a=t||new r;return a.copy(e).clamp(this.min,this.max)}}(),distanceToPoint:function(){var e=new r;return function(){return function(t){var a=e.copy(t).clamp(this.min,this.max);return a.sub(t).length()}}()}(),intersect:function(){return function(e){return this.min.max(e.min),this.max.min(e.max),this}}(),union:function(){return function(e){return this.min.min(e.min),this.max.max(e.max),this}}(),translate:function(){return function(e){return this.min.add(e),this.max.add(e),this}}(),equals:function(){return function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}()}),Z.prototype=Object.create(o.prototype),Z.prototype.constructor=Z;var Ds=0;Object.assign(Q.prototype,a.prototype,{isMaterial:!0,onBeforeCompile:function(){return function(){}}(),setValues:function(){return function(e){if(void 0!==e)for(var t in e){var a=e[t];if(void 0===a){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"==t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=a===vn;continue}var r=this[t];if(void 0===r){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(a):r&&r.isVector3&&a&&a.isVector3?r.copy(a):"overdraw"==t?this[t]=+a:this[t]=a}}}(),toJSON:function(){return function(e){function t(e){var t=[];for(var a in e){var r=e[a];delete r.metadata,t.push(r)}return t}var a=void 0===e;a&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearCoat&&(r.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(r.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==En&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==yn&&(r.side=this.side),this.vertexColors!==_n&&(r.vertexColors=this.vertexColors),1>this.opacity&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,!0===this.dithering&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),a){var o=t(e.textures),n=t(e.images);0<o.length&&(r.textures=o),0<n.length&&(r.images=n)}return r}}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,a=null;if(null!==t){var r=t.length;a=Array(r);for(var o=0;o!==r;++o)a[o]=t[o].clone()}return this.clippingPlanes=a,this}}(),dispose:function(){return function(){this.dispatchEvent({type:"dispose"})}}()}),$.prototype=Object.create(Q.prototype),$.prototype.constructor=$,$.prototype.isShaderMaterial=!0,$.prototype.copy=function(e){return Q.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ms.clone(e.uniforms),this.defines=e.defines,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},$.prototype.toJSON=function(e){var t=Q.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},ee.prototype=Object.create(Q.prototype),ee.prototype.constructor=ee,ee.prototype.isMeshDepthMaterial=!0,ee.prototype.copy=function(e){return Q.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},te.prototype=Object.create(Q.prototype),te.prototype.constructor=te,te.prototype.isMeshDistanceMaterial=!0,te.prototype.copy=function(e){return Q.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Object.assign(ae.prototype,{isBox3:!0,set:function(){return function(e,t){return this.min.copy(e),this.max.copy(t),this}}(),setFromArray:function(){return function(e){for(var t=+Infinity,a=+Infinity,r=+Infinity,o=-Infinity,n=-Infinity,s=-Infinity,d=0,i=e.length;d<i;d+=3){var l=e[d],p=e[d+1],c=e[d+2];l<t&&(t=l),p<a&&(a=p),c<r&&(r=c),l>o&&(o=l),p>n&&(n=p),c>s&&(s=c)}return this.min.set(t,a,r),this.max.set(o,n,s),this}}(),setFromBufferAttribute:function(){return function(e){for(var t=+Infinity,a=+Infinity,r=+Infinity,o=-Infinity,n=-Infinity,s=-Infinity,d=0,i=e.count;d<i;d++){var l=e.getX(d),p=e.getY(d),c=e.getZ(d);l<t&&(t=l),p<a&&(a=p),c<r&&(r=c),l>o&&(o=l),p>n&&(n=p),c>s&&(s=c)}return this.min.set(t,a,r),this.max.set(o,n,s),this}}(),setFromPoints:function(){return function(e){this.makeEmpty();for(var t=0,a=e.length;t<a;t++)this.expandByPoint(e[t]);return this}}(),setFromCenterAndSize:function(){var e=new m;return function(){return function(t,a){var r=e.copy(a).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}()}(),setFromObject:function(){return function(e){return this.makeEmpty(),this.expandByObject(e)}}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){return this.min.copy(e.min),this.max.copy(e.max),this}}(),makeEmpty:function(){return function(){return this.min.x=this.min.y=this.min.z=+Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this}}(),isEmpty:function(){return function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}}(),getCenter:function(){return function(e){var t=e||new m;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}}(),getSize:function(){return function(e){var t=e||new m;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}}(),expandByPoint:function(){return function(e){return this.min.min(e),this.max.max(e),this}}(),expandByVector:function(){return function(e){return this.min.sub(e),this.max.add(e),this}}(),expandByScalar:function(){return function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}}(),expandByObject:function(){var e=new m;return function(){return function(t){var a=this;return t.updateMatrixWorld(!0),t.traverse(function(t){var r=t.geometry,o,n;if(void 0!==r)if(r.isGeometry){var i=r.vertices;for(o=0,n=i.length;o<n;o++)e.copy(i[o]),e.applyMatrix4(t.matrixWorld),a.expandByPoint(e)}else if(r.isBufferGeometry){var s=r.attributes.position;if(void 0!==s)for(o=0,n=s.count;o<n;o++)e.fromBufferAttribute(s,o).applyMatrix4(t.matrixWorld),a.expandByPoint(e)}}),this}}()}(),containsPoint:function(){return function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}}(),containsBox:function(){return function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}}(),getParameter:function(){return function(e,t){var a=t||new m;return a.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}}(),intersectsBox:function(){return function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}}(),intersectsSphere:function(){var e=new m;return function(){return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}()}(),intersectsPlane:function(){return function(e){var t,a;return 0<e.normal.x?(t=e.normal.x*this.min.x,a=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,a=e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,a+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,a+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,a+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,a+=e.normal.z*this.min.z),t<=e.constant&&a>=e.constant}}(),clampPoint:function(){return function(e,t){var a=t||new m;return a.copy(e).clamp(this.min,this.max)}}(),distanceToPoint:function(){var e=new m;return function(){return function(t){var a=e.copy(t).clamp(this.min,this.max);return a.sub(t).length()}}()}(),getBoundingSphere:function(){var e=new m;return function(){return function(t){var a=t||new re;return this.getCenter(a.center),a.radius=.5*this.getSize(e).length(),a}}()}(),intersect:function(){return function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}}(),union:function(){return function(e){return this.min.min(e.min),this.max.max(e.max),this}}(),applyMatrix4:function(){var e=[new m,new m,new m,new m,new m,new m,new m,new m];return function(){return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}()}(),translate:function(){return function(e){return this.min.add(e),this.max.add(e),this}}(),equals:function(){return function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}()}),Object.assign(re.prototype,{set:function(){return function(e,t){return this.center.copy(e),this.radius=t,this}}(),setFromPoints:function(){var e=new ae;return function(){return function(t,a){var r=this.center;void 0===a?e.setFromPoints(t).getCenter(r):r.copy(a);for(var o=0,n=0,i=t.length;n<i;n++)o=en(o,r.distanceToSquared(t[n]));return this.radius=Yo(o),this}}()}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){return this.center.copy(e.center),this.radius=e.radius,this}}(),empty:function(){return function(){return 0>=this.radius}}(),containsPoint:function(){return function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}}(),distanceToPoint:function(){return function(e){return e.distanceTo(this.center)-this.radius}}(),intersectsSphere:function(){return function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}}(),intersectsBox:function(){return function(e){return e.intersectsSphere(this)}}(),intersectsPlane:function(){return function(e){return qo(e.distanceToPoint(this.center))<=this.radius}}(),clampPoint:function(){return function(e,t){var a=this.center.distanceToSquared(e),r=t||new m;return r.copy(e),a>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r}}(),getBoundingBox:function(){return function(e){var t=e||new ae;return t.set(this.center,this.center),t.expandByScalar(this.radius),t}}(),applyMatrix4:function(){return function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this}}(),translate:function(){return function(e){return this.center.add(e),this}}(),equals:function(){return function(e){return e.center.equals(this.center)&&e.radius===this.radius}}()}),Object.assign(oe.prototype,{isMatrix3:!0,set:function(){return function(e,t,a,r,o,n,i,s,d){var l=this.elements;return l[0]=e,l[1]=r,l[2]=i,l[3]=t,l[4]=o,l[5]=s,l[6]=a,l[7]=n,l[8]=d,this}}(),identity:function(){return function(){return this.set(1,0,0,0,1,0,0,0,1),this}}(),clone:function(){return function(){return new this.constructor().fromArray(this.elements)}}(),copy:function(){return function(e){var t=this.elements,a=e.elements;return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],this}}(),setFromMatrix4:function(){return function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}}(),applyToBufferAttribute:function(){var e=new m;return function(){return function(t){for(var a=0,r=t.count;a<r;a++)e.x=t.getX(a),e.y=t.getY(a),e.z=t.getZ(a),e.applyMatrix3(this),t.setXYZ(a,e.x,e.y,e.z);return t}}()}(),multiply:function(){return function(e){return this.multiplyMatrices(this,e)}}(),premultiply:function(){return function(e){return this.multiplyMatrices(e,this)}}(),multiplyMatrices:function(){return function(e,t){var a=e.elements,r=t.elements,o=this.elements,n=a[0],i=a[3],s=a[6],d=a[1],l=a[4],p=a[7],c=a[2],u=a[5],m=a[8],g=r[0],h=r[3],y=r[6],f=r[1],x=r[4],v=r[7],_=r[2],b=r[5],T=r[8];return o[0]=n*g+i*f+s*_,o[3]=n*h+i*x+s*b,o[6]=n*y+i*v+s*T,o[1]=d*g+l*f+p*_,o[4]=d*h+l*x+p*b,o[7]=d*y+l*v+p*T,o[2]=c*g+u*f+m*_,o[5]=c*h+u*x+m*b,o[8]=c*y+u*v+m*T,this}}(),multiplyScalar:function(){return function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}}(),determinant:function(){return function(){var t=this.elements,r=t[0],a=t[1],o=t[2],n=t[3],s=t[4],e=t[5],d=t[6],l=t[7],p=t[8];return r*s*p-r*e*l-a*n*p+a*e*d+o*n*l-o*s*d}}(),getInverse:function(){return function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var a=e.elements,r=this.elements,o=a[0],n=a[1],i=a[2],s=a[3],d=a[4],l=a[5],p=a[6],c=a[7],u=a[8],m=u*d-l*c,g=l*p-u*s,h=c*s-d*p,y=o*m+n*g+i*h;if(0==y){var f="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(f);else console.warn(f);return this.identity()}var x=1/y;return r[0]=m*x,r[1]=(i*c-u*n)*x,r[2]=(l*n-i*d)*x,r[3]=g*x,r[4]=(u*o-i*p)*x,r[5]=(i*s-l*o)*x,r[6]=h*x,r[7]=(n*p-c*o)*x,r[8]=(d*o-n*s)*x,this}}(),transpose:function(){return function(){var e=this.elements,t;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}}(),getNormalMatrix:function(){return function(e){return this.setFromMatrix4(e).getInverse(this).transpose()}}(),transposeIntoArray:function(){return function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}}(),equals:function(){return function(e){for(var t=this.elements,a=e.elements,r=0;9>r;r++)if(t[r]!==a[r])return!1;return!0}}(),fromArray:function(){return function(e,t){t===void 0&&(t=0);for(var a=0;9>a;a++)this.elements[a]=e[a+t];return this}}(),toArray:function(){return function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var a=this.elements;return e[t]=a[0],e[t+1]=a[1],e[t+2]=a[2],e[t+3]=a[3],e[t+4]=a[4],e[t+5]=a[5],e[t+6]=a[6],e[t+7]=a[7],e[t+8]=a[8],e}}()}),Object.assign(ne.prototype,{set:function(){return function(e,t){return this.normal.copy(e),this.constant=t,this}}(),setComponents:function(){return function(e,t,a,r){return this.normal.set(e,t,a),this.constant=r,this}}(),setFromNormalAndCoplanarPoint:function(){return function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}}(),setFromCoplanarPoints:function(){var e=new m,t=new m;return function(){return function(r,a,o){var n=e.subVectors(o,a).cross(t.subVectors(r,a)).normalize();return this.setFromNormalAndCoplanarPoint(n,r),this}}()}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}}(),normalize:function(){return function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}}(),negate:function(){return function(){return this.constant*=-1,this.normal.negate(),this}}(),distanceToPoint:function(){return function(e){return this.normal.dot(e)+this.constant}}(),distanceToSphere:function(){return function(e){return this.distanceToPoint(e.center)-e.radius}}(),projectPoint:function(){return function(e,t){var a=t||new m;return a.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}}(),intersectLine:function(){var e=new m;return function(){return function(a,r){var o=r||new m,n=a.delta(e),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(a.start)?o.copy(a.start):void 0;var s=-(a.start.dot(this.normal)+this.constant)/i;return 0>s||1<s?void 0:o.copy(n).multiplyScalar(s).add(a.start)}}()}(),intersectsLine:function(){return function(e){var t=this.distanceToPoint(e.start),a=this.distanceToPoint(e.end);return 0>t&&0<a||0>a&&0<t}}(),intersectsBox:function(){return function(e){return e.intersectsPlane(this)}}(),intersectsSphere:function(){return function(e){return e.intersectsPlane(this)}}(),coplanarPoint:function(){return function(e){var t=e||new m;return t.copy(this.normal).multiplyScalar(-this.constant)}}(),applyMatrix4:function(){var e=new m,t=new oe;return function(){return function(a,r){var o=r||t.getNormalMatrix(a),n=this.coplanarPoint(e).applyMatrix4(a),i=this.normal.applyMatrix3(o).normalize();return this.constant=-n.dot(i),this}}()}(),translate:function(){return function(e){return this.constant-=e.dot(this.normal),this}}(),equals:function(){return function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}()}),Object.assign(ie.prototype,{set:function(){return function(e,t,a,r,o,n){var i=this.planes;return i[0].copy(e),i[1].copy(t),i[2].copy(a),i[3].copy(r),i[4].copy(o),i[5].copy(n),this}}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){for(var t=this.planes,a=0;6>a;a++)t[a].copy(e.planes[a]);return this}}(),setFromMatrix:function(){return function(e){var t=this.planes,a=e.elements,r=a[0],o=a[1],n=a[2],i=a[3],s=a[4],d=a[5],l=a[6],p=a[7],c=a[8],u=a[9],m=a[10],g=a[11],h=a[12],y=a[13],f=a[14],x=a[15];return t[0].setComponents(i-r,p-s,g-c,x-h).normalize(),t[1].setComponents(i+r,p+s,g+c,x+h).normalize(),t[2].setComponents(i+o,p+d,g+u,x+y).normalize(),t[3].setComponents(i-o,p-d,g-u,x-y).normalize(),t[4].setComponents(i-n,p-l,g-m,x-f).normalize(),t[5].setComponents(i+n,p+l,g+m,x+f).normalize(),this}}(),intersectsObject:function(){var e=new re;return function(){return function(t){var a=t.geometry;return null===a.boundingSphere&&a.computeBoundingSphere(),e.copy(a.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}()}(),intersectsSprite:function(){var e=new re;return function(){return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}()}(),intersectsSphere:function(){return function(e){for(var t=this.planes,a=e.center,r=-e.radius,o=0,n;6>o;o++)if(n=t[o].distanceToPoint(a),n<r)return!1;return!0}}(),intersectsBox:function(){var e=new m,t=new m;return function(){return function(a){for(var r=this.planes,o=0,n;6>o;o++){n=r[o],e.x=0<n.normal.x?a.min.x:a.max.x,t.x=0<n.normal.x?a.max.x:a.min.x,e.y=0<n.normal.y?a.min.y:a.max.y,t.y=0<n.normal.y?a.max.y:a.min.y,e.z=0<n.normal.z?a.min.z:a.max.z,t.z=0<n.normal.z?a.max.z:a.min.z;var i=n.distanceToPoint(e),s=n.distanceToPoint(t);if(0>i&&0>s)return!1}return!0}}()}(),containsPoint:function(){return function(e){for(var t=this.planes,a=0;6>a;a++)if(0>t[a].distanceToPoint(e))return!1;return!0}}()}),le.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],le.DefaultOrder="XYZ",Object.defineProperties(le.prototype,{x:{get:function(){return function(){return this._x}}(),set:function(){return function(e){this._x=e,this.onChangeCallback()}}()},y:{get:function(){return function(){return this._y}}(),set:function(){return function(e){this._y=e,this.onChangeCallback()}}()},z:{get:function(){return function(){return this._z}}(),set:function(){return function(e){this._z=e,this.onChangeCallback()}}()},order:{get:function(){return function(){return this._order}}(),set:function(){return function(e){this._order=e,this.onChangeCallback()}}()}}),Object.assign(le.prototype,{isEuler:!0,set:function(){return function(e,t,a,r){return this._x=e,this._y=t,this._z=a,this._order=r||this._order,this.onChangeCallback(),this}}(),clone:function(){return function(){return new this.constructor(this._x,this._y,this._z,this._order)}}(),copy:function(){return function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this}}(),setFromRotationMatrix:function(){return function(e,t,a){var r=vs.clamp,o=e.elements,n=o[0],i=o[4],s=o[8],d=o[1],l=o[5],p=o[9],c=o[2],u=o[6],m=o[10];return t=t||this._order,"XYZ"===t?(this._y=Wo(r(s,-1,1)),.99999>qo(s)?(this._x=jo(-p,m),this._z=jo(-i,n)):(this._x=jo(u,l),this._z=0)):"YXZ"===t?(this._x=Wo(-r(p,-1,1)),.99999>qo(p)?(this._y=jo(s,m),this._z=jo(d,l)):(this._y=jo(-c,n),this._z=0)):"ZXY"===t?(this._x=Wo(r(u,-1,1)),.99999>qo(u)?(this._y=jo(-c,m),this._z=jo(-i,l)):(this._y=0,this._z=jo(d,n))):"ZYX"===t?(this._y=Wo(-r(c,-1,1)),.99999>qo(c)?(this._x=jo(u,m),this._z=jo(d,n)):(this._x=0,this._z=jo(-i,l))):"YZX"===t?(this._z=Wo(r(d,-1,1)),.99999>qo(d)?(this._x=jo(-p,l),this._y=jo(-c,n)):(this._x=0,this._y=jo(s,m))):"XZY"===t?(this._z=Wo(-r(i,-1,1)),.99999>qo(i)?(this._x=jo(u,l),this._y=jo(s,n)):(this._x=jo(-p,m),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==a&&this.onChangeCallback(),this}}(),setFromQuaternion:function(){var e=new l;return function(){return function(t,a,r){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,a,r)}}()}(),setFromVector3:function(){return function(e,t){return this.set(e.x,e.y,e.z,t||this._order)}}(),reorder:function(){var e=new d;return function(){return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}()}(),equals:function(){return function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}}(),fromArray:function(){return function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this}}(),toArray:function(){return function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}}(),toVector3:function(){return function(e){return e?e.set(this._x,this._y,this._z):new m(this._x,this._y,this._z)}}(),onChange:function(){return function(e){return this.onChangeCallback=e,this}}(),onChangeCallback:function(){return function(){}}()}),Object.assign(pe.prototype,{set:function(){return function(e){this.mask=0|1<<e}}(),enable:function(){return function(e){this.mask|=0|1<<e}}(),toggle:function(){return function(e){this.mask^=0|1<<e}}(),disable:function(){return function(e){this.mask&=~(0|1<<e)}}(),test:function(){return function(e){return 0!=(this.mask&e.mask)}}()});var Is=0;ce.DefaultUp=new m(0,1,0),ce.DefaultMatrixAutoUpdate=!0,Object.assign(ce.prototype,a.prototype,{isObject3D:!0,onBeforeRender:function(){return function(){}}(),onAfterRender:function(){return function(){}}(),applyMatrix:function(){return function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)}}(),applyQuaternion:function(){return function(e){return this.quaternion.premultiply(e),this}}(),setRotationFromAxisAngle:function(){return function(e,t){this.quaternion.setFromAxisAngle(e,t)}}(),setRotationFromEuler:function(){return function(e){this.quaternion.setFromEuler(e,!0)}}(),setRotationFromMatrix:function(){return function(e){this.quaternion.setFromRotationMatrix(e)}}(),setRotationFromQuaternion:function(){return function(e){this.quaternion.copy(e)}}(),rotateOnAxis:function(){var e=new d;return function(){return function(t,a){return e.setFromAxisAngle(t,a),this.quaternion.multiply(e),this}}()}(),rotateX:function(){var e=new m(1,0,0);return function(){return function(t){return this.rotateOnAxis(e,t)}}()}(),rotateY:function(){var e=new m(0,1,0);return function(){return function(t){return this.rotateOnAxis(e,t)}}()}(),rotateZ:function(){var e=new m(0,0,1);return function(){return function(t){return this.rotateOnAxis(e,t)}}()}(),translateOnAxis:function(){var e=new m;return function(){return function(t,a){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(a)),this}}()}(),translateX:function(){var e=new m(1,0,0);return function(){return function(t){return this.translateOnAxis(e,t)}}()}(),translateY:function(){var e=new m(0,1,0);return function(){return function(t){return this.translateOnAxis(e,t)}}()}(),translateZ:function(){var e=new m(0,0,1);return function(){return function(t){return this.translateOnAxis(e,t)}}()}(),localToWorld:function(){return function(e){return e.applyMatrix4(this.matrixWorld)}}(),worldToLocal:function(){var e=new l;return function(){return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}()}(),lookAt:function(){var e=new l;return function(){return function(t){this.isCamera?e.lookAt(this.position,t,this.up):e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}()}(),add:function(){return function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}}(),remove:function(){return function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var a=this.children.indexOf(e);return-1!==a&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(a,1)),this}}(),getObjectById:function(){return function(e){return this.getObjectByProperty("id",e)}}(),getObjectByName:function(){return function(e){return this.getObjectByProperty("name",e)}}(),getObjectByProperty:function(){return function(e,t){if(this[e]===t)return this;for(var a=0,r=this.children.length;a<r;a++){var o=this.children[a],n=o.getObjectByProperty(e,t);if(n!==void 0)return n}}}(),getWorldPosition:function(){return function(e){var t=e||new m;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)}}(),getWorldQuaternion:function(){var e=new m,t=new m;return function(){return function(a){var r=a||new d;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}()}(),getWorldRotation:function(){var e=new d;return function(){return function(t){var a=t||new le;return this.getWorldQuaternion(e),a.setFromQuaternion(e,this.rotation.order,!1)}}()}(),getWorldScale:function(){var e=new m,t=new d;return function(){return function(a){var r=a||new m;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}()}(),getWorldDirection:function(){var e=new d;return function(){return function(t){var a=t||new m;return this.getWorldQuaternion(e),a.set(0,0,1).applyQuaternion(e)}}()}(),raycast:function(){return function(){}}(),traverse:function(){return function(e){e(this);for(var t=this.children,a=0,r=t.length;a<r;a++)t[a].traverse(e)}}(),traverseVisible:function(){return function(e){if(!1!==this.visible){e(this);for(var t=this.children,a=0,r=t.length;a<r;a++)t[a].traverseVisible(e)}}}(),traverseAncestors:function(){return function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}}(),updateMatrix:function(){return function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}}(),updateMatrixWorld:function(){return function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,a=0,r=t.length;a<r;a++)t[a].updateMatrixWorld(e)}}(),toJSON:function(){return function(e){function t(t,a){return void 0===t[a.uuid]&&(t[a.uuid]=a.toJSON(e)),a.uuid}function a(e){var t=[];for(var a in e){var r=e[a];delete r.metadata,t.push(r)}return t}var r=void 0===e||""===e,o={};r&&(e={geometries:{},materials:{},textures:{},images:{}},o.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.matrix=this.matrix.toArray(),void 0!==this.geometry&&(n.geometry=t(e.geometries,this.geometry)),void 0!==this.material)if(Array.isArray(this.material)){for(var s=[],d=0,i=this.material.length;d<i;d++)s.push(t(e.materials,this.material[d]));n.material=s}else n.material=t(e.materials,this.material);if(0<this.children.length){n.children=[];for(var d=0;d<this.children.length;d++)n.children.push(this.children[d].toJSON(e).object)}if(r){var l=a(e.geometries),p=a(e.materials),c=a(e.textures),u=a(e.images);0<l.length&&(o.geometries=l),0<p.length&&(o.materials=p),0<c.length&&(o.textures=c),0<u.length&&(o.images=u)}return o.object=n,o}}(),clone:function(){return function(e){return new this.constructor().copy(this,e)}}(),copy:function(){return function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var a=0,r;a<e.children.length;a++)r=e.children[a],this.add(r.clone());return this}}()}),ue.prototype=Object.assign(Object.create(ce.prototype),{constructor:ue,isCamera:!0,copy:function(){return function(e,t){return ce.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this}}(),getWorldDirection:function(){var e=new d;return function(){return function(t){var a=t||new m;return this.getWorldQuaternion(e),a.set(0,0,-1).applyQuaternion(e)}}()}(),updateMatrixWorld:function(){return function(e){ce.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)}}(),clone:function(){return function(){return new this.constructor().copy(this)}}()}),me.prototype=Object.assign(Object.create(ue.prototype),{constructor:me,isOrthographicCamera:!0,copy:function(){return function(e,t){return ue.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}}(),setViewOffset:function(){return function(e,t,a,r,o,n){this.view={fullWidth:e,fullHeight:t,offsetX:a,offsetY:r,width:o,height:n},this.updateProjectionMatrix()}}(),clearViewOffset:function(){return function(){this.view=null,this.updateProjectionMatrix()}}(),updateProjectionMatrix:function(){return function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),a=(this.right+this.left)/2,r=(this.top+this.bottom)/2,o=a-e,n=a+e,i=r+t,s=r-t;if(null!==this.view){var d=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),p=(this.right-this.left)/this.view.width,c=(this.top-this.bottom)/this.view.height;o+=p*(this.view.offsetX/d),n=o+p*(this.view.width/d),i-=c*(this.view.offsetY/l),s=i-c*(this.view.height/l)}this.projectionMatrix.makeOrthographic(o,n,i,s,this.near,this.far)}}(),toJSON:function(){return function(e){var t=ce.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}()}),ge.prototype=Object.assign(Object.create(ue.prototype),{constructor:ge,isPerspectiveCamera:!0,copy:function(){return function(e,t){return ue.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}}(),setFocalLength:function(){return function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*vs.RAD2DEG*zo(t),this.updateProjectionMatrix()}}(),getFocalLength:function(){return function(){var e=No(.5*vs.DEG2RAD*this.fov);return .5*this.getFilmHeight()/e}}(),getEffectiveFOV:function(){return function(){return 2*vs.RAD2DEG*zo(No(.5*vs.DEG2RAD*this.fov)/this.zoom)}}(),getFilmWidth:function(){return function(){return this.filmGauge*tn(this.aspect,1)}}(),getFilmHeight:function(){return function(){return this.filmGauge/en(this.aspect,1)}}(),setViewOffset:function(){return function(e,t,a,r,o,n){this.aspect=e/t,this.view={fullWidth:e,fullHeight:t,offsetX:a,offsetY:r,width:o,height:n},this.updateProjectionMatrix()}}(),clearViewOffset:function(){return function(){this.view=null,this.updateProjectionMatrix()}}(),updateProjectionMatrix:function(){return function(){var e=this.near,t=e*No(.5*vs.DEG2RAD*this.fov)/this.zoom,a=2*t,r=this.aspect*a,o=-.5*r,n=this.view;if(null!==n){var i=n.fullWidth,s=n.fullHeight;o+=n.offsetX*r/i,t-=n.offsetY*a/s,r*=n.width/i,a*=n.height/s}var d=this.filmOffset;0!==d&&(o+=e*d/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,t,t-a,e,this.far)}}(),toJSON:function(){return function(e){var t=ce.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}()}),Object.assign(he.prototype,{clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,a=e.vertexNormals.length;t<a;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,a=e.vertexColors.length;t<a;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}()});var Fs=0;Object.assign(fe.prototype,a.prototype,{isGeometry:!0,applyMatrix:function(){return function(e){for(var t=new oe().getNormalMatrix(e),a=0,r=this.vertices.length,o;a<r;a++)o=this.vertices[a],o.applyMatrix4(e);for(var a=0,r=this.faces.length,n;a<r;a++){n=this.faces[a],n.normal.applyMatrix3(t).normalize();for(var i=0,s=n.vertexNormals.length;i<s;i++)n.vertexNormals[i].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}}(),rotateX:function(){var e=new l;return function(){return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}()}(),rotateY:function(){var e=new l;return function(){return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}()}(),rotateZ:function(){var e=new l;return function(){return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}()}(),translate:function(){var e=new l;return function(){return function(t,a,r){return e.makeTranslation(t,a,r),this.applyMatrix(e),this}}()}(),scale:function(){var e=new l;return function(){return function(t,a,r){return e.makeScale(t,a,r),this.applyMatrix(e),this}}()}(),lookAt:function(){var e=new ce;return function(){return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}()}(),fromBufferGeometry:function(){function e(e){function t(e,t,a,r){var n=void 0===d?[]:[g[e].clone(),g[t].clone(),g[a].clone()],i=void 0===l?[]:[o.colors[e].clone(),o.colors[t].clone(),o.colors[a].clone()],s=new he(e,t,a,n,i,r);o.faces.push(s),void 0!==p&&o.faceVertexUvs[0].push([h[e].clone(),h[t].clone(),h[a].clone()]),void 0!==u&&o.faceVertexUvs[1].push([y[e].clone(),y[t].clone(),y[a].clone()])}var o=this,a=null===e.index?void 0:e.index.array,n=e.attributes,s=n.position.array,d=void 0===n.normal?void 0:n.normal.array,l=void 0===n.color?void 0:n.color.array,p=void 0===n.uv?void 0:n.uv.array,u=void 0===n.uv2?void 0:n.uv2.array;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var g=[],h=[],y=[],c=0,i=0;c<s.length;c+=3,i+=2)o.vertices.push(new m(s[c],s[c+1],s[c+2])),void 0!==d&&g.push(new m(d[c],d[c+1],d[c+2])),void 0!==l&&o.colors.push(new q(l[c],l[c+1],l[c+2])),void 0!==p&&h.push(new r(p[i],p[i+1])),void 0!==u&&y.push(new r(u[i],u[i+1]));var f=e.groups;if(0<f.length)for(var c=0;c<f.length;c++)for(var x=f[c],v=x.start,_=x.count,i=v;i<v+_;i+=3)void 0===a?t(i,i+1,i+2,x.materialIndex):t(a[i],a[i+1],a[i+2],x.materialIndex);else if(void 0!==a)for(var c=0;c<a.length;c+=3)t(a[c],a[c+1],a[c+2]);else for(var c=0;c<s.length/3;c+=3)t(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}return e}(),center:function(){return function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e}}(),normalize:function(){return function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,a=0===t?1:1/t,r=new l;return r.set(a,0,0,-a*e.x,0,a,0,-a*e.y,0,0,a,-a*e.z,0,0,0,1),this.applyMatrix(r),this}}(),computeFaceNormals:function(){return function(){for(var e=new m,t=new m,a=0,r=this.faces.length;a<r;a++){var o=this.faces[a],n=this.vertices[o.a],i=this.vertices[o.b],s=this.vertices[o.c];e.subVectors(s,i),t.subVectors(n,i),e.cross(t),e.normalize(),o.normal.copy(e)}}}(),computeVertexNormals:function(){return function(e){e===void 0&&(e=!0);var t,a,r,o,n,i;for(i=Array(this.vertices.length),t=0,a=this.vertices.length;t<a;t++)i[t]=new m;if(e){var s=new m,d=new m,l,p,c;for(r=0,o=this.faces.length;r<o;r++)n=this.faces[r],l=this.vertices[n.a],p=this.vertices[n.b],c=this.vertices[n.c],s.subVectors(c,p),d.subVectors(l,p),s.cross(d),i[n.a].add(s),i[n.b].add(s),i[n.c].add(s)}else for(this.computeFaceNormals(),r=0,o=this.faces.length;r<o;r++)n=this.faces[r],i[n.a].add(n.normal),i[n.b].add(n.normal),i[n.c].add(n.normal);for(t=0,a=this.vertices.length;t<a;t++)i[t].normalize();for(r=0,o=this.faces.length;r<o;r++){n=this.faces[r];var u=n.vertexNormals;3===u.length?(u[0].copy(i[n.a]),u[1].copy(i[n.b]),u[2].copy(i[n.c])):(u[0]=i[n.a].clone(),u[1]=i[n.b].clone(),u[2]=i[n.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)}}(),computeFlatVertexNormals:function(){return function(){var e,t,a;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){a=this.faces[e];var r=a.vertexNormals;3===r.length?(r[0].copy(a.normal),r[1].copy(a.normal),r[2].copy(a.normal)):(r[0]=a.normal.clone(),r[1]=a.normal.clone(),r[2]=a.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)}}(),computeMorphNormals:function(){return function(){var e,t,a,r,o;for(a=0,r=this.faces.length;a<r;a++)for(o=this.faces[a],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),(e=0,t=o.vertexNormals.length);e<t;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();var n=new fe;for(n.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var i=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals,d,l;for(a=0,r=this.faces.length;a<r;a++)d=new m,l={a:new m,b:new m,c:new m},i.push(d),s.push(l)}var p=this.morphNormals[e];n.vertices=this.morphTargets[e].vertices,n.computeFaceNormals(),n.computeVertexNormals();var d,l;for(a=0,r=this.faces.length;a<r;a++)o=this.faces[a],d=p.faceNormals[a],l=p.vertexNormals[a],d.copy(o.normal),l.a.copy(o.vertexNormals[0]),l.b.copy(o.vertexNormals[1]),l.c.copy(o.vertexNormals[2])}for(a=0,r=this.faces.length;a<r;a++)o=this.faces[a],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals}}(),computeLineDistances:function(){return function(){for(var e=0,t=this.vertices,a=0,r=t.length;a<r;a++)0<a&&(e+=t[a].distanceTo(t[a-1])),this.lineDistances[a]=e}}(),computeBoundingBox:function(){return function(){null===this.boundingBox&&(this.boundingBox=new ae),this.boundingBox.setFromPoints(this.vertices)}}(),computeBoundingSphere:function(){return function(){null===this.boundingSphere&&(this.boundingSphere=new re),this.boundingSphere.setFromPoints(this.vertices)}}(),merge:function(){return function(e,t,a){if(!(e&&e.isGeometry))return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);var r=this.vertices.length,o=this.vertices,n=e.vertices,s=this.faces,d=e.faces,l=this.faceVertexUvs[0],p=e.faceVertexUvs[0],c=this.colors,u=e.colors,m;a===void 0&&(a=0),t!==void 0&&(m=new oe().getNormalMatrix(t));for(var g=0,i=n.length;g<i;g++){var h=n[g],y=h.clone();t!==void 0&&y.applyMatrix4(t),o.push(y)}for(var g=0,i=u.length;g<i;g++)c.push(u[g].clone());for(g=0,i=d.length;g<i;g++){var f=d[g],x=f.vertexNormals,v=f.vertexColors,_,b,T;_=new he(f.a+r,f.b+r,f.c+r),_.normal.copy(f.normal),m!==void 0&&_.normal.applyMatrix3(m).normalize();for(var S=0,E=x.length;S<E;S++)b=x[S].clone(),void 0!==m&&b.applyMatrix3(m).normalize(),_.vertexNormals.push(b);_.color.copy(f.color);for(var S=0,E=v.length;S<E;S++)T=v[S],_.vertexColors.push(T.clone());_.materialIndex=f.materialIndex+a,s.push(_)}for(g=0,i=p.length;g<i;g++){var C=p[g],P=[];if(void 0!==C){for(var S=0,E=C.length;S<E;S++)P.push(C[S].clone());l.push(P)}}}}(),mergeMesh:function(){return function(e){return e&&e.isMesh?void(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)}}(),mergeVertices:function(){return function(){var e={},t=[],a=[],r=10000,o,s,d,i,l,p,c,u;for(d=0,i=this.vertices.length;d<i;d++)o=this.vertices[d],s=Jo(o.x*r)+"_"+Jo(o.y*r)+"_"+Jo(o.z*r),void 0===e[s]?(e[s]=d,t.push(this.vertices[d]),a[d]=t.length-1):a[d]=a[e[s]];var m=[];for(d=0,i=this.faces.length;d<i;d++){l=this.faces[d],l.a=a[l.a],l.b=a[l.b],l.c=a[l.c],p=[l.a,l.b,l.c];for(var g=0;3>g;g++)if(p[g]===p[(g+1)%3]){m.push(d);break}}for(d=m.length-1;0<=d;d--){var n=m[d];for(this.faces.splice(n,1),c=0,u=this.faceVertexUvs.length;c<u;c++)this.faceVertexUvs[c].splice(n,1)}var h=this.vertices.length-t.length;return this.vertices=t,h}}(),sortFacesByMaterialIndex:function(){return function(){for(var e=this.faces,t=e.length,a=0;a<t;a++)e[a]._id=a;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var r=this.faceVertexUvs[0],o=this.faceVertexUvs[1],n,i;r&&r.length===t&&(n=[]),o&&o.length===t&&(i=[]);for(var a=0,s;a<t;a++)s=e[a]._id,n&&n.push(r[s]),i&&i.push(o[s]);n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)}}(),toJSON:function(){return function(){function e(e,t,a){return a?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0===u[t]?(u[t]=c.length/3,c.push(e.x,e.y,e.z),u[t]):u[t]}function a(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0===g[t]?(g[t]=m.length,m.push(e.getHex()),g[t]):g[t]}function r(e){var t=e.x.toString()+e.y.toString();return void 0===y[t]?(y[t]=h.length/2,h.push(e.x,e.y),y[t]):y[t]}var o={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),void 0!==this.parameters){var n=this.parameters;for(var s in n)void 0!==n[s]&&(o[s]=n[s]);return o}for(var d=[],l=0,i;l<this.vertices.length;l++)i=this.vertices[l],d.push(i.x,i.y,i.z);for(var p=[],c=[],u={},m=[],g={},h=[],y={},l=0;l<this.faces.length;l++){var f=this.faces[l],x=void 0!==this.faceVertexUvs[0][l],v=0<f.normal.length(),_=0<f.vertexNormals.length,b=1!==f.color.r||1!==f.color.g||1!==f.color.b,T=0<f.vertexColors.length,S=0;if(S=e(S,0,0),S=e(S,1,!0),S=e(S,2,!1),S=e(S,3,x),S=e(S,4,v),S=e(S,5,_),S=e(S,6,b),S=e(S,7,T),p.push(S),p.push(f.a,f.b,f.c),p.push(f.materialIndex),x){var E=this.faceVertexUvs[0][l];p.push(r(E[0]),r(E[1]),r(E[2]))}if(v&&p.push(t(f.normal)),_){var C=f.vertexNormals;p.push(t(C[0]),t(C[1]),t(C[2]))}if(b&&p.push(a(f.color)),T){var P=f.vertexColors;p.push(a(P[0]),a(P[1]),a(P[2]))}}return o.data={},o.data.vertices=d,o.data.normals=c,0<m.length&&(o.data.colors=m),0<h.length&&(o.data.uvs=[h]),o.data.faces=p,o}}(),clone:function(){return function(){return new fe().copy(this)}}(),copy:function(){return function(e){var t,a,r,o,n,i;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,a=s.length;t<a;t++)this.vertices.push(s[t].clone());var d=e.colors;for(t=0,a=d.length;t<a;t++)this.colors.push(d[t].clone());var l=e.faces;for(t=0,a=l.length;t<a;t++)this.faces.push(l[t].clone());for(t=0,a=e.faceVertexUvs.length;t<a;t++){var p=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,o=p.length;r<o;r++){var c=p[r],u=[];for(n=0,i=c.length;n<i;n++){var m=c[n];u.push(m.clone())}this.faceVertexUvs[t].push(u)}}var g=e.morphTargets;for(t=0,a=g.length;t<a;t++){var h={name:g[t].name};if(void 0!==g[t].vertices)for(h.vertices=[],r=0,o=g[t].vertices.length;r<o;r++)h.vertices.push(g[t].vertices[r].clone());if(void 0!==g[t].normals)for(h.normals=[],r=0,o=g[t].normals.length;r<o;r++)h.normals.push(g[t].normals[r].clone());this.morphTargets.push(h)}var y=e.morphNormals;for(t=0,a=y.length;t<a;t++){var f={};if(void 0!==y[t].vertexNormals)for(f.vertexNormals=[],r=0,o=y[t].vertexNormals.length;r<o;r++){var x=y[t].vertexNormals[r],v={};v.a=x.a.clone(),v.b=x.b.clone(),v.c=x.c.clone(),f.vertexNormals.push(v)}if(void 0!==y[t].faceNormals)for(f.faceNormals=[],r=0,o=y[t].faceNormals.length;r<o;r++)f.faceNormals.push(y[t].faceNormals[r].clone());this.morphNormals.push(f)}var _=e.skinWeights;for(t=0,a=_.length;t<a;t++)this.skinWeights.push(_[t].clone());var b=e.skinIndices;for(t=0,a=b.length;t<a;t++)this.skinIndices.push(b[t].clone());var T=e.lineDistances;for(t=0,a=T.length;t<a;t++)this.lineDistances.push(T[t]);var S=e.boundingBox;null!==S&&(this.boundingBox=S.clone());var E=e.boundingSphere;return null!==E&&(this.boundingSphere=E.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}}(),dispose:function(){return function(){this.dispatchEvent({type:"dispose"})}}()}),Object.defineProperty(xe.prototype,"needsUpdate",{set:function(){return function(e){!0===e&&this.version++}}()}),Object.assign(xe.prototype,{isBufferAttribute:!0,setArray:function(){return function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=e===void 0?0:e.length/this.itemSize,this.array=e}}(),setDynamic:function(){return function(e){return this.dynamic=e,this}}(),copy:function(){return function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this}}(),copyAt:function(){return function(e,t,a){e*=this.itemSize,a*=t.itemSize;for(var r=0,o=this.itemSize;r<o;r++)this.array[e+r]=t.array[a+r];return this}}(),copyArray:function(){return function(e){return this.array.set(e),this}}(),copyColorsArray:function(){return function(e){for(var t=this.array,a=0,r=0,o=e.length,n;r<o;r++)n=e[r],void 0===n&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),n=new q),t[a++]=n.r,t[a++]=n.g,t[a++]=n.b;return this}}(),copyIndicesArray:function(){return function(e){for(var t=this.array,a=0,r=0,o=e.length,n;r<o;r++)n=e[r],t[a++]=n.a,t[a++]=n.b,t[a++]=n.c;return this}}(),copyVector2sArray:function(){return function(e){for(var t=this.array,a=0,o=0,n=e.length,i;o<n;o++)i=e[o],void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",o),i=new r),t[a++]=i.x,t[a++]=i.y;return this}}(),copyVector3sArray:function(){return function(e){for(var t=this.array,a=0,r=0,o=e.length,n;r<o;r++)n=e[r],void 0===n&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),n=new m),t[a++]=n.x,t[a++]=n.y,t[a++]=n.z;return this}}(),copyVector4sArray:function(){return function(e){for(var t=this.array,a=0,r=0,o=e.length,i;r<o;r++)i=e[r],void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new n),t[a++]=i.x,t[a++]=i.y,t[a++]=i.z,t[a++]=i.w;return this}}(),set:function(){return function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this}}(),getX:function(){return function(e){return this.array[e*this.itemSize]}}(),setX:function(){return function(e,t){return this.array[e*this.itemSize]=t,this}}(),getY:function(){return function(e){return this.array[e*this.itemSize+1]}}(),setY:function(){return function(e,t){return this.array[e*this.itemSize+1]=t,this}}(),getZ:function(){return function(e){return this.array[e*this.itemSize+2]}}(),setZ:function(){return function(e,t){return this.array[e*this.itemSize+2]=t,this}}(),getW:function(){return function(e){return this.array[e*this.itemSize+3]}}(),setW:function(){return function(e,t){return this.array[e*this.itemSize+3]=t,this}}(),setXY:function(){return function(e,t,a){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=a,this}}(),setXYZ:function(){return function(e,t,a,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=a,this.array[e+2]=r,this}}(),setXYZW:function(){return function(e,t,a,r,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=a,this.array[e+2]=r,this.array[e+3]=o,this}}(),onUpload:function(){return function(e){return this.onUploadCallback=e,this}}(),clone:function(){return function(){return new this.constructor(this.array,this.itemSize).copy(this)}}()}),ve.prototype=Object.create(xe.prototype),ve.prototype.constructor=ve,_e.prototype=Object.create(xe.prototype),_e.prototype.constructor=_e,be.prototype=Object.create(xe.prototype),be.prototype.constructor=be,Te.prototype=Object.create(xe.prototype),Te.prototype.constructor=Te,Se.prototype=Object.create(xe.prototype),Se.prototype.constructor=Se,Ee.prototype=Object.create(xe.prototype),Ee.prototype.constructor=Ee,Ce.prototype=Object.create(xe.prototype),Ce.prototype.constructor=Ce,Pe.prototype=Object.create(xe.prototype),Pe.prototype.constructor=Pe,we.prototype=Object.create(xe.prototype),we.prototype.constructor=we,Object.assign(Ae.prototype,{computeGroups:function(){return function(e){for(var t=[],a=void 0,r=e.faces,o=0,n,i;o<r.length;o++)i=r[o],i.materialIndex!==a&&(a=i.materialIndex,void 0!=n&&(n.count=3*o-n.start,t.push(n)),n={start:3*o,materialIndex:a});n!==void 0&&(n.count=3*o-n.start,t.push(n)),this.groups=t}}(),fromGeometry:function(){return function(e){var t=e.faces,a=e.vertices,o=e.faceVertexUvs,n=o[0]&&0<o[0].length,s=o[1]&&0<o[1].length,d=e.morphTargets,l=d.length,p;if(0<l){p=[];for(var c=0;c<l;c++)p[c]=[];this.morphTargets.position=p}var i=e.morphNormals,u=i.length,m;if(0<u){m=[];for(var c=0;c<u;c++)m[c]=[];this.morphTargets.normal=m}for(var g=e.skinIndices,h=e.skinWeights,y=g.length===a.length,f=h.length===a.length,c=0,x;c<t.length;c++){x=t[c],this.vertices.push(a[x.a],a[x.b],a[x.c]);var v=x.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{var _=x.normal;this.normals.push(_,_,_)}var b=x.vertexColors;if(3===b.length)this.colors.push(b[0],b[1],b[2]);else{var T=x.color;this.colors.push(T,T,T)}if(!0===n){var S=o[0][c];void 0===S?(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new r,new r,new r)):this.uvs.push(S[0],S[1],S[2])}if(!0===s){var S=o[1][c];void 0===S?(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new r,new r,new r)):this.uvs2.push(S[0],S[1],S[2])}for(var E=0,C;E<l;E++)C=d[E].vertices,p[E].push(C[x.a],C[x.b],C[x.c]);for(var E=0,P;E<u;E++)P=i[E].vertexNormals[c],m[E].push(P.a,P.b,P.c);y&&this.skinIndices.push(g[x.a],g[x.b],g[x.c]),f&&this.skinWeights.push(h[x.a],h[x.b],h[x.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}}()}),Me.MaxIndex=65535,Object.assign(Me.prototype,a.prototype,{isBufferGeometry:!0,getIndex:function(){return function(){return this.index}}(),setIndex:function(){return function(e){this.index=Array.isArray(e)?new(65535<Re(e)?Ce:Se)(e,1):e}}(),addAttribute:function(){return function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new xe(arguments[1],arguments[2])))}}(),getAttribute:function(){return function(e){return this.attributes[e]}}(),removeAttribute:function(){return function(e){return delete this.attributes[e],this}}(),addGroup:function(){function e(e,t,a){this.groups.push({start:e,count:t,materialIndex:a===void 0?0:a})}return e}(),clearGroups:function(){return function(){this.groups=[]}}(),setDrawRange:function(){function e(e,t){this.drawRange.start=e,this.drawRange.count=t}return e}(),applyMatrix:function(){return function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var a=this.attributes.normal;if(void 0!==a){var r=new oe().getNormalMatrix(e);r.applyToBufferAttribute(a),a.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}}(),rotateX:function(){var e=new l;return function(){return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}()}(),rotateY:function(){var e=new l;return function(){return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}()}(),rotateZ:function(){var e=new l;return function(){return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}()}(),translate:function(){var e=new l;return function(){return function(t,a,r){return e.makeTranslation(t,a,r),this.applyMatrix(e),this}}()}(),scale:function(){var e=new l;return function(){return function(t,a,r){return e.makeScale(t,a,r),this.applyMatrix(e),this}}()}(),lookAt:function(){var e=new ce;return function(){return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}()}(),center:function(){return function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e}}(),setFromObject:function(){return function(e){var t=e.geometry;if(e.isPoints||e.isLine){var a=new Pe(3*t.vertices.length,3),r=new Pe(3*t.colors.length,3);if(this.addAttribute("position",a.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var o=new Pe(t.lineDistances.length,1);this.addAttribute("lineDistance",o.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this}}(),updateFromObject:function(){return function(e){var t=e.geometry;if(e.isMesh){var a=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(a=void 0,t.elementsNeedUpdate=!1),void 0===a)return this.fromGeometry(t);a.verticesNeedUpdate=t.verticesNeedUpdate,a.normalsNeedUpdate=t.normalsNeedUpdate,a.colorsNeedUpdate=t.colorsNeedUpdate,a.uvsNeedUpdate=t.uvsNeedUpdate,a.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=a}var r;return!0===t.verticesNeedUpdate&&(r=this.attributes.position,void 0!==r&&(r.copyVector3sArray(t.vertices),r.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(r=this.attributes.normal,void 0!==r&&(r.copyVector3sArray(t.normals),r.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(r=this.attributes.color,void 0!==r&&(r.copyColorsArray(t.colors),r.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(r=this.attributes.uv,void 0!==r&&(r.copyVector2sArray(t.uvs),r.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(r=this.attributes.lineDistance,void 0!==r&&(r.copyArray(t.lineDistances),r.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this}}(),fromGeometry:function(){return function(e){return e.__directGeometry=new Ae().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)}}(),fromDirectGeometry:function(){return function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new xe(t,3).copyVector3sArray(e.vertices)),0<e.normals.length){var a=new Float32Array(3*e.normals.length);this.addAttribute("normal",new xe(a,3).copyVector3sArray(e.normals))}if(0<e.colors.length){var r=new Float32Array(3*e.colors.length);this.addAttribute("color",new xe(r,3).copyColorsArray(e.colors))}if(0<e.uvs.length){var o=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new xe(o,2).copyVector2sArray(e.uvs))}if(0<e.uvs2.length){var n=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new xe(n,2).copyVector2sArray(e.uvs2))}if(0<e.indices.length){var s=65535<Re(e.indices)?Uint32Array:Uint16Array,d=new s(3*e.indices.length);this.setIndex(new xe(d,1).copyIndicesArray(e.indices))}for(var p in this.groups=e.groups,e.morphTargets){for(var c=[],u=e.morphTargets[p],m=0,i=u.length;m<i;m++){var l=u[m],g=new Pe(3*l.length,3);c.push(g.copyVector3sArray(l))}this.morphAttributes[p]=c}if(0<e.skinIndices.length){var h=new Pe(4*e.skinIndices.length,4);this.addAttribute("skinIndex",h.copyVector4sArray(e.skinIndices))}if(0<e.skinWeights.length){var y=new Pe(4*e.skinWeights.length,4);this.addAttribute("skinWeight",y.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}}(),computeBoundingBox:function(){return function(){null===this.boundingBox&&(this.boundingBox=new ae);var e=this.attributes.position;e===void 0?this.boundingBox.makeEmpty():this.boundingBox.setFromBufferAttribute(e),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error("THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.",this)}}(),computeBoundingSphere:function(){var e=new ae,t=new m;return function(){return function(){null===this.boundingSphere&&(this.boundingSphere=new re);var a=this.attributes.position;if(a){var r=this.boundingSphere.center;e.setFromBufferAttribute(a),e.getCenter(r);for(var o=0,n=0,i=a.count;n<i;n++)t.x=a.getX(n),t.y=a.getY(n),t.z=a.getZ(n),o=en(o,r.distanceToSquared(t));this.boundingSphere.radius=Yo(o),isNaN(this.boundingSphere.radius)&&console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this)}}}()}(),computeFaceNormals:function(){return function(){}}(),computeVertexNormals:function(){function e(){var e=this.index,t=this.attributes,a=this.groups;if(t.position){var r=t.position.array;if(t.normal===void 0)this.addAttribute("normal",new xe(new Float32Array(r.length),3));else for(var o=t.normal.array,n=0,i=o.length;n<i;n++)o[n]=0;var s=t.normal.array,d=new m,l=new m,p=new m,c=new m,u=new m,g,h,y;if(e){var f=e.array;0===a.length&&this.addGroup(0,f.length);for(var x=0,v=a.length;x<v;++x)for(var _=a[x],b=_.start,T=_.count,n=b,i=b+T;n<i;n+=3)g=3*f[n+0],h=3*f[n+1],y=3*f[n+2],d.fromArray(r,g),l.fromArray(r,h),p.fromArray(r,y),c.subVectors(p,l),u.subVectors(d,l),c.cross(u),s[g]+=c.x,s[g+1]+=c.y,s[g+2]+=c.z,s[h]+=c.x,s[h+1]+=c.y,s[h+2]+=c.z,s[y]+=c.x,s[y+1]+=c.y,s[y+2]+=c.z}else for(var n=0,i=r.length;n<i;n+=9)d.fromArray(r,n),l.fromArray(r,n+3),p.fromArray(r,n+6),c.subVectors(p,l),u.subVectors(d,l),c.cross(u),s[n]=c.x,s[n+1]=c.y,s[n+2]=c.z,s[n+3]=c.x,s[n+4]=c.y,s[n+5]=c.z,s[n+6]=c.x,s[n+7]=c.y,s[n+8]=c.z;this.normalizeNormals(),t.normal.needsUpdate=!0}}return e}(),merge:function(){return function(e,t){if(!(e&&e.isBufferGeometry))return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);t===void 0&&(t=0);var a=this.attributes;for(var r in a)if(e.attributes[r]!==void 0)for(var o=a[r],n=o.array,s=e.attributes[r],d=s.array,l=s.itemSize,p=0,i=l*t;p<d.length;p++,i++)n[i]=d[p];return this}}(),normalizeNormals:function(){var e=new m;return function(){return function(){for(var t=this.attributes.normal,a=0,r=t.count;a<r;a++)e.x=t.getX(a),e.y=t.getY(a),e.z=t.getZ(a),e.normalize(),t.setXYZ(a,e.x,e.y,e.z)}}()}(),toNonIndexed:function(){return function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new Me,t=this.index.array,a=this.attributes;for(var r in a){for(var o=a[r],n=o.array,s=o.itemSize,d=new n.constructor(t.length*s),p=0,c=0,u=0,i=t.length;u<i;u++){p=t[u]*s;for(var l=0;l<s;l++)d[c++]=n[p++]}e.addAttribute(r,new xe(d,s))}return e}}(),toJSON:function(){return function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var a in t)void 0!==t[a]&&(e[a]=t[a]);return e}e.data={attributes:{}};var r=this.index;if(null!==r){var o=Array.prototype.slice.call(r.array);e.data.index={type:r.array.constructor.name,array:o}}var n=this.attributes;for(var a in n){var i=n[a],o=Array.prototype.slice.call(i.array);e.data.attributes[a]={itemSize:i.itemSize,type:i.array.constructor.name,array:o,normalized:i.normalized}}var s=this.groups;0<s.length&&(e.data.groups=JSON.parse(JSON.stringify(s)));var d=this.boundingSphere;return null!==d&&(e.data.boundingSphere={center:d.center.toArray(),radius:d.radius}),e}}(),clone:function(){return function(){return new Me().copy(this)}}(),copy:function(){return function(e){var t,a,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var o=e.index;null!==o&&this.setIndex(o.clone());var n=e.attributes;for(t in n){var i=n[t];this.addAttribute(t,i.clone())}var s=e.morphAttributes;for(t in s){var d=[],l=s[t];for(a=0,r=l.length;a<r;a++)d.push(l[a].clone());this.morphAttributes[t]=d}var p=e.groups;for(a=0,r=p.length;a<r;a++){var c=p[a];this.addGroup(c.start,c.count,c.materialIndex)}var u=e.boundingBox;null!==u&&(this.boundingBox=u.clone());var m=e.boundingSphere;return null!==m&&(this.boundingSphere=m.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this}}(),dispose:function(){return function(){this.dispatchEvent({type:"dispose"})}}()}),Le.prototype=Object.create(fe.prototype),Le.prototype.constructor=Le,Be.prototype=Object.create(Me.prototype),Be.prototype.constructor=Be,De.prototype=Object.create(fe.prototype),De.prototype.constructor=De,Ie.prototype=Object.create(Me.prototype),Ie.prototype.constructor=Ie,Fe.prototype=Object.create(Q.prototype),Fe.prototype.constructor=Fe,Fe.prototype.isMeshBasicMaterial=!0,Fe.prototype.copy=function(e){return Q.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.assign(Oe.prototype,{set:function(){return function(e,t){return this.origin.copy(e),this.direction.copy(t),this}}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}}(),at:function(){return function(e,t){var a=t||new m;return a.copy(this.direction).multiplyScalar(e).add(this.origin)}}(),lookAt:function(){return function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}}(),recast:function(){var e=new m;return function(){return function(a){return this.origin.copy(this.at(a,e)),this}}()}(),closestPointToPoint:function(){return function(e,t){var a=t||new m;a.subVectors(e,this.origin);var r=a.dot(this.direction);return 0>r?a.copy(this.origin):a.copy(this.direction).multiplyScalar(r).add(this.origin)}}(),distanceToPoint:function(){return function(e){return Yo(this.distanceSqToPoint(e))}}(),distanceSqToPoint:function(){var e=new m;return function(){return function(t){var a=e.subVectors(t,this.origin).dot(this.direction);return 0>a?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(a).add(this.origin),e.distanceToSquared(t))}}()}(),distanceSqToSegment:function(){var e=new m,t=new m,a=new m;return function(){return function(r,o,n,i){e.copy(r).add(o).multiplyScalar(.5),t.copy(o).sub(r).normalize(),a.copy(this.origin).sub(e);var s=.5*r.distanceTo(o),d=-this.direction.dot(t),l=a.dot(this.direction),p=-a.dot(t),u=a.lengthSq(),c=qo(1-d*d),m,g,h,y;if(!(0<c))g=0<d?-s:s,m=en(0,-(d*g+l)),h=-m*m+g*(g+2*p)+u;else if(m=d*p-l,g=d*l-p,y=s*c,!(0<=m))g<=-y?(m=en(0,-(-d*s+l)),g=0<m?-s:tn(en(-s,-p),s),h=-m*m+g*(g+2*p)+u):g<=y?(m=0,g=tn(en(-s,-p),s),h=g*(g+2*p)+u):(m=en(0,-(d*s+l)),g=0<m?s:tn(en(-s,-p),s),h=-m*m+g*(g+2*p)+u);else if(!(g>=-y))g=-s,m=en(0,-(d*g+l)),h=-m*m+g*(g+2*p)+u;else if(g<=y){var f=1/c;m*=f,g*=f,h=m*(m+d*g+2*l)+g*(d*m+g+2*p)+u}else g=s,m=en(0,-(d*g+l)),h=-m*m+g*(g+2*p)+u;return n&&n.copy(this.direction).multiplyScalar(m).add(this.origin),i&&i.copy(t).multiplyScalar(g).add(e),h}}()}(),intersectSphere:function(){var e=new m;return function(){return function(t,a){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),o=e.dot(e)-r*r,n=t.radius*t.radius;if(o>n)return null;var i=Yo(n-o),s=r-i,d=r+i;return 0>s&&0>d?null:0>s?this.at(d,a):this.at(s,a)}}()}(),intersectsSphere:function(){return function(e){return this.distanceToPoint(e.center)<=e.radius}}(),distanceToPlane:function(){return function(e){var a=e.normal.dot(this.direction);if(0===a)return 0===e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/a;return 0<=r?r:null}}(),intersectPlane:function(){return function(e,a){var r=this.distanceToPlane(e);return null===r?null:this.at(r,a)}}(),intersectsPlane:function(){return function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var a=e.normal.dot(this.direction);return!!(0>a*t)}}(),intersectBox:function(){return function(e,t){var a=1/this.direction.x,r=1/this.direction.y,o=1/this.direction.z,n=this.origin,i,s,d,l,p,c;return(0<=a?(i=(e.min.x-n.x)*a,s=(e.max.x-n.x)*a):(i=(e.max.x-n.x)*a,s=(e.min.x-n.x)*a),0<=r?(d=(e.min.y-n.y)*r,l=(e.max.y-n.y)*r):(d=(e.max.y-n.y)*r,l=(e.min.y-n.y)*r),i>l||d>s)?null:((d>i||i!=i)&&(i=d),(l<s||s!=s)&&(s=l),0<=o?(p=(e.min.z-n.z)*o,c=(e.max.z-n.z)*o):(p=(e.max.z-n.z)*o,c=(e.min.z-n.z)*o),i>c||p>s)?null:((p>i||i!=i)&&(i=p),(c<s||s!=s)&&(s=c),0>s?null:this.at(0<=i?i:s,t))}}(),intersectsBox:function(){var e=new m;return function(){return function(t){return null!==this.intersectBox(t,e)}}()}(),intersectTriangle:function(){var e=new m,t=new m,r=new m,o=new m;return function(){return function(n,a,i,s,d){t.subVectors(a,n),r.subVectors(i,n),o.crossVectors(t,r);var l=this.direction.dot(o),p;if(0<l){if(s)return null;p=1}else if(0>l)p=-1,l=-l;else return null;e.subVectors(this.origin,n);var c=p*this.direction.dot(r.crossVectors(e,r));if(0>c)return null;var u=p*this.direction.dot(t.cross(e));if(0>u)return null;if(c+u>l)return null;var m=-p*e.dot(o);return 0>m?null:this.at(m/l,d)}}()}(),applyMatrix4:function(){return function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}}(),equals:function(){return function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}()}),Object.assign(Ue.prototype,{set:function(){return function(e,t){return this.start.copy(e),this.end.copy(t),this}}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){return this.start.copy(e.start),this.end.copy(e.end),this}}(),getCenter:function(){return function(e){var t=e||new m;return t.addVectors(this.start,this.end).multiplyScalar(.5)}}(),delta:function(){return function(e){var t=e||new m;return t.subVectors(this.end,this.start)}}(),distanceSq:function(){return function(){return this.start.distanceToSquared(this.end)}}(),distance:function(){return function(){return this.start.distanceTo(this.end)}}(),at:function(){return function(e,t){var a=t||new m;return this.delta(a).multiplyScalar(e).add(this.start)}}(),closestPointToPointParameter:function(){var e=new m,a=new m;return function(){return function(r,o){e.subVectors(r,this.start),a.subVectors(this.end,this.start);var n=a.dot(a),i=a.dot(e),s=i/n;return o&&(s=vs.clamp(s,0,1)),s}}()}(),closestPointToPoint:function(){return function(e,a,r){var o=this.closestPointToPointParameter(e,a),t=r||new m;return this.delta(t).multiplyScalar(o).add(this.start)}}(),applyMatrix4:function(){return function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}}(),equals:function(){return function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}()}),Object.assign(ke,{normal:function(){var e=new m;return function(){return function(t,a,r,o){var n=o||new m;n.subVectors(r,a),e.subVectors(t,a),n.cross(e);var i=n.lengthSq();return 0<i?n.multiplyScalar(1/Yo(i)):n.set(0,0,0)}}()}(),barycoordFromPoint:function(){var e=new m,t=new m,r=new m;return function(){return function(o,n,a,i,s){e.subVectors(i,n),t.subVectors(a,n),r.subVectors(o,n);var d=e.dot(e),l=e.dot(t),p=e.dot(r),c=t.dot(t),g=t.dot(r),h=d*c-l*l,y=s||new m;if(0==h)return y.set(-2,-1,-1);var f=1/h,x=(c*p-l*g)*f,u=(d*g-l*p)*f;return y.set(1-x-u,u,x)}}()}(),containsPoint:function(){var e=new m;return function(){return function(t,r,a,o){var n=ke.barycoordFromPoint(t,r,a,o,e);return 0<=n.x&&0<=n.y&&1>=n.x+n.y}}()}()}),Object.assign(ke.prototype,{set:function(){return function(e,t,a){return this.a.copy(e),this.b.copy(t),this.c.copy(a),this}}(),setFromPointsAndIndices:function(){return function(e,t,a,r){return this.a.copy(e[t]),this.b.copy(e[a]),this.c.copy(e[r]),this}}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}}(),area:function(){var e=new m,t=new m;return function(){return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}()}(),midpoint:function(){return function(e){var t=e||new m;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}}(),normal:function(){return function(e){return ke.normal(this.a,this.b,this.c,e)}}(),plane:function(){return function(e){var t=e||new ne;return t.setFromCoplanarPoints(this.a,this.b,this.c)}}(),barycoordFromPoint:function(){return function(e,t){return ke.barycoordFromPoint(e,this.a,this.b,this.c,t)}}(),containsPoint:function(){return function(e){return ke.containsPoint(e,this.a,this.b,this.c)}}(),closestPointToPoint:function(){var e=new ne,t=[new Ue,new Ue,new Ue],a=new m,r=new m;return function(){return function(o,n){var s=n||new m,d=Infinity;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(o,a),!0===this.containsPoint(a))s.copy(a);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var l=0;l<t.length;l++){t[l].closestPointToPoint(a,!0,r);var i=a.distanceToSquared(r);i<d&&(d=i,s.copy(r))}}return s}}()}(),equals:function(){return function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}()}),Ge.prototype=Object.assign(Object.create(ce.prototype),{constructor:Ge,isMesh:!0,setDrawMode:function(){return function(e){this.drawMode=e}}(),copy:function(){return function(e){return ce.prototype.copy.call(this,e),this.drawMode=e.drawMode,this}}(),updateMorphTargets:function(){return function(){var e=this.geometry,t,a,r;if(e.isBufferGeometry){var o=e.morphAttributes,n=Object.keys(o);if(0<n.length){var i=o[n[0]];if(i!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},(t=0,a=i.length);t<a;t++)r=i[t].name||t+"",this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=e.morphTargets;if(s!==void 0&&0<s.length)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},(t=0,a=s.length);t<a;t++)r=s[t].name||t+"",this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}}(),raycast:function(){function e(e,t,a,r,o,n,i){return ke.barycoordFromPoint(e,t,a,r,f),o.multiplyScalar(f.x),n.multiplyScalar(f.y),i.multiplyScalar(f.z),o.add(n).add(i),o.clone()}function o(e,t,a,r,o,n,i,s){var d;if(d=t.side===fn?r.intersectTriangle(i,n,o,!0,s):r.intersectTriangle(o,n,i,t.side!==xn,s),null===d)return null;_.copy(s),_.applyMatrix4(e.matrixWorld);var l=a.ray.origin.distanceTo(_);return l<a.near||l>a.far?null:{distance:l,point:_.clone(),object:e}}function t(t,r,n,s,d,l,a,m){i.fromBufferAttribute(s,l),p.fromBufferAttribute(s,a),u.fromBufferAttribute(s,m);var c=o(t,t.material,r,n,i,p,u,v);return c&&(d&&(h.fromBufferAttribute(d,l),y.fromBufferAttribute(d,a),x.fromBufferAttribute(d,m),c.uv=e(v,i,p,u,h,y,x)),c.face=new he(l,a,m,ke.normal(i,p,u)),c.faceIndex=l),c}var n=new l,s=new Oe,d=new re,i=new m,p=new m,u=new m,a=new m,c=new m,g=new m,h=new r,y=new r,x=new r,f=new m,v=new m,_=new m;return function(){return function(r,m){var _=this.geometry,T=this.material,S=this.matrixWorld;if(void 0!==T&&(null===_.boundingSphere&&_.computeBoundingSphere(),d.copy(_.boundingSphere),d.applyMatrix4(S),!1!==r.ray.intersectsSphere(d))&&(n.getInverse(S),s.copy(r.ray).applyMatrix4(n),null===_.boundingBox||!1!==s.intersectsBox(_.boundingBox))){var E;if(_.isBufferGeometry){var C=_.index,P=_.attributes.position,w=_.attributes.uv,A,R,b,M,L;if(null!==C)for(M=0,L=C.count;M<L;M+=3)A=C.getX(M),R=C.getX(M+1),b=C.getX(M+2),E=t(this,r,s,P,w,A,R,b),E&&(E.faceIndex=on(M/3),m.push(E));else for(M=0,L=P.count;M<L;M+=3)A=M,R=M+1,b=M+2,E=t(this,r,s,P,w,A,R,b),E&&(E.index=A,m.push(E))}else if(_.isGeometry){var l=Array.isArray(T),B=_.vertices,D=_.faces,I=_.faceVertexUvs[0],F,O,U,k;0<I.length&&(k=I);for(var G=0,f=D.length;G<f;G++){var N=D[G],z=l?T[N.materialIndex]:T;if(void 0!==z){if(F=B[N.a],O=B[N.b],U=B[N.c],!0===z.morphTargets){var W=_.morphTargets,H=this.morphTargetInfluences;i.set(0,0,0),p.set(0,0,0),u.set(0,0,0);for(var V=0,X=W.length,j;V<X;V++)if(j=H[V],0!==j){var q=W[V].vertices;i.addScaledVector(a.subVectors(q[N.a],F),j),p.addScaledVector(c.subVectors(q[N.b],O),j),u.addScaledVector(g.subVectors(q[N.c],U),j)}i.add(F),p.add(O),u.add(U),F=i,O=p,U=u}if(E=o(this,z,r,s,F,O,U,v),E){if(k&&k[G]){var Y=k[G];h.copy(Y[0]),y.copy(Y[1]),x.copy(Y[2]),E.uv=e(v,F,O,U,h,y,x)}E.face=N,E.faceIndex=G,m.push(E)}}}}}}}()}(),clone:function(){return function(){return new this.constructor(this.geometry,this.material).copy(this)}}()});var Os=0;xt.prototype=Object.assign(Object.create(ge.prototype),{constructor:xt,isArrayCamera:!0}),Et.prototype.isFogExp2=!0,Et.prototype.clone=function(){return new Et(this.color.getHex(),this.density)},Et.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Ct.prototype.isFog=!0,Ct.prototype.clone=function(){return new Ct(this.color.getHex(),this.near,this.far)},Ct.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Pt.prototype=Object.assign(Object.create(ce.prototype),{constructor:Pt,copy:function(){return function(e,t){return ce.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}}(),toJSON:function(){return function(e){var t=ce.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}()}),wt.prototype=Object.assign(Object.create(ce.prototype),{constructor:wt,isLensFlare:!0,copy:function(){return function(e){ce.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,a=e.lensFlares.length;t<a;t++)this.lensFlares.push(e.lensFlares[t]);return this}}(),add:function(){return function(e,t,a,r,o,n){t===void 0&&(t=-1),a===void 0&&(a=0),n===void 0&&(n=1),o===void 0&&(o=new q(16777215)),r===void 0&&(r=En),a=tn(a,en(0,a)),this.lensFlares.push({texture:e,size:t,distance:a,x:0,y:0,z:0,scale:1,rotation:0,opacity:n,color:o,blending:r})}}(),updateLensFlares:function(){return function(){var e=this.lensFlares.length,t=2*-this.positionScreen.x,a=2*-this.positionScreen.y,r,o;for(r=0;r<e;r++)o=this.lensFlares[r],o.x=this.positionScreen.x+t*o.distance,o.y=this.positionScreen.y+a*o.distance,o.wantedRotation=.25*(o.x*an),o.rotation+=.25*(o.wantedRotation-o.rotation)}}()}),At.prototype=Object.create(Q.prototype),At.prototype.constructor=At,At.prototype.isSpriteMaterial=!0,At.prototype.copy=function(e){return Q.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},Rt.prototype=Object.assign(Object.create(ce.prototype),{constructor:Rt,isSprite:!0,raycast:function(){var e=new m,t=new m,a=new m;return function(){return function(r,o){t.setFromMatrixPosition(this.matrixWorld),r.ray.closestPointToPoint(t,e),a.setFromMatrixScale(this.matrixWorld);var n=a.x*a.y/4;if(!(t.distanceToSquared(e)>n)){var i=r.ray.origin.distanceTo(e);i<r.near||i>r.far||o.push({distance:i,point:e.clone(),face:null,object:this})}}}()}(),clone:function(){return function(){return new this.constructor(this.material).copy(this)}}()}),Mt.prototype=Object.assign(Object.create(ce.prototype),{constructor:Mt,copy:function(){return function(e){ce.prototype.copy.call(this,e,!1);for(var t=e.levels,a=0,r=t.length,o;a<r;a++)o=t[a],this.addLevel(o.object.clone(),o.distance);return this}}(),addLevel:function(){return function(e,t){t===void 0&&(t=0),t=qo(t);for(var a=this.levels,r=0;r<a.length&&!(t<a[r].distance);r++);a.splice(r,0,{distance:t,object:e}),this.add(e)}}(),getObjectForDistance:function(){return function(e){for(var t=this.levels,a=1,r=t.length;a<r&&!(e<t[a].distance);a++);return t[a-1].object}}(),raycast:function(){var e=new m;return function(){return function(t,a){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(e);this.getObjectForDistance(r).raycast(t,a)}}()}(),update:function(){var e=new m,t=new m;return function(){return function(a){var r=this.levels;if(1<r.length){e.setFromMatrixPosition(a.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var o=e.distanceTo(t);r[0].object.visible=!0;for(var n=1,i=r.length;n<i&&o>=r[n].distance;n++)r[n-1].object.visible=!1,r[n].object.visible=!0;for(;n<i;n++)r[n].object.visible=!1}}}()}(),toJSON:function(){return function(e){var t=ce.prototype.toJSON.call(this,e);t.object.levels=[];for(var a=this.levels,r=0,o=a.length,n;r<o;r++)n=a[r],t.object.levels.push({object:n.object.uuid,distance:n.distance});return t}}()}),Object.assign(Lt.prototype,{calculateInverses:function(){return function(){this.boneInverses=[];for(var e=0,t=this.bones.length,a;e<t;e++)a=new l,this.bones[e]&&a.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(a)}}(),pose:function(){return function(){var e,t,a;for(t=0,a=this.bones.length;t<a;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,a=this.bones.length;t<a;t++)e=this.bones[t],e&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}(),update:function(){var e=new l,t=new l;return function(){return function(){for(var a=this.bones,r=this.boneInverses,o=this.boneMatrices,n=this.boneTexture,s=0,i=a.length,d;s<i;s++)d=a[s]?a[s].matrixWorld:t,e.multiplyMatrices(d,r[s]),e.toArray(o,16*s);n!==void 0&&(n.needsUpdate=!0)}}()}(),clone:function(){return function(){return new Lt(this.bones,this.boneInverses)}}()}),Bt.prototype=Object.assign(Object.create(ce.prototype),{constructor:Bt,isBone:!0}),Dt.prototype=Object.assign(Object.create(Ge.prototype),{constructor:Dt,isSkinnedMesh:!0,initBones:function(){return function(){var e=[],t,a,r,o;if(this.geometry&&void 0!==this.geometry.bones){for(r=0,o=this.geometry.bones.length;r<o;r++)a=this.geometry.bones[r],t=new Bt,e.push(t),t.name=a.name,t.position.fromArray(a.pos),t.quaternion.fromArray(a.rotq),void 0!==a.scl&&t.scale.fromArray(a.scl);for(r=0,o=this.geometry.bones.length;r<o;r++)a=this.geometry.bones[r],-1!==a.parent&&null!==a.parent&&void 0!==e[a.parent]?e[a.parent].add(e[r]):this.add(e[r])}return this.updateMatrixWorld(!0),e}}(),bind:function(){return function(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)}}(),pose:function(){return function(){this.skeleton.pose()}}(),normalizeSkinWeights:function(){return function(){var e,t;if(this.geometry&&this.geometry.isGeometry)for(t=0;t<this.geometry.skinWeights.length;t++){var a=this.geometry.skinWeights[t];e=1/a.lengthManhattan(),e===Infinity?a.set(1,0,0,0):a.multiplyScalar(e)}else if(this.geometry&&this.geometry.isBufferGeometry){var r=new n,o=this.geometry.attributes.skinWeight;for(t=0;t<o.count;t++)r.x=o.getX(t),r.y=o.getY(t),r.z=o.getZ(t),r.w=o.getW(t),e=1/r.lengthManhattan(),e===Infinity?r.set(1,0,0,0):r.multiplyScalar(e),o.setXYZW(t,r.x,r.y,r.z,r.w)}}}(),updateMatrixWorld:function(){return function(e){Ge.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}}(),clone:function(){return function(){return new this.constructor(this.geometry,this.material).copy(this)}}()}),It.prototype=Object.create(Q.prototype),It.prototype.constructor=It,It.prototype.isLineBasicMaterial=!0,It.prototype.copy=function(e){return Q.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Ft.prototype=Object.assign(Object.create(ce.prototype),{constructor:Ft,isLine:!0,raycast:function(){var e=new l,t=new Oe,r=new re;return function(){return function(o,n){var s=o.linePrecision,d=s*s,p=this.geometry,c=this.matrixWorld;if(null===p.boundingSphere&&p.computeBoundingSphere(),r.copy(p.boundingSphere),r.applyMatrix4(c),!1!==o.ray.intersectsSphere(r)){e.getInverse(c),t.copy(o.ray).applyMatrix4(e);var u=new m,g=new m,h=new m,y=new m,f=this&&this.isLineSegments?2:1;if(p.isBufferGeometry){var x=p.index,v=p.attributes,_=v.position.array;if(null!==x)for(var T=x.array,S=0,E=T.length-1;S<E;S+=f){var l=T[S],a=T[S+1];u.fromArray(_,3*l),g.fromArray(_,3*a);var b=t.distanceSqToSegment(u,g,y,h);if(!(b>d)){y.applyMatrix4(this.matrixWorld);var C=o.ray.origin.distanceTo(y);C<o.near||C>o.far||n.push({distance:C,point:h.clone().applyMatrix4(this.matrixWorld),index:S,face:null,faceIndex:null,object:this})}}else for(var S=0,E=_.length/3-1;S<E;S+=f){u.fromArray(_,3*S),g.fromArray(_,3*S+3);var b=t.distanceSqToSegment(u,g,y,h);if(!(b>d)){y.applyMatrix4(this.matrixWorld);var C=o.ray.origin.distanceTo(y);C<o.near||C>o.far||n.push({distance:C,point:h.clone().applyMatrix4(this.matrixWorld),index:S,face:null,faceIndex:null,object:this})}}}else if(p.isGeometry)for(var P=p.vertices,w=P.length,S=0,b;S<w-1;S+=f)if(b=t.distanceSqToSegment(P[S],P[S+1],y,h),!(b>d)){y.applyMatrix4(this.matrixWorld);var C=o.ray.origin.distanceTo(y);C<o.near||C>o.far||n.push({distance:C,point:h.clone().applyMatrix4(this.matrixWorld),index:S,face:null,faceIndex:null,object:this})}}}}()}(),clone:function(){return function(){return new this.constructor(this.geometry,this.material).copy(this)}}()}),Ot.prototype=Object.assign(Object.create(Ft.prototype),{constructor:Ot,isLineSegments:!0}),Ut.prototype=Object.assign(Object.create(Ft.prototype),{constructor:Ut,isLineLoop:!0}),kt.prototype=Object.create(Q.prototype),kt.prototype.constructor=kt,kt.prototype.isPointsMaterial=!0,kt.prototype.copy=function(e){return Q.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},Gt.prototype=Object.assign(Object.create(ce.prototype),{constructor:Gt,isPoints:!0,raycast:function(){var e=new l,t=new Oe,r=new re;return function(){return function(o,n){function s(e,a){var r=t.distanceSqToPoint(e);if(r<h){var i=t.closestPointToPoint(e);i.applyMatrix4(c);var s=o.ray.origin.distanceTo(i);if(s<o.near||s>o.far)return;n.push({distance:s,distanceToRay:Yo(r),point:i.clone(),index:a,face:null,object:d})}}var d=this,p=this.geometry,c=this.matrixWorld,u=o.params.Points.threshold;if(null===p.boundingSphere&&p.computeBoundingSphere(),r.copy(p.boundingSphere),r.applyMatrix4(c),r.radius+=u,!1!==o.ray.intersectsSphere(r)){e.getInverse(c),t.copy(o.ray).applyMatrix4(e);var g=u/((this.scale.x+this.scale.y+this.scale.z)/3),h=g*g,y=new m;if(p.isBufferGeometry){var f=p.index,x=p.attributes,v=x.position.array;if(null!==f)for(var _=f.array,b=0,i=_.length,T;b<i;b++)T=_[b],y.fromArray(v,3*T),s(y,T);else for(var b=0,a=v.length/3;b<a;b++)y.fromArray(v,3*b),s(y,b)}else for(var l=p.vertices,b=0,a=l.length;b<a;b++)s(l[b],b)}}}()}(),clone:function(){return function(){return new this.constructor(this.geometry,this.material).copy(this)}}()}),Nt.prototype=Object.assign(Object.create(ce.prototype),{constructor:Nt}),zt.prototype=Object.create(o.prototype),zt.prototype.constructor=zt,Wt.prototype=Object.create(o.prototype),Wt.prototype.constructor=Wt,Wt.prototype.isCompressedTexture=!0,Ht.prototype=Object.create(o.prototype),Ht.prototype.constructor=Ht,Ht.prototype.isDepthTexture=!0,Vt.prototype=Object.create(Me.prototype),Vt.prototype.constructor=Vt,Xt.prototype=Object.create(fe.prototype),Xt.prototype.constructor=Xt,jt.prototype=Object.create(Me.prototype),jt.prototype.constructor=jt,qt.prototype=Object.create(fe.prototype),qt.prototype.constructor=qt,Yt.prototype=Object.create(Me.prototype),Yt.prototype.constructor=Yt,Kt.prototype=Object.create(fe.prototype),Kt.prototype.constructor=Kt,Zt.prototype=Object.create(Yt.prototype),Zt.prototype.constructor=Zt,Jt.prototype=Object.create(fe.prototype),Jt.prototype.constructor=Jt,Qt.prototype=Object.create(Yt.prototype),Qt.prototype.constructor=Qt,$t.prototype=Object.create(fe.prototype),$t.prototype.constructor=$t,ea.prototype=Object.create(Yt.prototype),ea.prototype.constructor=ea,ta.prototype=Object.create(fe.prototype),ta.prototype.constructor=ta,aa.prototype=Object.create(Yt.prototype),aa.prototype.constructor=aa,ra.prototype=Object.create(fe.prototype),ra.prototype.constructor=ra,oa.prototype=Object.create(Me.prototype),oa.prototype.constructor=oa,na.prototype=Object.create(fe.prototype),na.prototype.constructor=na,ia.prototype=Object.create(Me.prototype),ia.prototype.constructor=ia,sa.prototype=Object.create(fe.prototype),sa.prototype.constructor=sa,da.prototype=Object.create(Me.prototype),da.prototype.constructor=da;var Us={area:function(){return function(e){for(var t=e.length,r=0,a=t-1,o=0;o<t;a=o++)r+=e[a].x*e[o].y-e[o].x*e[a].y;return .5*r}}(),triangulate:function(){function e(e,t,a,r,o,n){var i,s,d,l,p,c,u,m,g;if(s=e[n[t]].x,d=e[n[t]].y,l=e[n[a]].x,p=e[n[a]].y,c=e[n[r]].x,u=e[n[r]].y,0>=(l-s)*(u-d)-(p-d)*(c-s))return!1;var h,y,f,x,v,_,b,T,S,E,C,P,w,A,R;for(h=c-l,y=u-p,f=s-c,x=d-u,v=l-s,_=p-d,i=0;i<o;i++)if(m=e[n[i]].x,g=e[n[i]].y,(m!==s||g!==d)&&(m!==l||g!==p)&&(m!==c||g!==u)&&(b=m-s,T=g-d,S=m-l,E=g-p,C=m-c,P=g-u,R=h*E-y*S,w=v*T-_*b,A=f*P-x*C,R>=-sn&&A>=-sn&&w>=-sn))return!1;return!0}return function(){function t(r,o){var i=r.length;if(3>i)return null;var n=[],d=[],l=[],p,u,m;if(0<Us.area(r))for(u=0;u<i;u++)d[u]=u;else for(u=0;u<i;u++)d[u]=i-1-u;var g=i,h=2*g;for(u=g-1;2<g;){if(0>=h--)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),o?l:n;if(p=u,g<=p&&(p=0),u=p+1,g<=u&&(u=0),m=u+1,g<=m&&(m=0),e(r,p,u,m,g,d)){var y,a,f,c,s;for(y=d[p],a=d[u],f=d[m],n.push([r[y],r[a],r[f]]),l.push([d[p],d[u],d[m]]),(c=u,s=u+1);s<g;c++,s++)d[c]=d[s];g--,h=2*g}}return o?l:n}return t}()}(),triangulateShape:function(){return function(e,t){function a(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function r(e,t,a){return e.x===t.x?e.y<t.y?e.y<=a.y&&a.y<=t.y:t.y<=a.y&&a.y<=e.y:e.x<t.x?e.x<=a.x&&a.x<=t.x:t.x<=a.x&&a.x<=e.x}function o(e,t,a,o,n){var i=t.x-e.x,s=t.y-e.y,d=o.x-a.x,l=o.y-a.y,p=e.x-a.x,c=e.y-a.y,u=s*d-i*l,m=s*p-i*c;if(qo(u)>sn){var g;if(0<u){if(0>m||m>u)return[];if(g=l*p-d*c,0>g||g>u)return[]}else{if(0<m||m<u)return[];if(g=l*p-d*c,0<g||g<u)return[]}if(0===g)return n&&(0==m||m==u)?[]:[e];if(g===u)return n&&(0==m||m==u)?[]:[t];if(0==m)return[a];if(m==u)return[o];var h=g/u;return[{x:e.x+h*i,y:e.y+h*s}]}if(0!=m||l*p!=d*c)return[];var y=0==i&&0==s,f=0==d&&0==l;if(y&&f)return e.x!==a.x||e.y!==a.y?[]:[e];if(y)return r(a,o,e)?[e]:[];if(f)return r(e,t,a)?[a]:[];var x,v,_,b,T,S,E,C;return 0==i?(e.y<t.y?(x=e,_=e.y,v=t,b=t.y):(x=t,_=t.y,v=e,b=e.y),a.y<o.y?(T=a,E=a.y,S=o,C=o.y):(T=o,E=o.y,S=a,C=a.y)):(e.x<t.x?(x=e,_=e.x,v=t,b=t.x):(x=t,_=t.x,v=e,b=e.x),a.x<o.x?(T=a,E=a.x,S=o,C=o.x):(T=o,E=o.x,S=a,C=a.x)),_<=E?b<E?[]:b===E?n?[]:[T]:b<=C?[T,v]:[T,S]:_>C?[]:_===C?n?[]:[x]:b<=C?[x,v]:[x,S]}function n(e,t,a,r){var o=t.x-e.x,n=t.y-e.y,i=a.x-e.x,s=a.y-e.y,d=r.x-e.x,l=r.y-e.y,p=o*s-n*i,c=o*l-n*d;if(qo(p)>sn){var u=d*s-l*i;return 0<p?0<=c&&0<=u:0<=c||0<=u}return 0<c}function s(e,t){function a(e,t){var a=s.length-1,r=e-1;0>r&&(r=a);var o=e+1;o>a&&(o=0);var i=n(s[e],s[r],s[o],u[t]);if(!i)return!1;var d=u.length-1,l=t-1;0>l&&(l=d);var p=t+1;return p>d&&(p=0),i=n(u[t],u[l],u[p],s[e]),!!i}function r(e,t){var a,r,n;for(a=0;a<s.length;a++)if(r=a+1,r%=s.length,n=o(e,t,s[a],s[r],!0),0<n.length)return!0;return!1}function i(e,a){var r,n,i,s,l;for(r=0;r<d.length;r++)for(n=t[d[r]],i=0;i<n.length;i++)if(s=i+1,s%=n.length,l=o(e,a,n[i],n[s],!0),0<l.length)return!0;return!1}for(var s=e.concat(),d=[],l=[],p=0,c=t.length,u,m,g,h,y,f,x,v,_,b,T;p<c;p++)d.push(p);for(var S=0,E=2*d.length;0<d.length;){if(E--,0>E){console.log("THREE.ShapeUtils: Infinite Loop! Holes left:\" + indepHoles.length + \", Probably Hole outside Shape!");break}for(g=S;g<s.length;g++){h=s[g],m=-1;for(var p=0;p<d.length;p++)if(f=d[p],x=h.x+":"+h.y+":"+f,void 0===l[x]){u=t[f];for(var C=0;C<u.length;C++)if(y=u[C],a(g,C)&&!r(h,y)&&!i(h,y)){m=C,d.splice(p,1),v=s.slice(0,g+1),_=s.slice(g),b=u.slice(m),T=u.slice(0,m+1),s=v.concat(b).concat(T).concat(_),S=g;break}if(0<=m)break;l[x]=!0}if(0<=m)break}}return s}a(e),t.forEach(a);for(var d={},l=e.concat(),p=0,c=t.length,u,i,m,g,h,y;p<c;p++)Array.prototype.push.apply(l,t[p]);for(u=0,i=l.length;u<i;u++)h=l[u].x+":"+l[u].y,void 0!==d[h]&&console.warn("THREE.ShapeUtils: Duplicate point",h,u),d[h]=u;var f=s(e,t),x=Us.triangulate(f,!1);for(u=0,i=x.length;u<i;u++)for(g=x[u],m=0;3>m;m++)h=g[m].x+":"+g[m].y,y=d[h],void 0!==y&&(g[m]=y);return x.concat()}}(),isClockWise:function(){return function(e){return 0>Us.area(e)}}()};la.prototype=Object.create(fe.prototype),la.prototype.constructor=la,pa.prototype=Object.create(Me.prototype),pa.prototype.constructor=pa,pa.prototype.getArrays=function(){var e=this.getAttribute("position"),t=e?Array.prototype.slice.call(e.array):[],a=this.getAttribute("uv"),r=a?Array.prototype.slice.call(a.array):[],o=this.index,n=o?Array.prototype.slice.call(o.array):[];return{position:t,uv:r,index:n}},pa.prototype.addShapeList=function(e,t){var a=e.length;t.arrays=this.getArrays();for(var r=0,o;r<a;r++)o=e[r],this.addShape(o,t);this.setIndex(t.arrays.index),this.addAttribute("position",new Pe(t.arrays.position,3)),this.addAttribute("uv",new Pe(t.arrays.uv,2))},pa.prototype.addShape=function(e,a){function o(e,t,a){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(a).add(e)}function n(e,t,a){var o=e.x-t.x,n=e.y-t.y,i=a.x-e.x,s=a.y-e.y,d=o*o+n*n,l,p,c;if(qo(o*s-n*i)>sn){var u=Yo(d),m=Yo(i*i+s*s),g=t.x-n/u,h=t.y+o/u,y=a.x-s/m,f=a.y+i/m,x=((y-g)*s-(f-h)*i)/(o*s-n*i);l=g+o*x-e.x,p=h+n*x-e.y;var v=l*l+p*p;if(2>=v)return new r(l,p);c=Yo(v/2)}else{var _=!1;o>sn?i>sn&&(_=!0):o<-sn?i<-sn&&(_=!0):rn(n)===rn(s)&&(_=!0),_?(l=-n,p=o,c=Yo(d)):(l=o,p=n,c=Yo(d/2))}return new r(l/c,p/c)}function d(){var e=v.length/3;if(A){var t=0,r=J*t;for(ee=0;ee<Q;ee++)oe=K[ee],u(oe[2]+r,oe[1]+r,oe[0]+r);for(t=M+2*w,r=J*t,ee=0;ee<Q;ee++)oe=K[ee],u(oe[0]+r,oe[1]+r,oe[2]+r)}else{for(ee=0;ee<Q;ee++)oe=K[ee],u(oe[2],oe[1],oe[0]);for(ee=0;ee<Q;ee++)oe=K[ee],u(oe[0]+J*M,oe[1]+J*M,oe[2]+J*M)}N.addGroup(e,v.length/3-e,a.material===void 0?0:a.material)}function l(){var e=v.length/3,t=0;for(p(Z,t),t+=Z.length,(Y=0,h=V.length);Y<h;Y++)q=V[Y],p(q,t),t+=q.length;N.addGroup(e,v.length/3-e,a.extrudeMaterial===void 0?1:a.extrudeMaterial)}function p(e,t){var r,o;for(ee=e.length;0<=--ee;){r=ee,o=ee-1,0>o&&(o=e.length-1);var n=0,i=M+2*w;for(n=0;n<i;n++){var s=J*n,l=J*(n+1),p=t+r+s,a=t+o+s,u=t+o+l,c=t+r+l;g(p,a,u,c,e,n,i,r,o)}}}function c(e,t,a){S.push(e),S.push(t),S.push(a)}function u(e,t,a){y(e),y(t),y(a);var r=v.length/3,o=D.generateTopUV(N,v,r-3,r-2,r-1);f(o[0]),f(o[1]),f(o[2])}function g(e,t,a,r){y(e),y(t),y(r),y(t),y(a),y(r);var o=v.length/3,n=D.generateSideWallUV(N,v,o-6,o-3,o-2,o-1);f(n[0]),f(n[1]),f(n[3]),f(n[1]),f(n[2]),f(n[3])}function y(e){_.push(v.length/3),v.push(S[3*e+0]),v.push(S[3*e+1]),v.push(S[3*e+2])}function f(e){T.push(e.x),T.push(e.y)}var x=a.arrays?a.arrays:this.getArrays(),v=x.position,_=x.index,T=x.uv,S=[],E=a.amount===void 0?100:a.amount,C=a.bevelThickness===void 0?6:a.bevelThickness,P=a.bevelSize===void 0?C-2:a.bevelSize,w=a.bevelSegments===void 0?3:a.bevelSegments,A=!(a.bevelEnabled!==void 0)||a.bevelEnabled,R=a.curveSegments===void 0?12:a.curveSegments,M=a.steps===void 0?1:a.steps,L=a.extrudePath,B=!1,D=a.UVGenerator===void 0?la.WorldUVGenerator:a.UVGenerator,I,F,O,U,G;L&&(I=L.getSpacedPoints(M),B=!0,A=!1,F=a.frames===void 0?L.computeFrenetFrames(M,!1):a.frames,O=new m,U=new m,G=new m),A||(w=0,C=0,P=0);var N=this,W=e.extractPoints(R),H=W.shape,V=W.holes,X=!Us.isClockWise(H),q,Y,h;if(X)for(H=H.reverse(),Y=0,h=V.length;Y<h;Y++)q=V[Y],Us.isClockWise(q)&&(V[Y]=q.reverse());var K=Us.triangulateShape(H,V),Z=H;for(Y=0,h=V.length;Y<h;Y++)q=V[Y],H=H.concat(q);for(var J=H.length,Q=K.length,$=[],ee=0,i=Z.length,te=i-1,j=ee+1,k,b,ae,t,re,oe;ee<i;ee++,te++,j++)te===i&&(te=0),j===i&&(j=0),$[ee]=n(Z[ee],Z[te],Z[j]);var ne=[],ie=$.concat(),se;for(Y=0,h=V.length;Y<h;Y++){for(q=V[Y],se=[],(ee=0,i=q.length,te=i-1,j=ee+1);ee<i;ee++,te++,j++)te===i&&(te=0),j===i&&(j=0),se[ee]=n(q[ee],q[te],q[j]);ne.push(se),ie=ie.concat(se)}for(k=0;k<w;k++){for(ae=k/w,t=C*Xo(ae*an/2),b=P*Vo(ae*an/2),(ee=0,i=Z.length);ee<i;ee++)re=o(Z[ee],$[ee],b),c(re.x,re.y,-t);for(Y=0,h=V.length;Y<h;Y++)for(q=V[Y],se=ne[Y],(ee=0,i=q.length);ee<i;ee++)re=o(q[ee],se[ee],b),c(re.x,re.y,-t)}for(b=P,ee=0;ee<J;ee++)re=A?o(H[ee],ie[ee],b):H[ee],B?(U.copy(F.normals[0]).multiplyScalar(re.x),O.copy(F.binormals[0]).multiplyScalar(re.y),G.copy(I[0]).add(U).add(O),c(G.x,G.y,G.z)):c(re.x,re.y,0);var de;for(de=1;de<=M;de++)for(ee=0;ee<J;ee++)re=A?o(H[ee],ie[ee],b):H[ee],B?(U.copy(F.normals[de]).multiplyScalar(re.x),O.copy(F.binormals[de]).multiplyScalar(re.y),G.copy(I[de]).add(U).add(O),c(G.x,G.y,G.z)):c(re.x,re.y,E/M*de);for(k=w-1;0<=k;k--){for(ae=k/w,t=C*Xo(ae*an/2),b=P*Vo(ae*an/2),(ee=0,i=Z.length);ee<i;ee++)re=o(Z[ee],$[ee],b),c(re.x,re.y,E+t);for(Y=0,h=V.length;Y<h;Y++)for(q=V[Y],se=ne[Y],(ee=0,i=q.length);ee<i;ee++)re=o(q[ee],se[ee],b),B?c(re.x,re.y+I[M-1].y,I[M-1].x+t):c(re.x,re.y,E+t)}d(),l(),a.arrays||(this.setIndex(_),this.addAttribute("position",new Pe(v,3)),this.addAttribute("uv",new Pe(a.arrays.uv,2)))},la.WorldUVGenerator={generateTopUV:function(){return function(e,t,a,o,n){var i=t[3*a],s=t[3*a+1],d=t[3*o],l=t[3*o+1],p=t[3*n],c=t[3*n+1];return[new r(i,s),new r(d,l),new r(p,c)]}}(),generateSideWallUV:function(){return function(e,t,a,o,n,i){var s=t[3*a],d=t[3*a+1],l=t[3*a+2],p=t[3*o],c=t[3*o+1],u=t[3*o+2],m=t[3*n],g=t[3*n+1],h=t[3*n+2],y=t[3*i],f=t[3*i+1],x=t[3*i+2];return .01>qo(d-c)?[new r(s,1-l),new r(p,1-u),new r(m,1-h),new r(y,1-x)]:[new r(d,1-l),new r(c,1-u),new r(g,1-h),new r(f,1-x)]}}()},ca.prototype=Object.create(fe.prototype),ca.prototype.constructor=ca,ua.prototype=Object.create(pa.prototype),ua.prototype.constructor=ua,ma.prototype=Object.create(fe.prototype),ma.prototype.constructor=ma,ga.prototype=Object.create(Me.prototype),ga.prototype.constructor=ga,ha.prototype=Object.create(fe.prototype),ha.prototype.constructor=ha,ya.prototype=Object.create(Me.prototype),ya.prototype.constructor=ya,fa.prototype=Object.create(fe.prototype),fa.prototype.constructor=fa,xa.prototype=Object.create(Me.prototype),xa.prototype.constructor=xa,va.prototype=Object.create(fe.prototype),va.prototype.constructor=va,_a.prototype=Object.create(Me.prototype),_a.prototype.constructor=_a,ba.prototype=Object.create(Me.prototype),ba.prototype.constructor=ba,Ta.prototype=Object.create(fe.prototype),Ta.prototype.constructor=Ta,Sa.prototype=Object.create(Me.prototype),Sa.prototype.constructor=Sa,Ea.prototype=Object.create(Ta.prototype),Ea.prototype.constructor=Ea,Ca.prototype=Object.create(Sa.prototype),Ca.prototype.constructor=Ca,Pa.prototype=Object.create(fe.prototype),Pa.prototype.constructor=Pa,wa.prototype=Object.create(Me.prototype),wa.prototype.constructor=wa;var ks=Object.freeze({WireframeGeometry:Vt,ParametricGeometry:Xt,ParametricBufferGeometry:jt,TetrahedronGeometry:Kt,TetrahedronBufferGeometry:Zt,OctahedronGeometry:Jt,OctahedronBufferGeometry:Qt,IcosahedronGeometry:$t,IcosahedronBufferGeometry:ea,DodecahedronGeometry:ta,DodecahedronBufferGeometry:aa,PolyhedronGeometry:qt,PolyhedronBufferGeometry:Yt,TubeGeometry:ra,TubeBufferGeometry:oa,TorusKnotGeometry:na,TorusKnotBufferGeometry:ia,TorusGeometry:sa,TorusBufferGeometry:da,TextGeometry:ca,TextBufferGeometry:ua,SphereGeometry:ma,SphereBufferGeometry:ga,RingGeometry:ha,RingBufferGeometry:ya,PlaneGeometry:De,PlaneBufferGeometry:Ie,LatheGeometry:fa,LatheBufferGeometry:xa,ShapeGeometry:va,ShapeBufferGeometry:_a,ExtrudeGeometry:la,ExtrudeBufferGeometry:pa,EdgesGeometry:ba,ConeGeometry:Ea,ConeBufferGeometry:Ca,CylinderGeometry:Ta,CylinderBufferGeometry:Sa,CircleGeometry:Pa,CircleBufferGeometry:wa,BoxGeometry:Le,BoxBufferGeometry:Be});Aa.prototype=Object.create(Q.prototype),Aa.prototype.constructor=Aa,Aa.prototype.isShadowMaterial=!0,Ra.prototype=Object.create($.prototype),Ra.prototype.constructor=Ra,Ra.prototype.isRawShaderMaterial=!0,Ma.prototype=Object.create(Q.prototype),Ma.prototype.constructor=Ma,Ma.prototype.isMeshStandardMaterial=!0,Ma.prototype.copy=function(e){return Q.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},La.prototype=Object.create(Ma.prototype),La.prototype.constructor=La,La.prototype.isMeshPhysicalMaterial=!0,La.prototype.copy=function(e){return Ma.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},Ba.prototype=Object.create(Q.prototype),Ba.prototype.constructor=Ba,Ba.prototype.isMeshPhongMaterial=!0,Ba.prototype.copy=function(e){return Q.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Da.prototype=Object.create(Ba.prototype),Da.prototype.constructor=Da,Da.prototype.isMeshToonMaterial=!0,Da.prototype.copy=function(e){return Ba.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},Ia.prototype=Object.create(Q.prototype),Ia.prototype.constructor=Ia,Ia.prototype.isMeshNormalMaterial=!0,Ia.prototype.copy=function(e){return Q.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Fa.prototype=Object.create(Q.prototype),Fa.prototype.constructor=Fa,Fa.prototype.isMeshLambertMaterial=!0,Fa.prototype.copy=function(e){return Q.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Oa.prototype=Object.create(It.prototype),Oa.prototype.constructor=Oa,Oa.prototype.isLineDashedMaterial=!0,Oa.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Gs=Object.freeze({ShadowMaterial:Aa,SpriteMaterial:At,RawShaderMaterial:Ra,ShaderMaterial:$,PointsMaterial:kt,MeshPhysicalMaterial:La,MeshStandardMaterial:Ma,MeshPhongMaterial:Ba,MeshToonMaterial:Da,MeshNormalMaterial:Ia,MeshLambertMaterial:Fa,MeshDepthMaterial:ee,MeshDistanceMaterial:te,MeshBasicMaterial:Fe,LineDashedMaterial:Oa,LineBasicMaterial:It,Material:Q}),Ns={enabled:!1,files:{},add:function(){return function(e,t){!1===this.enabled||(this.files[e]=t)}}(),get:function(){return function(e){return!1===this.enabled?void 0:this.files[e]}}(),remove:function(){return function(e){delete this.files[e]}}(),clear:function(){return function(){this.files={}}}()},zs=new Ua;Object.assign(ka.prototype,{load:function(){return function(e,t,a,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var o=this,n=Ns.get(e);if(void 0!==n)return o.manager.itemStart(e),setTimeout(function(){t&&t(n),o.manager.itemEnd(e)},0),n;var s=/^data:(.*?)(;base64)?,(.*)$/,d=e.match(s);if(d){var l=d[1],p=!!d[2],c=d[3];c=window.decodeURIComponent(c),p&&(c=window.atob(c));try{var u=(this.responseType||"").toLowerCase(),m;switch(u){case"arraybuffer":case"blob":m=new ArrayBuffer(c.length);for(var g=new Uint8Array(m),h=0;h<c.length;h++)g[h]=c.charCodeAt(h);"blob"===u&&(m=new Blob([m],{type:l}));break;case"document":var i=new DOMParser;m=i.parseFromString(c,l);break;case"json":m=JSON.parse(c);break;default:m=c;}window.setTimeout(function(){t&&t(m),o.manager.itemEnd(e)},0)}catch(t){window.setTimeout(function(){r&&r(t),o.manager.itemEnd(e),o.manager.itemError(e)},0)}}else{var y=new XMLHttpRequest;for(var f in y.open("GET",e,!0),y.addEventListener("load",function(a){var n=a.target.response;Ns.add(e,n),200===this.status?(t&&t(n),o.manager.itemEnd(e)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),t&&t(n),o.manager.itemEnd(e)):(r&&r(a),o.manager.itemEnd(e),o.manager.itemError(e))},!1),void 0!==a&&y.addEventListener("progress",function(e){a(e)},!1),y.addEventListener("error",function(t){r&&r(t),o.manager.itemEnd(e),o.manager.itemError(e)},!1),void 0!==this.responseType&&(y.responseType=this.responseType),void 0!==this.withCredentials&&(y.withCredentials=this.withCredentials),y.overrideMimeType&&y.overrideMimeType(void 0===this.mimeType?"text/plain":this.mimeType),this.requestHeader)y.setRequestHeader(f,this.requestHeader[f]);y.send(null)}return o.manager.itemStart(e),y}}(),setPath:function(){return function(e){return this.path=e,this}}(),setResponseType:function(){return function(e){return this.responseType=e,this}}(),setWithCredentials:function(){return function(e){return this.withCredentials=e,this}}(),setMimeType:function(){return function(e){return this.mimeType=e,this}}(),setRequestHeader:function(){return function(e){return this.requestHeader=e,this}}()}),Object.assign(Ga.prototype,{load:function(){return function(e,t,a,r){function o(o){l.load(e[o],function(e){var a=n._parser(e,!0);s[o]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps},p+=1,6===p&&(1===a.mipmapCount&&(d.minFilter=bi),d.format=a.format,d.needsUpdate=!0,t&&t(d))},a,r)}var n=this,s=[],d=new Wt;d.image=s;var l=new ka(this.manager);if(l.setPath(this.path),l.setResponseType("arraybuffer"),Array.isArray(e))for(var p=0,c=0,i=e.length;c<i;++c)o(c);else l.load(e,function(e){var a=n._parser(e,!0);if(a.isCubemap)for(var r=a.mipmaps.length/a.mipmapCount,o=0;o<r;o++){s[o]={mipmaps:[]};for(var l=0;l<a.mipmapCount;l++)s[o].mipmaps.push(a.mipmaps[o*a.mipmapCount+l]),s[o].format=a.format,s[o].width=a.width,s[o].height=a.height}else d.image.width=a.width,d.image.height=a.height,d.mipmaps=a.mipmaps;1===a.mipmapCount&&(d.minFilter=bi),d.format=a.format,d.needsUpdate=!0,t&&t(d)},a,r);return d}}(),setPath:function(){return function(e){return this.path=e,this}}()}),Object.assign(Na.prototype,{load:function(){return function(e,t,a,r){var o=this,n=new p,i=new ka(this.manager);return i.setResponseType("arraybuffer"),i.load(e,function(e){var a=o._parser(e);a&&(void 0===a.image?void 0!==a.data&&(n.image.width=a.width,n.image.height=a.height,n.image.data=a.data):n.image=a.image,n.wrapS=void 0===a.wrapS?yi:a.wrapS,n.wrapT=void 0===a.wrapT?yi:a.wrapT,n.magFilter=void 0===a.magFilter?bi:a.magFilter,n.minFilter=void 0===a.minFilter?Si:a.minFilter,n.anisotropy=void 0===a.anisotropy?1:a.anisotropy,void 0!==a.format&&(n.format=a.format),void 0!==a.type&&(n.type=a.type),void 0!==a.mipmaps&&(n.mipmaps=a.mipmaps),1===a.mipmapCount&&(n.minFilter=bi),n.needsUpdate=!0,t&&t(n,a))},a,r),n}}()}),Object.assign(za.prototype,{crossOrigin:"Anonymous",load:function(){return function(e,t,a,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var o=this,n=Ns.get(e);if(void 0!==n)return o.manager.itemStart(e),setTimeout(function(){t&&t(n),o.manager.itemEnd(e)},0),n;var i=document.createElementNS("http://www.w3.org/1999/xhtml","img");return i.addEventListener("load",function(){Ns.add(e,this),t&&t(this),o.manager.itemEnd(e)},!1),i.addEventListener("error",function(t){r&&r(t),o.manager.itemEnd(e),o.manager.itemError(e)},!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(i.crossOrigin=this.crossOrigin),o.manager.itemStart(e),i.src=e,i}}(),setCrossOrigin:function(){return function(e){return this.crossOrigin=e,this}}(),setPath:function(){return function(e){return this.path=e,this}}()}),Object.assign(Wa.prototype,{crossOrigin:"Anonymous",load:function(){return function(e,t,a,r){function o(a){s.load(e[a],function(e){n.images[a]=e,d++,6===d&&(n.needsUpdate=!0,t&&t(n))},void 0,r)}var n=new c,s=new za(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);for(var d=0,l=0;l<e.length;++l)o(l);return n}}(),setCrossOrigin:function(){return function(e){return this.crossOrigin=e,this}}(),setPath:function(){return function(e){return this.path=e,this}}()}),Object.assign(Ha.prototype,{crossOrigin:"Anonymous",load:function(){return function(e,t,a,r){var n=new za(this.manager);n.setCrossOrigin(this.crossOrigin),n.setPath(this.path);var i=new o;return i.image=n.load(e,function(){var a=0<e.search(/\.(jpg|jpeg)$/)||0===e.search(/^data\:image\/jpeg/);i.format=a?Ui:ki,i.needsUpdate=!0,void 0!==t&&t(i)},a,r),i}}(),setCrossOrigin:function(){return function(e){return this.crossOrigin=e,this}}(),setPath:function(){return function(e){return this.path=e,this}}()}),Va.prototype=Object.assign(Object.create(ce.prototype),{constructor:Va,isLight:!0,copy:function(){return function(e){return ce.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this}}(),toJSON:function(){return function(e){var t=ce.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}()}),Xa.prototype=Object.assign(Object.create(Va.prototype),{constructor:Xa,isHemisphereLight:!0,copy:function(){return function(e){return Va.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}()}),Object.assign(ja.prototype,{copy:function(){return function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),toJSON:function(){return function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}()}),qa.prototype=Object.assign(Object.create(ja.prototype),{constructor:qa,isSpotLightShadow:!0,update:function(){return function(e){var t=this.camera,a=2*vs.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(a!==t.fov||r!==t.aspect||o!==t.far)&&(t.fov=a,t.aspect=r,t.far=o,t.updateProjectionMatrix())}}()}),Ya.prototype=Object.assign(Object.create(Va.prototype),{constructor:Ya,isSpotLight:!0,copy:function(){return function(e){return Va.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}()}),Ka.prototype=Object.assign(Object.create(Va.prototype),{constructor:Ka,isPointLight:!0,copy:function(){return function(e){return Va.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}()}),Za.prototype=Object.assign(Object.create(ja.prototype),{constructor:Za}),Ja.prototype=Object.assign(Object.create(Va.prototype),{constructor:Ja,isDirectionalLight:!0,copy:function(){return function(e){return Va.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}()}),Qa.prototype=Object.assign(Object.create(Va.prototype),{constructor:Qa,isAmbientLight:!0}),$a.prototype=Object.assign(Object.create(Va.prototype),{constructor:$a,isRectAreaLight:!0,copy:function(){return function(e){return Va.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this}}(),toJSON:function(){return function(e){var t=Va.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}()});var Ws={arraySlice:function(){return function(e,t,a){return Ws.isTypedArray(e)?new e.constructor(e.subarray(t,void 0===a?e.length:a)):e.slice(t,a)}}(),convertArray:function(){return function(e,t,a){return e&&(a||e.constructor!==t)?"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e):e}}(),isTypedArray:function(){return function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}}(),getKeyframeOrder:function(){return function(e){function t(t,a){return e[t]-e[a]}for(var a=e.length,r=Array(a),o=0;o!==a;++o)r[o]=o;return r.sort(t),r}}(),sortedArray:function(){return function(e,t,a){for(var r=e.length,o=new e.constructor(r),n=0,i=0,s;i!==r;++n){s=a[n]*t;for(var d=0;d!==t;++d)o[i++]=e[s+d]}return o}}(),flattenJSON:function(){return function(e,t,a,r){for(var o=1,n=e[0];n!==void 0&&n[r]===void 0;)n=e[o++];if(void 0!==n){var i=n[r];if(void 0!==i)if(Array.isArray(i))do i=n[r],void 0!==i&&(t.push(n.time),a.push.apply(a,i)),n=e[o++];while(void 0!==n);else if(void 0!==i.toArray)do i=n[r],void 0!==i&&(t.push(n.time),i.toArray(a,a.length)),n=e[o++];while(void 0!==n);else do i=n[r],void 0!==i&&(t.push(n.time),a.push(i)),n=e[o++];while(void 0!==n)}}}()};Object.assign(er.prototype,{evaluate:function(){return function(e){var t=this.parameterPositions,a=this._cachedIndex,r=t[a],o=t[a-1];validate_interval:{seek:{var n;linear_scan:{forward_scan:if(!(e<r)){for(var i=a+2;;){if(void 0===r){if(e<o)break forward_scan;return a=t.length,this._cachedIndex=a,this.afterEnd_(a-1,e,o)}if(a===i)break;if(o=r,r=t[++a],e<r)break seek}n=t.length;break linear_scan}if(!(e>=o)){var s=t[1];e<s&&(a=2,o=s);for(var i=a-2;;){if(void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(a===i)break;if(r=o,o=t[--a-1],e>=o)break seek}n=a,a=0;break linear_scan}break validate_interval}for(;a<n;){var d=a+n>>>1;e<t[d]?n=d:a=d+1}if(r=t[a],o=t[a-1],void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return a=t.length,this._cachedIndex=a,this.afterEnd_(a-1,o,e)}this._cachedIndex=a,this.intervalChanged_(a,o,r)}return this.interpolate_(a,o,e,r)}}(),settings:null,DefaultSettings_:{},getSettings_:function(){return function(){return this.settings||this.DefaultSettings_}}(),copySampleValue_:function(){return function(e){for(var t=this.resultBuffer,a=this.sampleValues,r=this.valueSize,o=0;o!==r;++o)t[o]=a[e*r+o];return t}}(),interpolate_:function(){return function(){throw new Error("call to abstract method")}}(),intervalChanged_:function(){return function(){}}()}),Object.assign(er.prototype,{beforeStart_:er.prototype.copySampleValue_,afterEnd_:er.prototype.copySampleValue_}),tr.prototype=Object.assign(Object.create(er.prototype),{constructor:tr,DefaultSettings_:{endingStart:os,endingEnd:os},intervalChanged_:function(){return function(e,t,a){var r=this.parameterPositions,o=e-2,n=e+1,i=r[o],s=r[n];if(i===void 0)switch(this.getSettings_().endingStart){case ns:o=e,i=2*t-a;break;case is:o=r.length-2,i=t+r[o]-r[o+1];break;default:o=e,i=a;}if(void 0===s)switch(this.getSettings_().endingEnd){case ns:n=e,s=2*a-t;break;case is:n=1,s=a+r[1]-r[0];break;default:n=e-1,s=t;}var d=.5*(a-t),l=this.valueSize;this._weightPrev=d/(t-i),this._weightNext=d/(s-a),this._offsetPrev=o*l,this._offsetNext=n*l}}(),interpolate_:function(){return function(e,a,r,t){for(var o=this.resultBuffer,n=this.sampleValues,s=this.valueSize,d=e*s,l=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,m=this._weightNext,g=(r-a)/(t-a),p=g*g,h=p*g,y=0;y!==s;++y)o[y]=(-u*h+2*u*p-u*g)*n[l+y]+((1+u)*h+(-1.5-2*u)*p+(-.5+u)*g+1)*n[d-s+y]+((-1-m)*h+(1.5+m)*p+.5*g)*n[d+y]+(m*h-m*p)*n[c+y];return o}}()}),ar.prototype=Object.assign(Object.create(er.prototype),{constructor:ar,interpolate_:function(){return function(e,a,r,t){for(var o=this.resultBuffer,n=this.sampleValues,s=this.valueSize,d=e*s,l=(r-a)/(t-a),p=0;p!==s;++p)o[p]=n[d-s+p]*(1-l)+n[d+p]*l;return o}}()}),rr.prototype=Object.assign(Object.create(er.prototype),{constructor:rr,interpolate_:function(){return function(e){return this.copySampleValue_(e-1)}}()});var Hs;Hs={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:as,InterpolantFactoryMethodDiscrete:function(){return function(e){return new rr(this.times,this.values,this.getValueSize(),e)}}(),InterpolantFactoryMethodLinear:function(){return function(e){return new ar(this.times,this.values,this.getValueSize(),e)}}(),InterpolantFactoryMethodSmooth:function(){return function(e){return new tr(this.times,this.values,this.getValueSize(),e)}}(),setInterpolation:function(){return function(e){var t;if(e===ts?t=this.InterpolantFactoryMethodDiscrete:e===as?t=this.InterpolantFactoryMethodLinear:e===rs?t=this.InterpolantFactoryMethodSmooth:void 0,void 0===t){var a="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(a);return void console.warn("THREE.KeyframeTrackPrototype:",a)}this.createInterpolant=t}}(),getInterpolation:function(){return function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ts;case this.InterpolantFactoryMethodLinear:return as;case this.InterpolantFactoryMethodSmooth:return rs;}}}(),getValueSize:function(){return function(){return this.values.length/this.times.length}}(),shift:function(){return function(e){if(0!==e)for(var t=this.times,a=0,r=t.length;a!==r;++a)t[a]+=e;return this}}(),scale:function(){return function(e){if(1!==e)for(var t=this.times,a=0,r=t.length;a!==r;++a)t[a]*=e;return this}}(),trim:function(){return function(e,t){for(var a=this.times,r=a.length,o=0,n=r-1;o!==r&&a[o]<e;)++o;for(;-1!==n&&a[n]>t;)--n;if(++n,0!==o||n!==r){o>=n&&(n=en(n,1),o=n-1);var i=this.getValueSize();this.times=Ws.arraySlice(a,o,n),this.values=Ws.arraySlice(this.values,o*i,n*i)}return this}}(),validate:function(){return function(){var e=!0,t=this.getValueSize();0!=t-on(t)&&(console.error("THREE.KeyframeTrackPrototype: Invalid value size in track.",this),e=!1);var a=this.times,r=this.values,o=a.length;0===o&&(console.error("THREE.KeyframeTrackPrototype: Track is empty.",this),e=!1);for(var s=null,d=0,i;d!==o;d++){if(i=a[d],"number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrackPrototype: Time is not a valid number.",this,d,i),e=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrackPrototype: Out of order keys.",this,d,i,s),e=!1;break}s=i}if(r!==void 0&&Ws.isTypedArray(r))for(var d=0,l=r.length,n;d!==l;++d)if(n=r[d],isNaN(n)){console.error("THREE.KeyframeTrackPrototype: Value is not a valid number.",this,d,n),e=!1;break}return e}}(),optimize:function(){return function(){for(var e=this.times,t=this.values,a=this.getValueSize(),r=this.getInterpolation()===rs,o=1,n=e.length-1,s=1;s<n;++s){var i=!1,d=e[s],l=e[s+1];if(d!==l&&(1!==s||d!==d[0]))if(!r){for(var p=s*a,c=0,u;c!==a;++c)if(u=t[p+c],u!==t[p-a+c]||u!==t[p+a+c]){i=!0;break}}else i=!0;if(i){if(s!==o){e[o]=e[s];for(var m=s*a,g=o*a,c=0;c!==a;++c)t[g+c]=t[m+c]}++o}}if(0<n){e[o]=e[n];for(var m=n*a,g=o*a,c=0;c!==a;++c)t[g+c]=t[m+c];++o}return o!==e.length&&(this.times=Ws.arraySlice(e,0,o),this.values=Ws.arraySlice(t,0,o*a)),this}}()},nr.prototype=Object.assign(Object.create(Hs),{constructor:nr,ValueTypeName:"vector"}),ir.prototype=Object.assign(Object.create(er.prototype),{constructor:ir,interpolate_:function(){return function(e,a,r,t){for(var o=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i,l=s+i;s!==l;s+=4)d.slerpFlat(o,0,n,s-i,n,s,(r-a)/(t-a));return o}}()}),sr.prototype=Object.assign(Object.create(Hs),{constructor:sr,ValueTypeName:"quaternion",DefaultInterpolation:as,InterpolantFactoryMethodLinear:function(){return function(e){return new ir(this.times,this.values,this.getValueSize(),e)}}(),InterpolantFactoryMethodSmooth:void 0}),dr.prototype=Object.assign(Object.create(Hs),{constructor:dr,ValueTypeName:"number"}),lr.prototype=Object.assign(Object.create(Hs),{constructor:lr,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ts,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),pr.prototype=Object.assign(Object.create(Hs),{constructor:pr,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ts,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),cr.prototype=Object.assign(Object.create(Hs),{constructor:cr,ValueTypeName:"color"}),ur.prototype=Hs,Hs.constructor=ur,Object.assign(ur,{parse:function(){return function(e){if(e.type===void 0)throw new Error("track type undefined, can not parse");var t=ur._getTrackTypeForValueTypeName(e.type);if(e.times===void 0){var a=[],r=[];Ws.flattenJSON(e.keys,a,r,"value"),e.times=a,e.values=r}return void 0===t.parse?new t(e.name,e.times,e.values,e.interpolation):t.parse(e)}}(),toJSON:function(){return function(e){var t=e.constructor,a;if(void 0!==t.toJSON)a=t.toJSON(e);else{a={name:e.name,times:Ws.convertArray(e.times,Array),values:Ws.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(a.interpolation=r)}return a.type=e.ValueTypeName,a}}(),_getTrackTypeForValueTypeName:function(){return function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return dr;case"vector":case"vector2":case"vector3":case"vector4":return nr;case"color":return cr;case"quaternion":return sr;case"bool":case"boolean":return pr;case"string":return lr;}throw new Error("Unsupported typeName: "+e)}}()}),Object.assign(mr,{parse:function(){return function(e){for(var t=[],a=e.tracks,r=1/(e.fps||1),o=0,i=a.length;o!==i;++o)t.push(ur.parse(a[o]).scale(r));return new mr(e.name,e.duration,t)}}(),toJSON:function(){return function(e){for(var t=[],a=e.tracks,r={name:e.name,duration:e.duration,tracks:t},o=0,i=a.length;o!==i;++o)t.push(ur.toJSON(a[o]));return r}}(),CreateFromMorphTargetSequence:function(){return function(e,t,a,r){for(var o=t.length,n=[],s=0;s<o;s++){var i=[],d=[];i.push((s+o-1)%o,s,(s+1)%o),d.push(0,1,0);var l=Ws.getKeyframeOrder(i);i=Ws.sortedArray(i,1,l),d=Ws.sortedArray(d,1,l),r||0!==i[0]||(i.push(o),d.push(d[0])),n.push(new dr(".morphTargetInfluences["+t[s].name+"]",i,d).scale(1/a))}return new mr(e,-1,n)}}(),findByName:function(){return function(e,t){var a=e;if(!Array.isArray(e)){var r=e;a=r.geometry&&r.geometry.animations||r.animations}for(var o=0;o<a.length;o++)if(a[o].name===t)return a[o];return null}}(),CreateClipsFromMorphTargetSequences:function(){return function(e,t,a){for(var r={},o=/^([\w-]*?)([\d]+)$/,n=0,i=e.length;n<i;n++){var s=e[n],d=s.name.match(o);if(d&&1<d.length){var l=d[1],p=r[l];p||(r[l]=p=[]),p.push(s)}}var c=[];for(var l in r)c.push(mr.CreateFromMorphTargetSequence(l,r[l],t,a));return c}}(),parseAnimation:function(){return function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var a=function(){function e(e,t,a,r,o){if(0!==a.length){var n=[],i=[];Ws.flattenJSON(a,n,i,r),0!==n.length&&o.push(new e(t,n,i))}}return e}(),r=[],o=e.name||"default",n=e.length||-1,i=e.fps||30,s=e.hierarchy||[],d=0,l;d<s.length;d++)if(l=s[d].keys,l&&0!==l.length)if(l[0].morphTargets){for(var p={},c=0;c<l.length;c++)if(l[c].morphTargets)for(var u=0;u<l[c].morphTargets.length;u++)p[l[c].morphTargets[u]]=-1;for(var m in p){for(var g=[],h=[],u=0,y;u!==l[c].morphTargets.length;++u)y=l[c],g.push(y.time),h.push(y.morphTarget===m?1:0);r.push(new dr(".morphTargetInfluence["+m+"]",g,h))}n=p.length*(i||1)}else{var f=".bones["+t[d].name+"]";a(nr,f+".position",l,"pos",r),a(sr,f+".quaternion",l,"rot",r),a(nr,f+".scale",l,"scl",r)}if(0===r.length)return null;var x=new mr(o,n,r);return x}}()}),Object.assign(mr.prototype,{resetDuration:function(){return function(){for(var e=this.tracks,t=0,a=0,r=e.length,o;a!==r;++a)o=this.tracks[a],t=en(t,o.times[o.times.length-1]);this.duration=t}}(),trim:function(){return function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}}(),optimize:function(){return function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}()}),Object.assign(gr.prototype,{load:function(){return function(e,t,a,r){var o=this,n=new ka(o.manager);n.load(e,function(e){t(o.parse(JSON.parse(e)))},a,r)}}(),setTextures:function(){return function(e){this.textures=e}}(),parse:function(){return function(e){function t(e){return void 0===a[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),a[e]}var a=this.textures,o=new Gs[e.type];if(void 0!==e.uuid&&(o.uuid=e.uuid),void 0!==e.name&&(o.name=e.name),void 0!==e.color&&o.color.setHex(e.color),void 0!==e.roughness&&(o.roughness=e.roughness),void 0!==e.metalness&&(o.metalness=e.metalness),void 0!==e.emissive&&o.emissive.setHex(e.emissive),void 0!==e.specular&&o.specular.setHex(e.specular),void 0!==e.shininess&&(o.shininess=e.shininess),void 0!==e.clearCoat&&(o.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(o.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.uniforms&&(o.uniforms=e.uniforms),void 0!==e.vertexShader&&(o.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(o.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(o.vertexColors=e.vertexColors),void 0!==e.fog&&(o.fog=e.fog),void 0!==e.flatShading&&(o.flatShading=e.flatShading),void 0!==e.blending&&(o.blending=e.blending),void 0!==e.side&&(o.side=e.side),void 0!==e.opacity&&(o.opacity=e.opacity),void 0!==e.transparent&&(o.transparent=e.transparent),void 0!==e.alphaTest&&(o.alphaTest=e.alphaTest),void 0!==e.depthTest&&(o.depthTest=e.depthTest),void 0!==e.depthWrite&&(o.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(o.colorWrite=e.colorWrite),void 0!==e.wireframe&&(o.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(o.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(o.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(o.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.skinning&&(o.skinning=e.skinning),void 0!==e.morphTargets&&(o.morphTargets=e.morphTargets),void 0!==e.dithering&&(o.dithering=e.dithering),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.shading&&(o.flatShading=1===e.shading),void 0!==e.size&&(o.size=e.size),void 0!==e.sizeAttenuation&&(o.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(o.map=t(e.map)),void 0!==e.alphaMap&&(o.alphaMap=t(e.alphaMap),o.transparent=!0),void 0!==e.bumpMap&&(o.bumpMap=t(e.bumpMap)),void 0!==e.bumpScale&&(o.bumpScale=e.bumpScale),void 0!==e.normalMap&&(o.normalMap=t(e.normalMap)),void 0!==e.normalScale){var n=e.normalScale;!1===Array.isArray(n)&&(n=[n,n]),o.normalScale=new r().fromArray(n)}return void 0!==e.displacementMap&&(o.displacementMap=t(e.displacementMap)),void 0!==e.displacementScale&&(o.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(o.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(o.roughnessMap=t(e.roughnessMap)),void 0!==e.metalnessMap&&(o.metalnessMap=t(e.metalnessMap)),void 0!==e.emissiveMap&&(o.emissiveMap=t(e.emissiveMap)),void 0!==e.emissiveIntensity&&(o.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(o.specularMap=t(e.specularMap)),void 0!==e.envMap&&(o.envMap=t(e.envMap)),void 0!==e.reflectivity&&(o.reflectivity=e.reflectivity),void 0!==e.lightMap&&(o.lightMap=t(e.lightMap)),void 0!==e.lightMapIntensity&&(o.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(o.aoMap=t(e.aoMap)),void 0!==e.aoMapIntensity&&(o.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(o.gradientMap=t(e.gradientMap)),o}}()}),Object.assign(hr.prototype,{load:function(){return function(e,t,a,r){var o=this,n=new ka(o.manager);n.load(e,function(e){t(o.parse(JSON.parse(e)))},a,r)}}(),parse:function(){return function(e){var t=new Me,a=e.data.index;if(a!==void 0){var r=new Vs[a.type](a.array);t.setIndex(new xe(r,1))}var o=e.data.attributes;for(var s in o){var d=o[s],r=new Vs[d.type](d.array);t.addAttribute(s,new xe(r,d.itemSize,d.normalized))}var l=e.data.groups||e.data.drawcalls||e.data.offsets;if(l!==void 0)for(var p=0,i=l.length,n;p!==i;++p)n=l[p],t.addGroup(n.start,n.count,n.materialIndex);var c=e.data.boundingSphere;if(c!==void 0){var u=new m;c.center!==void 0&&u.fromArray(c.center),t.boundingSphere=new re(u,c.radius)}return t}}()});var Vs={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"==typeof Uint8ClampedArray?Uint8Array:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};yr.Handlers={handlers:[],add:function(){return function(e,t){this.handlers.push(e,t)}}(),get:function(){return function(e){for(var t=this.handlers,a=0,r=t.length;a<r;a+=2){var o=t[a],n=t[a+1];if(o.test(e))return n}return null}}()},Object.assign(yr.prototype,{crossOrigin:void 0,extractUrlBase:function(){return function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")}}(),initMaterials:function(){return function(e,t,a){for(var r=[],o=0;o<e.length;++o)r[o]=this.createMaterial(e[o],t,a);return r}}(),createMaterial:function(){var e={NoBlending:Sn,NormalBlending:En,AdditiveBlending:Cn,SubtractiveBlending:Pn,MultiplyBlending:wn,CustomBlending:An},t=new q,a=new Ha,r=new gr;return function(){return function(o,n,i){function s(e,t,r,o,s){var l=n+e,p=yr.Handlers.get(l),c;null===p?(a.setCrossOrigin(i),c=a.load(l)):c=p.load(l),void 0!==t&&(c.repeat.fromArray(t),1!==t[0]&&(c.wrapS=hi),1!==t[1]&&(c.wrapT=hi)),void 0!==r&&c.offset.fromArray(r),void 0!==o&&("repeat"===o[0]&&(c.wrapS=hi),"mirror"===o[0]&&(c.wrapS=fi),"repeat"===o[1]&&(c.wrapT=hi),"mirror"===o[1]&&(c.wrapT=fi)),void 0!==s&&(c.anisotropy=s);var u=vs.generateUUID();return d[u]=c,u}var d={},l={uuid:vs.generateUUID(),type:"MeshLambertMaterial"};for(var p in o){var c=o[p];switch(p){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":l.name=c;break;case"blending":l.blending=e[c];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",p,"is no longer supported.");break;case"colorDiffuse":l.color=t.fromArray(c).getHex();break;case"colorSpecular":l.specular=t.fromArray(c).getHex();break;case"colorEmissive":l.emissive=t.fromArray(c).getHex();break;case"specularCoef":l.shininess=c;break;case"shading":"basic"===c.toLowerCase()&&(l.type="MeshBasicMaterial"),"phong"===c.toLowerCase()&&(l.type="MeshPhongMaterial"),"standard"===c.toLowerCase()&&(l.type="MeshStandardMaterial");break;case"mapDiffuse":l.map=s(c,o.mapDiffuseRepeat,o.mapDiffuseOffset,o.mapDiffuseWrap,o.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":l.emissiveMap=s(c,o.mapEmissiveRepeat,o.mapEmissiveOffset,o.mapEmissiveWrap,o.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":l.lightMap=s(c,o.mapLightRepeat,o.mapLightOffset,o.mapLightWrap,o.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":l.aoMap=s(c,o.mapAORepeat,o.mapAOOffset,o.mapAOWrap,o.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":l.bumpMap=s(c,o.mapBumpRepeat,o.mapBumpOffset,o.mapBumpWrap,o.mapBumpAnisotropy);break;case"mapBumpScale":l.bumpScale=c;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":l.normalMap=s(c,o.mapNormalRepeat,o.mapNormalOffset,o.mapNormalWrap,o.mapNormalAnisotropy);break;case"mapNormalFactor":l.normalScale=[c,c];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":l.specularMap=s(c,o.mapSpecularRepeat,o.mapSpecularOffset,o.mapSpecularWrap,o.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":l.metalnessMap=s(c,o.mapMetalnessRepeat,o.mapMetalnessOffset,o.mapMetalnessWrap,o.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":l.roughnessMap=s(c,o.mapRoughnessRepeat,o.mapRoughnessOffset,o.mapRoughnessWrap,o.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":l.alphaMap=s(c,o.mapAlphaRepeat,o.mapAlphaOffset,o.mapAlphaWrap,o.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":l.side=fn;break;case"doubleSided":l.side=xn;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),l.opacity=c;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":l[p]=c;break;case"vertexColors":!0===c&&(l.vertexColors=Tn),"face"===c&&(l.vertexColors=bn);break;default:console.error("THREE.Loader.createMaterial: Unsupported",p,c);}}return"MeshBasicMaterial"===l.type&&delete l.emissive,"MeshPhongMaterial"!==l.type&&delete l.specular,1>l.opacity&&(l.transparent=!0),r.setTextures(d),r.parse(l)}}()}()}),Object.assign(fr.prototype,{load:function(){return function(e,t,a,r){var o=this,n=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:yr.prototype.extractUrlBase(e),i=new ka(this.manager);i.setWithCredentials(this.withCredentials),i.load(e,function(a){var r=JSON.parse(a),i=r.metadata;if(i!==void 0){var s=i.type;if(s!==void 0){if("object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");if("scene"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.")}}var d=o.parse(r,n);t(d.geometry,d.materials)},a,r)}}(),setTexturePath:function(){return function(e){this.texturePath=e}}(),parse:function(){function e(e,t){function a(e,t){return e&1<<t}var o=e.faces,n=e.vertices,s=e.normals,d=e.colors,l=e.scale,p=0,c,i,g,h,y,f,x,_,b,T,S,E,C,P,w,A,R,M,L,B,D,I,F,O,U,k,u;if(e.uvs!==void 0){for(c=0;c<e.uvs.length;c++)e.uvs[c].length&&p++;for(c=0;c<p;c++)t.faceVertexUvs[c]=[]}for(h=0,y=n.length;h<y;)M=new m,M.x=n[h++]*l,M.y=n[h++]*l,M.z=n[h++]*l,t.vertices.push(M);for(h=0,y=o.length;h<y;)if(T=o[h++],S=a(T,0),E=a(T,1),C=a(T,3),P=a(T,4),w=a(T,5),A=a(T,6),R=a(T,7),S){if(B=new he,B.a=o[h],B.b=o[h+1],B.c=o[h+3],D=new he,D.a=o[h+1],D.b=o[h+2],D.c=o[h+3],h+=4,E&&(b=o[h++],B.materialIndex=b,D.materialIndex=b),g=t.faces.length,C)for(c=0;c<p;c++)for(O=e.uvs[c],t.faceVertexUvs[c][g]=[],t.faceVertexUvs[c][g+1]=[],i=0;4>i;i++)_=o[h++],k=O[2*_],u=O[2*_+1],U=new r(k,u),2!==i&&t.faceVertexUvs[c][g].push(U),0!==i&&t.faceVertexUvs[c][g+1].push(U);if(P&&(x=3*o[h++],B.normal.set(s[x++],s[x++],s[x]),D.normal.copy(B.normal)),w)for(c=0;4>c;c++)x=3*o[h++],F=new m(s[x++],s[x++],s[x]),2!==c&&B.vertexNormals.push(F),0!==c&&D.vertexNormals.push(F);if(A&&(f=o[h++],I=d[f],B.color.setHex(I),D.color.setHex(I)),R)for(c=0;4>c;c++)f=o[h++],I=d[f],2!==c&&B.vertexColors.push(new q(I)),0!==c&&D.vertexColors.push(new q(I));t.faces.push(B),t.faces.push(D)}else{if(L=new he,L.a=o[h++],L.b=o[h++],L.c=o[h++],E&&(b=o[h++],L.materialIndex=b),g=t.faces.length,C)for(c=0;c<p;c++)for(O=e.uvs[c],t.faceVertexUvs[c][g]=[],i=0;3>i;i++)_=o[h++],k=O[2*_],u=O[2*_+1],U=new r(k,u),t.faceVertexUvs[c][g].push(U);if(P&&(x=3*o[h++],L.normal.set(s[x++],s[x++],s[x])),w)for(c=0;3>c;c++)x=3*o[h++],F=new m(s[x++],s[x++],s[x]),L.vertexNormals.push(F);if(A&&(f=o[h++],L.color.setHex(d[f])),R)for(c=0;3>c;c++)f=o[h++],L.vertexColors.push(new q(d[f]));t.faces.push(L)}}function t(e,t){var r=e.influencesPerVertex===void 0?2:e.influencesPerVertex;if(e.skinWeights)for(var o=0,i=e.skinWeights.length;o<i;o+=r){var s=e.skinWeights[o],l=1<r?e.skinWeights[o+1]:0,p=2<r?e.skinWeights[o+2]:0,u=3<r?e.skinWeights[o+3]:0;t.skinWeights.push(new n(s,l,p,u))}if(e.skinIndices)for(var o=0,i=e.skinIndices.length;o<i;o+=r){var m=e.skinIndices[o],a=1<r?e.skinIndices[o+1]:0,g=2<r?e.skinIndices[o+2]:0,c=3<r?e.skinIndices[o+3]:0;t.skinIndices.push(new n(m,a,g,c))}t.bones=e.bones,t.bones&&0<t.bones.length&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}function a(e,t){var a=e.scale;if(e.morphTargets!==void 0)for(var r=0,o=e.morphTargets.length;r<o;r++){t.morphTargets[r]={},t.morphTargets[r].name=e.morphTargets[r].name,t.morphTargets[r].vertices=[];for(var n=t.morphTargets[r].vertices,i=e.morphTargets[r].vertices,s=0,d=i.length,l;s<d;s+=3)l=new m,l.x=i[s]*a,l.y=i[s+1]*a,l.z=i[s+2]*a,n.push(l)}if(void 0!==e.morphColors&&0<e.morphColors.length){console.warn("THREE.JSONLoader: \"morphColors\" no longer supported. Using them as face colors.");for(var p=t.faces,c=e.morphColors[0].colors,r=0,o=p.length;r<o;r++)p[r].color.fromArray(c,3*r)}}function o(e,t){var a=[],r=[];e.animation!==void 0&&r.push(e.animation),e.animations!==void 0&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var o=0,n;o<r.length;o++)n=mr.parseAnimation(r[o],t.bones),n&&a.push(n);if(t.morphTargets){var i=mr.CreateClipsFromMorphTargetSequences(t.morphTargets,10);a=a.concat(i)}0<a.length&&(t.animations=a)}return function(r,n){void 0!==r.data&&(r=r.data),r.scale=void 0===r.scale?1:1/r.scale;var i=new fe;if(e(r,i),t(r,i),a(r,i),o(r,i),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===r.materials||0===r.materials.length)return{geometry:i};var s=yr.prototype.initMaterials(r.materials,n,this.crossOrigin);return{geometry:i,materials:s}}}()}),Object.assign(xr.prototype,{load:function(){return function(e,t,a,r){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var o=this,n=new ka(o.manager);n.load(e,function(a){var n=null;try{n=JSON.parse(a)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var i=n.metadata;return void 0===i||void 0===i.type||"geometry"===i.type.toLowerCase()?void console.error("THREE.ObjectLoader: Can't load "+e+". Use THREE.JSONLoader instead."):void o.parse(n,t)},a,r)}}(),setTexturePath:function(){return function(e){this.texturePath=e}}(),setCrossOrigin:function(){return function(e){this.crossOrigin=e}}(),parse:function(){return function(e,t){var a=this.parseGeometries(e.geometries),r=this.parseImages(e.images,function(){void 0!==t&&t(i)}),o=this.parseTextures(e.textures,r),n=this.parseMaterials(e.materials,o),i=this.parseObject(e.object,a,n);return e.animations&&(i.animations=this.parseAnimations(e.animations)),(void 0===e.images||0===e.images.length)&&void 0!==t&&t(i),i}}(),parseGeometries:function(){return function(e){var t={};if(e!==void 0)for(var a=new fr,r=new hr,o=0,n=e.length;o<n;o++){var i=e[o],s;switch(i.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new ks[i.type](i.width,i.height,i.widthSegments,i.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new ks[i.type](i.width,i.height,i.depth,i.widthSegments,i.heightSegments,i.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new ks[i.type](i.radius,i.segments,i.thetaStart,i.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new ks[i.type](i.radiusTop,i.radiusBottom,i.height,i.radialSegments,i.heightSegments,i.openEnded,i.thetaStart,i.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new ks[i.type](i.radius,i.height,i.radialSegments,i.heightSegments,i.openEnded,i.thetaStart,i.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new ks[i.type](i.radius,i.widthSegments,i.heightSegments,i.phiStart,i.phiLength,i.thetaStart,i.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":s=new ks[i.type](i.radius,i.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new ks[i.type](i.innerRadius,i.outerRadius,i.thetaSegments,i.phiSegments,i.thetaStart,i.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new ks[i.type](i.radius,i.tube,i.radialSegments,i.tubularSegments,i.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new ks[i.type](i.radius,i.tube,i.tubularSegments,i.radialSegments,i.p,i.q);break;case"LatheGeometry":case"LatheBufferGeometry":s=new ks[i.type](i.points,i.segments,i.phiStart,i.phiLength);break;case"BufferGeometry":s=r.parse(i);break;case"Geometry":s=a.parse(i,this.texturePath).geometry;break;default:console.warn("THREE.ObjectLoader: Unsupported geometry type \""+i.type+"\"");continue;}s.uuid=i.uuid,void 0!==i.name&&(s.name=i.name),t[i.uuid]=s}return t}}(),parseMaterials:function(){return function(e,t){var a={};if(e!==void 0){var r=new gr;r.setTextures(t);for(var o=0,n=e.length,i;o<n;o++)if(i=e[o],"MultiMaterial"===i.type){for(var s=[],d=0;d<i.materials.length;d++)s.push(r.parse(i.materials[d]));a[i.uuid]=s}else a[i.uuid]=r.parse(i)}return a}}(),parseAnimations:function(){return function(e){for(var t=[],a=0,r;a<e.length;a++)r=mr.parse(e[a]),t.push(r);return t}}(),parseImages:function(){return function(e,t){function a(e){return r.manager.itemStart(e),s.load(e,function(){r.manager.itemEnd(e)},void 0,function(){r.manager.itemEnd(e),r.manager.itemError(e)})}var r=this,o={};if(e!==void 0&&0<e.length){var n=new Ua(t),s=new za(n);s.setCrossOrigin(this.crossOrigin);for(var d=0,i=e.length;d<i;d++){var l=e[d],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.texturePath+l.url;o[l.uuid]=a(p)}}return o}}(),parseTextures:function(){return function(e,t){function a(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(e!==void 0)for(var n=0,i=e.length,s;n<i;n++){s=e[n],void 0===s.image&&console.warn("THREE.ObjectLoader: No \"image\" specified for",s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var d=new o(t[s.image]);d.needsUpdate=!0,d.uuid=s.uuid,void 0!==s.name&&(d.name=s.name),void 0!==s.mapping&&(d.mapping=a(s.mapping,Xs)),void 0!==s.offset&&d.offset.fromArray(s.offset),void 0!==s.repeat&&d.repeat.fromArray(s.repeat),void 0!==s.wrap&&(d.wrapS=a(s.wrap[0],js),d.wrapT=a(s.wrap[1],js)),void 0!==s.minFilter&&(d.minFilter=a(s.minFilter,qs)),void 0!==s.magFilter&&(d.magFilter=a(s.magFilter,qs)),void 0!==s.anisotropy&&(d.anisotropy=s.anisotropy),void 0!==s.flipY&&(d.flipY=s.flipY),r[s.uuid]=d}return r}}(),parseObject:function(){var e=new l;return function(){function t(t,a,r){function o(e){return void 0===a[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),a[e]}function n(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],a=0,o=e.length,n;a<o;a++)n=e[a],void 0===r[n]&&console.warn("THREE.ObjectLoader: Undefined material",n),t.push(r[n]);return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}var s;switch(t.type){case"Scene":s=new Pt,void 0!==t.background&&nn(t.background)&&(s.background=new q(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new Ct(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new Et(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":s=new ge(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new me(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":s=new Qa(t.color,t.intensity);break;case"DirectionalLight":s=new Ja(t.color,t.intensity);break;case"PointLight":s=new Ka(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new $a(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new Ya(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new Xa(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var d=o(t.geometry),p=n(t.material);s=d.bones&&0<d.bones.length?new Dt(d,p):new Ge(d,p);break;case"LOD":s=new Mt;break;case"Line":s=new Ft(o(t.geometry),n(t.material),t.mode);break;case"LineLoop":s=new Ut(o(t.geometry),n(t.material));break;case"LineSegments":s=new Ot(o(t.geometry),n(t.material));break;case"PointCloud":case"Points":s=new Gt(o(t.geometry),n(t.material));break;case"Sprite":s=new Rt(n(t.material));break;case"Group":s=new Nt;break;default:s=new ce;}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0===t.matrix?(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)):(e.fromArray(t.matrix),e.decompose(s.position,s.quaternion,s.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.children)for(var c=t.children,u=0;u<c.length;u++)s.add(this.parseObject(c[u],a,r));if("LOD"===t.type)for(var i=t.levels,m=0;m<i.length;m++){var l=i[m],g=s.getObjectByProperty("uuid",l.object);void 0!==g&&s.addLevel(g,l.distance)}return s}return t}()}()});var Xs={UVMapping:si,CubeReflectionMapping:di,CubeRefractionMapping:li,EquirectangularReflectionMapping:pi,EquirectangularRefractionMapping:ci,SphericalReflectionMapping:ui,CubeUVReflectionMapping:mi,CubeUVRefractionMapping:gi},js={RepeatWrapping:hi,ClampToEdgeWrapping:yi,MirroredRepeatWrapping:fi},qs={NearestFilter:xi,NearestMipMapNearestFilter:vi,NearestMipMapLinearFilter:_i,LinearFilter:bi,LinearMipMapNearestFilter:Ti,LinearMipMapLinearFilter:Si};Object.assign(Rr.prototype,{getPoint:function(){return function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}}(),getPointAt:function(){return function(e){var a=this.getUtoTmapping(e);return this.getPoint(a)}}(),getPoints:function(){return function(e){e===void 0&&(e=5);for(var t=[],a=0;a<=e;a++)t.push(this.getPoint(a/e));return t}}(),getSpacedPoints:function(){return function(e){e===void 0&&(e=5);for(var t=[],a=0;a<=e;a++)t.push(this.getPointAt(a/e));return t}}(),getLength:function(){return function(){var e=this.getLengths();return e[e.length-1]}}(),getLengths:function(){return function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],a=this.getPoint(0),r=0,o,n;for(t.push(0),n=1;n<=e;n++)o=this.getPoint(n/e),r+=o.distanceTo(a),t.push(r),a=o;return this.cacheArcLengths=t,t}}(),updateArcLengths:function(){return function(){this.needsUpdate=!0,this.getLengths()}}(),getUtoTmapping:function(){return function(e,a){var r=this.getLengths(),o=0,n=r.length,i;i=a?a:e*r[n-1];for(var s=0,d=n-1,l;s<=d;)if(o=on(s+(d-s)/2),l=r[o]-i,0>l)s=o+1;else if(0<l)d=o-1;else{d=o;break}if(o=d,r[o]===i)return o/(n-1);var p=r[o],c=r[o+1],u=(i-p)/(c-p),m=(o+u)/(n-1);return m}}(),getTangent:function(){return function(e){var t=1e-4,a=e-t,r=e+t;0>a&&(a=0),1<r&&(r=1);var o=this.getPoint(a),n=this.getPoint(r),i=n.clone().sub(o);return i.normalize()}}(),getTangentAt:function(){return function(e){var a=this.getUtoTmapping(e);return this.getTangent(a)}}(),computeFrenetFrames:function(){function e(e,t){var a=new m,r=[],o=[],n=[],s=new m,d=new l,p,i,c;for(p=0;p<=e;p++)i=p/e,r[p]=this.getTangentAt(i),r[p].normalize();o[0]=new m,n[0]=new m;var u=Number.MAX_VALUE,g=qo(r[0].x),h=qo(r[0].y),y=qo(r[0].z);for(g<=u&&(u=g,a.set(1,0,0)),h<=u&&(u=h,a.set(0,1,0)),y<=u&&a.set(0,0,1),s.crossVectors(r[0],a).normalize(),o[0].crossVectors(r[0],s),n[0].crossVectors(r[0],o[0]),p=1;p<=e;p++)o[p]=o[p-1].clone(),n[p]=n[p-1].clone(),s.crossVectors(r[p-1],r[p]),s.length()>sn&&(s.normalize(),c=Ho(vs.clamp(r[p-1].dot(r[p]),-1,1)),o[p].applyMatrix4(d.makeRotationAxis(s,c))),n[p].crossVectors(r[p],o[p]);if(!0===t)for(c=Ho(vs.clamp(o[0].dot(o[e]),-1,1)),c/=e,0<r[0].dot(s.crossVectors(o[0],o[e]))&&(c=-c),p=1;p<=e;p++)o[p].applyMatrix4(d.makeRotationAxis(r[p],c*p)),n[p].crossVectors(r[p],o[p]);return{tangents:r,normals:o,binormals:n}}return e}()}),Mr.prototype=Object.create(Rr.prototype),Mr.prototype.constructor=Mr,Mr.prototype.isLineCurve=!0,Mr.prototype.getPoint=function(e){if(1===e)return this.v2.clone();var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},Mr.prototype.getPointAt=function(e){return this.getPoint(e)},Mr.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()},Lr.prototype=Object.assign(Object.create(Rr.prototype),{constructor:Lr,add:function(){return function(e){this.curves.push(e)}}(),closePath:function(){return function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Mr(t,e))}}(),getPoint:function(){return function(e){for(var t=e*this.getLength(),a=this.getCurveLengths(),r=0;r<a.length;){if(a[r]>=t){var o=a[r]-t,n=this.curves[r],i=n.getLength(),s=0===i?0:1-o/i;return n.getPointAt(s)}r++}return null}}(),getLength:function(){return function(){var e=this.getCurveLengths();return e[e.length-1]}}(),updateArcLengths:function(){return function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}}(),getCurveLengths:function(){return function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,a=0,r=this.curves.length;a<r;a++)t+=this.curves[a].getLength(),e.push(t);return this.cacheLengths=e,e}}(),getSpacedPoints:function(){return function(e){void 0===e&&(e=40);for(var t=[],a=0;a<=e;a++)t.push(this.getPoint(a/e));return this.autoClose&&t.push(t[0]),t}}(),getPoints:function(){return function(e){e=e||12;for(var t=[],a=0,r=this.curves,o;a<r.length;a++)for(var n=r[a],i=n&&n.isEllipseCurve?2*e:n&&n.isLineCurve?1:n&&n.isSplineCurve?e*n.points.length:e,s=n.getPoints(i),d=0,l;d<s.length;d++)l=s[d],o&&o.equals(l)||(t.push(l),o=l);return this.autoClose&&1<t.length&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}}(),createPointsGeometry:function(){return function(e){var t=this.getPoints(e);return this.createGeometry(t)}}(),createSpacedPointsGeometry:function(){return function(e){var t=this.getSpacedPoints(e);return this.createGeometry(t)}}(),createGeometry:function(){return function(e){for(var t=new fe,a=0,r=e.length,o;a<r;a++)o=e[a],t.vertices.push(new m(o.x,o.y,o.z||0));return t}}()}),Br.prototype=Object.create(Rr.prototype),Br.prototype.constructor=Br,Br.prototype.isEllipseCurve=!0,Br.prototype.getPoint=function(e){for(var t=2*an,a=this.aEndAngle-this.aStartAngle,o=qo(a)<sn;0>a;)a+=t;for(;a>t;)a-=t;a<sn&&(o?a=0:a=t),!0!==this.aClockwise||o||(a===t?a=-t:a-=t);var n=this.aStartAngle+e*a,i=this.aX+this.xRadius*Xo(n),s=this.aY+this.yRadius*Vo(n);if(0!==this.aRotation){var d=Xo(this.aRotation),l=Vo(this.aRotation),p=i-this.aX,c=s-this.aY;i=p*d-c*l+this.aX,s=p*l+c*d+this.aY}return new r(i,s)},Dr.prototype=Object.create(Rr.prototype),Dr.prototype.constructor=Dr,Dr.prototype.isSplineCurve=!0,Dr.prototype.getPoint=function(e){var t=this.points,a=(t.length-1)*e,o=on(a),n=a-o,i=t[0===o?o:o-1],s=t[o],d=t[o>t.length-2?t.length-1:o+1],l=t[o>t.length-3?t.length-1:o+2];return new r(vr(n,i.x,s.x,d.x,l.x),vr(n,i.y,s.y,d.y,l.y))},Ir.prototype=Object.create(Rr.prototype),Ir.prototype.constructor=Ir,Ir.prototype.getPoint=function(e){var t=this.v0,a=this.v1,o=this.v2,n=this.v3;return new r(Ar(e,t.x,a.x,o.x,n.x),Ar(e,t.y,a.y,o.y,n.y))},Fr.prototype=Object.create(Rr.prototype),Fr.prototype.constructor=Fr,Fr.prototype.getPoint=function(e){var t=this.v0,a=this.v1,o=this.v2;return new r(Sr(e,t.x,a.x,o.x),Sr(e,t.y,a.y,o.y))};var Ys=Object.assign(Object.create(Lr.prototype),{fromPoints:function(){return function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,a=e.length;t<a;t++)this.lineTo(e[t].x,e[t].y)}}(),moveTo:function(){return function(e,t){this.currentPoint.set(e,t)}}(),lineTo:function(){return function(e,t){var a=new Mr(this.currentPoint.clone(),new r(e,t));this.curves.push(a),this.currentPoint.set(e,t)}}(),quadraticCurveTo:function(){return function(e,t,a,o){var n=new Fr(this.currentPoint.clone(),new r(e,t),new r(a,o));this.curves.push(n),this.currentPoint.set(a,o)}}(),bezierCurveTo:function(){return function(e,t,a,o,n,i){var s=new Ir(this.currentPoint.clone(),new r(e,t),new r(a,o),new r(n,i));this.curves.push(s),this.currentPoint.set(n,i)}}(),splineThru:function(){return function(e){var t=[this.currentPoint.clone()].concat(e),a=new Dr(t);this.curves.push(a),this.currentPoint.copy(e[e.length-1])}}(),arc:function(){return function(e,t,a,r,o,n){var i=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+i,t+s,a,r,o,n)}}(),absarc:function(){return function(e,t,a,r,o,n){this.absellipse(e,t,a,a,r,o,n)}}(),ellipse:function(){return function(e,t,a,r,o,n,i,s){var d=this.currentPoint.x,l=this.currentPoint.y;this.absellipse(e+d,t+l,a,r,o,n,i,s)}}(),absellipse:function(){return function(e,t,a,r,o,n,i,s){var d=new Br(e,t,a,r,o,n,i,s);if(0<this.curves.length){var l=d.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(d);var p=d.getPoint(1);this.currentPoint.copy(p)}}()});Or.prototype=Ys,Ys.constructor=Or,Ur.prototype=Object.assign(Object.create(Ys),{constructor:Ur,getPointsHoles:function(){return function(e){for(var t=[],a=0,r=this.holes.length;a<r;a++)t[a]=this.holes[a].getPoints(e);return t}}(),extractAllPoints:function(){return function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}}(),extractPoints:function(){return function(e){return this.extractAllPoints(e)}}()}),Object.assign(kr.prototype,{moveTo:function(){return function(e,t){this.currentPath=new Or,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)}}(),lineTo:function(){return function(e,t){this.currentPath.lineTo(e,t)}}(),quadraticCurveTo:function(){return function(e,t,a,r){this.currentPath.quadraticCurveTo(e,t,a,r)}}(),bezierCurveTo:function(){return function(e,t,a,r,o,n){this.currentPath.bezierCurveTo(e,t,a,r,o,n)}}(),splineThru:function(){return function(e){this.currentPath.splineThru(e)}}(),toShapes:function(){return function(e,t){function a(e){for(var t=[],a=0,r=e.length;a<r;a++){var o=e[a],n=new Ur;n.curves=o.curves,t.push(n)}return t}function r(e,t){for(var a=t.length,r=!1,o=a-1,n=0;n<a;o=n++){var i=t[o],s=t[n],d=s.x-i.x,l=s.y-i.y;if(qo(l)>sn){if(0>l&&(i=t[n],d=-d,s=t[o],l=-l),e.y<i.y||e.y>s.y)continue;if(e.y!==i.y){var p=l*(e.x-i.x)-d*(e.y-i.y);if(0==p)return!0;if(0>p)continue;r=!r}else if(e.x===i.x)return!0}else{if(e.y!==i.y)continue;if(s.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=s.x)return!0}}return r}var o=Us.isClockWise,n=this.subPaths;if(0===n.length)return[];if(!0===t)return a(n);var s=[],d,p,c;if(1===n.length)return p=n[0],c=new Ur,c.curves=p.curves,s.push(c),s;var u=!o(n[0].getPoints());u=e?!u:u;var m=[],g=[],h=[],y=0,f;g[y]=void 0,h[y]=[];for(var x=0,i=n.length;x<i;x++)p=n[x],f=p.getPoints(),d=o(f),d=e?!d:d,d?(!u&&g[y]&&y++,g[y]={s:new Ur,p:f},g[y].s.curves=p.curves,u&&y++,h[y]=[]):h[y].push({h:p,p:f[0]});if(!g[0])return a(n);if(1<g.length){for(var l=!1,v=[],_=0,b=g.length;_<b;_++)m[_]=[];for(var _=0,b=g.length,T;_<b;_++){T=h[_];for(var S=0;S<T.length;S++){for(var E=T[S],C=!0,P=0;P<g.length;P++)r(E.p,g[P].p)&&(_!==P&&v.push({froms:_,tos:P,hole:S}),C?(C=!1,m[P].push(E)):l=!0);C&&m[_].push(E)}}0<v.length&&!l&&(h=m)}for(var x=0,w=g.length,A;x<w;x++){c=g[x].s,s.push(c),A=h[x];for(var R=0,M=A.length;R<M;R++)c.holes.push(A[R].h)}return s}}()}),Object.assign(Gr.prototype,{isFont:!0,generateShapes:function(){return function(e,t,a){function r(e){for(var a=(e+"").split(""),r=t/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,d=0,l=0,p=[],c=0,i;c<a.length;c++)if(i=a[c],"\n"===i)d=0,l-=s;else{var u=o(i,r,d,l);d+=u.offsetX,p.push(u.path)}return p}function o(e,r,o,s){var d=n.glyphs[e]||n.glyphs["?"];if(d){var p=new kr,c=[],u,m,g,h,y,f,x,v,_,b,T;if(d.o)for(var S=d._cachedOutline||(d._cachedOutline=d.o.split(" ")),E=0,i=S.length,l;E<i;)switch(l=S[E++],l){case"m":u=S[E++]*r+o,m=S[E++]*r+s,p.moveTo(u,m);break;case"l":u=S[E++]*r+o,m=S[E++]*r+s,p.lineTo(u,m);break;case"q":if(g=S[E++]*r+o,h=S[E++]*r+s,x=S[E++]*r+o,v=S[E++]*r+s,p.quadraticCurveTo(x,v,g,h),T=c[c.length-1],T){y=T.x,f=T.y;for(var C=1,P;C<=a;C++)P=C/a,Sr(P,y,x,g),Sr(P,f,v,h)}break;case"b":if(g=S[E++]*r+o,h=S[E++]*r+s,x=S[E++]*r+o,v=S[E++]*r+s,_=S[E++]*r+o,b=S[E++]*r+s,p.bezierCurveTo(x,v,_,b,g,h),T=c[c.length-1],T){y=T.x,f=T.y;for(var C=1,P;C<=a;C++)P=C/a,Ar(P,y,x,_,g),Ar(P,f,v,b,h)}}return{offsetX:d.ha*r,path:p}}}t===void 0&&(t=100),a===void 0&&(a=4);for(var n=this.data,i=r(e),s=[],d=0,l=i.length;d<l;d++)Array.prototype.push.apply(s,i[d].toShapes());return s}}()}),Object.assign(Nr.prototype,{load:function(){return function(e,t,a,r){var o=this,n=new ka(this.manager);n.load(e,function(e){var a;try{a=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),a=JSON.parse(e.substring(65,e.length-2))}var r=o.parse(a);t&&t(r)},a,r)}}(),parse:function(){return function(e){return new Gr(e)}}()});var Ks={getContext:function(){function e(){return void 0===Zs&&(Zs=new(window.AudioContext||window.webkitAudioContext)),Zs}return e}(),setContext:function(){return function(e){Zs=e}}()},Zs;Object.assign(zr.prototype,{load:function(){return function(e,t,a,r){var o=new ka(this.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){var a=Ks.getContext();a.decodeAudioData(e,function(e){t(e)})},a,r)}}()}),Object.assign(Wr.prototype,{update:function(){var e=new l,t=new l,a,r,o,n,i,s,d,p;return function(){function l(l){var c=a!==this||r!==l.focus||o!==l.fov||n!==l.aspect*this.aspect||i!==l.near||s!==l.far||d!==l.zoom||p!==this.eyeSep;if(c){a=this,r=l.focus,o=l.fov,n=l.aspect*this.aspect,i=l.near,s=l.far,d=l.zoom;var u=l.projectionMatrix.clone();p=this.eyeSep/2;var m=p*i/r,g=i*No(.5*(vs.DEG2RAD*o))/d,h,y;t.elements[12]=-p,e.elements[12]=p,h=-g*n+m,y=g*n+m,u.elements[0]=2*i/(y-h),u.elements[8]=(y+h)/(y-h),this.cameraL.projectionMatrix.copy(u),h=-g*n-m,y=g*n-m,u.elements[0]=2*i/(y-h),u.elements[8]=(y+h)/(y-h),this.cameraR.projectionMatrix.copy(u)}this.cameraL.matrixWorld.copy(l.matrixWorld).multiply(t),this.cameraR.matrixWorld.copy(l.matrixWorld).multiply(e)}return l}()}()}),Hr.prototype=Object.create(ce.prototype),Hr.prototype.constructor=Hr,Vr.prototype=Object.assign(Object.create(ce.prototype),{constructor:Vr,getInput:function(){return function(){return this.gain}}(),removeFilter:function(){return function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)}}(),getFilter:function(){return function(){return this.filter}}(),setFilter:function(){return function(e){null===this.filter?this.gain.disconnect(this.context.destination):(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)}}(),getMasterVolume:function(){return function(){return this.gain.gain.value}}(),setMasterVolume:function(){return function(e){this.gain.gain.value=e}}(),updateMatrixWorld:function(){var e=new m,t=new d,a=new m,r=new m;return function(){return function(o){ce.prototype.updateMatrixWorld.call(this,o);var n=this.context.listener,i=this.up;this.matrixWorld.decompose(e,t,a),r.set(0,0,-1).applyQuaternion(t),n.positionX?(n.positionX.setValueAtTime(e.x,this.context.currentTime),n.positionY.setValueAtTime(e.y,this.context.currentTime),n.positionZ.setValueAtTime(e.z,this.context.currentTime),n.forwardX.setValueAtTime(r.x,this.context.currentTime),n.forwardY.setValueAtTime(r.y,this.context.currentTime),n.forwardZ.setValueAtTime(r.z,this.context.currentTime),n.upX.setValueAtTime(i.x,this.context.currentTime),n.upY.setValueAtTime(i.y,this.context.currentTime),n.upZ.setValueAtTime(i.z,this.context.currentTime)):(n.setPosition(e.x,e.y,e.z),n.setOrientation(r.x,r.y,r.z,i.x,i.y,i.z))}}()}()}),Xr.prototype=Object.assign(Object.create(ce.prototype),{constructor:Xr,getOutput:function(){return function(){return this.gain}}(),setNodeSource:function(){return function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}}(),setBuffer:function(){return function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}}(),play:function(){return function(){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),e.start(0,this.startTime),this.isPlaying=!0,this.source=e,this.connect()}}(),pause:function(){return function(){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this)}}(),stop:function(){return function(){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.startTime=0,this.isPlaying=!1,this)}}(),connect:function(){return function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this}}(),disconnect:function(){return function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this}}(),getFilters:function(){return function(){return this.filters}}(),setFilters:function(){return function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this}}(),getFilter:function(){return function(){return this.getFilters()[0]}}(),setFilter:function(){return function(e){return this.setFilters(e?[e]:[])}}(),setPlaybackRate:function(){return function(e){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this)}}(),getPlaybackRate:function(){return function(){return this.playbackRate}}(),onEnded:function(){return function(){this.isPlaying=!1}}(),getLoop:function(){return function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}}(),setLoop:function(){return function(e){return!1===this.hasPlaybackControl?void console.warn("THREE.Audio: this Audio has no playback control."):(this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this)}}(),getVolume:function(){return function(){return this.gain.gain.value}}(),setVolume:function(){return function(e){return this.gain.gain.value=e,this}}()}),jr.prototype=Object.assign(Object.create(Xr.prototype),{constructor:jr,getOutput:function(){return function(){return this.panner}}(),getRefDistance:function(){return function(){return this.panner.refDistance}}(),setRefDistance:function(){return function(e){this.panner.refDistance=e}}(),getRolloffFactor:function(){return function(){return this.panner.rolloffFactor}}(),setRolloffFactor:function(){return function(e){this.panner.rolloffFactor=e}}(),getDistanceModel:function(){return function(){return this.panner.distanceModel}}(),setDistanceModel:function(){return function(e){this.panner.distanceModel=e}}(),getMaxDistance:function(){return function(){return this.panner.maxDistance}}(),setMaxDistance:function(){return function(e){this.panner.maxDistance=e}}(),updateMatrixWorld:function(){var e=new m;return function(){return function(t){ce.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}()}()}),Object.assign(qr.prototype,{getFrequencyData:function(){return function(){return this.analyser.getByteFrequencyData(this.data),this.data}}(),getAverageFrequency:function(){return function(){for(var e=0,t=this.getFrequencyData(),a=0;a<t.length;a++)e+=t[a];return e/t.length}}()}),Object.assign(Yr.prototype,{accumulate:function(){return function(e,t){var a=this.buffer,r=this.valueSize,o=e*r+r,n=this.cumulativeWeight;if(0===n){for(var s=0;s!==r;++s)a[o+s]=a[s];n=t}else{n+=t;var i=t/n;this._mixBufferRegion(a,o,0,i,r)}this.cumulativeWeight=n}}(),apply:function(){return function(e){var t=this.valueSize,a=this.buffer,r=e*t+t,o=this.cumulativeWeight,n=this.binding;if(this.cumulativeWeight=0,1>o){this._mixBufferRegion(a,r,3*t,1-o,t)}for(var s=t;s!==t+t;++s)if(a[s]!==a[s+t]){n.setValue(a,r);break}}}(),saveOriginalState:function(){return function(){var e=this.binding,t=this.buffer,a=this.valueSize,r=3*a;e.getValue(t,r);for(var o=a;o!==r;++o)t[o]=t[r+o%a];this.cumulativeWeight=0}}(),restoreOriginalState:function(){return function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}}(),_select:function(){return function(e,a,r,o,t){if(.5<=o)for(var n=0;n!==t;++n)e[a+n]=e[r+n]}}(),_slerp:function(){return function(e,a,r,o){d.slerpFlat(e,a,e,a,e,r,o)}}(),_lerp:function(){return function(e,a,r,o,t){for(var n=0,i;n!==t;++n)i=a+n,e[i]=e[i]*(1-o)+e[r+n]*o}}()}),Object.assign(Kr.prototype,{getValue:function(){return function(e,t){this.bind();var a=this._targetGroup.nCachedObjects_,r=this._bindings[a];r!==void 0&&r.getValue(e,t)}}(),setValue:function(){return function(e,t){for(var a=this._bindings,r=this._targetGroup.nCachedObjects_,o=a.length;r!==o;++r)a[r].setValue(e,t)}}(),bind:function(){return function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,a=e.length;t!==a;++t)e[t].bind()}}(),unbind:function(){return function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,a=e.length;t!==a;++t)e[t].unbind()}}()}),Object.assign(Zr,{Composite:Kr,create:function(){return function(e,t,a){return e&&e.isAnimationObjectGroup?new Zr.Composite(e,t,a):new Zr(e,t,a)}}(),sanitizeNodeName:function(){return function(e){return e.replace(/\s/g,"_").replace(/[^\w-]/g,"")}}(),parseTrackName:function(){var e=/((?:[\w-]+[\/:])*)/,t=/([\w-\.]+)?/,a=/(?:\.([\w-]+)(?:\[(.+)\])?)?/,r=/\.([\w-]+)(?:\[(.+)\])?/,o=new RegExp("^"+e.source+t.source+a.source+r.source+"$"),n=["material","materials","bones"];return function(e){var t=o.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var a={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=a.nodeName&&a.nodeName.lastIndexOf(".");if(r!==void 0&&-1!==r){var i=a.nodeName.substring(r+1);-1!==n.indexOf(i)&&(a.nodeName=a.nodeName.substring(0,r),a.objectName=i)}if(null===a.propertyName||0===a.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return a}}(),findNode:function(){return function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var a=function(){return function(e){for(var a=0,r;a<e.bones.length;a++)if(r=e.bones[a],r.name===t)return r;return null}}(),r=a(e.skeleton);if(r)return r}if(e.children){var o=function(){function e(a){for(var r=0,o;r<a.length;r++){if(o=a[r],o.name===t||o.uuid===t)return o;var n=e(o.children);if(n)return n}return null}return e}(),n=o(e.children);if(n)return n}return null}}()}),Object.assign(Zr.prototype,{_getValue_unavailable:function(){return function(){}}(),_setValue_unavailable:function(){return function(){}}(),BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(){return function(e,t){e[t]=this.node[this.propertyName]}}(),function(){return function(e,t){for(var a=this.resolvedProperty,r=0,o=a.length;r!==o;++r)e[t++]=a[r]}}(),function(){return function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}}(),function(){return function(e,t){this.resolvedProperty.toArray(e,t)}}()],SetterByBindingTypeAndVersioning:[[function(){return function(e,t){this.node[this.propertyName]=e[t]}}(),function(){return function(e,t){this.node[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}}(),function(){return function(e,t){this.node[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}}()],[function(){return function(e,t){for(var a=this.resolvedProperty,r=0,o=a.length;r!==o;++r)a[r]=e[t++]}}(),function(){return function(e,t){for(var a=this.resolvedProperty,r=0,o=a.length;r!==o;++r)a[r]=e[t++];this.targetObject.needsUpdate=!0}}(),function(){return function(e,t){for(var a=this.resolvedProperty,r=0,o=a.length;r!==o;++r)a[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}}()],[function(){return function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}}(),function(){return function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}}(),function(){return function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}}()],[function(){return function(e,t){this.resolvedProperty.fromArray(e,t)}}(),function(){return function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}}(),function(){return function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}}()]],getValue:function(){return function(e,t){this.bind(),this.getValue(e,t)}}(),setValue:function(){return function(e,t){this.bind(),this.setValue(e,t)}}(),bind:function(){return function(){var e=this.node,t=this.parsedPath,a=t.objectName,r=t.propertyName,o=t.propertyIndex;if(e||(e=Zr.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(a){var n=t.objectIndex;switch(a){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var s=0;s<e.length;s++)if(e[s].name===n){n=s;break}break;default:if(void 0===e[a])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[a];}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}var i=e[r];if(void 0===i){var d=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+d+"."+r+" but it wasn't found.",e)}var l=this.Versioning.None;void 0===e.needsUpdate?void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e):(l=this.Versioning.NeedsUpdate,this.targetObject=e);var p=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(var s=0;s<this.node.geometry.morphAttributes.position.length;s++)if(e.geometry.morphAttributes.position[s].name===o){o=s;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(var s=0;s<this.node.geometry.morphTargets.length;s++)if(e.geometry.morphTargets[s].name===o){o=s;break}}}p=this.BindingType.ArrayElement,this.resolvedProperty=i,this.propertyIndex=o}else void 0!==i.fromArray&&void 0!==i.toArray?(p=this.BindingType.HasFromToArray,this.resolvedProperty=i):Array.isArray(i)?(p=this.BindingType.EntireArray,this.resolvedProperty=i):this.propertyName=r;this.getValue=this.GetterByBindingType[p],this.setValue=this.SetterByBindingTypeAndVersioning[p][l]}}(),unbind:function(){return function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}()}),Object.assign(Zr.prototype,{_getValue_unbound:Zr.prototype.getValue,_setValue_unbound:Zr.prototype.setValue}),Object.assign(Jr.prototype,{isAnimationObjectGroup:!0,add:function(){return function(){for(var e=this._objects,t=e.length,a=this.nCachedObjects_,r=this._indicesByUUID,o=this._paths,s=this._parsedPaths,d=this._bindings,l=d.length,p=0,i=arguments.length;p!==i;++p){var n=arguments[p],c=n.uuid,u=r[c],g=void 0;if(u===void 0){u=t++,r[c]=u,e.push(n);for(var h=0,y=l;h!==y;++h)d[h].push(new Zr(n,o[h],s[h]))}else if(u<a){g=e[u];var m=--a,f=e[m];r[f.uuid]=u,e[u]=f,r[c]=m,e[m]=n;for(var h=0,y=l;h!==y;++h){var x=d[h],v=x[m],_=x[u];x[u]=v,_===void 0&&(_=new Zr(n,o[h],s[h])),x[m]=_}}else e[u]!==g&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=a}}(),remove:function(){return function(){for(var e=this._objects,t=this.nCachedObjects_,a=this._indicesByUUID,r=this._bindings,o=r.length,s=0,i=arguments.length;s!==i;++s){var n=arguments[s],d=n.uuid,l=a[d];if(l!==void 0&&l>=t){var p=t++,c=e[p];a[c.uuid]=l,e[l]=c,a[d]=p,e[p]=n;for(var u=0;u!==o;++u){var m=r[u],g=m[p],h=m[l];m[l]=g,m[p]=h}}}this.nCachedObjects_=t}}(),uncache:function(){return function(){for(var e=this._objects,t=e.length,a=this.nCachedObjects_,r=this._indicesByUUID,o=this._bindings,s=o.length,d=0,i=arguments.length;d!==i;++d){var n=arguments[d],l=n.uuid,p=r[l];if(void 0!==p)if(delete r[l],p<a){var c=--a,u=e[c],g=--t,h=e[g];r[u.uuid]=p,e[p]=u,r[h.uuid]=c,e[c]=h,e.pop();for(var y=0,f=s;y!==f;++y){var m=o[y],x=m[c],v=m[g];m[p]=x,m[c]=v,m.pop()}}else{var g=--t,h=e[g];r[h.uuid]=p,e[p]=h,e.pop();for(var y=0,f=s,m;y!==f;++y)m=o[y],m[p]=m[g],m.pop()}}this.nCachedObjects_=a}}(),subscribe_:function(){return function(e,t){var a=this._bindingsIndicesByPath,r=a[e],o=this._bindings;if(r!==void 0)return o[r];var s=this._paths,d=this._parsedPaths,l=this._objects,p=l.length,c=this.nCachedObjects_,u=Array(p);r=o.length,a[e]=r,s.push(e),d.push(t),o.push(u);for(var m=c,i=l.length,n;m!==i;++m)n=l[m],u[m]=new Zr(n,e,t);return u}}(),unsubscribe_:function(){return function(e){var t=this._bindingsIndicesByPath,a=t[e];if(a!==void 0){var r=this._paths,o=this._parsedPaths,n=this._bindings,i=n.length-1,s=n[i],d=e[i];t[d]=a,n[a]=s,n.pop(),o[a]=o[i],o.pop(),r[a]=r[i],r.pop()}}}()}),Object.assign(Qr.prototype,{play:function(){return function(){return this._mixer._activateAction(this),this}}(),stop:function(){return function(){return this._mixer._deactivateAction(this),this.reset()}}(),reset:function(){return function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}}(),isRunning:function(){return function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}}(),isScheduled:function(){return function(){return this._mixer._isActiveAction(this)}}(),startAt:function(){return function(e){return this._startTime=e,this}}(),setLoop:function(){return function(e,t){return this.loop=e,this.repetitions=t,this}}(),setEffectiveWeight:function(){return function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}}(),getEffectiveWeight:function(){return function(){return this._effectiveWeight}}(),fadeIn:function(){return function(e){return this._scheduleFading(e,0,1)}}(),fadeOut:function(){return function(e){return this._scheduleFading(e,1,0)}}(),crossFadeFrom:function(){return function(e,t,a){if(e.fadeOut(t),this.fadeIn(t),a){var r=this._clip.duration,o=e._clip.duration;e.warp(1,o/r,t),this.warp(r/o,1,t)}return this}}(),crossFadeTo:function(){return function(e,t,a){return e.crossFadeFrom(this,t,a)}}(),stopFading:function(){return function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}}(),setEffectiveTimeScale:function(){return function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}}(),getEffectiveTimeScale:function(){return function(){return this._effectiveTimeScale}}(),setDuration:function(){return function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}}(),syncWith:function(){return function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}}(),halt:function(){return function(e){return this.warp(this._effectiveTimeScale,0,e)}}(),warp:function(){return function(e,t,a){var r=this._mixer,o=r.time,n=this._timeScaleInterpolant,i=this.timeScale;null===n&&(n=r._lendControlInterpolant(),this._timeScaleInterpolant=n);var s=n.parameterPositions,d=n.sampleValues;return s[0]=o,s[1]=o+a,d[0]=e/i,d[1]=t/i,this}}(),stopWarping:function(){return function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}}(),getMixer:function(){return function(){return this._mixer}}(),getClip:function(){return function(){return this._clip}}(),getRoot:function(){return function(){return this._localRoot||this._mixer._root}}(),_update:function(){return function(e,t,a,r){if(!this.enabled)return void this._updateWeight(e);var o=this._startTime;if(null!==o){var n=(e-o)*a;if(0>n||0===a)return;this._startTime=null,t=a*n}t*=this._updateTimeScale(e);var i=this._updateTime(t),s=this._updateWeight(e);if(0<s)for(var d=this._interpolants,l=this._propertyBindings,p=0,c=d.length;p!==c;++p)d[p].evaluate(i),l[p].accumulate(r,s)}}(),_updateWeight:function(){return function(e){var t=0;if(this.enabled){t=this.weight;var a=this._weightInterpolant;if(null!==a){var r=a.evaluate(e)[0];t*=r,e>a.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}}(),_updateTimeScale:function(){return function(e){var t=0;if(!this.paused){t=this.timeScale;var a=this._timeScaleInterpolant;if(null!==a){var r=a.evaluate(e)[0];t*=r,e>a.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}}(),_updateTime:function(){return function(e){var t=this.time+e;if(0===e)return t;var a=this._clip.duration,r=this.loop,o=this._loopCount;if(r===Qi){-1===o&&(this._loopCount=0,this._setEndings(!0,!0,!1));handle_stop:{if(t>=a)t=a;else if(0>t)t=0;else break handle_stop;this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:0>e?-1:1})}}else{var n=r===es;if(-1===o&&(0<=e?(o=0,this._setEndings(!0,0===this.repetitions,n)):this._setEndings(0===this.repetitions,!0,n)),t>=a||0>t){var i=on(t/a);t-=a*i,o+=qo(i);var s=this.repetitions-o;if(0>s)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=0<e?a:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1});else{if(0==s){var d=0>e;this._setEndings(d,!d,n)}else this._setEndings(!1,!1,n);this._loopCount=o,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}if(n&&1==(1&o))return this.time=t,a-t}return this.time=t,t}}(),_setEndings:function(){return function(e,t,a){var r=this._interpolantSettings;a?(r.endingStart=ns,r.endingEnd=ns):(r.endingStart=e?this.zeroSlopeAtStart?ns:os:is,r.endingEnd=t?this.zeroSlopeAtEnd?ns:os:is)}}(),_scheduleFading:function(){return function(e,t,a){var r=this._mixer,o=r.time,n=this._weightInterpolant;null===n&&(n=r._lendControlInterpolant(),this._weightInterpolant=n);var i=n.parameterPositions,s=n.sampleValues;return i[0]=o,s[0]=t,i[1]=o+e,s[1]=a,this}}()}),Object.assign($r.prototype,a.prototype,{_bindAction:function(){return function(e,t){var a=e._localRoot||this._root,r=e._clip.tracks,o=r.length,n=e._propertyBindings,s=e._interpolants,d=a.uuid,l=this._bindingsByRootAndName,p=l[d];p===void 0&&(p={},l[d]=p);for(var c=0;c!==o;++c){var i=r[c],u=i.name,m=p[u];if(void 0!==m)n[c]=m;else{if(m=n[c],void 0!==m){null===m._cacheIndex&&(++m.referenceCount,this._addInactiveBinding(m,d,u));continue}var g=t&&t._propertyBindings[c].binding.parsedPath;m=new Yr(Zr.create(a,u,g),i.ValueTypeName,i.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,d,u),n[c]=m}s[c].resultBuffer=m.buffer}}}(),_activateAction:function(){return function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,a=e._clip.uuid,r=this._actionsByClip[a];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,a,t)}for(var o=e._propertyBindings,s=0,i=o.length,n;s!==i;++s)n=o[s],0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState());this._lendAction(e)}}}(),_deactivateAction:function(){return function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,a=0,r=t.length,o;a!==r;++a)o=t[a],0==--o.useCount&&(o.restoreOriginalState(),this._takeBackBinding(o));this._takeBackAction(e)}}}(),_initMemoryManager:function(){return function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}}(),_isActiveAction:function(){return function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}}(),_addInactiveAction:function(){return function(e,t,a){var r=this._actions,o=this._actionsByClip,n=o[t];if(n===void 0)n={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=n;else{var i=n.knownActions;e._byClipCacheIndex=i.length,i.push(e)}e._cacheIndex=r.length,r.push(e),n.actionByRoot[a]=e}}(),_removeInactiveAction:function(){return function(e){var t=this._actions,a=t[t.length-1],r=e._cacheIndex;a._cacheIndex=r,t[r]=a,t.pop(),e._cacheIndex=null;var o=e._clip.uuid,n=this._actionsByClip,i=n[o],s=i.knownActions,d=s[s.length-1],l=e._byClipCacheIndex;d._byClipCacheIndex=l,s[l]=d,s.pop(),e._byClipCacheIndex=null;var p=i.actionByRoot,c=(e._localRoot||this._root).uuid;delete p[c],0===s.length&&delete n[o],this._removeInactiveBindingsForAction(e)}}(),_removeInactiveBindingsForAction:function(){return function(e){for(var t=e._propertyBindings,a=0,r=t.length,o;a!==r;++a)o=t[a],0==--o.referenceCount&&this._removeInactiveBinding(o)}}(),_lendAction:function(){return function(e){var t=this._actions,a=e._cacheIndex,r=this._nActiveActions++,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=a,t[a]=o}}(),_takeBackAction:function(){return function(e){var t=this._actions,a=e._cacheIndex,r=--this._nActiveActions,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=a,t[a]=o}}(),_addInactiveBinding:function(){return function(e,t,a){var r=this._bindingsByRootAndName,o=r[t],n=this._bindings;o===void 0&&(o={},r[t]=o),o[a]=e,e._cacheIndex=n.length,n.push(e)}}(),_removeInactiveBinding:function(){return function(e){var t=this._bindings,a=e.binding,r=a.rootNode.uuid,o=a.path,n=this._bindingsByRootAndName,i=n[r],s=t[t.length-1],d=e._cacheIndex;s._cacheIndex=d,t[d]=s,t.pop(),delete i[o];remove_empty_map:{for(var l in i)break remove_empty_map;delete n[r]}}}(),_lendBinding:function(){return function(e){var t=this._bindings,a=e._cacheIndex,r=this._nActiveBindings++,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=a,t[a]=o}}(),_takeBackBinding:function(){return function(e){var t=this._bindings,a=e._cacheIndex,r=--this._nActiveBindings,o=t[r];e._cacheIndex=r,t[r]=e,o._cacheIndex=a,t[a]=o}}(),_lendControlInterpolant:function(){return function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,a=e[t];return void 0===a&&(a=new ar(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),a.__cacheIndex=t,e[t]=a),a}}(),_takeBackControlInterpolant:function(){return function(e){var t=this._controlInterpolants,a=e.__cacheIndex,r=--this._nActiveControlInterpolants,o=t[r];e.__cacheIndex=r,t[r]=e,o.__cacheIndex=a,t[a]=o}}(),_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(){return function(e,t){var a=t||this._root,r=a.uuid,o="string"==typeof e?mr.findByName(a,e):e,n=null===o?e:o.uuid,i=this._actionsByClip[n],s=null;if(void 0!==i){var d=i.actionByRoot[r];if(void 0!==d)return d;s=i.knownActions[0],null===o&&(o=s._clip)}if(null===o)return null;var l=new Qr(this,o,t);return this._bindAction(l,s),this._addInactiveAction(l,n,r),l}}(),existingAction:function(){return function(e,t){var a=t||this._root,r=a.uuid,o="string"==typeof e?mr.findByName(a,e):e,n=o?o.uuid:e,i=this._actionsByClip[n];return void 0===i?null:i.actionByRoot[r]||null}}(),stopAllAction:function(){return function(){var e=this._actions,t=this._nActiveActions,a=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var o=0;o!==t;++o)e[o].reset();for(var o=0;o!==r;++o)a[o].useCount=0;return this}}(),update:function(){function e(e){e*=this.timeScale;for(var t=this._actions,a=this._nActiveActions,r=this.time+=e,o=rn(e),n=this._accuIndex^=1,s=0,i;s!==a;++s)i=t[s],i._update(r,e,o,n);for(var d=this._bindings,l=this._nActiveBindings,s=0;s!==l;++s)d[s].apply(n);return this}return e}(),getRoot:function(){return function(){return this._root}}(),uncacheClip:function(){return function(e){var t=this._actions,a=e.uuid,r=this._actionsByClip,o=r[a];if(o!==void 0){for(var s=o.knownActions,d=0,i=s.length,n;d!==i;++d){n=s[d],this._deactivateAction(n);var l=n._cacheIndex,p=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,p._cacheIndex=l,t[l]=p,t.pop(),this._removeInactiveBindingsForAction(n)}delete r[a]}}}(),uncacheRoot:function(){return function(e){var t=e.uuid,a=this._actionsByClip;for(var r in a){var o=a[r].actionByRoot,n=o[t];n!==void 0&&(this._deactivateAction(n),this._removeInactiveAction(n))}var i=this._bindingsByRootAndName,s=i[t];if(s!==void 0)for(var d in s){var l=s[d];l.restoreOriginalState(),this._removeInactiveBinding(l)}}}(),uncacheAction:function(){return function(e,t){var a=this.existingAction(e,t);null!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}}()}),eo.prototype.clone=function(){return new eo(this.value.clone===void 0?this.value:this.value.clone())},to.prototype=Object.assign(Object.create(Me.prototype),{constructor:to,isInstancedBufferGeometry:!0,addGroup:function(){function e(e,t,a){this.groups.push({start:e,count:t,materialIndex:a})}return e}(),copy:function(){return function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var a=e.attributes;for(var r in a){var o=a[r];this.addAttribute(r,o.clone())}for(var n=e.groups,s=0,i=n.length,d;s<i;s++)d=n[s],this.addGroup(d.start,d.count,d.materialIndex);return this}}()}),Object.defineProperties(ao.prototype,{count:{get:function(){return function(){return this.data.count}}()},array:{get:function(){return function(){return this.data.array}}()}}),Object.assign(ao.prototype,{isInterleavedBufferAttribute:!0,setX:function(){return function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}}(),setY:function(){return function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}}(),setZ:function(){return function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}}(),setW:function(){return function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}}(),getX:function(){return function(e){return this.data.array[e*this.data.stride+this.offset]}}(),getY:function(){return function(e){return this.data.array[e*this.data.stride+this.offset+1]}}(),getZ:function(){return function(e){return this.data.array[e*this.data.stride+this.offset+2]}}(),getW:function(){return function(e){return this.data.array[e*this.data.stride+this.offset+3]}}(),setXY:function(){return function(e,t,a){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=a,this}}(),setXYZ:function(){return function(e,t,a,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=a,this.data.array[e+2]=r,this}}(),setXYZW:function(){return function(e,t,a,r,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=a,this.data.array[e+2]=r,this.data.array[e+3]=o,this}}()}),Object.defineProperty(ro.prototype,"needsUpdate",{set:function(){return function(e){!0===e&&this.version++}}()}),Object.assign(ro.prototype,{isInterleavedBuffer:!0,setArray:function(){return function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=e===void 0?0:e.length/this.stride,this.array=e}}(),setDynamic:function(){return function(e){return this.dynamic=e,this}}(),copy:function(){return function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this}}(),copyAt:function(){return function(e,t,a){e*=this.stride,a*=t.stride;for(var r=0,o=this.stride;r<o;r++)this.array[e+r]=t.array[a+r];return this}}(),set:function(){return function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this}}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),onUpload:function(){return function(e){return this.onUploadCallback=e,this}}()}),oo.prototype=Object.assign(Object.create(ro.prototype),{constructor:oo,isInstancedInterleavedBuffer:!0,copy:function(){return function(e){return ro.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}()}),no.prototype=Object.assign(Object.create(xe.prototype),{constructor:no,isInstancedBufferAttribute:!0,copy:function(){return function(e){return xe.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}()}),Object.assign(io.prototype,{linePrecision:1,set:function(){return function(e,t){this.ray.set(e,t)}}(),setFromCamera:function(){return function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")}}(),intersectObject:function(){return function(e,t){var a=[];return lo(e,this,a,t),a.sort(so),a}}(),intersectObjects:function(){return function(e,t){var a=[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),a;for(var r=0,o=e.length;r<o;r++)lo(e[r],this,a,t);return a.sort(so),a}}()}),Object.assign(po.prototype,{start:function(){return function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}}(),stop:function(){return function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}}(),getElapsedTime:function(){return function(){return this.getDelta(),this.elapsedTime}}(),getDelta:function(){return function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}()}),Object.assign(co.prototype,{set:function(){return function(e,t,a){return this.radius=e,this.phi=t,this.theta=a,this}}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}}(),makeSafe:function(){return function(){var e=1e-6;return this.phi=en(e,tn(an-e,this.phi)),this}}(),setFromVector3:function(){return function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=jo(e.x,e.z),this.phi=Ho(vs.clamp(e.y/this.radius,-1,1))),this}}()}),Object.assign(uo.prototype,{set:function(){return function(e,t,a){return this.radius=e,this.theta=t,this.y=a,this}}(),clone:function(){return function(){return new this.constructor().copy(this)}}(),copy:function(){return function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}}(),setFromVector3:function(){return function(e){return this.radius=Yo(e.x*e.x+e.z*e.z),this.theta=jo(e.x,e.z),this.y=e.y,this}}()}),mo.prototype=Object.create(ce.prototype),mo.prototype.constructor=mo,mo.prototype.isImmediateRenderObject=!0,go.prototype=Object.create(Ot.prototype),go.prototype.constructor=go,go.prototype.update=function(){var e=new m,t=new m,a=new oe;return function(){return function(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),a.getNormalMatrix(this.object.matrixWorld);var o=this.object.matrixWorld,n=this.geometry.attributes.position,s=this.object.geometry;if(s&&s.isGeometry)for(var d=s.vertices,p=s.faces,c=0,u=0,i=p.length,l;u<i;u++){l=p[u];for(var m=0,g=l.vertexNormals.length;m<g;m++){var h=d[l[r[m]]],y=l.vertexNormals[m];e.copy(h).applyMatrix4(o),t.copy(y).applyMatrix3(a).normalize().multiplyScalar(this.size).add(e),n.setXYZ(c,e.x,e.y,e.z),++c,n.setXYZ(c,t.x,t.y,t.z),++c}}else if(s&&s.isBufferGeometry)for(var f=s.attributes.position,x=s.attributes.normal,c=0,m=0,g=f.count;m<g;m++)e.set(f.getX(m),f.getY(m),f.getZ(m)).applyMatrix4(o),t.set(x.getX(m),x.getY(m),x.getZ(m)),t.applyMatrix3(a).normalize().multiplyScalar(this.size).add(e),n.setXYZ(c,e.x,e.y,e.z),++c,n.setXYZ(c,t.x,t.y,t.z),++c;n.needsUpdate=!0}}()}(),ho.prototype=Object.create(ce.prototype),ho.prototype.constructor=ho,ho.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},ho.prototype.update=function(){var e=new m,t=new m;return function(){return function(){this.light.updateMatrixWorld();var a=this.light.distance?this.light.distance:1e3,r=a*No(this.light.angle);this.cone.scale.set(r,r,a),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.color===void 0?this.cone.material.color.copy(this.light.color):this.cone.material.color.set(this.color)}}()}(),fo.prototype=Object.create(Ot.prototype),fo.prototype.constructor=fo,fo.prototype.onBeforeRender=function(){var e=new m,t=new l,a=new l;return function(){return function(){var r=this.bones,o=this.geometry,n=o.getAttribute("position");a.getInverse(this.root.matrixWorld);for(var s=0,i=0,d;s<r.length;s++)d=r[s],d.parent&&d.parent.isBone&&(t.multiplyMatrices(a,d.matrixWorld),e.setFromMatrixPosition(t),n.setXYZ(i,e.x,e.y,e.z),t.multiplyMatrices(a,d.parent.matrixWorld),e.setFromMatrixPosition(t),n.setXYZ(i+1,e.x,e.y,e.z),i+=2);o.getAttribute("position").needsUpdate=!0}}()}(),xo.prototype=Object.create(Ge.prototype),xo.prototype.constructor=xo,xo.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},xo.prototype.update=function(){this.color===void 0?this.material.color.copy(this.light.color):this.material.color.set(this.color)},vo.prototype=Object.create(ce.prototype),vo.prototype.constructor=vo,vo.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},vo.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,a=this.line.geometry.attributes.position,r=a.array;r[0]=e,r[1]=-t,r[2]=0,r[3]=e,r[4]=t,r[5]=0,r[6]=-e,r[7]=t,r[8]=0,r[9]=-e,r[10]=-t,r[11]=0,r[12]=e,r[13]=-t,r[14]=0,a.needsUpdate=!0,this.color===void 0?this.line.material.color.copy(this.light.color):this.line.material.color.set(this.color)},_o.prototype=Object.create(ce.prototype),_o.prototype.constructor=_o,_o.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},_o.prototype.update=function(){var e=new m,t=new q,a=new q;return function(){return function(){var r=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var o=r.geometry.getAttribute("color");t.copy(this.light.color),a.copy(this.light.groundColor);for(var n=0,i=o.count,s;n<i;n++)s=n<i/2?t:a,o.setXYZ(n,s.r,s.g,s.b);o.needsUpdate=!0}r.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}()}(),bo.prototype=Object.create(Ot.prototype),bo.prototype.constructor=bo,To.prototype=Object.create(Ot.prototype),To.prototype.constructor=To,So.prototype=Object.create(Ot.prototype),So.prototype.constructor=So,So.prototype.update=function(){var e=new m,t=new m,a=new oe;return function(){return function(){this.object.updateMatrixWorld(!0),a.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,o=this.geometry.attributes.position,n=this.object.geometry,s=n.vertices,d=n.faces,p=0,c=0,i=d.length;c<i;c++){var l=d[c],u=l.normal;e.copy(s[l.a]).add(s[l.b]).add(s[l.c]).divideScalar(3).applyMatrix4(r),t.copy(u).applyMatrix3(a).normalize().multiplyScalar(this.size).add(e),o.setXYZ(p,e.x,e.y,e.z),++p,o.setXYZ(p,t.x,t.y,t.z),++p}o.needsUpdate=!0}}()}(),Eo.prototype=Object.create(ce.prototype),Eo.prototype.constructor=Eo,Eo.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Eo.prototype.update=function(){var e=new m,t=new m,a=new m;return function(){return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),a.subVectors(t,e),this.lightPlane.lookAt(a),this.color===void 0?(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)):(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)),this.targetLine.lookAt(a),this.targetLine.scale.z=a.length()}}()}(),Co.prototype=Object.create(Ot.prototype),Co.prototype.constructor=Co,Co.prototype.update=function(){function e(e,n,s,d){t.set(n,s,d).unproject(a);var p=o[e];if(p!==void 0)for(var c=r.getAttribute("position"),u=0,i=p.length;u<i;u++)c.setXYZ(p[u],t.x,t.y,t.z)}var t=new m,a=new ue,r,o;return function(){function t(){r=this.geometry,o=this.pointMap;var t=1,n=1;a.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-t,-n,-1),e("n2",t,-n,-1),e("n3",-t,n,-1),e("n4",t,n,-1),e("f1",-t,-n,1),e("f2",t,-n,1),e("f3",-t,n,1),e("f4",t,n,1),e("u1",.7*t,1.1*n,-1),e("u2",.7*-t,1.1*n,-1),e("u3",0,2*n,-1),e("cf1",-t,0,1),e("cf2",t,0,1),e("cf3",0,-n,1),e("cf4",0,n,1),e("cn1",-t,0,-1),e("cn2",t,0,-1),e("cn3",0,-n,-1),e("cn4",0,n,-1),r.getAttribute("position").needsUpdate=!0}return t}()}(),Po.prototype=Object.create(Ot.prototype),Po.prototype.constructor=Po,Po.prototype.update=function(){var e=new ae;return function(){return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var a=e.min,r=e.max,o=this.geometry.attributes.position,n=o.array;n[0]=r.x,n[1]=r.y,n[2]=r.z,n[3]=a.x,n[4]=r.y,n[5]=r.z,n[6]=a.x,n[7]=a.y,n[8]=r.z,n[9]=r.x,n[10]=a.y,n[11]=r.z,n[12]=r.x,n[13]=r.y,n[14]=a.z,n[15]=a.x,n[16]=r.y,n[17]=a.z,n[18]=a.x,n[19]=a.y,n[20]=a.z,n[21]=r.x,n[22]=a.y,n[23]=a.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}()}(),Po.prototype.setFromObject=function(e){return this.object=e,this.update(),this},wo.prototype=Object.create(Ot.prototype),wo.prototype.constructor=wo,wo.prototype.onBeforeRender=function(){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5))},Ao.prototype=Object.create(Ft.prototype),Ao.prototype.constructor=Ao,Ao.prototype.onBeforeRender=function(){var e=-this.plane.constant;1e-8>qo(e)&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.lookAt(this.plane.normal),this.updateMatrixWorld()};var Js,Qs;Ro.prototype=Object.create(ce.prototype),Ro.prototype.constructor=Ro,Ro.prototype.setDirection=function(){var e=new m,t;return function(){function a(a){.99999<a.y?this.quaternion.set(0,0,0,1):-.99999>a.y?this.quaternion.set(1,0,0,0):(e.set(a.z,0,-a.x).normalize(),t=Ho(a.y),this.quaternion.setFromAxisAngle(e,t))}return a}()}(),Ro.prototype.setLength=function(e,t,a){t===void 0&&(t=.2*e),a===void 0&&(a=.2*t),this.line.scale.set(1,en(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(a,t,a),this.cone.position.y=e,this.cone.updateMatrix()},Ro.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},Mo.prototype=Object.create(Ot.prototype),Mo.prototype.constructor=Mo;var $s=new m,ed=new Lo,td=new Lo,ad=new Lo;Bo.prototype=Object.create(Rr.prototype),Bo.prototype.constructor=Bo,Bo.prototype.getPoint=function(e){var t=this.points,a=t.length,r=(a-(this.closed?0:1))*e,o=on(r),n=r-o;this.closed?o+=0<o?0:(on(qo(o)/t.length)+1)*t.length:0==n&&o===a-1&&(o=a-2,n=1);var i,s,d,l;if(this.closed||0<o?i=t[(o-1)%a]:($s.subVectors(t[0],t[1]).add(t[0]),i=$s),s=t[o%a],d=t[(o+1)%a],this.closed||o+2<a?l=t[(o+2)%a]:($s.subVectors(t[a-1],t[a-2]).add(t[a-1]),l=$s),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var p="chordal"===this.type?.5:.25,c=Zo(i.distanceToSquared(s),p),u=Zo(s.distanceToSquared(d),p),g=Zo(d.distanceToSquared(l),p);1e-4>u&&(u=1),1e-4>c&&(c=u),1e-4>g&&(g=u),ed.initNonuniformCatmullRom(i.x,s.x,d.x,l.x,c,u,g),td.initNonuniformCatmullRom(i.y,s.y,d.y,l.y,c,u,g),ad.initNonuniformCatmullRom(i.z,s.z,d.z,l.z,c,u,g)}else if("catmullrom"===this.type){var h=void 0===this.tension?.5:this.tension;ed.initCatmullRom(i.x,s.x,d.x,l.x,h),td.initCatmullRom(i.y,s.y,d.y,l.y,h),ad.initCatmullRom(i.z,s.z,d.z,l.z,h)}return new m(ed.calc(n),td.calc(n),ad.calc(n))},Do.prototype=Object.create(Rr.prototype),Do.prototype.constructor=Do,Do.prototype.getPoint=function(e){var t=this.v0,a=this.v1,r=this.v2,o=this.v3;return new m(Ar(e,t.x,a.x,r.x,o.x),Ar(e,t.y,a.y,r.y,o.y),Ar(e,t.z,a.z,r.z,o.z))},Io.prototype=Object.create(Rr.prototype),Io.prototype.constructor=Io,Io.prototype.getPoint=function(e){var t=this.v0,a=this.v1,r=this.v2;return new m(Sr(e,t.x,a.x,r.x),Sr(e,t.y,a.y,r.y),Sr(e,t.z,a.z,r.z))},Fo.prototype=Object.create(Rr.prototype),Fo.prototype.constructor=Fo,Fo.prototype.getPoint=function(e){if(1===e)return this.v2.clone();var t=new m;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t},Oo.prototype=Object.create(Br.prototype),Oo.prototype.constructor=Oo;var rd={createMultiMaterialObject:function(){return function(e,t){for(var a=new Nt,r=0,o=t.length;r<o;r++)a.add(new Ge(e,t[r]));return a}}(),detach:function(){return function(e,t,a){e.applyMatrix(t.matrixWorld),t.remove(e),a.add(e)}}(),attach:function(){return function(e,t,a){e.applyMatrix(new l().getInverse(a.matrixWorld)),t.remove(e),a.add(e)}}()};Rr.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Rr.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Uo.prototype=Object.create(Bo.prototype),ko.prototype=Object.create(Bo.prototype),Go.prototype=Object.create(Bo.prototype),Object.assign(Go.prototype,{initFromArray:function(){return function(){console.error("THREE.Spline: .initFromArray() has been removed.")}}(),getControlPointsArray:function(){return function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")}}(),reparametrizeByArcLength:function(){return function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}()}),bo.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},fo.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Y.prototype,{center:function(){return function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)}}(),empty:function(){return function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}(),isIntersectionBox:function(){return function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)}}(),size:function(){return function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}()}),Object.assign(ae.prototype,{center:function(){return function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)}}(),empty:function(){return function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}(),isIntersectionBox:function(){return function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)}}(),isIntersectionSphere:function(){return function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}(),size:function(){return function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}()}),Ue.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},vs.random16=function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},Object.assign(oe.prototype,{flattenToArrayOffset:function(){return function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)}}(),multiplyVector3:function(){return function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)}}(),multiplyVector3Array:function(){return function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")}}(),applyToBuffer:function(){return function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)}}(),applyToVector3Array:function(){return function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}()}),Object.assign(l.prototype,{extractPosition:function(){return function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)}}(),flattenToArrayOffset:function(){return function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)}}(),getPosition:function(){var e;return function(){function t(){return void 0==e&&(e=new m),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}return t}()}(),setRotationFromQuaternion:function(){return function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)}}(),multiplyToArray:function(){return function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")}}(),multiplyVector3:function(){return function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)}}(),multiplyVector4:function(){return function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)}}(),multiplyVector3Array:function(){return function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")}}(),rotateAxis:function(){return function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)}}(),crossVector:function(){return function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)}}(),translate:function(){return function(){console.error("THREE.Matrix4: .translate() has been removed.")}}(),rotateX:function(){return function(){console.error("THREE.Matrix4: .rotateX() has been removed.")}}(),rotateY:function(){return function(){console.error("THREE.Matrix4: .rotateY() has been removed.")}}(),rotateZ:function(){return function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")}}(),rotateByAxis:function(){return function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}}(),applyToBuffer:function(){return function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)}}(),applyToVector3Array:function(){return function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")}}(),makeFrustum:function(){return function(e,t,a,r,o,n){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,a,o,n)}}()}),ne.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},d.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Oe.prototype,{isIntersectionBox:function(){return function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)}}(),isIntersectionPlane:function(){return function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)}}(),isIntersectionSphere:function(){return function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}()}),Object.assign(Ur.prototype,{extrude:function(){return function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new la(this,e)}}(),makeGeometry:function(){return function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new va(this,e)}}()}),Object.assign(r.prototype,{fromAttribute:function(){return function(e,t,a){return console.error("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,a)}}()}),Object.assign(m.prototype,{setEulerFromRotationMatrix:function(){return function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")}}(),setEulerFromQuaternion:function(){return function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")}}(),getPositionFromMatrix:function(){return function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)}}(),getScaleFromMatrix:function(){return function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)}}(),getColumnFromMatrix:function(){return function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)}}(),applyProjection:function(){return function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)}}(),fromAttribute:function(){return function(e,t,a){return console.error("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,a)}}()}),Object.assign(n.prototype,{fromAttribute:function(){return function(e,t,a){return console.error("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,a)}}()}),fe.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(ce.prototype,{getChildByName:function(){return function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)}}(),renderDepth:function(){return function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")}}(),translate:function(){return function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)}}()}),Object.defineProperties(ce.prototype,{eulerOrder:{get:function(){return function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order}}(),set:function(){return function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}}()},useQuaternion:{get:function(){return function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}(),set:function(){return function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}()}}),Object.defineProperties(Mt.prototype,{objects:{get:function(){return function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}()}}),Object.defineProperty(Lt.prototype,"useVertexTexture",{get:function(){return function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}(),set:function(){return function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}()}),Object.defineProperty(Rr.prototype,"__arcLengthDivisions",{get:function(){return function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions}}(),set:function(){return function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}()}),ge.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Va.prototype,{onlyShadow:{set:function(){return function(){console.warn("THREE.Light: .onlyShadow has been removed.")}}()},shadowCameraFov:{set:function(){return function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}}()},shadowCameraLeft:{set:function(){return function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}}()},shadowCameraRight:{set:function(){return function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}}()},shadowCameraTop:{set:function(){return function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}}()},shadowCameraBottom:{set:function(){return function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}}()},shadowCameraNear:{set:function(){return function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}}()},shadowCameraFar:{set:function(){return function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}}()},shadowCameraVisible:{set:function(){return function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}}()},shadowBias:{set:function(){return function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}}()},shadowDarkness:{set:function(){return function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}}()},shadowMapWidth:{set:function(){return function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}}()},shadowMapHeight:{set:function(){return function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}()}}),Object.defineProperties(xe.prototype,{length:{get:function(){return function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}()}}),Object.assign(Me.prototype,{addIndex:function(){return function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)}}(),addDrawCall:function(){function e(e,t,a){a!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)}return e}(),clearDrawCalls:function(){return function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()}}(),computeTangents:function(){return function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")}}(),computeOffsets:function(){return function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}()}),Object.defineProperties(Me.prototype,{drawcalls:{get:function(){return function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}}()},offsets:{get:function(){return function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}()}}),Object.defineProperties(eo.prototype,{dynamic:{set:function(){return function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}}()},onUpdate:{value:function(){return function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}()}}),Object.defineProperties(Q.prototype,{wrapAround:{get:function(){return function(){console.warn("THREE.Material: .wrapAround has been removed.")}}(),set:function(){return function(){console.warn("THREE.Material: .wrapAround has been removed.")}}()},wrapRGB:{get:function(){return function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new q}}()},shading:{get:function(){return function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")}}(),set:function(){return function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===vn}}()}}),Object.defineProperties(Ba.prototype,{metal:{get:function(){return function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1}}(),set:function(){return function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}()}}),Object.defineProperties($.prototype,{derivatives:{get:function(){return function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives}}(),set:function(){return function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}()}}),Object.assign(St.prototype,{getCurrentRenderTarget:function(){return function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()}}(),getMaxAnisotropy:function(){return function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()}}(),getPrecision:function(){return function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision}}(),supportsFloatTextures:function(){return function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")}}(),supportsHalfFloatTextures:function(){return function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")}}(),supportsStandardDerivatives:function(){return function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")}}(),supportsCompressedTextureS3TC:function(){return function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")}}(),supportsCompressedTexturePVRTC:function(){return function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")}}(),supportsBlendMinMax:function(){return function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")}}(),supportsVertexTextures:function(){return function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures}}(),supportsInstancedArrays:function(){return function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")}}(),enableScissorTest:function(){return function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)}}(),initMaterial:function(){return function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")}}(),addPrePlugin:function(){return function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")}}(),addPostPlugin:function(){return function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")}}(),updateShadowMap:function(){return function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}()}),Object.defineProperties(St.prototype,{shadowMapEnabled:{get:function(){return function(){return this.shadowMap.enabled}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}}()},shadowMapType:{get:function(){return function(){return this.shadowMap.type}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}}()},shadowMapCullFace:{get:function(){return function(){return this.shadowMap.cullFace}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=e}}()}}),Object.defineProperties(se.prototype,{cullFace:{get:function(){return function(){return this.renderReverseSided?un:cn}}(),set:function(){return function(e){var t=e!==cn;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+t+"."),this.renderReverseSided=t}}()}}),Object.defineProperties(i.prototype,{wrapS:{get:function(){return function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}}()},wrapT:{get:function(){return function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}}()},magFilter:{get:function(){return function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}}()},minFilter:{get:function(){return function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}}()},anisotropy:{get:function(){return function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}}()},offset:{get:function(){return function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}}()},repeat:{get:function(){return function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}}()},format:{get:function(){return function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}}()},type:{get:function(){return function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}}()},generateMipmaps:{get:function(){return function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps}}(),set:function(){return function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}()}}),Xr.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this,a=new zr;return a.load(e,function(e){t.setBuffer(e)}),this},qr.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Hr.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var od={merge:function(){return function(e,t,a){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var r;t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,a)}}(),center:function(){return function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}}()},nd={crossOrigin:void 0,loadTexture:function(){return function(e,t,a,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var o=new Ha;o.setCrossOrigin(this.crossOrigin);var n=o.load(e,a,void 0,r);return t&&(n.mapping=t),n}}(),loadTextureCube:function(){return function(e,t,a,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var o=new Wa;o.setCrossOrigin(this.crossOrigin);var n=o.load(e,a,void 0,r);return t&&(n.mapping=t),n}}(),loadCompressedTexture:function(){return function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")}}(),loadCompressedTextureCube:function(){return function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}}()};t.WebGLRenderTargetCube=s,t.WebGLRenderTarget=i,t.WebGLRenderer=St,t.ShaderLib=Bs,t.UniformsLib=Rs,t.UniformsUtils=Ms,t.ShaderChunk=Ls,t.FogExp2=Et,t.Fog=Ct,t.Scene=Pt,t.LensFlare=wt,t.Sprite=Rt,t.LOD=Mt,t.SkinnedMesh=Dt,t.Skeleton=Lt,t.Bone=Bt,t.Mesh=Ge,t.LineSegments=Ot,t.LineLoop=Ut,t.Line=Ft,t.Points=Gt,t.Group=Nt,t.VideoTexture=zt,t.DataTexture=p,t.CompressedTexture=Wt,t.CubeTexture=c,t.CanvasTexture=Z,t.DepthTexture=Ht,t.Texture=o,t.CompressedTextureLoader=Ga,t.DataTextureLoader=Na,t.CubeTextureLoader=Wa,t.TextureLoader=Ha,t.ObjectLoader=xr,t.MaterialLoader=gr,t.BufferGeometryLoader=hr,t.DefaultLoadingManager=zs,t.LoadingManager=Ua,t.JSONLoader=fr,t.ImageLoader=za,t.FontLoader=Nr,t.FileLoader=ka,t.Loader=yr,t.Cache=Ns,t.AudioLoader=zr,t.SpotLightShadow=qa,t.SpotLight=Ya,t.PointLight=Ka,t.RectAreaLight=$a,t.HemisphereLight=Xa,t.DirectionalLightShadow=Za,t.DirectionalLight=Ja,t.AmbientLight=Qa,t.LightShadow=ja,t.Light=Va,t.StereoCamera=Wr,t.PerspectiveCamera=ge,t.OrthographicCamera=me,t.CubeCamera=Hr,t.ArrayCamera=xt,t.Camera=ue,t.AudioListener=Vr,t.PositionalAudio=jr,t.AudioContext=Ks,t.AudioAnalyser=qr,t.Audio=Xr,t.VectorKeyframeTrack=nr,t.StringKeyframeTrack=lr,t.QuaternionKeyframeTrack=sr,t.NumberKeyframeTrack=dr,t.ColorKeyframeTrack=cr,t.BooleanKeyframeTrack=pr,t.PropertyMixer=Yr,t.PropertyBinding=Zr,t.KeyframeTrack=ur,t.AnimationUtils=Ws,t.AnimationObjectGroup=Jr,t.AnimationMixer=$r,t.AnimationClip=mr,t.Uniform=eo,t.InstancedBufferGeometry=to,t.BufferGeometry=Me,t.GeometryIdCount=ye,t.Geometry=fe,t.InterleavedBufferAttribute=ao,t.InstancedInterleavedBuffer=oo,t.InterleavedBuffer=ro,t.InstancedBufferAttribute=no,t.Face3=he,t.Object3D=ce,t.Raycaster=io,t.Layers=pe,t.EventDispatcher=a,t.Clock=po,t.QuaternionLinearInterpolant=ir,t.LinearInterpolant=ar,t.DiscreteInterpolant=rr,t.CubicInterpolant=tr,t.Interpolant=er,t.Triangle=ke,t.Math=vs,t.Spherical=co,t.Cylindrical=uo,t.Plane=ne,t.Frustum=ie,t.Sphere=re,t.Ray=Oe,t.Matrix4=l,t.Matrix3=oe,t.Box3=ae,t.Box2=Y,t.Line3=Ue,t.Euler=le,t.Vector4=n,t.Vector3=m,t.Vector2=r,t.Quaternion=d,t.Color=q,t.ImmediateRenderObject=mo,t.VertexNormalsHelper=go,t.SpotLightHelper=ho,t.SkeletonHelper=fo,t.PointLightHelper=xo,t.RectAreaLightHelper=vo,t.HemisphereLightHelper=_o,t.GridHelper=bo,t.PolarGridHelper=To,t.FaceNormalsHelper=So,t.DirectionalLightHelper=Eo,t.CameraHelper=Co,t.BoxHelper=Po,t.Box3Helper=wo,t.PlaneHelper=Ao,t.ArrowHelper=Ro,t.AxisHelper=Mo,t.CatmullRomCurve3=Bo,t.CubicBezierCurve3=Do,t.QuadraticBezierCurve3=Io,t.LineCurve3=Fo,t.ArcCurve=Oo,t.EllipseCurve=Br,t.SplineCurve=Dr,t.CubicBezierCurve=Ir,t.QuadraticBezierCurve=Fr,t.LineCurve=Mr,t.Shape=Ur,t.Path=Or,t.ShapePath=kr,t.Font=Gr,t.CurvePath=Lr,t.Curve=Rr,t.ShapeUtils=Us,t.SceneUtils=rd,t.WebGLUtils=Tt,t.WireframeGeometry=Vt,t.ParametricGeometry=Xt,t.ParametricBufferGeometry=jt,t.TetrahedronGeometry=Kt,t.TetrahedronBufferGeometry=Zt,t.OctahedronGeometry=Jt,t.OctahedronBufferGeometry=Qt,t.IcosahedronGeometry=$t,t.IcosahedronBufferGeometry=ea,t.DodecahedronGeometry=ta,t.DodecahedronBufferGeometry=aa,t.PolyhedronGeometry=qt,t.PolyhedronBufferGeometry=Yt,t.TubeGeometry=ra,t.TubeBufferGeometry=oa,t.TorusKnotGeometry=na,t.TorusKnotBufferGeometry=ia,t.TorusGeometry=sa,t.TorusBufferGeometry=da,t.TextGeometry=ca,t.TextBufferGeometry=ua,t.SphereGeometry=ma,t.SphereBufferGeometry=ga,t.RingGeometry=ha,t.RingBufferGeometry=ya,t.PlaneGeometry=De,t.PlaneBufferGeometry=Ie,t.LatheGeometry=fa,t.LatheBufferGeometry=xa,t.ShapeGeometry=va,t.ShapeBufferGeometry=_a,t.ExtrudeGeometry=la,t.ExtrudeBufferGeometry=pa,t.EdgesGeometry=ba,t.ConeGeometry=Ea,t.ConeBufferGeometry=Ca,t.CylinderGeometry=Ta,t.CylinderBufferGeometry=Sa,t.CircleGeometry=Pa,t.CircleBufferGeometry=wa,t.BoxGeometry=Le,t.BoxBufferGeometry=Be,t.ShadowMaterial=Aa,t.SpriteMaterial=At,t.RawShaderMaterial=Ra,t.ShaderMaterial=$,t.PointsMaterial=kt,t.MeshPhysicalMaterial=La,t.MeshStandardMaterial=Ma,t.MeshPhongMaterial=Ba,t.MeshToonMaterial=Da,t.MeshNormalMaterial=Ia,t.MeshLambertMaterial=Fa,t.MeshDepthMaterial=ee,t.MeshDistanceMaterial=te,t.MeshBasicMaterial=Fe,t.LineDashedMaterial=Oa,t.LineBasicMaterial=It,t.Material=Q,t.Float64BufferAttribute=we,t.Float32BufferAttribute=Pe,t.Uint32BufferAttribute=Ce,t.Int32BufferAttribute=Ee,t.Uint16BufferAttribute=Se,t.Int16BufferAttribute=Te,t.Uint8ClampedBufferAttribute=be,t.Uint8BufferAttribute=_e,t.Int8BufferAttribute=ve,t.BufferAttribute=xe,t.REVISION=ln,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},t.CullFaceNone=pn,t.CullFaceBack=cn,t.CullFaceFront=un,t.CullFaceFrontBack=3,t.FrontFaceDirectionCW=mn,t.FrontFaceDirectionCCW=1,t.BasicShadowMap=0,t.PCFShadowMap=gn,t.PCFSoftShadowMap=hn,t.FrontSide=yn,t.BackSide=fn,t.DoubleSide=xn,t.FlatShading=vn,t.SmoothShading=2,t.NoColors=_n,t.FaceColors=bn,t.VertexColors=Tn,t.NoBlending=Sn,t.NormalBlending=En,t.AdditiveBlending=Cn,t.SubtractiveBlending=Pn,t.MultiplyBlending=wn,t.CustomBlending=An,t.AddEquation=Rn,t.SubtractEquation=Mn,t.ReverseSubtractEquation=Ln,t.MinEquation=Bn,t.MaxEquation=Dn,t.ZeroFactor=In,t.OneFactor=Fn,t.SrcColorFactor=On,t.OneMinusSrcColorFactor=Un,t.SrcAlphaFactor=kn,t.OneMinusSrcAlphaFactor=Gn,t.DstAlphaFactor=Nn,t.OneMinusDstAlphaFactor=zn,t.DstColorFactor=Wn,t.OneMinusDstColorFactor=Hn,t.SrcAlphaSaturateFactor=Vn,t.NeverDepth=Xn,t.AlwaysDepth=jn,t.LessDepth=qn,t.LessEqualDepth=Yn,t.EqualDepth=Kn,t.GreaterEqualDepth=Zn,t.GreaterDepth=Jn,t.NotEqualDepth=Qn,t.MultiplyOperation=$n,t.MixOperation=ei,t.AddOperation=ti,t.NoToneMapping=ai,t.LinearToneMapping=ri,t.ReinhardToneMapping=oi,t.Uncharted2ToneMapping=ni,t.CineonToneMapping=ii,t.UVMapping=si,t.CubeReflectionMapping=di,t.CubeRefractionMapping=li,t.EquirectangularReflectionMapping=pi,t.EquirectangularRefractionMapping=ci,t.SphericalReflectionMapping=ui,t.CubeUVReflectionMapping=mi,t.CubeUVRefractionMapping=gi,t.RepeatWrapping=hi,t.ClampToEdgeWrapping=yi,t.MirroredRepeatWrapping=fi,t.NearestFilter=xi,t.NearestMipMapNearestFilter=vi,t.NearestMipMapLinearFilter=_i,t.LinearFilter=bi,t.LinearMipMapNearestFilter=Ti,t.LinearMipMapLinearFilter=Si,t.UnsignedByteType=Ei,t.ByteType=Ci,t.ShortType=Pi,t.UnsignedShortType=wi,t.IntType=Ai,t.UnsignedIntType=Ri,t.FloatType=Mi,t.HalfFloatType=Li,t.UnsignedShort4444Type=Bi,t.UnsignedShort5551Type=Di,t.UnsignedShort565Type=Ii,t.UnsignedInt248Type=Fi,t.AlphaFormat=Oi,t.RGBFormat=Ui,t.RGBAFormat=ki,t.LuminanceFormat=Gi,t.LuminanceAlphaFormat=Ni,t.RGBEFormat=ki,t.DepthFormat=zi,t.DepthStencilFormat=Wi,t.RGB_S3TC_DXT1_Format=Hi,t.RGBA_S3TC_DXT1_Format=Vi,t.RGBA_S3TC_DXT3_Format=Xi,t.RGBA_S3TC_DXT5_Format=ji,t.RGB_PVRTC_4BPPV1_Format=qi,t.RGB_PVRTC_2BPPV1_Format=Yi,t.RGBA_PVRTC_4BPPV1_Format=Ki,t.RGBA_PVRTC_2BPPV1_Format=Zi,t.RGB_ETC1_Format=Ji,t.LoopOnce=Qi,t.LoopRepeat=$i,t.LoopPingPong=es,t.InterpolateDiscrete=ts,t.InterpolateLinear=as,t.InterpolateSmooth=rs,t.ZeroCurvatureEnding=os,t.ZeroSlopeEnding=ns,t.WrapAroundEnding=is,t.TrianglesDrawMode=ss,t.TriangleStripDrawMode=ds,t.TriangleFanDrawMode=ls,t.LinearEncoding=ps,t.sRGBEncoding=cs,t.GammaEncoding=us,t.RGBEEncoding=ms,t.LogLuvEncoding=3003,t.RGBM7Encoding=gs,t.RGBM16Encoding=hs,t.RGBDEncoding=ys,t.BasicDepthPacking=fs,t.RGBADepthPacking=xs,t.CubeGeometry=Le,t.Face4=function(e,t,a,r,o,n,i){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new he(e,t,a,o,n,i)},t.LineStrip=0,t.LinePieces=1,t.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},t.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},t.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Gt(e,t)},t.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Rt(e)},t.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Gt(e,t)},t.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new kt(e)},t.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new kt(e)},t.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new kt(e)},t.Vertex=function(e,t,a){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new m(e,t,a)},t.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new xe(e,t).setDynamic(!0)},t.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new ve(e,t)},t.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new _e(e,t)},t.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new be(e,t)},t.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Te(e,t)},t.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Se(e,t)},t.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Ee(e,t)},t.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Ce(e,t)},t.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Pe(e,t)},t.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new we(e,t)},t.ClosedSplineCurve3=Uo,t.SplineCurve3=ko,t.Spline=Go,t.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Po(e,t)},t.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Ot(new ba(e.geometry),new It({color:void 0===t?16777215:t}))},t.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Ot(new Vt(e.geometry),new It({color:void 0===t?16777215:t}))},t.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new ka(e)},t.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Na(e)},t.GeometryUtils=od,t.ImageUtils=nd,t.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},t.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}},516:function(e,t,a){a(517),a(519),a(521),a(524),e.exports=a(50)},517:function(e,t,a){(function(t){e.exports=t.PIXI=a(518)}).call(t,a(45))},518:function(a,o){var e=Math.acos,t=Math.sqrt,n=Math.ceil,d=Math.max;(function(){function p(a,n,t,r){var i=a.createTexture();return a.bindTexture(a.TEXTURE_2D,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,r===D.scaleModes.LINEAR?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,r===D.scaleModes.LINEAR?a.LINEAR:a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,n,t,0,a.RGBA,a.UNSIGNED_BYTE,null),i}function l(e,s,r,i,o){var a=e.createFramebuffer(),n=e.createRenderbuffer(),d=null,l=0;return e.activeTexture(e.TEXTURE0+o),e.bindFramebuffer(e.FRAMEBUFFER,a),e.bindRenderbuffer(e.RENDERBUFFER,n),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer),d=p(e,s,r,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,d,0),(l=e.checkFramebufferStatus(e.FRAMEBUFFER))!==e.FRAMEBUFFER_COMPLETE&&console.error("Incomplete GL framebuffer. ",m[l]),a.width=s,a.height=r,a.targetTexture=d,a.renderBuffer=n,a}var c=this,D=D||{};D.DisplayObject=function(){this.position=new D.Point(0,0),this.scale=new D.Point(1,1),this.pivot=new D.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.renderable=!1,this.parent=null,this.worldAlpha=1,this.worldTransform=new Phaser.Matrix,this.worldPosition=new D.Point(0,0),this.worldScale=new D.Point(1,1),this.worldRotation=0,this.filterArea=null,this._sr=0,this._cr=1,this._bounds=new D.Rectangle(0,0,0,0),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},D.DisplayObject.prototype={constructor:D.DisplayObject,destroy:function(){if(this.children){for(var t=this.children.length;t--;)this.children[t].destroy();this.children=[]}this.hitArea=null,this.parent=null,this.worldTransform=null,this.filterArea=null,this.renderable=!1,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite()},updateTransform:function(p){if(!p&&!this.parent&&!this.game)return this;var m=this.parent;p?m=p:this.parent||(m=this.game.world);var g=m.worldTransform,h=this.worldTransform,l,r,i,y,o,a;this.rotation%Phaser.Math.PI2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),l=this._cr*this.scale.x,r=this._sr*this.scale.x,i=-this._sr*this.scale.y,y=this._cr*this.scale.y,o=this.position.x,a=this.position.y,(this.pivot.x||this.pivot.y)&&(o-=this.pivot.x*l+this.pivot.y*i,a-=this.pivot.x*r+this.pivot.y*y),h.a=l*g.a+r*g.c,h.b=l*g.b+r*g.d,h.c=i*g.a+y*g.c,h.d=i*g.b+y*g.d,h.tx=o*g.a+a*g.c+g.tx,h.ty=o*g.b+a*g.d+g.ty):(l=this.scale.x,r=0,i=0,y=this.scale.y,o=this.position.x-this.pivot.x*l,a=this.position.y-this.pivot.y*y,h.a=l*g.a,h.b=l*g.b,h.c=y*g.c,h.d=y*g.d,h.tx=o*g.a+a*g.c+g.tx,h.ty=o*g.b+a*g.d+g.ty),l=h.a,r=h.b,i=h.c;var n=l*(y=h.d)-r*i;if(l||r){var u=t(l*l+r*r);this.worldRotation=0<r?e(l/u):-e(l/u),this.worldScale.x=u,this.worldScale.y=n/u}else if(i||y){var c=t(i*i+y*y);this.worldRotation=Phaser.Math.HALF_PI-(0<y?e(-i/c):-e(i/c)),this.worldScale.x=n/c,this.worldScale.y=c}else this.worldScale.x=0,this.worldScale.y=0;return this.worldAlpha=this.alpha*m.worldAlpha,this.worldPosition.x=h.tx,this.worldPosition.y=h.ty,this._currentBounds=null,this.transformCallback&&this.transformCallback.call(this.transformCallbackContext,h,g),this},preUpdate:function(){},generateTexture:function(a,e,t){var r=this.getLocalBounds(),n=new Phaser.RenderTexture(this.game,0|r.width,0|r.height,t,e,a);return D.DisplayObject._tempMatrix.tx=-r.x,D.DisplayObject._tempMatrix.ty=-r.y,n.render(this,D.DisplayObject._tempMatrix),n},updateCache:function(){return this._generateCachedSprite(),this},toGlobal:function(t){return this.updateTransform(),this.worldTransform.apply(t)},toLocal:function(a,e){return e&&(a=e.toGlobal(a)),this.updateTransform(),this.worldTransform.applyInverse(a)},_renderCachedSprite:function(t){this._cachedSprite.worldAlpha=this.worldAlpha,t.gl?D.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):D.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)},_generateCachedSprite:function(){this._cacheAsBitmap=!1;var a=this.getLocalBounds();if(a.width=d(1,n(a.width)),a.height=d(1,n(a.height)),this.updateTransform(),this._cachedSprite)this._cachedSprite.texture.resize(a.width,a.height);else{var e=0;this.texture&&this.texture.baseTexture&&D._enableMultiTextureToggle&&(e=this.texture.baseTexture.textureIndex);var t=new Phaser.RenderTexture(this.game,a.width,a.height,void 0,void 0,void 0,void 0,e);this._cachedSprite=new D.Sprite(t),this._cachedSprite.worldTransform=this.worldTransform}var r=this._filters;this._filters=null,this._cachedSprite.filters=r,D.DisplayObject._tempMatrix.tx=-a.x,D.DisplayObject._tempMatrix.ty=-a.y,this._cachedSprite.texture.render(this,D.DisplayObject._tempMatrix,!0),this._cachedSprite.anchor.x=-a.x/a.width,this._cachedSprite.anchor.y=-a.y/a.height,this._filters=r,this._cacheAsBitmap=!0},_destroyCachedSprite:function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)}},D.DisplayObject.prototype.displayObjectUpdateTransform=D.DisplayObject.prototype.updateTransform,Object.defineProperties(D.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},worldVisible:{get:function(){if(this.visible){var t=this.parent;if(!t)return this.visible;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}return!1}},mask:{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,t&&(this._mask.isMask=!0)}},filters:{get:function(){return this._filters},set:function(a){if(Array.isArray(a)){for(var e=[],n=0;n<a.length;n++)for(var r=a[n].passes,i=0;i<r.length;i++)e.push(r[i]);this._filterBlock={target:this,filterPasses:e}}this._filters=a,this.blendMode&&this.blendMode===D.blendModes.MULTIPLY&&(this.blendMode=D.blendModes.NORMAL)}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}}),D.DisplayObjectContainer=function(){D.DisplayObject.call(this),this.children=[],this.ignoreChildInput=!1},D.DisplayObjectContainer.prototype=Object.create(D.DisplayObject.prototype),D.DisplayObjectContainer.prototype.constructor=D.DisplayObjectContainer,D.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},D.DisplayObjectContainer.prototype.addChildAt=function(a,e){if(0<=e&&e<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(e,0,a),a;throw new Error(a+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},D.DisplayObjectContainer.prototype.swapChildren=function(a,e){if(a!==e){var t=this.getChildIndex(a),r=this.getChildIndex(e);if(0>t||0>r)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[t]=e,this.children[r]=a}},D.DisplayObjectContainer.prototype.getChildIndex=function(a){var e=this.children.indexOf(a);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},D.DisplayObjectContainer.prototype.setChildIndex=function(a,e){if(0>e||e>=this.children.length)throw new Error("The supplied index is out of bounds");var t=this.getChildIndex(a);this.children.splice(t,1),this.children.splice(e,0,a)},D.DisplayObjectContainer.prototype.getChildAt=function(t){if(0>t||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},D.DisplayObjectContainer.prototype.removeChild=function(a){var e=this.children.indexOf(a);if(-1!==e)return this.removeChildAt(e)},D.DisplayObjectContainer.prototype.removeChildAt=function(a){var e=this.getChildAt(a);return e&&(e.parent=void 0,this.children.splice(a,1)),e},D.DisplayObjectContainer.prototype.removeChildren=function(a,e){void 0===a&&(a=0),void 0===e&&(e=this.children.length);var t=e-a;if(0<t&&t<=e){for(var r=this.children.splice(a,t),o=0;o<r.length;o++)r[o].parent=void 0;return r}if(0==t&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},D.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(this.displayObjectUpdateTransform(),!this._cacheAsBitmap))for(var t=0;t<this.children.length;t++)this.children[t].updateTransform()},D.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=D.DisplayObjectContainer.prototype.updateTransform,D.DisplayObjectContainer.prototype.getBounds=function(i){var e=i&&i instanceof D.DisplayObject,t=!0;e?t=i instanceof D.DisplayObjectContainer&&i.contains(this):i=this;var I;if(e){var s=i.worldTransform;for(i.worldTransform=Phaser.identityMatrix,I=0;I<i.children.length;I++)i.children[I].updateTransform()}var o=1/0,l=1/0,u=-1/0,c=-1/0,d=!1,O,a,n;for(I=0;I<this.children.length;I++)this.children[I].visible&&(d=!0,o=o<(O=this.children[I].getBounds()).x?o:O.x,l=l<O.y?l:O.y,a=O.width+O.x,n=O.height+O.y,u=u>a?u:a,c=c>n?c:n);var h=this._bounds;if(!d){var x=(h=new D.Rectangle).x,p=h.width+h.x,g=h.y,v=h.height+h.y,T=this.worldTransform,m=T.a,E=T.b,_=T.c,S=T.d,y=T.tx,b=T.ty,A=m*p+_*v+y,R=S*v+E*p+b,M=m*x+_*v+y,C=S*v+E*x+b,L=m*x+_*g+y,B=S*g+E*x+b,P=m*p+_*g+y,w=S*g+E*p+b;u=A,c=R,l=R,o=P<(o=L<(o=M<(o=A)?M:o)?L:o)?P:o,l=w<(l=B<(l=C<l?C:l)?B:l)?w:l,u=P>(u=L>(u=M>u?M:u)?L:u)?P:u,c=w>(c=B>(c=C>c?C:c)?B:c)?w:c}if(h.x=o,h.y=l,h.width=u-o,h.height=c-l,e)for(i.worldTransform=s,I=0;I<i.children.length;I++)i.children[I].updateTransform();if(!t){var U=i.getBounds();h.x-=U.x,h.y-=U.y}return h},D.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)},D.DisplayObjectContainer.prototype.contains=function(t){return!!t&&(t===this||this.contains(t.parent))},D.DisplayObjectContainer.prototype._renderWebGL=function(a){if(this.visible&&!(0>=this.alpha))if(this._cacheAsBitmap)this._renderCachedSprite(a);else{var e;if(this._mask||this._filters){for(this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(a);a.spriteBatch.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&a.filterManager.popFilter(),a.spriteBatch.start()}else for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(a)}},D.DisplayObjectContainer.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha)if(this._cacheAsBitmap)this._renderCachedSprite(a);else{this._mask&&a.maskManager.pushMask(this._mask,a);for(var e=0;e<this.children.length;e++)this.children[e]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}},Object.defineProperty(D.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(a){var e=this.getLocalBounds().width;this.scale.x=0===e?1:a/e,this._width=a}}),Object.defineProperty(D.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(a){var e=this.getLocalBounds().height;this.scale.y=0===e?1:a/e,this._height=a}}),D.Sprite=function(t){D.DisplayObjectContainer.call(this),this.anchor=new D.Point(D.Sprite.defaultAnchor.x,D.Sprite.defaultAnchor.y),this.texture=t||D.Texture.emptyTexture,this._width=0,this._height=0,this.tint=16777215,this.cachedTint=-1,this.tintedTexture=null,this.blendMode=D.blendModes.NORMAL,this.shader=null,this.exists=!0,this.texture.baseTexture.hasLoaded&&this.onTextureUpdate(),this.renderable=!0},D.Sprite.defaultAnchor={x:0,y:0},D.Sprite.prototype=Object.create(D.DisplayObjectContainer.prototype),D.Sprite.prototype.constructor=D.Sprite,Object.defineProperty(D.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(D.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),D.Sprite.prototype.setTexture=function(a,e){e&&this.texture.baseTexture.destroy(),this.texture.baseTexture.skipRender=!1,this.texture=a,this.texture.valid=!0,this.cachedTint=-1},D.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},D.Sprite.prototype.getBounds=function(C){var e=this.texture.frame.width,t=this.texture.frame.height,r=e*(1-this.anchor.x),i=e*-this.anchor.x,P=t*(1-this.anchor.y),o=t*-this.anchor.y,w=C||this.worldTransform,n=w.a,h=w.b,l=w.c,u=w.d,c=w.tx,d=w.ty,f=-1/0,x=-1/0,p=1/0,g=1/0;if(0===h&&0===l){if(0>n&&(n*=-1,v=r,r=-i,i=-v),0>u){u*=-1;var v=P;P=-o,o=-v}p=n*i+c,f=n*r+c,g=u*o+d,x=u*P+d}else{var L=n*i+l*o+c,m=u*o+h*i+d,E=n*r+l*o+c,_=u*o+h*r+d,S=n*r+l*P+c,y=u*P+h*r+d,b=n*i+l*P+c,A=u*P+h*i+d;p=b<(p=S<(p=E<(p=L<p?L:p)?E:p)?S:p)?b:p,g=A<(g=y<(g=_<(g=m<g?m:g)?_:g)?y:g)?A:g,f=b>(f=S>(f=E>(f=L>f?L:f)?E:f)?S:f)?b:f,x=A>(x=y>(x=_>(x=m>x?m:x)?_:x)?y:x)?A:x}var R=this._bounds;return R.x=p,R.width=f-p,R.y=g,R.height=x-g,this._currentBounds=R,R},D.Sprite.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=Phaser.identityMatrix;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform();var t=this.getBounds();for(this.worldTransform=a,e=0;e<this.children.length;e++)this.children[e].updateTransform();return t},D.Sprite.prototype._renderWebGL=function(a,e){if(this.visible&&!(0>=this.alpha)&&this.renderable){var t=this.worldTransform;if(e&&(t=e),this._mask||this._filters){var r=a.spriteBatch;for(this._filters&&(r.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(r.stop(),a.maskManager.pushMask(this.mask,a),r.start()),r.render(this),o=0;o<this.children.length;o++)this.children[o]._renderWebGL(a);r.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&a.filterManager.popFilter(),r.start()}else{a.spriteBatch.render(this);for(var o=0;o<this.children.length;o++)this.children[o]._renderWebGL(a,t)}}},D.Sprite.prototype._renderCanvas=function(i,e){if(this.visible&&0!==this.alpha&&this.renderable&&!(1>this.texture.crop.width)&&!(1>this.texture.crop.height)){var t=this.worldTransform;if(e&&(t=e),this.blendMode!==i.currentBlendMode&&(i.currentBlendMode=this.blendMode,i.context.globalCompositeOperation=D.blendModesCanvas[i.currentBlendMode]),this._mask&&i.maskManager.pushMask(this._mask,i),this.texture.valid){var r=this.texture.baseTexture.resolution/i.resolution;i.context.globalAlpha=this.worldAlpha,i.smoothProperty&&i.scaleMode!==this.texture.baseTexture.scaleMode&&(i.scaleMode=this.texture.baseTexture.scaleMode,i.context[i.smoothProperty]=i.scaleMode===D.scaleModes.LINEAR);var s=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,o=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,a=t.tx*i.resolution+i.shakeX,n=t.ty*i.resolution+i.shakeY,m=this.texture.crop.width,l=this.texture.crop.height;if(this.texture.rotated){var u=t.a,c=t.b,d=t.c,h=t.d,y=m;a=t.c*l+a,n=t.d*l+n,t.a=6123233995736766e-32*u-d,t.b=6123233995736766e-32*c-h,t.c=u+6123233995736766e-32*d,t.d=c+6123233995736766e-32*h,m=l,l=y}if(i.roundPixels?(i.context.setTransform(t.a,t.b,t.c,t.d,0|a,0|n),s|=0,o|=0):i.context.setTransform(t.a,t.b,t.c,t.d,a,n),s/=r,o/=r,m|=0,l|=0,m&&l){if(16777215!==this.tint)(this.texture.requiresReTint||this.cachedTint!==this.tint)&&(this.tintedTexture=D.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1),i.context.drawImage(this.tintedTexture,0,0,m,l,s,o,m/r,l/r);else{var p=this.texture.crop.x,g=this.texture.crop.y;i.context.drawImage(this.texture.baseTexture.source,p,g,m,l,s,o,m/r,l/r)}for(f=0;f<this.children.length;f++)this.children[f]._renderCanvas(i);this._mask&&i.maskManager.popMask(i)}}else{for(var f=0;f<this.children.length;f++)this.children[f]._renderCanvas(i);this._mask&&i.maskManager.popMask(i)}}},D.initDefaultShaders=function(){},D.CompileVertexShader=function(a,e){return D._CompileShader(a,e,a.VERTEX_SHADER)},D.CompileFragmentShader=function(a,e){return D._CompileShader(a,e,a.FRAGMENT_SHADER)},D._CompileShader=function(a,e,t){var r=e;Array.isArray(e)&&(r=e.join("\n"));var o=a.createShader(t);return a.shaderSource(o,r),a.compileShader(o),a.getShaderParameter(o,a.COMPILE_STATUS)?o:(window.console.log(a.getShaderInfoLog(o)),null)},D.compileProgram=function(n,e,t){var r=D.CompileFragmentShader(n,t),i=D.CompileVertexShader(n,e),o=n.createProgram();return n.attachShader(o,i),n.attachShader(o,r),n.linkProgram(o),n.getProgramParameter(o,n.LINK_STATUS)||(window.console.log(n.getProgramInfoLog(o)),window.console.log("Could not initialise shaders")),o},D.PixiShader=function(t){this._UID=Phaser._UID++,this.gl=t,this.program=null,this.fragmentSrc=null,this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},D.PixiShader.prototype.constructor=D.PixiShader,D.PixiShader.prototype.initMultitexShader=function(){var i=this.gl;this.MAX_TEXTURES=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS);for(var e="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",t=1;t<this.MAX_TEXTURES;++t)e+="\tif (vTextureIndex == "+t+".0) {gl_FragColor = texture2D(uSamplerArray["+t+"], vTextureCoord) * vColor;return;}\n";this.fragmentSrc=["// PixiShader Fragment Shader.","precision lowp float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",e,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) { gl_FragColor = RED;return;}","}"];var r=D.compileProgram(i,this.vertexSrc||D.PixiShader.defaultVertexSrc,this.fragmentSrc);i.useProgram(r),this.uSamplerArray=i.getUniformLocation(r,"uSamplerArray[0]"),this.projectionVector=i.getUniformLocation(r,"projectionVector"),this.offsetVector=i.getUniformLocation(r,"offsetVector"),this.dimensions=i.getUniformLocation(r,"dimensions"),this.aVertexPosition=i.getAttribLocation(r,"aVertexPosition"),this.aTextureCoord=i.getAttribLocation(r,"aTextureCoord"),this.colorAttribute=i.getAttribLocation(r,"aColor"),this.aTextureIndex=i.getAttribLocation(r,"aTextureIndex");var s=[],o=i.createTexture();i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o),i.texImage2D(i.TEXTURE_2D,0,i.RGB,1,1,0,i.RGB,i.UNSIGNED_BYTE,null);for(var a=0;a<this.MAX_TEXTURES;++a)i.activeTexture(i.TEXTURE0+a),i.bindTexture(i.TEXTURE_2D,o),s.push(a);for(var n in i.activeTexture(i.TEXTURE0),i.uniform1iv(this.uSamplerArray,s),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex],this.uniforms)this.uniforms[n].uniformLocation=i.getUniformLocation(r,n);this.initUniforms(),this.program=r},D.PixiShader.prototype.initDefaultShader=function(){null===this.fragmentSrc&&(this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"]);var a=this.gl,e=D.compileProgram(a,this.vertexSrc||D.PixiShader.defaultVertexSrc,this.fragmentSrc);for(var t in a.useProgram(e),this.uSampler=a.getUniformLocation(e,"uSampler"),this.projectionVector=a.getUniformLocation(e,"projectionVector"),this.offsetVector=a.getUniformLocation(e,"offsetVector"),this.dimensions=a.getUniformLocation(e,"dimensions"),this.aVertexPosition=a.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(e,"aColor"),this.aTextureIndex=a.getAttribLocation(e,"aTextureIndex"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute,this.aTextureIndex],this.uniforms)this.uniforms[t].uniformLocation=a.getUniformLocation(e,t);this.initUniforms(),this.program=e},D.PixiShader.prototype.init=function(t){D._enableMultiTextureToggle&&!t?this.initMultitexShader():this.initDefaultShader()},D.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var a=this.gl,t;for(var e in this.uniforms){var r=(t=this.uniforms[e]).type;"sampler2D"===r?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===r||"mat3"===r||"mat4"===r?(t.glMatrix=!0,t.glValueLength=1,"mat2"===r?t.glFunc=a.uniformMatrix2fv:"mat3"===r?t.glFunc=a.uniformMatrix3fv:"mat4"===r&&(t.glFunc=a.uniformMatrix4fv)):(t.glFunc=a["uniform"+r],t.glValueLength="2f"===r||"2i"===r?2:"3f"===r||"3i"===r?3:"4f"===r||"4i"===r?4:1)}},D.PixiShader.prototype.initSampler2D=function(d){if(d.value&&d.value.baseTexture&&d.value.baseTexture.hasLoaded){var e=this.gl;if(e.activeTexture(e.TEXTURE0+this.textureCount),e.bindTexture(e.TEXTURE_2D,d.value.baseTexture._glTextures[e.id]),d.textureData){var t=d.textureData,r=t.magFilter?t.magFilter:e.LINEAR,i=t.minFilter?t.minFilter:e.LINEAR,s=t.wrapS?t.wrapS:e.CLAMP_TO_EDGE,o=t.wrapT?t.wrapT:e.CLAMP_TO_EDGE,a=t.luminance?e.LUMINANCE:e.RGBA;if(t.repeat&&(s=e.REPEAT,o=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!t.flipY),t.width){var n=t.width?t.width:512,p=t.height?t.height:2,l=t.border?t.border:0;e.texImage2D(e.TEXTURE_2D,0,a,n,p,l,a,e.UNSIGNED_BYTE,null)}else e.texImage2D(e.TEXTURE_2D,0,a,e.RGBA,e.UNSIGNED_BYTE,d.value.baseTexture.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,o)}e.uniform1i(d.uniformLocation,this.textureCount),d._init=!0,this.textureCount++}},D.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a=this.gl,t;for(var e in this.uniforms)1===(t=this.uniforms[e]).glValueLength?!0===t.glMatrix?t.glFunc.call(a,t.uniformLocation,t.transpose,t.value):t.glFunc.call(a,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(a,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(a,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(a,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):"sampler2D"===t.type&&(t._init?(a.activeTexture(a["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[a.id]?D.instances[a.id].updateTexture(t.value.baseTexture):a.bindTexture(a.TEXTURE_2D,t.value.baseTexture._glTextures[a.id]),a.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},D.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},D.PixiShader.defaultVertexSrc=["// PixiShader Vertex Shader","// With multi-texture rendering","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","attribute float aTextureIndex;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   if (aTextureIndex > 0.0) gl_Position = vec4(0.0);","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","   vTextureIndex = aTextureIndex;","}"],D.PixiFastShader=function(a){if(this._UID=Phaser._UID++,this.gl=a,this.program=null,D._enableMultiTextureToggle){var a=this.gl;this.MAX_TEXTURES=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(var e="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",t=1;t<this.MAX_TEXTURES;++t)e+="\tif (vTextureIndex == "+t+".0) { gl_FragColor = texture2D(uSamplerArray["+t+"], vTextureCoord) * vColor;return;}\n";this.fragmentSrc=["// PixiFastShader Fragment Shader.","precision lowp float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",e,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}","}"]}else this.fragmentSrc=["// PixiFastShader Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"];this.vertexSrc=["// PixiFastShader Vertex Shader.","attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute float aTextureIndex;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","varying float vTextureIndex;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vTextureIndex = aTextureIndex;","   vColor = aColor;","}"],this.textureCount=0,this.init()},D.PixiFastShader.prototype.constructor=D.PixiFastShader,D.PixiFastShader.prototype.init=function(){var a=this.gl,e=D.compileProgram(a,this.vertexSrc,this.fragmentSrc);if(a.useProgram(e),this.uSampler=D._enableMultiTextureToggle?a.getUniformLocation(e,"uSamplerArray[0]"):a.getUniformLocation(e,"uSampler"),D._enableMultiTextureToggle){var t=[],r=a.createTexture();a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,r),a.texImage2D(a.TEXTURE_2D,0,a.RGB,1,1,0,a.RGB,a.UNSIGNED_BYTE,null);for(var n=0;n<this.MAX_TEXTURES;++n)a.activeTexture(a.TEXTURE0+n),a.bindTexture(a.TEXTURE_2D,r),t.push(n);a.activeTexture(a.TEXTURE0),a.uniform1iv(this.uSampler,t)}this.projectionVector=a.getUniformLocation(e,"projectionVector"),this.offsetVector=a.getUniformLocation(e,"offsetVector"),this.dimensions=a.getUniformLocation(e,"dimensions"),this.uMatrix=a.getUniformLocation(e,"uMatrix"),this.aVertexPosition=a.getAttribLocation(e,"aVertexPosition"),this.aPositionCoord=a.getAttribLocation(e,"aPositionCoord"),this.aScale=a.getAttribLocation(e,"aScale"),this.aRotation=a.getAttribLocation(e,"aRotation"),this.aTextureCoord=a.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(e,"aColor"),this.aTextureIndex=a.getAttribLocation(e,"aTextureIndex"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute,this.aTextureIndex],this.program=e},D.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},D.StripShader=function(a){if(this._UID=Phaser._UID++,this.gl=a,this.program=null,D._enableMultiTextureToggle){var a=this.gl;this.MAX_TEXTURES=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(var e="\tif (vTextureIndex == 0.0) { gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord);return;}\n",t=1;t<this.MAX_TEXTURES;++t)e+="\tif (vTextureIndex == "+t+".0) { gl_FragColor = texture2D(uSamplerArray["+t+"], vTextureCoord) ;return;}\n";this.fragmentSrc=["//StripShader Fragment Shader.","precision mediump float;","bool isnan( float val ) {  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true; }","varying vec2 vTextureCoord;","varying float vTextureIndex;","uniform float alpha;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","const vec4 BLUE = vec4(1.0, 0.0, 1.0, 1.0);","const vec4 RED = vec4(1.0, 0.0, 0.0, 1.0);","void main(void) {",e,"   if(vTextureIndex >= "+this.MAX_TEXTURES+".0) { gl_FragColor = BLUE;return;}","   if(isnan(vTextureIndex)) {gl_FragColor = RED;return;}","}"]}else this.fragmentSrc=["//StripShader Fragment Shader.","precision mediump float;","varying vec2 vTextureCoord;","varying float vTextureIndex;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","}"];this.vertexSrc=["//StripShader Vertex Shader.","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aTextureIndex;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying float vTextureIndex;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vTextureIndex = aTextureIndex;","}"],this.init()},D.StripShader.prototype.constructor=D.StripShader,D.StripShader.prototype.init=function(){var a=this.gl,e=D.compileProgram(a,this.vertexSrc,this.fragmentSrc);if(a.useProgram(e),this.uSampler=D._enableMultiTextureToggle?a.getUniformLocation(e,"uSamplerArray[0]"):a.getUniformLocation(e,"uSampler"),D._enableMultiTextureToggle){var t=[],r=a.createTexture();a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,r),a.texImage2D(a.TEXTURE_2D,0,a.RGB,1,1,0,a.RGB,a.UNSIGNED_BYTE,null);for(var n=0;n<this.MAX_TEXTURES;++n)a.activeTexture(a.TEXTURE0+n),a.bindTexture(a.TEXTURE_2D,r),t.push(n);a.activeTexture(a.TEXTURE0),a.uniform1iv(this.uSampler,t)}this.projectionVector=a.getUniformLocation(e,"projectionVector"),this.offsetVector=a.getUniformLocation(e,"offsetVector"),this.colorAttribute=a.getAttribLocation(e,"aColor"),this.aTextureIndex=a.getAttribLocation(e,"aTextureIndex"),this.aVertexPosition=a.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(e,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.aTextureIndex],this.translationMatrix=a.getUniformLocation(e,"translationMatrix"),this.alpha=a.getUniformLocation(e,"alpha"),this.program=e},D.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},D.PrimitiveShader=function(t){this._UID=Phaser._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},D.PrimitiveShader.prototype.constructor=D.PrimitiveShader,D.PrimitiveShader.prototype.init=function(){var a=this.gl,e=D.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(e),this.projectionVector=a.getUniformLocation(e,"projectionVector"),this.offsetVector=a.getUniformLocation(e,"offsetVector"),this.tintColor=a.getUniformLocation(e,"tint"),this.flipY=a.getUniformLocation(e,"flipY"),this.aVertexPosition=a.getAttribLocation(e,"aVertexPosition"),this.colorAttribute=a.getAttribLocation(e,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=a.getUniformLocation(e,"translationMatrix"),this.alpha=a.getUniformLocation(e,"alpha"),this.program=e},D.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},D.ComplexPrimitiveShader=function(t){this._UID=Phaser._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},D.ComplexPrimitiveShader.prototype.constructor=D.ComplexPrimitiveShader,D.ComplexPrimitiveShader.prototype.init=function(){var a=this.gl,e=D.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(e),this.projectionVector=a.getUniformLocation(e,"projectionVector"),this.offsetVector=a.getUniformLocation(e,"offsetVector"),this.tintColor=a.getUniformLocation(e,"tint"),this.color=a.getUniformLocation(e,"color"),this.flipY=a.getUniformLocation(e,"flipY"),this.aVertexPosition=a.getAttribLocation(e,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=a.getUniformLocation(e,"translationMatrix"),this.alpha=a.getUniformLocation(e,"alpha"),this.program=e},D.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},D.glContexts=[],D.instances=[],D._enableMultiTextureToggle=!1,D.WebGLRenderer=function(a,e){this.game=a,D.defaultRenderer||(D.defaultRenderer=this),this.extensions={},this.type=Phaser.WEBGL,this.resolution=a.resolution,this.transparent=a.transparent,this.autoResize=!1,this.preserveDrawingBuffer=a.preserveDrawingBuffer,this.clearBeforeRender=a.clearBeforeRender,this.width=a.width,this.height=a.height,this.view=a.canvas,this._contextOptions={alpha:this.transparent,antialias:a.antialias,failIfMajorPerformanceCaveat:e.failIfMajorPerformanceCaveat,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:this.preserveDrawingBuffer},this.projection=new D.Point,this.offset=new D.Point,this.shaderManager=new D.WebGLShaderManager,this.spriteBatch=new D.WebGLSpriteBatch(a),this.maskManager=new D.WebGLMaskManager,this.filterManager=new D.WebGLFilterManager,this.stencilManager=new D.WebGLStencilManager,this.blendModeManager=new D.WebGLBlendModeManager,this.renderSession={},this.currentBatchedTextures=[],this.renderSession.game=this.game,this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.renderSession.roundPixels=e.roundPixels||!1,this.renderSession.maxTextureAvailableSpace=null,this.initContext(),this.mapBlendModes()},D.WebGLRenderer.prototype.constructor=D.WebGLRenderer,D.WebGLRenderer.prototype.initContext=function(){var a=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=a,!a)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.maxTextures=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=this.gl.getParameter(a.MAX_TEXTURE_SIZE),this.glContextId=a.id=D.WebGLRenderer.glContextId++,D.glContexts[this.glContextId]=a,D.instances[this.glContextId]=this,a.disable(a.DEPTH_TEST),a.disable(a.CULL_FACE),a.enable(a.BLEND),this.shaderManager.setContext(a),this.spriteBatch.setContext(a),this.maskManager.setContext(a),this.filterManager.setContext(a),this.blendModeManager.setContext(a),this.stencilManager.setContext(a),this.renderSession.gl=this.gl,this.resize(this.width,this.height),this.extensions.compression={};var o=a.getExtension("WEBGL_compressed_texture_etc1")||a.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),t=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),r=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");o&&(this.extensions.compression.ETC1=o),t&&(this.extensions.compression.PVRTC=t),r&&(this.extensions.compression.S3TC=r)},D.WebGLRenderer.prototype.setTexturePriority=function(i){if(D._enableMultiTextureToggle){for(var e=function(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},t=this.gl,r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),s=t.getParameter(t.MAX_TEXTURE_SIZE),o=this.game.cache._cache.image,a=null,n=0;n<this.currentBatchedTextures.length;n++)(a=this.currentBatchedTextures[n])in o?o[a].base.textureIndex=0:console.warn("setTexturePriority: There is no image \"%s\" in the image cache.",a);var p=s-e(d(this.width,this.height));this.currentBatchedTextures.length=0;for(var l=0;l<i.length;++l)if((a=i[l])in o){var u=o[a].base;0>=(p-=e(d(u.width,u.height)))?(u.textureIndex=0,console.warn("setTexturePriority: Image \"%s\" was given textureIndex=0 because there is no available texture space (%s).",a,p)):u.textureIndex=1+l%(r-1),this.currentBatchedTextures.push(a)}else console.warn("setTexturePriority: There is no image \"%s\" in the image cache.",a);return this.renderSession.maxTextureAvailableSpace=p,this.currentBatchedTextures}console.warn("setTexturePriority error: Multi Texture support hasn't been enabled in the Phaser Game Config.")},D.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){var e=this.gl;e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.game.clearBeforeRender&&(e.clearColor(a._bgColor.r,a._bgColor.g,a._bgColor.b,a._bgColor.a),e.clear(e.COLOR_BUFFER_BIT)),this.offset.x=this.game.camera._shake.x,this.offset.y=this.game.camera._shake.y,this.renderDisplayObject(a,this.projection)}},D.WebGLRenderer.prototype.renderDisplayObject=function(a,e,t,r){this.renderSession.blendModeManager.setBlendMode(D.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.flipY=t?-1:1,this.renderSession.projection=e,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,t),a._renderWebGL(this.renderSession,r),this.spriteBatch.end()},D.WebGLRenderer.prototype.resize=function(a,e){this.width=a*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},D.WebGLRenderer.prototype.updateCompressedTexture=function(a){if(!a.hasLoaded)return!1;var e=this.gl,t=a.source;return a._glTextures[e.id]||(a._glTextures[e.id]=e.createTexture()),e.activeTexture(e.TEXTURE0+a.textureIndex),e.bindTexture(e.TEXTURE_2D,a._glTextures[e.id]),e.compressedTexImage2D(e.TEXTURE_2D,0,t.glExtensionFormat,t.width,t.height,0,t.textureData),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a.scaleMode===D.scaleModes.LINEAR?e.LINEAR:e.NEAREST),a.mipmap&&Phaser.Math.isPowerOfTwo(a.width,a.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a.scaleMode===D.scaleModes.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a.scaleMode===D.scaleModes.LINEAR?e.LINEAR:e.NEAREST),a._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),a._dirty[e.id]=!1,!0},D.WebGLRenderer.prototype.updateTexture=function(a){if(!a.hasLoaded)return!1;if(a.source.compressionAlgorithm)return this.updateCompressedTexture(a);var e=this.gl;return a._glTextures[e.id]||(a._glTextures[e.id]=e.createTexture()),e.activeTexture(e.TEXTURE0+a.textureIndex),e.bindTexture(e.TEXTURE_2D,a._glTextures[e.id]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a.scaleMode===D.scaleModes.LINEAR?e.LINEAR:e.NEAREST),a.mipmap&&Phaser.Math.isPowerOfTwo(a.width,a.height)?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a.scaleMode===D.scaleModes.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a.scaleMode===D.scaleModes.LINEAR?e.LINEAR:e.NEAREST),a._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),a._dirty[e.id]=!1,!0},D.WebGLRenderer.prototype.destroy=function(){D.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null,Phaser.CanvasPool.remove(this),D.instances[this.glContextId]=null,D.WebGLRenderer.glContextId--},D.WebGLRenderer.prototype.mapBlendModes=function(){var a=this.gl;if(!D.blendModesWebGL){var e=[],t=D.blendModes;e[t.NORMAL]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.ADD]=[a.SRC_ALPHA,a.DST_ALPHA],e[t.MULTIPLY]=[a.DST_COLOR,a.ONE_MINUS_SRC_ALPHA],e[t.SCREEN]=[a.SRC_ALPHA,a.ONE],e[t.OVERLAY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.DARKEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.LIGHTEN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.COLOR_DODGE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.COLOR_BURN]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.HARD_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.SOFT_LIGHT]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.DIFFERENCE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.EXCLUSION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.HUE]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.SATURATION]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.COLOR]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],e[t.LUMINOSITY]=[a.ONE,a.ONE_MINUS_SRC_ALPHA],D.blendModesWebGL=e}},D.WebGLRenderer.prototype.getMaxTextureUnit=function(){var t=this.gl;return t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)},D.enableMultiTexture=function(){D._enableMultiTextureToggle=!0},D.WebGLRenderer.glContextId=0,D.WebGLRenderer.textureArray=[],D.WebGLBlendModeManager=function(){this.currentBlendMode=99999},D.WebGLBlendModeManager.prototype.constructor=D.WebGLBlendModeManager,D.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},D.WebGLBlendModeManager.prototype.setBlendMode=function(a){if(this.currentBlendMode===a)return!1;this.currentBlendMode=a;var e=D.blendModesWebGL[this.currentBlendMode];return e&&this.gl.blendFunc(e[0],e[1]),!0},D.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},D.WebGLMaskManager=function(){},D.WebGLMaskManager.prototype.constructor=D.WebGLMaskManager,D.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},D.WebGLMaskManager.prototype.pushMask=function(a,e){var t=e.gl;a.dirty&&D.WebGLGraphics.updateGraphics(a,t),void 0!==a._webGL[t.id]&&void 0!==a._webGL[t.id].data&&0!==a._webGL[t.id].data.length&&e.stencilManager.pushStencil(a,a._webGL[t.id].data[0],e)},D.WebGLMaskManager.prototype.popMask=function(a,e){var t=this.gl;void 0!==a._webGL[t.id]&&void 0!==a._webGL[t.id].data&&0!==a._webGL[t.id].data.length&&e.stencilManager.popStencil(a,a._webGL[t.id].data[0],e)},D.WebGLMaskManager.prototype.destroy=function(){this.gl=null},D.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},D.WebGLStencilManager.prototype.setContext=function(t){this.gl=t},D.WebGLStencilManager.prototype.pushStencil=function(a,e,t){var r=this.gl;this.bindGraphics(a,e,t),0===this.stencilStack.length&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);var o=this.count;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),1===e.mode?(r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-o,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,o,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?r.stencilFunc(r.EQUAL,255-(o+1),255):r.stencilFunc(r.EQUAL,o+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,o,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-o,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,o+1,255):r.stencilFunc(r.EQUAL,255-(o+1),255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),this.count++},D.WebGLStencilManager.prototype.bindGraphics=function(n,e,t){this._currentGraphics=n;var r=this.gl,s=t.projection,o=t.offset,a;1===e.mode?(a=t.shaderManager.complexPrimitiveShader,t.shaderManager.setShader(a),r.uniform1f(a.flipY,t.flipY),r.uniformMatrix3fv(a.translationMatrix,!1,n.worldTransform.toArray(!0)),r.uniform2f(a.projectionVector,s.x,-s.y),r.uniform2f(a.offsetVector,-o.x,-o.y),r.uniform3fv(a.tintColor,Phaser.Color.hexToRGBArray(n.tint)),r.uniform3fv(a.color,e.color),r.uniform1f(a.alpha,n.worldAlpha*e.alpha),r.bindBuffer(r.ARRAY_BUFFER,e.buffer),r.vertexAttribPointer(a.aVertexPosition,2,r.FLOAT,!1,8,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.indexBuffer)):(a=t.shaderManager.primitiveShader,t.shaderManager.setShader(a),r.uniformMatrix3fv(a.translationMatrix,!1,n.worldTransform.toArray(!0)),r.uniform1f(a.flipY,t.flipY),r.uniform2f(a.projectionVector,s.x,-s.y),r.uniform2f(a.offsetVector,-o.x,-o.y),r.uniform3fv(a.tintColor,Phaser.Color.hexToRGBArray(n.tint)),r.uniform1f(a.alpha,n.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,e.buffer),r.vertexAttribPointer(a.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(a.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.indexBuffer))},D.WebGLStencilManager.prototype.popStencil=function(a,e,t){var r=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)r.disable(r.STENCIL_TEST);else{var o=this.count;this.bindGraphics(a,e,t),r.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(o+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,o+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,2*(e.indices.length-4)),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,o,255):r.stencilFunc(r.EQUAL,255-o,255)):(this.reverse?(r.stencilFunc(r.EQUAL,o+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(o+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,o,255):r.stencilFunc(r.EQUAL,255-o,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}},D.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},D.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]},D.WebGLShaderManager.prototype.constructor=D.WebGLShaderManager,D.WebGLShaderManager.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new D.PrimitiveShader(t),this.complexPrimitiveShader=new D.ComplexPrimitiveShader(t),this.defaultShader=new D.PixiShader(t),this.fastShader=new D.PixiFastShader(t),this.stripShader=new D.StripShader(t),this.creatureShader=D.CreatureShader?new D.CreatureShader(t):null,this.setShader(this.defaultShader)},D.WebGLShaderManager.prototype.setAttribs=function(a){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<a.length;e++){var t=a[e];this.tempAttribState[t]=!0}var r=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?r.enableVertexAttribArray(e):r.disableVertexAttribArray(e))},D.WebGLShaderManager.prototype.setShader=function(t){return this._currentId!==t._UID&&(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},D.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.creatureShader&&this.creatureShader.destroy(),this.gl=null},D.WebGLSpriteBatch=function(a){this.game=a,this.vertSize=5,this.size=2e3,this.vertexSize=24;var e=4*(this.vertexSize*this.size),t=6*this.size;this.vertices=new ArrayBuffer(e),this.positions=new Float32Array(this.vertices),this.colors=new Uint32Array(this.vertices),this.indices=new Uint16Array(t),this.lastIndexCount=0;for(var r=0,o=0;r<t;r+=6,o+=4)this.indices[r+0]=o+0,this.indices[r+1]=o+1,this.indices[r+2]=o+2,this.indices[r+3]=o+0,this.indices[r+4]=o+2,this.indices[r+5]=o+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=null},D.WebGLSpriteBatch.prototype.setContext=function(a){if(this.MAX_TEXTURES=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),this.gl=a,D._enableMultiTextureToggle){for(var e="\tif (vTextureIndex == 0.0) {gl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;return;}\n",t=1;t<this.MAX_TEXTURES;++t)e+="\tif (vTextureIndex == "+t+".0) {gl_FragColor = texture2D(uSamplerArray["+t+"], vTextureCoord) * vColor;return;}\n";this.defaultShader=new Phaser.Filter(this.game,void 0,["//WebGLSpriteBatch Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSamplerArray["+this.MAX_TEXTURES+"];","void main(void) {",e,"\tgl_FragColor = texture2D(uSamplerArray[0], vTextureCoord) * vColor;","}"])}else this.defaultShader=new Phaser.Filter(this.game,void 0,["//WebGLSpriteBatch Fragment Shader.","precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying float vTextureIndex;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;","}"]);this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW),this.currentBlendMode=99999;var r=new D.PixiShader(a);r.fragmentSrc=this.defaultShader.fragmentSrc,r.uniforms={},r.init(),this.defaultShader.shaders[a.id]=r},D.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},D.WebGLSpriteBatch.prototype.end=function(){this.flush()},D.WebGLSpriteBatch.prototype.render=function(i,e){var t=i.texture,r=t.baseTexture,s=this.gl;D.WebGLRenderer.textureArray[r.textureIndex]!=r&&(this.flush(),s.activeTexture(s.TEXTURE0+r.textureIndex),s.bindTexture(s.TEXTURE_2D,r._glTextures[s.id]),D.WebGLRenderer.textureArray[r.textureIndex]=r);var o=i.worldTransform;e&&(o=e),this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=t.baseTexture);var a=t._uvs;if(a){var n=i.anchor.x,I=i.anchor.y,O,h,l,u;if(t.trim){var c=t.trim;O=(h=c.x-n*c.width)+t.crop.width,l=(u=c.y-I*c.height)+t.crop.height}else O=t.frame.width*(1-n),h=t.frame.width*-n,l=t.frame.height*(1-I),u=t.frame.height*-I;var x=this.currentBatchSize*this.vertexSize,p=(this.currentBatchSize,t.baseTexture.resolution),g=t.baseTexture.textureIndex,v=o.a/p,T=o.b/p,m=o.c/p,E=o.d/p,_=o.tx,S=o.ty,y=(t.crop.width,t.crop.height);if(t.rotated){var b=o.a,A=o.b,R=o.c,M=o.d,C=h,L=O;_=o.c*y+_,S=o.d*y+S,v=6123233995736766e-32*b-R,T=6123233995736766e-32*A-M,m=b+6123233995736766e-32*R,E=A+6123233995736766e-32*M,t._updateUvsInverted(),O=l,h=u,l=L,u=C}var B=this.colors,P=this.positions,w=i.tint,U=(w>>16)+(65280&w)+((255&w)<<16)+(255*i.worldAlpha<<24);this.renderSession.roundPixels?(P[x++]=0|v*h+m*u+_,P[x++]=0|E*u+T*h+S,P[x++]=a.x0,P[x++]=a.y0,B[x++]=U,P[x++]=g,P[x++]=0|v*O+m*u+_,P[x++]=0|E*u+T*O+S,P[x++]=a.x1,P[x++]=a.y1,B[x++]=U,P[x++]=g,P[x++]=0|v*O+m*l+_,P[x++]=0|E*l+T*O+S,P[x++]=a.x2,P[x++]=a.y2,B[x++]=U,P[x++]=g,P[x++]=0|v*h+m*l+_,P[x++]=0|E*l+T*h+S,P[x++]=a.x3,P[x++]=a.y3,B[x++]=U,P[x++]=g):(P[x++]=v*h+m*u+_,P[x++]=E*u+T*h+S,P[x++]=a.x0,P[x++]=a.y0,B[x++]=U,P[x++]=g,P[x++]=v*O+m*u+_,P[x++]=E*u+T*O+S,P[x++]=a.x1,P[x++]=a.y1,B[x++]=U,P[x++]=g,P[x++]=v*O+m*l+_,P[x++]=E*l+T*O+S,P[x++]=a.x2,P[x++]=a.y2,B[x++]=U,P[x++]=g,P[x++]=v*h+m*l+_,P[x++]=E*l+T*h+S,P[x++]=a.x3,P[x++]=a.y3,B[x++]=U,P[x++]=g),this.sprites[this.currentBatchSize++]=i}},D.WebGLSpriteBatch.prototype.renderTilingSprite=function(i){var e=i.tilingTexture,t=e.baseTexture,r=this.gl,s=i.texture.baseTexture.textureIndex;D.WebGLRenderer.textureArray[s]!=t&&(this.flush(),r.activeTexture(r.TEXTURE0+s),r.bindTexture(r.TEXTURE_2D,t._glTextures[r.id]),D.WebGLRenderer.textureArray[s]=t),this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture),i._uvs||(i._uvs=new D.TextureUvs);var o=i._uvs,a=e.baseTexture.width,n=e.baseTexture.height;i.tilePosition.x%=a*i.tileScaleOffset.x,i.tilePosition.y%=n*i.tileScaleOffset.y;var h=i.tilePosition.x/(a*i.tileScaleOffset.x),l=i.tilePosition.y/(n*i.tileScaleOffset.y),u=i.width/a/(i.tileScale.x*i.tileScaleOffset.x),c=i.height/n/(i.tileScale.y*i.tileScaleOffset.y);o.x0=0-h,o.y0=0-l,o.x1=1*u-h,o.y1=0-l,o.x2=1*u-h,o.y2=1*c-l,o.x3=0-h,o.y3=1*c-l;var d=i.tint,f=(d>>16)+(65280&d)+((255&d)<<16)+(255*i.worldAlpha<<24),x=this.positions,p=this.colors,g=i.width,v=i.height,T=i.anchor.x,I=i.anchor.y,F=g*(1-T),_=g*-T,S=v*(1-I),y=v*-I,b=this.currentBatchSize*this.vertexSize,A=e.baseTexture.resolution,R=i.worldTransform,M=R.a/A,C=R.b/A,L=R.c/A,B=R.d/A,P=R.tx,w=R.ty;x[b++]=M*_+L*y+P,x[b++]=B*y+C*_+w,x[b++]=o.x0,x[b++]=o.y0,p[b++]=f,x[b++]=s,x[b++]=M*F+L*y+P,x[b++]=B*y+C*F+w,x[b++]=o.x1,x[b++]=o.y1,p[b++]=f,x[b++]=s,x[b++]=M*F+L*S+P,x[b++]=B*S+C*F+w,x[b++]=o.x2,x[b++]=o.y2,p[b++]=f,x[b++]=s,x[b++]=M*_+L*S+P,x[b++]=B*S+C*_+w,x[b++]=o.x3,x[b++]=o.y3,p[b++]=f,x[b++]=s,this.sprites[this.currentBatchSize++]=i},D.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var i=this.gl,t;if(this.dirty){this.dirty=!1,t=this.defaultShader.shaders[i.id],i.activeTexture(i.TEXTURE0),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.vertexSize;i.vertexAttribPointer(t.aVertexPosition,2,i.FLOAT,!1,e,0),i.vertexAttribPointer(t.aTextureCoord,2,i.FLOAT,!1,e,8),i.vertexAttribPointer(t.colorAttribute,4,i.UNSIGNED_BYTE,!0,e,16),i.vertexAttribPointer(t.aTextureIndex,1,i.FLOAT,!1,e,20)}if(this.currentBatchSize>.5*this.size)i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices);else{i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer);var r=this.positions.subarray(0,this.currentBatchSize*this.vertexSize);i.bufferSubData(i.ARRAY_BUFFER,0,r)}for(var s=0,l=0,u=null,c=this.renderSession.blendModeManager.currentBlendMode,d=null,y=!1,f=!1,p=0,g=this.currentBatchSize,x,o,a,n;p<g;p++){x=(n=this.sprites[p]).tilingTexture?n.tilingTexture.baseTexture:n.texture.baseTexture,y=c!==(o=n.blendMode),f=d!==(a=n.shader||this.defaultShader);var h=x.skipRender;if(h&&0<n.children.length&&(h=!1),(y||f)&&(this.renderBatch(u,s,l),l=p,s=0,u=x,y&&(c=o,this.renderSession.blendModeManager.setBlendMode(c)),f)){(t=(d=a).shaders[i.id])||((t=new D.PixiShader(i)).fragmentSrc=d.fragmentSrc,t.uniforms=d.uniforms,t.init(),d.shaders[i.id]=t),this.renderSession.shaderManager.setShader(t),t.dirty&&t.syncUniforms();var v=this.renderSession.projection;i.uniform2f(t.projectionVector,v.x,v.y);var m=this.renderSession.offset;i.uniform2f(t.offsetVector,m.x,m.y)}s++}this.renderBatch(u,s,l),this.currentBatchSize=0}},D.WebGLSpriteBatch.prototype.renderBatch=function(a,e,t){if(0!==e){var r=this.gl;if(!a._dirty[r.id])r.bindTexture(r.TEXTURE_2D,a._glTextures[r.id]);else if(!this.renderSession.renderer.updateTexture(a))return;r.drawElements(r.TRIANGLES,6*e,r.UNSIGNED_SHORT,2*(6*t)),this.renderSession.drawCount++}},D.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},D.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},D.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},D.WebGLFastSpriteBatch=function(a){this.vertSize=11,this.maxSize=6e3,this.size=this.maxSize;var e=4*this.size*this.vertSize,t=6*this.maxSize;this.vertices=new Float32Array(e),this.indices=new Uint16Array(t),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var r=0,o=0;r<t;r+=6,o+=4)this.indices[r+0]=o+0,this.indices[r+1]=o+1,this.indices[r+2]=o+2,this.indices[r+3]=o+0,this.indices[r+4]=o+2,this.indices[r+5]=o+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(a)},D.WebGLFastSpriteBatch.prototype.constructor=D.WebGLFastSpriteBatch,D.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)},D.WebGLFastSpriteBatch.prototype.begin=function(a,e){this.renderSession=e,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=a.worldTransform.toArray(!0),this.start()},D.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},D.WebGLFastSpriteBatch.prototype.render=function(a){var e=a.children,t=e[0];if(t.texture._uvs){this.currentBaseTexture=t.texture.baseTexture,t.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(t.blendMode));for(var r=0,o=e.length;r<o;r++)this.renderSprite(e[r]);this.flush()}},D.WebGLFastSpriteBatch.prototype.renderSprite=function(i){var e=i.texture.baseTexture,t=this.gl,r=i.texture.baseTexture.textureIndex;if((D.WebGLRenderer.textureArray[r]==e||!e._glTextures[t.id]||i.texture.baseTexture.skipRender||(this.flush(),t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,e._glTextures[t.id]),D.WebGLRenderer.textureArray[r]=e,i.texture._uvs))&&i.visible){var s=this.vertices,p,o,a,n,c,l;if(p=i.texture._uvs,i.texture.frame.width,i.texture.frame.height,i.texture.trim){var u=i.texture.trim;o=(a=u.x-i.anchor.x*u.width)+i.texture.crop.width,n=(c=u.y-i.anchor.y*u.height)+i.texture.crop.height}else o=i.texture.frame.width*(1-i.anchor.x),a=i.texture.frame.width*-i.anchor.x,n=i.texture.frame.height*(1-i.anchor.y),c=i.texture.frame.height*-i.anchor.y;l=4*this.currentBatchSize*this.vertSize,s[l++]=a,s[l++]=c,s[l++]=i.position.x,s[l++]=i.position.y,s[l++]=i.scale.x,s[l++]=i.scale.y,s[l++]=i.rotation,s[l++]=p.x0,s[l++]=p.y1,s[l++]=i.alpha,s[l++]=r,s[l++]=o,s[l++]=c,s[l++]=i.position.x,s[l++]=i.position.y,s[l++]=i.scale.x,s[l++]=i.scale.y,s[l++]=i.rotation,s[l++]=p.x1,s[l++]=p.y1,s[l++]=i.alpha,s[l++]=r,s[l++]=o,s[l++]=n,s[l++]=i.position.x,s[l++]=i.position.y,s[l++]=i.scale.x,s[l++]=i.scale.y,s[l++]=i.rotation,s[l++]=p.x2,s[l++]=p.y2,s[l++]=i.alpha,s[l++]=r,s[l++]=a,s[l++]=n,s[l++]=i.position.x,s[l++]=i.position.y,s[l++]=i.scale.x,s[l++]=i.scale.y,s[l++]=i.rotation,s[l++]=p.x3,s[l++]=p.y3,s[l++]=i.alpha,s[l++]=r,++this.currentBatchSize>=this.size&&this.flush()}},D.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]){if(this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,e)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}else this.renderSession.renderer.updateTexture(this.currentBaseTexture,a)}},D.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},D.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,e.x,e.y),a.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var t=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,t,0),a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,!1,t,8),a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,!1,t,16),a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,!1,t,24),a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,t,28),a.vertexAttribPointer(this.shader.colorAttribute,1,a.FLOAT,!1,t,36),a.vertexAttribPointer(this.shader.aTextureIndex,1,a.FLOAT,!1,t,40)},D.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},D.WebGLFilterManager.prototype.constructor=D.WebGLFilterManager,D.WebGLFilterManager.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},D.WebGLFilterManager.prototype.begin=function(a,e){this.renderSession=a,this.defaultShader=a.shaderManager.defaultShader;var t=this.renderSession.projection;this.width=2*t.x,this.height=2*-t.y,this.buffer=e},D.WebGLFilterManager.prototype.pushFilter=function(i){var e=this.gl,t=this.renderSession.projection,r=this.renderSession.offset;i._filterArea=i.target.filterArea||i.target.getBounds(),i._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new D.WebGLStencilManager,this.renderSession.stencilManager.setContext(e),e.disable(e.STENCIL_TEST),this.filterStack.push(i);var s=i.filterPasses[0];this.offsetX+=i._filterArea.x,this.offsetY+=i._filterArea.y;var o=this.texturePool.pop();o?o.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution):o=new D.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),e.bindTexture(e.TEXTURE_2D,o.texture);var a=i._filterArea,n=s.padding;a.x-=n,a.y-=n,a.width+=2*n,a.height+=2*n,0>a.x&&(a.x=0),a.width>this.width&&(a.width=this.width),0>a.y&&(a.y=0),a.height>this.height&&(a.height=this.height),e.bindFramebuffer(e.FRAMEBUFFER,o.frameBuffer),e.viewport(0,0,a.width*this.renderSession.resolution,a.height*this.renderSession.resolution),t.x=a.width/2,t.y=-a.height/2,r.x=-a.x,r.y=-a.y,e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),i._glFilterTexture=o},D.WebGLFilterManager.prototype.popFilter=function(){var i=this.gl,e=this.filterStack.pop(),t=e._filterArea,r=e._glFilterTexture,s=this.renderSession.projection,o=this.renderSession.offset;if(1<e.filterPasses.length){i.viewport(0,0,t.width*this.renderSession.resolution,t.height*this.renderSession.resolution),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=t.height,this.vertexArray[2]=t.width,this.vertexArray[3]=t.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=t.width,this.vertexArray[7]=0,i.bufferSubData(i.ARRAY_BUFFER,0,this.vertexArray),i.bindBuffer(i.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=t.width/this.width,this.uvArray[5]=t.height/this.height,this.uvArray[6]=t.width/this.width,this.uvArray[7]=t.height/this.height,i.bufferSubData(i.ARRAY_BUFFER,0,this.uvArray);var a=r,n=this.texturePool.pop();n||(n=new D.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)),n.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),i.bindFramebuffer(i.FRAMEBUFFER,n.frameBuffer),i.clear(i.COLOR_BUFFER_BIT),i.disable(i.BLEND);for(var h=0,l;h<e.filterPasses.length-1;h++){l=e.filterPasses[h],i.bindFramebuffer(i.FRAMEBUFFER,n.frameBuffer),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a.texture),this.applyFilterPass(l,t,t.width,t.height);var u=a;a=n,n=u}i.enable(i.BLEND),r=a,this.texturePool.push(n)}var c=e.filterPasses[e.filterPasses.length-1];this.offsetX-=t.x,this.offsetY-=t.y;var d=this.width,y=this.height,f=0,p=0,g=this.buffer;if(0===this.filterStack.length)i.colorMask(!0,!0,!0,!0);else{var v=this.filterStack[this.filterStack.length-1];d=(t=v._filterArea).width,y=t.height,f=t.x,p=t.y,g=v._glFilterTexture.frameBuffer}s.x=d/2,s.y=-y/2,o.x=f,o.y=p;var _=(t=e._filterArea).x-f,m=t.y-p;i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=_,this.vertexArray[1]=m+t.height,this.vertexArray[2]=_+t.width,this.vertexArray[3]=m+t.height,this.vertexArray[4]=_,this.vertexArray[5]=m,this.vertexArray[6]=_+t.width,this.vertexArray[7]=m,i.bufferSubData(i.ARRAY_BUFFER,0,this.vertexArray),i.bindBuffer(i.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=t.width/this.width,this.uvArray[5]=t.height/this.height,this.uvArray[6]=t.width/this.width,this.uvArray[7]=t.height/this.height,i.bufferSubData(i.ARRAY_BUFFER,0,this.uvArray),i.viewport(0,0,d*this.renderSession.resolution,y*this.renderSession.resolution),i.bindFramebuffer(i.FRAMEBUFFER,g),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,r.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=e._previous_stencil_mgr,e._previous_stencil_mgr=null,0<this.renderSession.stencilManager.count?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),this.applyFilterPass(c,t,d,y),this.texturePool.push(r),e._glFilterTexture=null},D.WebGLFilterManager.prototype.applyFilterPass=function(n,e,t,r){var i=this.gl,o=n.shaders[i.id];o||((o=new D.PixiShader(i)).fragmentSrc=n.fragmentSrc,o.uniforms=n.uniforms,o.init(!0),n.shaders[i.id]=o),this.renderSession.shaderManager.setShader(o),i.uniform2f(o.projectionVector,t/2,-r/2),i.uniform2f(o.offsetVector,0,0),n.uniforms.dimensions&&(n.uniforms.dimensions.value[0]=this.width,n.uniforms.dimensions.value[1]=this.height,n.uniforms.dimensions.value[2]=this.vertexArray[0],n.uniforms.dimensions.value[3]=this.vertexArray[5]),o.syncUniforms(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.vertexAttribPointer(o.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.uvBuffer),i.vertexAttribPointer(o.aTextureCoord,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.colorBuffer),i.vertexAttribPointer(o.colorAttribute,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0),this.renderSession.drawCount++},D.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},D.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,a.deleteBuffer(this.vertexBuffer),a.deleteBuffer(this.uvBuffer),a.deleteBuffer(this.colorBuffer),a.deleteBuffer(this.indexBuffer)};var m={36054:"Incomplete attachment",36055:"Missing attachment",36057:"Incomplete dimensions",36061:"Framebuffer unsupported"};return D.FilterTexture=function(t,e,r,n,o){o="number"==typeof o?o:0,this.gl=t,this.frameBuffer=l(t,e,r,n||D.scaleModes.DEFAULT,o),this.texture=this.frameBuffer.targetTexture,this.width=e,this.height=r,this.renderBuffer=this.frameBuffer.renderBuffer},D.FilterTexture.prototype.constructor=D.FilterTexture,D.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},D.FilterTexture.prototype.resize=function(a,e){if(this.width!==a||this.height!==e){this.width=a,this.height=e;var t=this.gl;t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,a,e,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,a,e)}},D.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},D.CanvasBuffer=function(a,e){this.width=a,this.height=e,this.canvas=Phaser.CanvasPool.create(this,this.width,this.height),this.context=this.canvas.getContext("2d"),this.canvas.width=a,this.canvas.height=e},D.CanvasBuffer.prototype.constructor=D.CanvasBuffer,D.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height)},D.CanvasBuffer.prototype.resize=function(a,e){this.width=this.canvas.width=a,this.height=this.canvas.height=e},D.CanvasBuffer.prototype.destroy=function(){Phaser.CanvasPool.remove(this)},D.CanvasMaskManager=function(){},D.CanvasMaskManager.prototype.constructor=D.CanvasMaskManager,D.CanvasMaskManager.prototype.pushMask=function(n,e){var t=e.context;t.save();var r=n.alpha,i=n.worldTransform,o=e.resolution;t.setTransform(i.a*o,i.b*o,i.c*o,i.d*o,i.tx*o,i.ty*o),D.CanvasGraphics.renderGraphicsMask(n,t),t.clip(),n.worldAlpha=r},D.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()},D.CanvasTinter=function(){},D.CanvasTinter.getTintedTexture=function(a,e){var t=a.tintedTexture||Phaser.CanvasPool.create(this);return D.CanvasTinter.tintMethod(a.texture,e,t),t},D.CanvasTinter.tintWithMultiply=function(n,e,t){var r=t.getContext("2d"),i=n.crop,s=i.width,o=i.height;n.rotated&&(s=o,o=i.width),t.width===s&&t.height===o||(t.width=s,t.height=o),r.clearRect(0,0,s,o),r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),r.fillRect(0,0,s,o),r.globalCompositeOperation="multiply",r.drawImage(n.baseTexture.source,i.x,i.y,s,o,0,0,s,o),r.globalCompositeOperation="destination-atop",r.drawImage(n.baseTexture.source,i.x,i.y,s,o,0,0,s,o)},D.CanvasTinter.tintWithPerPixel=function(i,e,t){var r=t.getContext("2d"),s=i.crop,o=s.width,a=s.height;i.rotated&&(o=a,a=s.width),t.width===o&&t.height===a||(t.width=o,t.height=a),r.globalCompositeOperation="copy",r.drawImage(i.baseTexture.source,s.x,s.y,o,a,0,0,o,a);for(var n=Phaser.Color.hexToRGBArray(e),m=n[0],l=n[1],u=n[2],c=r.getImageData(0,0,o,a),d=c.data,g=0;g<d.length;g+=4)if(d[g+0]*=m,d[g+1]*=l,d[g+2]*=u,!D.CanvasTinter.canHandleAlpha){var h=d[g+3];d[g+0]/=255/h,d[g+1]/=255/h,d[g+2]/=255/h}r.putImageData(c,0,0)},D.CanvasRenderer=function(a,e){if(this.game=a,D.defaultRenderer||(D.defaultRenderer=this),this.type=Phaser.CANVAS,this.resolution=a.resolution,this.clearBeforeRender=a.clearBeforeRender,this.transparent=a.transparent,this.autoResize=!1,this.width=a.width*this.resolution,this.height=a.height*this.resolution,this.view=a.canvas,this.context=this.view.getContext("2d",{alpha:this.transparent}),!this.context)throw new Error("Failed to create a Canvas 2d context.");this.refresh=!0,this.count=0,this.maskManager=new D.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:e.roundPixels||!1},this.mapBlendModes(),this.resize(this.width,this.height)},D.CanvasRenderer.prototype.constructor=D.CanvasRenderer,D.CanvasRenderer.prototype.render=function(t){this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=0,this.renderSession.shakeX=this.game.camera._shake.x,this.renderSession.shakeY=this.game.camera._shake.y,this.context.globalCompositeOperation="source-over",navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):t._bgColor&&(this.context.fillStyle=t._bgColor.rgba,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t)},D.CanvasRenderer.prototype.setTexturePriority=function(){},D.CanvasRenderer.prototype.destroy=function(t){void 0===t&&(t=!0),t&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},D.CanvasRenderer.prototype.resize=function(a,e){this.width=a*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"),this.renderSession.smoothProperty&&(this.context[this.renderSession.smoothProperty]=this.renderSession.scaleMode===D.scaleModes.LINEAR)},D.CanvasRenderer.prototype.renderDisplayObject=function(a,e,t){this.renderSession.context=e||this.context,this.renderSession.resolution=this.resolution,a._renderCanvas(this.renderSession,t)},D.CanvasRenderer.prototype.mapBlendModes=function(){if(!D.blendModesCanvas){var a=[],e=D.blendModes,t=this.game.device.canUseMultiply;a[e.NORMAL]="source-over",a[e.ADD]="lighter",a[e.MULTIPLY]=t?"multiply":"source-over",a[e.SCREEN]=t?"screen":"source-over",a[e.OVERLAY]=t?"overlay":"source-over",a[e.DARKEN]=t?"darken":"source-over",a[e.LIGHTEN]=t?"lighten":"source-over",a[e.COLOR_DODGE]=t?"color-dodge":"source-over",a[e.COLOR_BURN]=t?"color-burn":"source-over",a[e.HARD_LIGHT]=t?"hard-light":"source-over",a[e.SOFT_LIGHT]=t?"soft-light":"source-over",a[e.DIFFERENCE]=t?"difference":"source-over",a[e.EXCLUSION]=t?"exclusion":"source-over",a[e.HUE]=t?"hue":"source-over",a[e.SATURATION]=t?"saturation":"source-over",a[e.COLOR]=t?"color":"source-over",a[e.LUMINOSITY]=t?"luminosity":"source-over",D.blendModesCanvas=a}},D.BaseTexture=function(a,e,t){this.resolution=t||1,this.width=100,this.height=100,this.scaleMode=e||D.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=a,this.premultipliedAlpha=!0,this._glTextures=[],this.mipmap=!1,this.textureIndex=0,this._dirty=[!0,!0,!0,!0],a&&((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height&&(this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty()),this.skipRender=!1,this._powerOf2=!1)},D.BaseTexture.prototype.constructor=D.BaseTexture,D.BaseTexture.prototype.forceLoaded=function(a,e){this.hasLoaded=!0,this.width=a,this.height=e,this.dirty()},D.BaseTexture.prototype.destroy=function(){this.source&&Phaser.CanvasPool.removeByCanvas(this.source),this.source=null,this.unloadFromGPU()},D.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},D.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var a=this._glTextures.length-1;0<=a;a--){var e=this._glTextures[a],t=D.glContexts[a];t&&e&&t.deleteTexture(e)}this._glTextures.length=0,this.dirty()},D.BaseTexture.fromCanvas=function(a,e,t){return 0===a.width&&(a.width=1),0===a.height&&(a.height=1),t=t||1,new D.BaseTexture(a,e,t)},D.TextureSilentFail=!1,D.Texture=function(a,e,t,r){this.noFrame=!1,e||(this.noFrame=!0,e=new D.Rectangle(0,0,1,1)),a instanceof D.Texture&&(a=a.baseTexture),this.baseTexture=a,this.frame=e,this.trim=r,this.valid=!1,this.isTiling=!1,this.requiresUpdate=!1,this.requiresReTint=!1,this._uvs=null,this.width=0,this.height=0,this.crop=t||new D.Rectangle(0,0,1,1),this.rotated=!1,a.hasLoaded&&(this.noFrame&&(e=new D.Rectangle(0,0,a.width,a.height)),this.setFrame(e))},D.Texture.prototype.constructor=D.Texture,D.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;this.noFrame&&(this.frame=new D.Rectangle(0,0,t.width,t.height)),this.setFrame(this.frame)},D.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy(),this.valid=!1},D.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,this.trim||!(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs();else{if(!D.TextureSilentFail)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=!1}},D.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new D.TextureUvs);var a=this.crop,e=this.baseTexture.width,t=this.baseTexture.height;this._uvs.x0=a.x/e,this._uvs.y0=a.y/t,this._uvs.x1=(a.x+a.width)/e,this._uvs.y1=a.y/t,this._uvs.x2=(a.x+a.width)/e,this._uvs.y2=(a.y+a.height)/t,this._uvs.x3=a.x/e,this._uvs.y3=(a.y+a.height)/t},D.Texture.prototype._updateUvsInverted=function(){this._uvs||(this._uvs=new D.TextureUvs);var a=this.crop,e=this.baseTexture.width,t=this.baseTexture.height;this._uvs.x0=a.x/e,this._uvs.y0=a.y/t,this._uvs.x1=(a.x+a.height)/e,this._uvs.y1=a.y/t,this._uvs.x2=(a.x+a.height)/e,this._uvs.y2=(a.y+a.width)/t,this._uvs.x3=a.x/e,this._uvs.y3=(a.y+a.width)/t},D.Texture.fromCanvas=function(a,e){var t=D.BaseTexture.fromCanvas(a,e);return new D.Texture(t)},D.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},("undefined"!=typeof a&&a.exports&&(o=a.exports=D),o.PIXI=D),D}).call(this)},519:function(e,t,a){(function(t){e.exports=t.p2=a(520)}).call(t,a(45))},520:function(e){var z=Number.MAX_VALUE,m=Math.sin,g=Math.cos,$=Math.abs,x=Math.sqrt,_=Math.ceil,T=Math.pow,d=Math.max,l=Math.min,P=Math.PI,R=Math.floor,t,t;!function(a){e.exports=a()}(function(){return function d(l,e,o){function r(i,a){if(!e[i]){if(!l[i]){var s="function"==typeof t&&t;if(!a&&s)return t(i,!0);if(n)return n(i,!0);throw new Error("Cannot find module '"+i+"'")}var p=e[i]={exports:{}};l[i][0].call(p.exports,function(e){var t=l[i][1][e];return r(t||e)},p,p.exports,d,l,e,o)}return e[i].exports}for(var n="function"==typeof t&&t,i=0;i<o.length;i++)r(o[i]);return r}({1:[function(a,t){function e(){}var d=a("./Scalar");t.exports=e,e.lineInt=function(n,t,e){e=e||0;var o=[0,0],p,i,s,a,r,c,u;return p=n[1][1]-n[0][1],i=n[0][0]-n[1][0],s=p*n[0][0]+i*n[0][1],a=t[1][1]-t[0][1],r=t[0][0]-t[1][0],c=a*t[0][0]+r*t[0][1],u=p*r-a*i,d.eq(u,0,e)||(o[0]=(r*s-i*c)/u,o[1]=(p*c-a*s)/u),o},e.segmentsIntersect=function(d,t,e,o){var i=t[0]-d[0],n=t[1]-d[1],s=o[0]-e[0],a=o[1]-e[1];if(0==s*n-a*i)return!1;var r=(i*(e[1]-d[1])+n*(d[0]-e[0]))/(s*n-a*i),l=(s*(d[1]-e[1])+a*(e[0]-d[0]))/(a*i-s*n);return 0<=r&&1>=r&&0<=l&&1>=l}},{"./Scalar":4}],2:[function(a,t){function d(){}t.exports=d,d.area=function(a,t,e){return(t[0]-a[0])*(e[1]-a[1])-(e[0]-a[0])*(t[1]-a[1])},d.left=function(a,t,e){return 0<d.area(a,t,e)},d.leftOn=function(a,t,e){return 0<=d.area(a,t,e)},d.right=function(a,t,e){return 0>d.area(a,t,e)},d.rightOn=function(a,t,e){return 0>=d.area(a,t,e)};var i=[],n=[];d.collinear=function(s,t,e,o){if(o){var a=i,r=n;a[0]=t[0]-s[0],a[1]=t[1]-s[1],r[0]=e[0]-t[0],r[1]=e[1]-t[1];var c=a[0]*r[0]+a[1]*r[1],u=x(a[0]*a[0]+a[1]*a[1]),l=x(r[0]*r[0]+r[1]*r[1]);return Math.acos(c/(u*l))<o}return 0==d.area(s,t,e)},d.sqdist=function(a,t){var e=t[0]-a[0],r=t[1]-a[1];return e*e+r*r}},{}],3:[function(o,t){function x(){this.vertices=[]}function i(r,t,e,o,i){i=i||0;var d=t[1]-r[1],s=r[0]-t[0],a=d*r[0]+s*r[1],c=o[1]-e[1],g=e[0]-o[0],l=c*e[0]+g*e[1],p=d*g-c*s;return m.eq(p,0,i)?[0,0]:[(g*a-s*l)/p,(d*l-c*a)/p]}var d=o("./Line"),s=o("./Point"),m=o("./Scalar");t.exports=x,x.prototype.at=function(a){var t=this.vertices,e=t.length;return t[0>a?a%e+e:a%e]},x.prototype.first=function(){return this.vertices[0]},x.prototype.last=function(){return this.vertices[this.vertices.length-1]},x.prototype.clear=function(){this.vertices.length=0},x.prototype.append=function(a,t,e){if(void 0===t)throw new Error("From is not given!");if(void 0===e)throw new Error("To is not given!");if(e-1<t)throw new Error("lol1");if(e>a.vertices.length)throw new Error("lol2");if(0>t)throw new Error("lol3");for(var r=t;r<e;r++)this.vertices.push(a.vertices[r])},x.prototype.makeCCW=function(){for(var a=0,t=this.vertices,e=1;e<this.vertices.length;++e)(t[e][1]<t[a][1]||t[e][1]==t[a][1]&&t[e][0]>t[a][0])&&(a=e);s.left(this.at(a-1),this.at(a),this.at(a+1))||this.reverse()},x.prototype.reverse=function(){for(var a=[],t=0,e=this.vertices.length;t!==e;t++)a.push(this.vertices.pop());this.vertices=a},x.prototype.isReflex=function(e){return s.right(this.at(e-1),this.at(e),this.at(e+1))};var a=[],p=[];x.prototype.canSee=function(c,t){var e=a,n=p,r,o;if(s.leftOn(this.at(c+1),this.at(c),this.at(t))&&s.rightOn(this.at(c-1),this.at(c),this.at(t)))return!1;o=s.sqdist(this.at(c),this.at(t));for(var i=0;i!==this.vertices.length;++i)if((i+1)%this.vertices.length!==c&&i!==c&&s.leftOn(this.at(c),this.at(t),this.at(i+1))&&s.rightOn(this.at(c),this.at(t),this.at(i))&&(e[0]=this.at(c),e[1]=this.at(t),n[0]=this.at(i),n[1]=this.at(i+1),r=d.lineInt(e,n),s.sqdist(this.at(c),r)<o))return!1;return!0},x.prototype.copy=function(a,t,e){var r=e||new x;if(r.clear(),a<t)for(o=a;o<=t;o++)r.vertices.push(this.vertices[o]);else{for(o=0;o<=t;o++)r.vertices.push(this.vertices[o]);for(var o=a;o<this.vertices.length;o++)r.vertices.push(this.vertices[o])}return r},x.prototype.getCutEdges=function(){for(var i=[],t=[],e=[],o=new x,n=z,s=0;s<this.vertices.length;++s)if(this.isReflex(s))for(var a=0;a<this.vertices.length;++a)if(this.canSee(s,a)){t=this.copy(s,a,o).getCutEdges(),e=this.copy(a,s,o).getCutEdges();for(var r=0;r<e.length;r++)t.push(e[r]);t.length<n&&(i=t,n=t.length,i.push([this.at(s),this.at(a)]))}return i},x.prototype.decomp=function(){var e=this.getCutEdges();return 0<e.length?this.slice(e):[this]},x.prototype.slice=function(a){if(0==a.length)return[this];if(a instanceof Array&&a.length&&a[0]instanceof Array&&2==a[0].length&&a[0][0]instanceof Array){for(var t=[this],e=0;e<a.length;e++)for(var r=a[e],o=0,n;o<t.length;o++)if(n=t[o].slice(r),n){t.splice(o,1),t.push(n[0],n[1]);break}return t}var r=a,e=this.vertices.indexOf(r[0]),o=this.vertices.indexOf(r[1]);return-1!=e&&-1!=o&&[this.copy(e,o),this.copy(o,e)]},x.prototype.isSimple=function(){for(var a=this.vertices,t=0;t<a.length-1;t++)for(var e=0;e<t-1;e++)if(d.segmentsIntersect(a[t],a[t+1],a[e],a[e+1]))return!1;for(t=1;t<a.length-2;t++)if(d.segmentsIntersect(a[0],a[a.length-1],a[t],a[t+1]))return!1;return!0},x.prototype.quickDecomp=function(a,t,e,o,n,r){n=n||100,r=r||0,o=o||25,a=void 0===a?[]:a,t=t||[],e=e||[];var c=[0,0],h=[0,0],l=[0,0],p=0,u=0,d=0,f=0,v=0,y=0,m=0,g=new x,_=new x,b=this,T=this.vertices;if(3>T.length)return a;if(++r>n)return console.warn("quickDecomp: max level ("+n+") reached."),a;for(var S=0;S<this.vertices.length;++S)if(b.isReflex(S)){for(t.push(b.vertices[S]),p=u=z,E=0;E<this.vertices.length;++E)s.left(b.at(S-1),b.at(S),b.at(E))&&s.rightOn(b.at(S-1),b.at(S),b.at(E-1))&&(l=i(b.at(S-1),b.at(S),b.at(E),b.at(E-1)),s.right(b.at(S+1),b.at(S),l)&&(d=s.sqdist(b.vertices[S],l))<u&&(u=d,h=l,y=E)),s.left(b.at(S+1),b.at(S),b.at(E+1))&&s.rightOn(b.at(S+1),b.at(S),b.at(E))&&(l=i(b.at(S+1),b.at(S),b.at(E),b.at(E+1)),s.left(b.at(S-1),b.at(S),l)&&(d=s.sqdist(b.vertices[S],l))<p&&(p=d,c=l,v=E));if(y==(v+1)%this.vertices.length)l[0]=(h[0]+c[0])/2,l[1]=(h[1]+c[1])/2,e.push(l),S<v?(g.append(b,S,v+1),g.vertices.push(l),_.vertices.push(l),0!=y&&_.append(b,y,b.vertices.length),_.append(b,0,S+1)):(0!=S&&g.append(b,S,b.vertices.length),g.append(b,0,v+1),g.vertices.push(l),_.vertices.push(l),_.append(b,y,S+1));else{if(y>v&&(v+=this.vertices.length),f=z,v<y)return a;for(var E=y;E<=v;++E)s.leftOn(b.at(S-1),b.at(S),b.at(E))&&s.rightOn(b.at(S+1),b.at(S),b.at(E))&&(d=s.sqdist(b.at(S),b.at(E)))<f&&(f=d,m=E%this.vertices.length);S<m?(g.append(b,S,m+1),0!=m&&_.append(b,m,T.length),_.append(b,0,S+1)):(0!=S&&g.append(b,S,T.length),g.append(b,0,m+1),_.append(b,m,S+1))}return g.vertices.length<_.vertices.length?(g.quickDecomp(a,t,e,o,n,r),_.quickDecomp(a,t,e,o,n,r)):(_.quickDecomp(a,t,e,o,n,r),g.quickDecomp(a,t,e,o,n,r)),a}return a.push(this),a},x.prototype.removeCollinearPoints=function(a){for(var t=0,e=this.vertices.length-1;3<this.vertices.length&&0<=e;--e)s.collinear(this.at(e-1),this.at(e),this.at(e+1),a)&&(this.vertices.splice(e%this.vertices.length,1),e--,t++);return t}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(a,t){function e(){}t.exports=e,e.eq=function(a,t,e){return e=e||0,$(a-t)<e}},{}],5:[function(a,t){t.exports={Polygon:a("./Polygon"),Point:a("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(a,t){t.exports={name:"p2",version:"0.7.1",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.1"}}},{}],7:[function(a,t){function e(e){this.lowerBound=y.create(),e&&e.lowerBound&&y.copy(this.lowerBound,e.lowerBound),this.upperBound=y.create(),e&&e.upperBound&&y.copy(this.upperBound,e.upperBound)}var y=a("../math/vec2");a("../utils/Utils"),t.exports=e;var r=y.create();e.prototype.setFromPoints=function(n,t,e,s){var i=this.lowerBound,a=this.upperBound;"number"!=typeof e&&(e=0),0===e?y.copy(i,n[0]):y.rotate(i,n[0],e),y.copy(a,i);for(var x=g(e),c=m(e),h=1,l;h<n.length;h++){if(l=n[h],0!==e){var p=l[0],u=l[1];r[0]=x*p-c*u,r[1]=c*p+x*u,l=r}for(var d=0;2>d;d++)l[d]>a[d]&&(a[d]=l[d]),l[d]<i[d]&&(i[d]=l[d])}t&&(y.add(this.lowerBound,this.lowerBound,t),y.add(this.upperBound,this.upperBound,t)),s&&(this.lowerBound[0]-=s,this.lowerBound[1]-=s,this.upperBound[0]+=s,this.upperBound[1]+=s)},e.prototype.copy=function(e){y.copy(this.lowerBound,e.lowerBound),y.copy(this.upperBound,e.upperBound)},e.prototype.extend=function(a){for(var t=2,e;t--;){e=a.lowerBound[t],this.lowerBound[t]>e&&(this.lowerBound[t]=e);var r=a.upperBound[t];this.upperBound[t]<r&&(this.upperBound[t]=r)}},e.prototype.overlaps=function(a){var t=this.lowerBound,e=this.upperBound,r=a.lowerBound,o=a.upperBound;return(r[0]<=e[0]&&e[0]<=o[0]||t[0]<=o[0]&&o[0]<=e[0])&&(r[1]<=e[1]&&e[1]<=o[1]||t[1]<=o[1]&&o[1]<=e[1])},e.prototype.containsPoint=function(a){var t=this.lowerBound,e=this.upperBound;return t[0]<=a[0]&&a[0]<=e[0]&&t[1]<=a[1]&&a[1]<=e[1]},e.prototype.overlapsRay=function(p){var t=1/p.direction[0],e=1/p.direction[1],o=(this.lowerBound[0]-p.from[0])*t,i=(this.upperBound[0]-p.from[0])*t,n=(this.lowerBound[1]-p.from[1])*e,s=(this.upperBound[1]-p.from[1])*e,a=d(d(l(o,i),l(n,s))),r=l(l(d(o,i),d(n,s)));return 0>r?-1:a>r?-1:a}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(r,t){function d(e){this.type=e,this.result=[],this.world=null,this.boundingVolumeType=d.AABB}var l=r("../math/vec2"),n=r("../objects/Body");t.exports=d,d.AABB=1,d.BOUNDING_CIRCLE=2,d.prototype.setWorld=function(e){this.world=e},d.prototype.getCollisionPairs=function(){};var s=l.create();d.boundingRadiusCheck=function(a,t){l.sub(s,a.position,t.position);var e=l.squaredLength(s),r=a.boundingRadius+t.boundingRadius;return e<=r*r},d.aabbCheck=function(a,t){return a.getAABB().overlaps(t.getAABB())},d.prototype.boundingVolumeCheck=function(a,t){var e;switch(this.boundingVolumeType){case d.BOUNDING_CIRCLE:e=d.boundingRadiusCheck(a,t);break;case d.AABB:e=d.aabbCheck(a,t);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType);}return e},d.canCollide=function(a,t){var e=n.KINEMATIC,r=n.STATIC;return(a.type!==r||t.type!==r)&&(a.type!==e||t.type!==r)&&(a.type!==r||t.type!==e)&&(a.type!==e||t.type!==e)&&(a.sleepState!==n.SLEEPING||t.sleepState!==n.SLEEPING)&&(a.sleepState!==n.SLEEPING||t.type!==r)&&(t.sleepState!==n.SLEEPING||a.type!==r)},d.NAIVE=1,d.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(a,t){function e(){s.call(this,s.NAIVE)}a("../shapes/Circle"),a("../shapes/Plane"),a("../shapes/Shape"),a("../shapes/Particle");var s=a("../collision/Broadphase");a("../math/vec2"),t.exports=e,(e.prototype=new s).constructor=e,e.prototype.getCollisionPairs=function(n){var t=n.bodies,e=this.result;e.length=0;for(var o=0,i=t.length;o!==i;o++)for(var d=t[o],a=0,r;a<o;a++)r=t[a],s.canCollide(d,r)&&this.boundingVolumeCheck(d,r)&&e.push(d,r);return e},e.prototype.aabbQuery=function(a,t,e){e=e||[];for(var r=a.bodies,o=0,n;o<r.length;o++)n=r[o],n.aabbNeedsUpdate&&n.updateAABB(),n.aabb.overlaps(t)&&e.push(n);return e}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(o,t){function ee(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new e({size:32}),this.frictionEquationPool=new r({size:64}),this.restitution=0,this.stiffness=i.DEFAULT_STIFFNESS,this.relaxation=i.DEFAULT_RELAXATION,this.frictionStiffness=i.DEFAULT_STIFFNESS,this.frictionRelaxation=i.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new n,this.contactSkinSize=.01}function te(a,t){re.set(a.vertices[0],.5*-t.length,-t.radius),re.set(a.vertices[1],.5*t.length,-t.radius),re.set(a.vertices[2],.5*t.length,t.radius),re.set(a.vertices[3],.5*-t.length,t.radius)}function ae(r,t,e,o){for(var i=O,n=U,c=k,g=G,l=r,p=t.vertices,u=null,d=0;d!==p.length+1;d++){var h=p[d%p.length],f=p[(d+1)%p.length];re.rotate(i,h,o),re.rotate(n,f,o),oe(i,i,e),oe(n,n,e),a(c,i,l),a(g,n,l);var y=re.crossLength(c,g);if(null===u&&(u=y),0>=y*u)return!1;u=y}return!0}var re=o("../math/vec2"),a=re.sub,oe=re.add,ne=re.dot,e=(o("../utils/Utils"),o("../utils/ContactEquationPool")),r=o("../utils/FrictionEquationPool"),n=o("../utils/TupleDictionary"),i=o("../equations/Equation"),s=(o("../equations/ContactEquation"),o("../equations/FrictionEquation"),o("../shapes/Circle")),d=o("../shapes/Convex"),l=o("../shapes/Shape"),ie=(o("../objects/Body"),o("../shapes/Box"));t.exports=ee;var h=re.fromValues(0,1),se=re.fromValues(0,0),A=re.fromValues(0,0),c=re.fromValues(0,0),b=re.fromValues(0,0),E=re.fromValues(0,0),B=re.fromValues(0,0),q=re.fromValues(0,0),w=re.fromValues(0,0),S=re.fromValues(0,0),de=re.fromValues(0,0),L=re.fromValues(0,0),g=re.fromValues(0,0),le=re.fromValues(0,0),x=re.fromValues(0,0),u=re.fromValues(0,0),M=re.fromValues(0,0),C=re.fromValues(0,0),pe=re.fromValues(0,0),ce=[],p=re.create(),m=re.create();ee.prototype.bodiesOverlap=function(d,t){for(var e=p,o=m,i=0,n=d.shapes.length,s;i!==n;i++){s=d.shapes[i],d.toWorldFrame(e,s.position);for(var a=0,r=t.shapes.length,l;a!==r;a++)if(l=t.shapes[a],t.toWorldFrame(o,l.position),this[s.type|l.type](d,s,e,s.angle+d.angle,t,l,o,l.angle+t.angle,!0))return!0}return!1},ee.prototype.collidedLastStep=function(a,t){var e=0|a.id,r=0|t.id;return!!this.collidingBodiesLastStep.get(e,r)},ee.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var d=this.contactEquations,t=d.length;t--;){var e=d[t],o=e.bodyA.id,i=e.bodyB.id;this.collidingBodiesLastStep.set(o,i,!0)}for(var n=this.contactEquations,s=this.frictionEquations,a=0;a<n.length;a++)this.contactEquationPool.release(n[a]);for(a=0;a<s.length;a++)this.frictionEquationPool.release(s[a]);this.contactEquations.length=this.frictionEquations.length=0},ee.prototype.createContactEquation=function(a,t,e,r){var o=this.contactEquationPool.get();return o.bodyA=a,o.bodyB=t,o.shapeA=e,o.shapeB=r,o.restitution=this.restitution,o.firstImpact=!this.collidedLastStep(a,t),o.stiffness=this.stiffness,o.relaxation=this.relaxation,o.needsUpdate=!0,o.enabled=this.enabledEquations,o.offset=this.contactSkinSize,o},ee.prototype.createFrictionEquation=function(a,t,e,r){var o=this.frictionEquationPool.get();return o.bodyA=a,o.bodyB=t,o.shapeA=e,o.shapeB=r,o.setSlipForce(this.slipForce),o.frictionCoefficient=this.frictionCoefficient,o.relativeVelocity=this.surfaceVelocity,o.enabled=this.enabledEquations,o.needsUpdate=!0,o.stiffness=this.frictionStiffness,o.relaxation=this.frictionRelaxation,o.contactEquations.length=0,o},ee.prototype.createFrictionFromContact=function(a){var t=this.createFrictionEquation(a.bodyA,a.bodyB,a.shapeA,a.shapeB);return re.copy(t.contactPointA,a.contactPointA),re.copy(t.contactPointB,a.contactPointB),re.rotate90cw(t.t,a.normalA),t.contactEquations.push(a),t},ee.prototype.createFrictionFromAverage=function(a){var t=this.contactEquations[this.contactEquations.length-1],e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB),r=t.bodyA;t.bodyB,re.set(e.contactPointA,0,0),re.set(e.contactPointB,0,0),re.set(e.t,0,0);for(var o=0;o!==a;o++)(t=this.contactEquations[this.contactEquations.length-1-o]).bodyA===r?(re.add(e.t,e.t,t.normalA),re.add(e.contactPointA,e.contactPointA,t.contactPointA),re.add(e.contactPointB,e.contactPointB,t.contactPointB)):(re.sub(e.t,e.t,t.normalA),re.add(e.contactPointA,e.contactPointA,t.contactPointB),re.add(e.contactPointB,e.contactPointB,t.contactPointA)),e.contactEquations.push(t);var n=1/a;return re.scale(e.contactPointA,e.contactPointA,n),re.scale(e.contactPointB,e.contactPointB,n),re.normalize(e.t,e.t),re.rotate90cw(e.t,e.t),e},ee.prototype[l.LINE|l.CONVEX]=ee.prototype.convexLine=function(){},ee.prototype[l.LINE|l.BOX]=ee.prototype.lineBox=function(){};var y=new ie({width:1,height:1}),v=re.create();ee.prototype[l.CAPSULE|l.CONVEX]=ee.prototype[l.CAPSULE|l.BOX]=ee.prototype.convexCapsule=function(a,t,e,o,n,i,r,s,c){var l=v;re.set(l,i.length/2,0),re.rotate(l,l,s),re.add(l,l,r);var p=this.circleConvex(n,i,l,s,a,t,e,o,c,i.radius);re.set(l,-i.length/2,0),re.rotate(l,l,s),re.add(l,l,r);var u=this.circleConvex(n,i,l,s,a,t,e,o,c,i.radius);if(c&&(p||u))return!0;var d=y;return te(d,i),this.convexConvex(a,t,e,o,n,d,r,s,c)+p+u},ee.prototype[l.CAPSULE|l.LINE]=ee.prototype.lineCapsule=function(){};var I=re.create(),D=re.create(),F=new ie({width:1,height:1});ee.prototype[l.CAPSULE|l.CAPSULE]=ee.prototype.capsuleCapsule=function(a,t,e,o,n,i,r,s,c){for(var l=I,p=D,u=0,d=0;2>d;d++){re.set(l,(0===d?-1:1)*t.length/2,0),re.rotate(l,l,o),re.add(l,l,e);for(var h=0;2>h;h++){re.set(p,(0===h?-1:1)*i.length/2,0),re.rotate(p,p,s),re.add(p,p,r),this.enableFrictionReduction&&(g=this.enableFriction,this.enableFriction=!1);var f=this.circleCircle(a,t,l,o,n,i,p,s,c,t.radius,i.radius);if(this.enableFrictionReduction&&(this.enableFriction=g),c&&f)return!0;u+=f}}this.enableFrictionReduction&&(g=this.enableFriction,this.enableFriction=!1);var y=F;te(y,t);var m=this.convexCapsule(a,y,e,o,n,i,r,s,c);if(this.enableFrictionReduction&&(this.enableFriction=g),c&&m)return!0;if(u+=m,this.enableFrictionReduction){var g=this.enableFriction;this.enableFriction=!1}te(y,i);var x=this.convexCapsule(n,y,r,s,a,t,e,o,c);return this.enableFrictionReduction&&(this.enableFriction=g),c&&x||(u+=x,this.enableFrictionReduction&&u&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(u)),u)},ee.prototype[l.LINE|l.LINE]=ee.prototype.lineLine=function(){},ee.prototype[l.PLANE|l.LINE]=ee.prototype.planeLine=function(r,t,e,o,i,n,s,l,p){var g=se,d=A,f=c,v=b,y=E,m=B,_=q,x=w,C=ce,P=0;re.set(g,-n.length/2,0),re.set(d,n.length/2,0),re.rotate(f,g,l),re.rotate(v,d,l),oe(f,f,s),oe(v,v,s),re.copy(g,f),re.copy(d,v),a(y,d,g),re.normalize(m,y),re.rotate90cw(S,m),re.rotate(x,h,o),C[0]=g,C[1]=d;for(var R=0,M;R<C.length;R++){M=C[R],a(_,M,e);var T=ne(_,x);if(0>T){if(p)return!0;var L=this.createContactEquation(r,i,t,n);P++,re.copy(L.normalA,x),re.normalize(L.normalA,L.normalA),re.scale(_,x,T),a(L.contactPointA,M,_),a(L.contactPointA,L.contactPointA,r.position),a(L.contactPointB,M,s),oe(L.contactPointB,L.contactPointB,s),a(L.contactPointB,L.contactPointB,i.position),this.contactEquations.push(L),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L))}}return!p&&(this.enableFrictionReduction||P&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(P)),P)},ee.prototype[l.PARTICLE|l.CAPSULE]=ee.prototype.particleCapsule=function(d,t,e,o,i,n,s,a,r){return this.circleLine(d,t,e,o,i,n,s,a,r,n.radius,0)},ee.prototype[l.CIRCLE|l.LINE]=ee.prototype.circleLine=function(r,t,e,o,i,n,s,l,p,h,C){var h=h||0,C=void 0===C?t.radius:C,f=se,v=A,y=c,m=E,P=B,R=q,M=w,I=S,F=de,O=L,U=g,_=le,D=x,k=ce;re.set(M,-n.length/2,0),re.set(I,n.length/2,0),re.rotate(F,M,l),re.rotate(O,I,l),oe(F,F,s),oe(O,O,s),re.copy(M,F),re.copy(I,O),a(P,I,M),re.normalize(R,P),re.rotate90cw(m,R),a(U,e,M);var G=ne(U,m);a(b,M,s),a(_,e,s);var N=C+h;if($(G)<N){re.scale(f,m,G),a(y,e,f),re.scale(v,m,ne(m,_)),re.normalize(v,v),re.scale(v,v,h),oe(y,y,v);var z=ne(R,y),W=ne(R,M),V=ne(R,I);if(z>W&&z<V)return!!p||(j=this.createContactEquation(r,i,t,n),re.scale(j.normalA,f,-1),re.normalize(j.normalA,j.normalA),re.scale(j.contactPointA,j.normalA,C),oe(j.contactPointA,j.contactPointA,e),a(j.contactPointA,j.contactPointA,r.position),a(j.contactPointB,y,s),oe(j.contactPointB,j.contactPointB,s),a(j.contactPointB,j.contactPointB,i.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1)}k[0]=M,k[1]=I;for(var H=0,X;H<k.length;H++)if(X=k[H],a(U,X,e),re.squaredLength(U)<T(N,2)){if(p)return!0;var j=this.createContactEquation(r,i,t,n);return re.copy(j.normalA,U),re.normalize(j.normalA,j.normalA),re.scale(j.contactPointA,j.normalA,C),oe(j.contactPointA,j.contactPointA,e),a(j.contactPointA,j.contactPointA,r.position),a(j.contactPointB,X,s),re.scale(D,j.normalA,-h),oe(j.contactPointB,j.contactPointB,D),oe(j.contactPointB,j.contactPointB,s),a(j.contactPointB,j.contactPointB,i.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1}return 0},ee.prototype[l.CIRCLE|l.CAPSULE]=ee.prototype.circleCapsule=function(d,t,e,o,i,n,s,a,r){return this.circleLine(d,t,e,o,i,n,s,a,r,n.radius)},ee.prototype[l.CIRCLE|l.CONVEX]=ee.prototype[l.CIRCLE|l.BOX]=ee.prototype.circleConvex=function(r,t,e,o,i,n,s,l,p,h){for(var h="number"==typeof h?h:t.radius,R=se,f=A,v=c,y=b,m=E,g=de,P=L,w=le,S=x,C=u,B=M,I=!1,F=z,G=n.vertices,O=0;O!==G.length+1;O++){var U=G[O%G.length],k=G[(O+1)%G.length];if(re.rotate(R,U,l),re.rotate(f,k,l),oe(R,R,s),oe(f,f,s),a(v,f,R),re.normalize(y,v),re.rotate90cw(m,y),re.scale(S,m,-t.radius),oe(S,S,e),ae(S,n,s,l)){re.sub(C,R,S);var _=$(re.dot(C,m));_<F&&(re.copy(B,S),F=_,re.scale(w,m,_),re.add(w,w,S),I=!0)}}if(I)return!!p||(N=this.createContactEquation(r,i,t,n),re.sub(N.normalA,B,e),re.normalize(N.normalA,N.normalA),re.scale(N.contactPointA,N.normalA,h),oe(N.contactPointA,N.contactPointA,e),a(N.contactPointA,N.contactPointA,r.position),a(N.contactPointB,w,s),oe(N.contactPointB,N.contactPointB,s),a(N.contactPointB,N.contactPointB,i.position),this.contactEquations.push(N),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(N)),1);if(0<h)for(O=0;O<G.length;O++){var D=G[O];if(re.rotate(P,D,l),oe(P,P,s),a(g,P,e),re.squaredLength(g)<T(h,2)){if(p)return!0;var N=this.createContactEquation(r,i,t,n);return re.copy(N.normalA,g),re.normalize(N.normalA,N.normalA),re.scale(N.contactPointA,N.normalA,h),oe(N.contactPointA,N.contactPointA,e),a(N.contactPointA,N.contactPointA,r.position),a(N.contactPointB,P,s),oe(N.contactPointB,N.contactPointB,s),a(N.contactPointB,N.contactPointB,i.position),this.contactEquations.push(N),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(N)),1}}return 0};var O=re.create(),U=re.create(),k=re.create(),G=re.create();ee.prototype[l.PARTICLE|l.CONVEX]=ee.prototype[l.PARTICLE|l.BOX]=ee.prototype.particleConvex=function(r,t,e,o,i,n,s,l,p){var d=se,u=A,h=c,y=b,m=E,g=de,f=le,x=C,v=pe,T=z,S=!1,P=n.vertices;if(!ae(e,n,s,l))return 0;if(p)return!0;for(var w=0;w!==P.length+1;w++){var R=P[w%P.length],M=P[(w+1)%P.length];re.rotate(d,R,l),re.rotate(u,M,l),oe(d,d,s),oe(u,u,s),a(h,u,d),re.normalize(y,h),re.rotate90cw(m,y),a(g,e,d),ne(g,m),a(B,d,s),a(q,e,s),re.sub(x,d,e);var _=$(re.dot(x,m));_<T&&(T=_,re.scale(f,m,_),re.add(f,f,e),re.copy(v,m),S=!0)}if(S){var L=this.createContactEquation(r,i,t,n);return re.scale(L.normalA,v,-1),re.normalize(L.normalA,L.normalA),re.set(L.contactPointA,0,0),oe(L.contactPointA,L.contactPointA,e),a(L.contactPointA,L.contactPointA,r.position),a(L.contactPointB,f,s),oe(L.contactPointB,L.contactPointB,s),a(L.contactPointB,L.contactPointB,i.position),this.contactEquations.push(L),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(L)),1}return 0},ee.prototype[l.CIRCLE]=ee.prototype.circleCircle=function(r,t,e,o,i,n,s,c,l,p,u){var m=se,p=p||t.radius,u=u||n.radius;a(m,e,s);var g=p+u;if(re.squaredLength(m)>T(g,2))return 0;if(l)return!0;var h=this.createContactEquation(r,i,t,n);return a(h.normalA,s,e),re.normalize(h.normalA,h.normalA),re.scale(h.contactPointA,h.normalA,p),re.scale(h.contactPointB,h.normalA,-u),oe(h.contactPointA,h.contactPointA,e),a(h.contactPointA,h.contactPointA,r.position),oe(h.contactPointB,h.contactPointB,s),a(h.contactPointB,h.contactPointB,i.position),this.contactEquations.push(h),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(h)),1},ee.prototype[l.PLANE|l.CONVEX]=ee.prototype[l.PLANE|l.BOX]=ee.prototype.planeConvex=function(r,t,e,o,i,n,s,l,p){var u=se,d=A,g=c,f=0;re.rotate(d,h,o);for(var y=0,m;y!==n.vertices.length;y++)if(m=n.vertices[y],re.rotate(u,m,l),oe(u,u,s),a(g,u,e),0>=ne(g,d)){if(p)return!0;f++;var x=this.createContactEquation(r,i,t,n);a(g,u,e),re.copy(x.normalA,d);var v=ne(g,x.normalA);re.scale(g,x.normalA,v),a(x.contactPointB,u,i.position),a(x.contactPointA,u,g),a(x.contactPointA,x.contactPointA,r.position),this.contactEquations.push(x),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x))}return this.enableFrictionReduction&&this.enableFriction&&f&&this.frictionEquations.push(this.createFrictionFromAverage(f)),f},ee.prototype[l.PARTICLE|l.PLANE]=ee.prototype.particlePlane=function(r,t,e,o,i,n,s,c,l){var p=se,u=A;c=c||0,a(p,e,s),re.rotate(u,h,c);var d=ne(p,u);if(0<d)return 0;if(l)return!0;var m=this.createContactEquation(i,r,n,t);return re.copy(m.normalA,u),re.scale(p,m.normalA,d),a(m.contactPointA,e,p),a(m.contactPointA,m.contactPointA,i.position),a(m.contactPointB,e,r.position),this.contactEquations.push(m),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(m)),1},ee.prototype[l.CIRCLE|l.PARTICLE]=ee.prototype.circleParticle=function(r,t,e,o,i,n,s,c,l){var p=se;if(a(p,s,e),re.squaredLength(p)>T(t.radius,2))return 0;if(l)return!0;var u=this.createContactEquation(r,i,t,n);return re.copy(u.normalA,p),re.normalize(u.normalA,u.normalA),re.scale(u.contactPointA,u.normalA,t.radius),oe(u.contactPointA,u.contactPointA,e),a(u.contactPointA,u.contactPointA,r.position),a(u.contactPointB,s,i.position),this.contactEquations.push(u),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(u)),1};var N=new s({radius:1}),W=re.create(),H=re.create();re.create(),ee.prototype[l.PLANE|l.CAPSULE]=ee.prototype.planeCapsule=function(a,t,e,o,i,n,s,r,c){var l=W,p=H,u=N;re.set(l,-n.length/2,0),re.rotate(l,l,r),oe(l,l,s),re.set(p,n.length/2,0),re.rotate(p,p,r),oe(p,p,s),u.radius=n.radius;var d;this.enableFrictionReduction&&(d=this.enableFriction,this.enableFriction=!1);var g=this.circlePlane(i,u,l,0,a,t,e,o,c),h=this.circlePlane(i,u,p,0,a,t,e,o,c);if(this.enableFrictionReduction&&(this.enableFriction=d),c)return g||h;var y=g+h;return this.enableFrictionReduction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},ee.prototype[l.CIRCLE|l.PLANE]=ee.prototype.circlePlane=function(r,t,e,o,i,n,s,l,p){var u=r,d=t,g=e,f=i,y=s,m=l;m=m||0;var x=se,v=A,_=c;a(x,g,y),re.rotate(v,h,m);var b=ne(v,x);if(b>d.radius)return 0;if(p)return!0;var T=this.createContactEquation(f,u,n,t);return re.copy(T.normalA,v),re.scale(T.contactPointB,T.normalA,-d.radius),oe(T.contactPointB,T.contactPointB,g),a(T.contactPointB,T.contactPointB,u.position),re.scale(_,T.normalA,b),a(T.contactPointA,x,_),oe(T.contactPointA,T.contactPointA,y),a(T.contactPointA,T.contactPointA,f.position),this.contactEquations.push(T),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(T)),1},ee.prototype[l.CONVEX]=ee.prototype[l.CONVEX|l.BOX]=ee.prototype[l.BOX]=ee.prototype.convexConvex=function(r,t,e,o,n,i,s,l,p,d){var u=se,h=A,y=c,m=b,g=E,v=q,C=w,x=S,P=0,d="number"==typeof d?d:0;if(!ee.findSeparatingAxis(t,e,o,i,s,l,u))return 0;a(C,s,e),0<ne(u,C)&&re.scale(u,u,-1);var M=ee.getClosestEdge(t,o,u,!0),L=ee.getClosestEdge(i,l,u);if(-1===M||-1===L)return 0;for(var R=0;2>R;R++){var B=M,T=L,I=t,F=i,O=e,U=s,k=o,_=l,D=r,G=n;if(0===R){var N;N=B,B=T,T=N,N=I,I=F,F=N,N=O,O=U,U=N,N=k,k=_,_=N,N=D,D=G,G=N}for(var W=T,z;W<T+2;W++){z=F.vertices[(W+F.vertices.length)%F.vertices.length],re.rotate(h,z,_),oe(h,h,U);for(var V=0,X=B-1;X<B+2;X++){var H=I.vertices[(X+I.vertices.length)%I.vertices.length],j=I.vertices[(X+1+I.vertices.length)%I.vertices.length];re.rotate(y,H,k),re.rotate(m,j,k),oe(y,y,O),oe(m,m,O),a(g,m,y),re.rotate90cw(x,g),re.normalize(x,x),a(C,h,y),K=ne(x,C),(X===B&&K<=d||X!==B&&0>=K)&&V++}if(3<=V){if(p)return!0;var Y=this.createContactEquation(D,G,I,F);P++;var H=I.vertices[B%I.vertices.length],j=I.vertices[(B+1)%I.vertices.length];re.rotate(y,H,k),re.rotate(m,j,k),oe(y,y,O),oe(m,m,O),a(g,m,y),re.rotate90cw(Y.normalA,g),re.normalize(Y.normalA,Y.normalA),a(C,h,y);var K=ne(Y.normalA,C);re.scale(v,Y.normalA,K),a(Y.contactPointA,h,O),a(Y.contactPointA,Y.contactPointA,v),oe(Y.contactPointA,Y.contactPointA,O),a(Y.contactPointA,Y.contactPointA,D.position),a(Y.contactPointB,h,U),oe(Y.contactPointB,Y.contactPointB,U),a(Y.contactPointB,Y.contactPointB,G.position),this.contactEquations.push(Y),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Y))}}}return this.enableFrictionReduction&&this.enableFriction&&P&&this.frictionEquations.push(this.createFrictionFromAverage(P)),P};var V=re.fromValues(0,0);ee.projectConvexOntoAxis=function(a,t,e,m,i){var n=null,c=null,l=V,p,s;re.rotate(l,m,-e);for(var r=0;r<a.vertices.length;r++)p=a.vertices[r],s=ne(p,l),(null===n||s>n)&&(n=s),(null===c||s<c)&&(c=s);if(c>n){var u=c;c=n,n=u}var d=ne(t,m);re.set(i,c+d,n+d)};var X=re.fromValues(0,0),j=re.fromValues(0,0),Y=re.fromValues(0,0),K=re.fromValues(0,0),Z=re.fromValues(0,0),J=re.fromValues(0,0);ee.findSeparatingAxis=function(r,t,e,o,n,i,s){var c=null,l=!1,p=!1,u=X,d=j,m=Y,h=K,y=Z,g=J;if(r instanceof ie&&o instanceof ie)for(b=0;2!==b;b++){var f=r,x=e;for(1===b&&(f=o,x=i),T=0;2!==T;T++){0===T?re.set(h,0,1):1===T&&re.set(h,1,0),0!==x&&re.rotate(h,h,x),ee.projectConvexOntoAxis(r,t,e,h,y),ee.projectConvexOntoAxis(o,n,i,h,g);var v=y,_=g;y[0]>g[0]&&(_=y,v=g,!0),l=0>=(E=_[0]-v[1]),(null===c||E>c)&&(re.copy(s,h),c=E,p=l)}}else for(var b=0;2!==b;b++){var f=r,x=e;1===b&&(f=o,x=i);for(var T=0;T!==f.vertices.length;T++){re.rotate(d,f.vertices[T],x),re.rotate(m,f.vertices[(T+1)%f.vertices.length],x),a(u,m,d),re.rotate90cw(h,u),re.normalize(h,h),ee.projectConvexOntoAxis(r,t,e,h,y),ee.projectConvexOntoAxis(o,n,i,h,g);var v=y,_=g;y[0]>g[0]&&(_=y,v=g,!0);var E=_[0]-v[1];l=0>=E,(null===c||E>c)&&(re.copy(s,h),c=E,p=l)}}return p};var Q=re.fromValues(0,0),ue=re.fromValues(0,0),me=re.fromValues(0,0);ee.getClosestEdge=function(r,t,m,o){var i=Q,n=ue,s=me;re.rotate(i,m,-t),o&&re.scale(i,i,-1);for(var c=-1,l=r.vertices.length,p=-1,u=0;u!==l;u++){a(n,r.vertices[(u+1)%l],r.vertices[u%l]),re.rotate90cw(s,n),re.normalize(s,s);var d=ne(s,i);(-1==c||d>p)&&(c=u%l,p=d)}return c};var ge=re.create(),he=re.create(),ye=re.create(),fe=re.create(),xe=re.create(),ve=re.create(),_e=re.create();ee.prototype[l.CIRCLE|l.HEIGHTFIELD]=ee.prototype.circleHeightfield=function(r,t,e,o,i,n,s,c,l,p){var h=n.heights,p=p||t.radius,d=n.elementWidth,f=he,v=ge,y=xe,m=_e,g=ve,A=ye,b=fe,E=R((e[0]-p-s[0])/d),M=_((e[0]+p-s[0])/d);0>E&&(E=0),M>=h.length&&(M=h.length-1);for(var B=h[E],D=h[M],w=E;w<M;w++)h[w]<D&&(D=h[w]),h[w]>B&&(B=h[w]);if(!(e[1]-p>B)){for(var S=!1,w=E;w<M;w++){re.set(A,w*d,h[w]),re.set(b,(w+1)*d,h[w+1]),re.add(A,A,s),re.add(b,b,s),re.sub(g,b,A),re.rotate(g,g,P/2),re.normalize(g,g),re.scale(v,g,-p),re.add(v,v,e),re.sub(f,v,A);var C=re.dot(f,g);if(v[0]>=A[0]&&v[0]<b[0]&&0>=C){if(l)return!0;S=!0,re.scale(f,g,-C),re.add(y,v,f),re.copy(m,g),I=this.createContactEquation(i,r,n,t),re.copy(I.normalA,m),re.scale(I.contactPointB,I.normalA,-p),oe(I.contactPointB,I.contactPointB,e),a(I.contactPointB,I.contactPointB,r.position),re.copy(I.contactPointA,y),re.sub(I.contactPointA,I.contactPointA,i.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I))}}if(S=!1,0<p)for(w=E;w<=M;w++)if(re.set(A,w*d,h[w]),re.add(A,A,s),re.sub(f,e,A),re.squaredLength(f)<T(p,2)){if(l)return!0;S=!0;var I=this.createContactEquation(i,r,n,t);re.copy(I.normalA,f),re.normalize(I.normalA,I.normalA),re.scale(I.contactPointB,I.normalA,-p),oe(I.contactPointB,I.contactPointB,e),a(I.contactPointB,I.contactPointB,r.position),a(I.contactPointA,A,s),oe(I.contactPointA,I.contactPointA,s),a(I.contactPointA,I.contactPointA,i.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I))}return S?1:0}};var be=re.create(),Te=re.create(),Se=re.create(),Ee=new d({vertices:[re.create(),re.create(),re.create(),re.create()]});ee.prototype[l.BOX|l.HEIGHTFIELD]=ee.prototype[l.CONVEX|l.HEIGHTFIELD]=ee.prototype.convexHeightfield=function(a,t,e,o,i,n,s,r,c){var h=n.heights,l=n.elementWidth,p=be,u=Te,d=Se,f=Ee,x=R((a.aabb.lowerBound[0]-s[0])/l),y=_((a.aabb.upperBound[0]-s[0])/l);0>x&&(x=0),y>=h.length&&(y=h.length-1);for(var m=h[x],g=h[y],v=x;v<y;v++)h[v]<g&&(g=h[v]),h[v]>m&&(m=h[v]);if(!(a.aabb.lowerBound[1]>m)){for(var b=0,v=x;v<y;v++)re.set(p,v*l,h[v]),re.set(u,(v+1)*l,h[v+1]),re.add(p,p,s),re.add(u,u,s),re.set(d,.5*(u[0]+p[0]),.5*(u[1]+p[1]-100)),re.sub(f.vertices[0],u,d),re.sub(f.vertices[1],p,d),re.copy(f.vertices[2],f.vertices[1]),re.copy(f.vertices[3],f.vertices[0]),f.vertices[2][1]-=100,f.vertices[3][1]-=100,b+=this.convexConvex(a,t,e,o,i,f,d,0,c);return b}}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(o,t){function p(e){e=e||{},this.from=e.from?m.fromValues(e.from[0],e.from[1]):m.create(),this.to=e.to?m.fromValues(e.to[0],e.to[1]):m.create(),this.checkCollisionResponse=void 0===e.checkCollisionResponse||e.checkCollisionResponse,this.skipBackfaces=!!e.skipBackfaces,this.collisionMask=void 0===e.collisionMask?-1:e.collisionMask,this.collisionGroup=void 0===e.collisionGroup?-1:e.collisionGroup,this.mode=void 0===e.mode?p.ANY:e.mode,this.callback=e.callback||function(){},this.direction=m.create(),this.length=1,this.update()}function u(n,t,e){m.sub(a,e,n);var o=m.dot(a,t);return m.scale(r,t,o),m.add(r,r,n),m.squaredDistance(e,r)}t.exports=p;var m=o("../math/vec2");o("../collision/RaycastResult"),o("../shapes/Shape"),o("../collision/AABB"),p.prototype.constructor=p,p.CLOSEST=1,p.ANY=2,p.ALL=4,p.prototype.update=function(){var e=this.direction;m.sub(e,this.to,this.from),this.length=m.length(e),m.normalize(e,e)},p.prototype.intersectBodies=function(a,t){for(var e=0,r=t.length;!a.shouldStop(this)&&e<r;e++){var o=t[e],n=o.getAABB();(0<=n.overlapsRay(this)||n.containsPoint(this.from))&&this.intersectBody(a,o)}};var s=m.create();p.prototype.intersectBody=function(a,t){var e=this.checkCollisionResponse;if(!e||t.collisionResponse)for(var d=s,i=0,n=t.shapes.length,r;i<n;i++)if(r=t.shapes[i],(!e||r.collisionResponse)&&0!=(this.collisionGroup&r.collisionMask)&&0!=(r.collisionGroup&this.collisionMask)){m.rotate(d,r.position,t.angle),m.add(d,d,t.position);var l=r.angle+t.angle;if(this.intersectShape(a,r,l,d,t),a.shouldStop(this))break}},p.prototype.intersectShape=function(a,t,e,r,o){u(this.from,this.direction,r)>t.boundingRadius*t.boundingRadius||(this._currentBody=o,this._currentShape=t,t.raycast(a,this,r,e),this._currentBody=this._currentShape=null)},p.prototype.getAABB=function(a){var t=this.to,e=this.from;m.set(a.lowerBound,l(t[0],e[0]),l(t[1],e[1])),m.set(a.upperBound,d(t[0],e[0]),d(t[1],e[1]))},m.create(),p.prototype.reportIntersection=function(i,t,e,o){this.from,this.to;var n=this._currentShape,a=this._currentBody;if(!(this.skipBackfaces&&0<m.dot(e,this.direction)))switch(this.mode){case p.ALL:i.set(e,n,a,t,o),this.callback(i);break;case p.CLOSEST:(t<i.fraction||!i.hasHit())&&i.set(e,n,a,t,o);break;case p.ANY:i.set(e,n,a,t,o);}};var a=m.create(),r=m.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(a,t){function e(){this.normal=r.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var r=a("../math/vec2"),o=a("../collision/Ray");t.exports=e,e.prototype.reset=function(){r.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},e.prototype.getHitDistance=function(e){return r.distance(e.from,e.to)*this.fraction},e.prototype.hasHit=function(){return-1!==this.fraction},e.prototype.getHitPoint=function(a,t){r.lerp(a,t.from,t.to,this.fraction)},e.prototype.stop=function(){this.isStopped=!0},e.prototype.shouldStop=function(e){return this.isStopped||-1!==this.fraction&&e.mode===o.ANY},e.prototype.set=function(a,t,e,o,n){r.copy(this.normal,a),this.shape=t,this.body=e,this.fraction=o,this.faceIndex=n}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(a,t){function r(){n.call(this,n.SAP),this.axisList=[],this.axisIndex=0;var a=this;this._addBodyHandler=function(t){a.axisList.push(t.body)},this._removeBodyHandler=function(t){var e=a.axisList.indexOf(t.body);-1!==e&&a.axisList.splice(e,1)}}var e=a("../utils/Utils"),n=a("../collision/Broadphase");t.exports=r,(r.prototype=new n).constructor=r,r.prototype.setWorld=function(a){this.axisList.length=0,e.appendArray(this.axisList,a.bodies),a.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),a.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=a},r.sortAxisList=function(a,t){t|=0;for(var e=1,r=a.length;e<r;e++){for(var o=a[e],n=e-1;0<=n&&!(a[n].aabb.lowerBound[t]<=o.aabb.lowerBound[t]);n--)a[n+1]=a[n];a[n+1]=o}return a},r.prototype.sortList=function(){var a=this.axisList,t=this.axisIndex;r.sortAxisList(a,t)},r.prototype.getCollisionPairs=function(){var t=this.axisList,e=this.result,o=this.axisIndex;e.length=0;for(var i=t.length,s;i--;)s=t[i],s.aabbNeedsUpdate&&s.updateAABB();this.sortList();for(var a=0,r=0|t.length;a!==r;a++)for(var d=t[a],c=a+1,l;c<r&&(l=t[c],!!(l.aabb.lowerBound[o]<=d.aabb.upperBound[o]));c++)n.canCollide(d,l)&&this.boundingVolumeCheck(d,l)&&e.push(d,l);return e},r.prototype.aabbQuery=function(d,t,e){e=e||[],this.sortList();var o=this.axisIndex,i="x";1===o&&(i="y"),2===o&&(i="z");for(var n=this.axisList,s=(t.lowerBound[i],t.upperBound[i],0),a;s<n.length;s++)a=n[s],a.aabbNeedsUpdate&&a.updateAABB(),a.aabb.overlaps(t)&&e.push(a);return e}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(a,t){function e(a,t,e,o){this.type=e,o=r.defaults(o,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=a,this.bodyB=t,this.collideConnected=o.collideConnected,o.wakeUpBodies&&(a&&a.wakeUp(),t&&t.wakeUp())}t.exports=e;var r=a("../utils/Utils");e.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},e.DISTANCE=1,e.GEAR=2,e.LOCK=3,e.PRISMATIC=4,e.REVOLUTE=5,e.prototype.setStiffness=function(a){for(var t=this.equations,e=0,r;e!==t.length;e++)r=t[e],r.stiffness=a,r.needsUpdate=!0},e.prototype.setRelaxation=function(a){for(var t=this.equations,e=0,r;e!==t.length;e++)r=t[e],r.relaxation=a,r.needsUpdate=!0}},{"../utils/Utils":57}],15:[function(o,t){function e(r,t,e){e=a.defaults(e,{localAnchorA:[0,0],localAnchorB:[0,0]}),m.call(this,r,t,m.DISTANCE,e),this.localAnchorA=g.fromValues(e.localAnchorA[0],e.localAnchorA[1]),this.localAnchorB=g.fromValues(e.localAnchorB[0],e.localAnchorB[1]);var s=this.localAnchorA,x=this.localAnchorB;if(this.distance=0,"number"==typeof e.distance)this.distance=e.distance;else{var o=g.create(),c=g.create(),l=g.create();g.rotate(o,s,r.angle),g.rotate(c,x,t.angle),g.add(l,t.position,c),g.sub(l,l,o),g.sub(l,l,r.position),this.distance=g.length(l)}var p=void 0===e.maxForce?z:e.maxForce;var h=new n(r,t,-p,p);this.equations=[h],this.maxForce=p;var l=g.create(),d=g.create(),f=g.create(),v=this;h.computeGq=function(){var a=this.bodyA,t=this.bodyB,e=a.position,r=t.position;return g.rotate(d,s,a.angle),g.rotate(f,x,t.angle),g.add(l,r,f),g.sub(l,l,d),g.sub(l,l,e),g.length(l)-v.distance},this.setMaxForce(p),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var m=o("./Constraint"),n=o("../equations/Equation"),g=o("../math/vec2"),a=o("../utils/Utils");t.exports=e,(e.prototype=new m).constructor=e;var y=g.create(),c=g.create(),h=g.create();e.prototype.update=function(){var a=this.equations[0],t=this.bodyA,e=this.bodyB,o=(this.distance,t.position),i=e.position,n=this.equations[0],s=a.G;g.rotate(c,this.localAnchorA,t.angle),g.rotate(h,this.localAnchorB,e.angle),g.add(y,i,h),g.sub(y,y,c),g.sub(y,y,o),this.position=g.length(y);var r=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(n.maxForce=0,n.minForce=-this.maxForce,this.distance=this.upperLimit,r=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(n.maxForce=this.maxForce,n.minForce=0,this.distance=this.lowerLimit,r=!0),!this.lowerLimitEnabled&&!this.upperLimitEnabled||r){n.enabled=!0,g.normalize(y,y);var l=g.crossLength(c,y),p=g.crossLength(h,y);s[0]=-y[0],s[1]=-y[1],s[2]=-l,s[3]=y[0],s[4]=y[1],s[5]=p}else n.enabled=!1},e.prototype.setMaxForce=function(a){var r=this.equations[0];r.minForce=-a,r.maxForce=a},e.prototype.getMaxForce=function(){return this.equations[0].maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(a,t){function e(a,t,e){e=e||{},r.call(this,a,t,r.GEAR,e),this.ratio=void 0===e.ratio?1:e.ratio,this.angle=void 0===e.angle?t.angle-this.ratio*a.angle:e.angle,e.angle=this.angle,e.ratio=this.ratio,this.equations=[new n(a,t,e)],void 0!==e.maxTorque&&this.setMaxTorque(e.maxTorque)}var r=a("./Constraint"),n=(a("../equations/Equation"),a("../equations/AngleLockEquation"));a("../math/vec2"),t.exports=e,(e.prototype=new r).constructor=e,e.prototype.update=function(){var e=this.equations[0];e.ratio!==this.ratio&&e.setRatio(this.ratio),e.angle=this.angle},e.prototype.setMaxTorque=function(e){this.equations[0].setMaxTorque(e)},e.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(o,t){function e(a,t,e){e=e||{},m.call(this,a,t,m.LOCK,e);var o=void 0===e.maxForce?z:e.maxForce,s=(e.localAngleB,new n(a,t,-o,o)),r=new n(a,t,-o,o),c=new n(a,t,-o,o),h=g.create(),l=g.create(),p=this;s.computeGq=function(){return g.rotate(h,p.localOffsetB,a.angle),g.sub(l,t.position,a.position),g.sub(l,l,h),l[0]},r.computeGq=function(){return g.rotate(h,p.localOffsetB,a.angle),g.sub(l,t.position,a.position),g.sub(l,l,h),l[1]};var u=g.create(),d=g.create();c.computeGq=function(){return g.rotate(u,p.localOffsetB,t.angle-p.localAngleB),g.scale(u,u,-1),g.sub(l,a.position,t.position),g.add(l,l,u),g.rotate(d,u,-P/2),g.normalize(d,d),g.dot(l,d)},this.localOffsetB=g.create(),e.localOffsetB?g.copy(this.localOffsetB,e.localOffsetB):(g.sub(this.localOffsetB,t.position,a.position),g.rotate(this.localOffsetB,this.localOffsetB,-a.angle)),this.localAngleB=0,this.localAngleB="number"==typeof e.localAngleB?e.localAngleB:t.angle-a.angle,this.equations.push(s,r,c),this.setMaxForce(o)}var m=o("./Constraint"),g=o("../math/vec2"),n=o("../equations/Equation");t.exports=e,(e.prototype=new m).constructor=e,e.prototype.setMaxForce=function(a){for(var r=this.equations,e=0;e<this.equations.length;e++)r[e].maxForce=a,r[e].minForce=-a},e.prototype.getMaxForce=function(){return this.equations[0].maxForce};var a=g.create(),r=g.create(),s=g.create(),d=g.fromValues(1,0),l=g.fromValues(0,1);e.prototype.update=function(){var p=this.equations[0],t=this.equations[1],e=this.equations[2],o=this.bodyA,i=this.bodyB;g.rotate(a,this.localOffsetB,o.angle),g.rotate(r,this.localOffsetB,i.angle-this.localAngleB),g.scale(r,r,-1),g.rotate(s,r,P/2),g.normalize(s,s),p.G[0]=-1,p.G[1]=0,p.G[2]=-g.crossLength(a,d),p.G[3]=1,t.G[0]=0,t.G[1]=-1,t.G[2]=-g.crossLength(a,l),t.G[4]=1,e.G[0]=-s[0],e.G[1]=-s[1],e.G[3]=s[0],e.G[4]=s[1],e.G[5]=g.crossLength(r,s)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(o,t){function e(r,t,e){e=e||{},x.call(this,r,t,x.PRISMATIC,e);var c=_.fromValues(0,0),b=_.fromValues(1,0),h=_.fromValues(0,0);e.localAnchorA&&_.copy(c,e.localAnchorA),e.localAxisA&&_.copy(b,e.localAxisA),e.localAnchorB&&_.copy(h,e.localAnchorB),this.localAnchorA=c,this.localAnchorB=h,this.localAxisA=b;var o=this.maxForce=void 0===e.maxForce?z:e.maxForce,l=new s(r,t,-o,o),u=new _.create,d=new _.create,f=new _.create,v=new _.create;if(l.computeGq=function(){return _.dot(f,v)},l.updateJacobian=function(){var e=this.G,a=r.position,o=t.position;_.rotate(u,c,r.angle),_.rotate(d,h,t.angle),_.add(f,o,d),_.sub(f,f,a),_.sub(f,f,u),_.rotate(v,b,r.angle+P/2),e[0]=-v[0],e[1]=-v[1],e[2]=-_.crossLength(u,v)+_.crossLength(v,f),e[3]=v[0],e[4]=v[1],e[5]=_.crossLength(d,v)},this.equations.push(l),!e.disableRotationalLock){var y=new a(r,t,-o,o);this.equations.push(y)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==e.lowerLimit,this.upperLimitEnabled=void 0!==e.upperLimit,this.lowerLimit=void 0===e.lowerLimit?0:e.lowerLimit,this.upperLimit=void 0===e.upperLimit?1:e.upperLimit,this.upperLimitEquation=new n(r,t),this.lowerLimitEquation=new n(r,t),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=o,this.motorEquation=new s(r,t),this.motorEnabled=!1,this.motorSpeed=0;var m=this,g=this.motorEquation;g.computeGW,g.computeGq=function(){return 0},g.computeGW=function(){var r=this.G,t=this.bodyA,e=this.bodyB,o=t.velocity,i=e.velocity,n=t.angularVelocity,s=e.angularVelocity;return this.gmult(r,o,n,i,s)+m.motorSpeed}}var x=o("./Constraint"),n=o("../equations/ContactEquation"),s=o("../equations/Equation"),_=o("../math/vec2"),a=o("../equations/RotationalLockEquation");t.exports=e,(e.prototype=new x).constructor=e;var r=_.create(),h=_.create(),l=_.create(),p=_.create(),u=_.create(),d=_.create();e.prototype.update=function(){var f=this.equations,t=f[0],e=this.upperLimit,o=this.lowerLimit,i=this.upperLimitEquation,n=this.lowerLimitEquation,s=this.bodyA,a=this.bodyB,c=this.localAxisA,x=this.localAnchorA,y=this.localAnchorB;t.updateJacobian(),_.rotate(r,c,s.angle),_.rotate(p,x,s.angle),_.add(h,p,s.position),_.rotate(u,y,a.angle),_.add(l,u,a.position);var m=this.position=_.dot(l,r)-_.dot(h,r);if(this.motorEnabled){var g=this.motorEquation.G;g[0]=r[0],g[1]=r[1],g[2]=_.crossLength(r,u),g[3]=-r[0],g[4]=-r[1],g[5]=-_.crossLength(r,p)}if(this.upperLimitEnabled&&m>e?(_.scale(i.normalA,r,-1),_.sub(i.contactPointA,h,s.position),_.sub(i.contactPointB,l,a.position),_.scale(d,r,e),_.add(i.contactPointA,i.contactPointA,d),-1===f.indexOf(i)&&f.push(i)):-1!==(v=f.indexOf(i))&&f.splice(v,1),this.lowerLimitEnabled&&m<o)_.scale(n.normalA,r,1),_.sub(n.contactPointA,h,s.position),_.sub(n.contactPointB,l,a.position),_.scale(d,r,o),_.sub(n.contactPointB,n.contactPointB,d),-1===f.indexOf(n)&&f.push(n);else{var v=f.indexOf(n);-1!==v&&f.splice(v,1)}},e.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},e.prototype.disableMotor=function(){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations.splice(e,1),this.motorEnabled=!1}},e.prototype.setLimits=function(a,r){"number"==typeof a?(this.lowerLimit=a,this.lowerLimitEnabled=!0):(this.lowerLimit=a,this.lowerLimitEnabled=!1),"number"==typeof r?(this.upperLimit=r,this.upperLimitEnabled=!0):(this.upperLimit=r,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(o,t){function e(d,t,e){e=e||{},g.call(this,d,t,g.REVOLUTE,e);var o=this.maxForce=void 0===e.maxForce?z:e.maxForce;this.pivotA=x.create(),this.pivotB=x.create(),e.worldPivot?(x.sub(this.pivotA,e.worldPivot,d.position),x.sub(this.pivotB,e.worldPivot,t.position),x.rotate(this.pivotA,this.pivotA,-d.angle),x.rotate(this.pivotB,this.pivotB,-t.angle)):(x.copy(this.pivotA,e.localPivotA),x.copy(this.pivotB,e.localPivotB));var u=this.equations=[new n(d,t,-o,o),new n(d,t,-o,o)],f=u[0],v=u[1],y=this;f.computeGq=function(){return x.rotate(c,y.pivotA,d.angle),x.rotate(h,y.pivotB,t.angle),x.add(r,t.position,h),x.sub(r,r,d.position),x.sub(r,r,c),x.dot(r,l)},v.computeGq=function(){return x.rotate(c,y.pivotA,d.angle),x.rotate(h,y.pivotB,t.angle),x.add(r,t.position,h),x.sub(r,r,d.position),x.sub(r,r,c),x.dot(r,p)},v.minForce=f.minForce=-o,v.maxForce=f.maxForce=o,this.motorEquation=new s(d,t),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new a(d,t),this.lowerLimitEquation=new a(d,t),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var g=o("./Constraint"),n=o("../equations/Equation"),s=o("../equations/RotationalVelocityEquation"),a=o("../equations/RotationalLockEquation"),x=o("../math/vec2");t.exports=e;var c=x.create(),h=x.create(),l=x.fromValues(1,0),p=x.fromValues(0,1),r=x.create();(e.prototype=new g).constructor=e,e.prototype.setLimits=function(a,r){"number"==typeof a?(this.lowerLimit=a,this.lowerLimitEnabled=!0):(this.lowerLimit=a,this.lowerLimitEnabled=!1),"number"==typeof r?(this.upperLimit=r,this.upperLimitEnabled=!0):(this.upperLimit=r,this.upperLimitEnabled=!1)},e.prototype.update=function(){var u=this.bodyA,t=this.bodyB,e=this.pivotA,o=this.pivotB,i=this.equations,n=(i[0],i[1],i[0]),s=i[1],a=this.upperLimit,r=this.lowerLimit,d=this.upperLimitEquation,g=this.lowerLimitEquation,f=this.angle=t.angle-u.angle;if(this.upperLimitEnabled&&f>a?(d.angle=a,-1===i.indexOf(d)&&i.push(d)):-1!==(y=i.indexOf(d))&&i.splice(y,1),this.lowerLimitEnabled&&f<r)g.angle=r,-1===i.indexOf(g)&&i.push(g);else{var y=i.indexOf(g);-1!==y&&i.splice(y,1)}x.rotate(c,e,u.angle),x.rotate(h,o,t.angle),n.G[0]=-1,n.G[1]=0,n.G[2]=-x.crossLength(c,l),n.G[3]=1,n.G[4]=0,n.G[5]=x.crossLength(h,l),s.G[0]=0,s.G[1]=-1,s.G[2]=-x.crossLength(c,p),s.G[3]=0,s.G[4]=1,s.G[5]=x.crossLength(h,p)},e.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},e.prototype.disableMotor=function(){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations.splice(e,1),this.motorEnabled=!1}},e.prototype.setMotorSpeed=function(a){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations[t].relativeVelocity=a}},e.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(a,t){function e(a,t,e){e=e||{},r.call(this,a,t,-z,Number.MAX_VALUE),this.angle=e.angle||0,this.ratio="number"==typeof e.ratio?e.ratio:1,this.setRatio(this.ratio)}var r=a("./Equation");a("../math/vec2"),t.exports=e,(e.prototype=new r).constructor=e,e.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},e.prototype.setRatio=function(a){var t=this.G;t[2]=a,t[5]=-1,this.ratio=a},e.prototype.setMaxTorque=function(e){this.maxForce=e,this.minForce=-e}},{"../math/vec2":30,"./Equation":22}],21:[function(o,t){function e(a,t){i.call(this,a,t,0,Number.MAX_VALUE),this.contactPointA=m.create(),this.penetrationVec=m.create(),this.contactPointB=m.create(),this.normalA=m.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var i=o("./Equation"),m=o("../math/vec2");t.exports=e,(e.prototype=new i).constructor=e,e.prototype.computeB=function(s,t,e){var o=this.bodyA,i=this.bodyB,n=this.contactPointA,a=this.contactPointB,r=o.position,c=i.position,g=this.penetrationVec,l=this.normalA,p=this.G,u=m.crossLength(n,l),h=m.crossLength(a,l);p[0]=-l[0],p[1]=-l[1],p[2]=-u,p[3]=l[0],p[4]=l[1],p[5]=h,m.add(g,c,a),m.sub(g,g,r),m.sub(g,g,n);var f,x;return this.firstImpact&&0!==this.restitution?(x=0,f=1/t*(1+this.restitution)*this.computeGW()):(x=m.dot(l,g)+this.offset,f=this.computeGW()),-x*s-f*t-e*this.computeGiMf()};var n=m.create(),a=m.create(),r=m.create();e.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(n,this.contactPointA),this.bodyB.getVelocityAtPoint(a,this.contactPointB),m.subtract(r,n,a),m.dot(this.normalA,r)}},{"../math/vec2":30,"./Equation":22}],22:[function(o,t){function d(r,t,e,o){this.minForce=void 0===e?-z:e,this.maxForce=void 0===o?z:o,this.bodyA=r,this.bodyB=t,this.stiffness=d.DEFAULT_STIFFNESS,this.relaxation=d.DEFAULT_RELAXATION,this.G=new i.ARRAY_TYPE(6);for(var n=0;6>n;n++)this.G[n]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}t.exports=d;var m=o("../math/vec2"),i=o("../utils/Utils");o("../objects/Body"),d.prototype.constructor=d,d.DEFAULT_STIFFNESS=1e6,d.DEFAULT_RELAXATION=4,d.prototype.update=function(){var a=this.stiffness,t=this.relaxation,e=this.timeStep;this.a=4/(e*(1+4*t)),this.b=4*t/(1+4*t),this.epsilon=4/(e*e*a*(1+4*t)),this.needsUpdate=!1},d.prototype.gmult=function(a,t,e,r,o){return a[0]*t[0]+a[1]*t[1]+a[2]*e+a[3]*r[0]+a[4]*r[1]+a[5]*o},d.prototype.computeB=function(a,t,e){var r=this.computeGW();return-this.computeGq()*a-r*t-this.computeGiMf()*e};var s=m.create(),a=m.create();d.prototype.computeGq=function(){var r=this.G,t=this.bodyA,e=this.bodyB,o=(t.position,e.position,t.angle),i=e.angle;return this.gmult(r,s,o,a,i)+this.offset},d.prototype.computeGW=function(){var r=this.G,t=this.bodyA,e=this.bodyB,o=t.velocity,i=e.velocity,n=t.angularVelocity,s=e.angularVelocity;return this.gmult(r,o,n,i,s)+this.relativeVelocity},d.prototype.computeGWlambda=function(){var r=this.G,t=this.bodyA,e=this.bodyB,o=t.vlambda,i=e.vlambda,n=t.wlambda,s=e.wlambda;return this.gmult(r,o,n,i,s)};var n=m.create(),c=m.create();d.prototype.computeGiMf=function(){var g=this.bodyA,t=this.bodyB,e=g.force,o=g.angularForce,i=t.force,s=t.angularForce,a=g.invMassSolve,r=t.invMassSolve,l=g.invInertiaSolve,p=t.invInertiaSolve,u=this.G;return m.scale(n,e,a),m.multiply(n,g.massMultiplier,n),m.scale(c,i,r),m.multiply(c,t.massMultiplier,c),this.gmult(u,n,o*l,c,s*p)},d.prototype.computeGiMGt=function(){var r=this.bodyA,t=this.bodyB,e=r.invMassSolve,o=t.invMassSolve,i=r.invInertiaSolve,n=t.invInertiaSolve,s=this.G;return s[0]*s[0]*e*r.massMultiplier[0]+s[1]*s[1]*e*r.massMultiplier[1]+s[2]*s[2]*i+s[3]*s[3]*o*t.massMultiplier[0]+s[4]*s[4]*o*t.massMultiplier[1]+s[5]*s[5]*n};var g=m.create(),l=m.create(),p=m.create();m.create(),m.create(),m.create(),d.prototype.addToWlambda=function(n){var t=this.bodyA,e=this.bodyB,o=g,i=l,s=p,a=t.invMassSolve,r=e.invMassSolve,c=t.invInertiaSolve,u=e.invInertiaSolve,d=this.G;i[0]=d[0],i[1]=d[1],s[0]=d[3],s[1]=d[4],m.scale(o,i,a*n),m.multiply(o,o,t.massMultiplier),m.add(t.vlambda,t.vlambda,o),t.wlambda+=c*d[2]*n,m.scale(o,s,r*n),m.multiply(o,o,e.massMultiplier),m.add(e.vlambda,e.vlambda,o),e.wlambda+=u*d[5]*n},d.prototype.computeInvC=function(e){return 1/(this.computeGiMGt()+e)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(a,t){function e(a,t,e){r.call(this,a,t,-e,e),this.contactPointA=d.create(),this.contactPointB=d.create(),this.t=d.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var d=a("../math/vec2"),r=a("./Equation");a("../utils/Utils"),t.exports=e,(e.prototype=new r).constructor=e,e.prototype.setSlipForce=function(e){this.maxForce=e,this.minForce=-e},e.prototype.getSlipForce=function(){return this.maxForce},e.prototype.computeB=function(n,t,e){this.bodyA,this.bodyB;var o=this.contactPointA,i=this.contactPointB,s=this.t,a=this.G;return a[0]=-s[0],a[1]=-s[1],a[2]=-d.crossLength(o,s),a[3]=s[0],a[4]=s[1],a[5]=d.crossLength(i,s),-this.computeGW()*t-e*this.computeGiMf()}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(o,t){function e(a,t,e){e=e||{},d.call(this,a,t,-z,Number.MAX_VALUE),this.angle=e.angle||0;var r=this.G;r[2]=1,r[5]=-1}var d=o("./Equation"),n=o("../math/vec2");t.exports=e,(e.prototype=new d).constructor=e;var i=n.create(),a=n.create(),r=n.fromValues(1,0),s=n.fromValues(0,1);e.prototype.computeGq=function(){return n.rotate(i,r,this.bodyA.angle+this.angle),n.rotate(a,s,this.bodyB.angle),n.dot(i,a)}},{"../math/vec2":30,"./Equation":22}],25:[function(a,t){function e(a,t){r.call(this,a,t,-z,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var r=a("./Equation");a("../math/vec2"),t.exports=e,(e.prototype=new r).constructor=e,e.prototype.computeB=function(a,t,e){var r=this.G;r[2]=-1,r[5]=this.ratio;var o=this.computeGiMf();return-this.computeGW()*t-e*o}},{"../math/vec2":30,"./Equation":22}],26:[function(a,t){var e=function(){};t.exports=e,e.prototype={constructor:e,on:function(a,t,e){t.context=e||this,void 0===this._listeners&&(this._listeners={});var r=this._listeners;return void 0===r[a]&&(r[a]=[]),-1===r[a].indexOf(t)&&r[a].push(t),this},has:function(a,t){if(void 0===this._listeners)return!1;var e=this._listeners;if(t){if(void 0!==e[a]&&-1!==e[a].indexOf(t))return!0;}else if(void 0!==e[a])return!0;return!1},off:function(a,t){if(void 0===this._listeners)return this;var e=this._listeners,r=e[a].indexOf(t);return-1!==r&&e[a].splice(r,1),this},emit:function(a){if(void 0===this._listeners)return this;var t=this._listeners[a.type];if(void 0!==t){a.target=this;for(var e=0,r=t.length,o;e<r;e++)o=t[e],o.call(o.context,a)}return this}}},{}],27:[function(a,t){function r(a,t,e){if(e=e||{},!(a instanceof i&&t instanceof i))throw new Error("First two arguments must be Material instances.");this.id=r.idCounter++,this.materialA=a,this.materialB=t,this.friction=void 0===e.friction?.3:+e.friction,this.restitution=void 0===e.restitution?0:+e.restitution,this.stiffness=void 0===e.stiffness?n.DEFAULT_STIFFNESS:+e.stiffness,this.relaxation=void 0===e.relaxation?n.DEFAULT_RELAXATION:+e.relaxation,this.frictionStiffness=void 0===e.frictionStiffness?n.DEFAULT_STIFFNESS:+e.frictionStiffness,this.frictionRelaxation=void 0===e.frictionRelaxation?n.DEFAULT_RELAXATION:+e.frictionRelaxation,this.surfaceVelocity=void 0===e.surfaceVelocity?0:+e.surfaceVelocity,this.contactSkinSize=.005}var i=a("./Material"),n=a("../equations/Equation");t.exports=r,r.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(a,t){function e(a){this.id=a||e.idCounter++}t.exports=e,e.idCounter=0},{}],29:[function(a,t){var e={};e.GetArea=function(a){if(6>a.length)return 0;for(var t=a.length-2,e=0,r=0;r<t;r+=2)e+=(a[r+2]-a[r])*(a[r+1]+a[r+3]);return .5*-(e+=(a[0]-a[t])*(a[t+1]+a[1]))},e.Triangulate=function(i){var t=i.length>>1;if(3>t)return[];for(var x=[],o=[],n=0;n<t;n++)o.push(n);for(var n=0,s=t;3<s;){var a=o[(n+0)%s],r=o[(n+1)%s],c=o[(n+2)%s],h=i[2*a],l=i[2*a+1],p=i[2*r],u=i[2*r+1],d=i[2*c],f=i[2*c+1],v=!1;if(e._convex(h,l,p,u,d,f)){v=!0;for(var y=0,m;y<s;y++)if(m=o[y],m!=a&&m!=r&&m!=c&&e._PointInTriangle(i[2*m],i[2*m+1],h,l,p,u,d,f)){v=!1;break}}if(v)x.push(a,r,c),o.splice((n+1)%s,1),s--,n=0;else if(n++>3*s)break}return x.push(o[0],o[1],o[2]),x},e._PointInTriangle=function(x,t,e,o,i,n,s,a){var r=s-e,c=a-o,h=i-e,l=n-o,p=x-e,u=t-o,d=r*r+c*c,f=r*h+c*l,v=r*p+c*u,y=h*h+l*l,m=h*p+l*u,g=1/(d*y-f*f),_=(y*v-f*m)*g,b=(d*m-f*v)*g;return 0<=_&&0<=b&&1>_+b},e._convex=function(a,t,e,r,o,n){return 0<=(t-r)*(o-e)+(e-a)*(n-r)},t.exports=e},{}],30:[function(a,t){var r=t.exports={},i=a("../utils/Utils");r.crossLength=function(a,t){return a[0]*t[1]-a[1]*t[0]},r.crossVZ=function(a,t,e){return r.rotate(a,t,-P/2),r.scale(a,a,e),a},r.crossZV=function(a,t,e){return r.rotate(a,e,P/2),r.scale(a,a,t),a},r.rotate=function(r,t,e){if(0!==e){var o=g(e),i=m(e),n=t[0],s=t[1];r[0]=o*n-i*s,r[1]=i*n+o*s}else r[0]=t[0],r[1]=t[1]},r.rotate90cw=function(a,t){var e=t[0],r=t[1];a[0]=r,a[1]=-e},r.toLocalFrame=function(a,t,e,o){r.copy(a,t),r.sub(a,a,e),r.rotate(a,a,-o)},r.toGlobalFrame=function(a,t,e,o){r.copy(a,t),r.rotate(a,a,o),r.add(a,a,e)},r.vectorToLocalFrame=function(a,t,e){r.rotate(a,t,-e)},r.vectorToGlobalFrame=function(a,t,e){r.rotate(a,t,e)},r.centroid=function(a,t,e,o){return r.add(a,t,e),r.add(a,a,o),r.scale(a,a,1/3),a},r.create=function(){var e=new i.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e},r.clone=function(a){var t=new i.ARRAY_TYPE(2);return t[0]=a[0],t[1]=a[1],t},r.fromValues=function(a,t){var e=new i.ARRAY_TYPE(2);return e[0]=a,e[1]=t,e},r.copy=function(a,t){return a[0]=t[0],a[1]=t[1],a},r.set=function(a,t,e){return a[0]=t,a[1]=e,a},r.add=function(a,t,e){return a[0]=t[0]+e[0],a[1]=t[1]+e[1],a},r.subtract=function(a,t,e){return a[0]=t[0]-e[0],a[1]=t[1]-e[1],a},r.sub=r.subtract,r.multiply=function(a,t,e){return a[0]=t[0]*e[0],a[1]=t[1]*e[1],a},r.mul=r.multiply,r.divide=function(a,t,e){return a[0]=t[0]/e[0],a[1]=t[1]/e[1],a},r.div=r.divide,r.scale=function(a,t,e){return a[0]=t[0]*e,a[1]=t[1]*e,a},r.distance=function(a,t){var e=t[0]-a[0],r=t[1]-a[1];return x(e*e+r*r)},r.dist=r.distance,r.squaredDistance=function(a,t){var e=t[0]-a[0],r=t[1]-a[1];return e*e+r*r},r.sqrDist=r.squaredDistance,r.length=function(a){var t=a[0],e=a[1];return x(t*t+e*e)},r.len=r.length,r.squaredLength=function(a){var t=a[0],e=a[1];return t*t+e*e},r.sqrLen=r.squaredLength,r.negate=function(a,t){return a[0]=-t[0],a[1]=-t[1],a},r.normalize=function(a,t){var e=t[0],r=t[1],o=e*e+r*r;return 0<o&&(o=1/x(o),a[0]=t[0]*o,a[1]=t[1]*o),a},r.dot=function(a,t){return a[0]*t[0]+a[1]*t[1]},r.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},r.lerp=function(a,t,e,r){var o=t[0],n=t[1];return a[0]=o+r*(e[0]-o),a[1]=n+r*(e[1]-n),a},r.reflect=function(a,t,e){var r=t[0]*e[0]+t[1]*e[1];a[0]=t[0]-2*e[0]*r,a[1]=t[1]-2*e[1]*r},r.getLineSegmentsIntersection=function(i,t,e,o,n){var s=r.getLineSegmentsIntersectionFraction(t,e,o,n);return!(0>s)&&(i[0]=t[0]+s*(e[0]-t[0]),i[1]=t[1]+s*(e[1]-t[1]),!0)},r.getLineSegmentsIntersectionFraction=function(d,t,e,o){var i=t[0]-d[0],a=t[1]-d[1],l=o[0]-e[0],p=o[1]-e[1],u,n;return u=(-a*(d[0]-e[0])+i*(d[1]-e[1]))/(-l*a+i*p),n=(l*(d[1]-e[1])-p*(d[0]-e[0]))/(-l*a+i*p),0<=u&&1>=u&&0<=n&&1>=n?n:-1}},{"../utils/Utils":57}],31:[function(o,t){function _(e){e=e||{},s.call(this),this.id=e.id||++_._idCounter,this.world=null,this.shapes=[],this.mass=e.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!e.fixedRotation,this.fixedX=!!e.fixedX,this.fixedY=!!e.fixedY,this.massMultiplier=R.create(),this.position=R.fromValues(0,0),e.position&&R.copy(this.position,e.position),this.interpolatedPosition=R.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=R.fromValues(0,0),this.previousAngle=0,this.velocity=R.fromValues(0,0),e.velocity&&R.copy(this.velocity,e.velocity),this.vlambda=R.fromValues(0,0),this.wlambda=0,this.angle=e.angle||0,this.angularVelocity=e.angularVelocity||0,this.force=R.create(),e.force&&R.copy(this.force,e.force),this.angularForce=e.angularForce||0,this.damping="number"==typeof e.damping?e.damping:.1,this.angularDamping="number"==typeof e.angularDamping?e.angularDamping:.1,this.type=_.STATIC,this.type=void 0===e.type?e.mass?_.DYNAMIC:_.STATIC:e.type,this.boundingRadius=0,this.aabb=new i,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===e.allowSleep||e.allowSleep,this.wantsToSleep=!1,this.sleepState=_.AWAKE,this.sleepSpeedLimit=void 0===e.sleepSpeedLimit?.2:e.sleepSpeedLimit,this.sleepTimeLimit=void 0===e.sleepTimeLimit?1:e.sleepTimeLimit,this.gravityScale=void 0===e.gravityScale?1:e.gravityScale,this.collisionResponse=void 0===e.collisionResponse||e.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0===e.ccdSpeedThreshold?-1:e.ccdSpeedThreshold,this.ccdIterations=void 0===e.ccdIterations?10:e.ccdIterations,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var R=o("../math/vec2"),n=o("poly-decomp"),e=o("../shapes/Convex"),a=o("../collision/RaycastResult"),r=o("../collision/Ray"),i=o("../collision/AABB"),s=o("../events/EventEmitter");t.exports=_,_.prototype=new s,_.prototype.constructor=_,_._idCounter=0,_.prototype.updateSolveMassProperties=function(){this.sleepState===_.SLEEPING||this.type===_.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},_.prototype.setDensity=function(a){var t=this.getArea();this.mass=t*a,this.updateMassProperties()},_.prototype.getArea=function(){for(var a=0,t=0;t<this.shapes.length;t++)a+=this.shapes[t].area;return a},_.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var l=new i,p=R.create();_.prototype.updateAABB=function(){for(var n=this.shapes,t=n.length,e=p,o=this.angle,i=0;i!==t;i++){var s=n[i],a=s.angle+o;R.rotate(e,s.position,o),R.add(e,e,this.position),s.computeAABB(l,e,a),0===i?this.aabb.copy(l):this.aabb.extend(l)}this.aabbNeedsUpdate=!1},_.prototype.updateBoundingRadius=function(){for(var n=this.shapes,t=n.length,e=0,o=0;o!==t;o++){var i=n[o],s=R.length(i.position),a=i.boundingRadius;s+a>e&&(e=s+a)}this.boundingRadius=e},_.prototype.addShape=function(a,t,e){if(a.body)throw new Error("A shape can only be added to one body.");a.body=this,t?R.copy(a.position,t):R.set(a.position,0,0),a.angle=e||0,this.shapes.push(a),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},_.prototype.removeShape=function(a){var t=this.shapes.indexOf(a);return-1!==t&&(this.shapes.splice(t,1),this.aabbNeedsUpdate=!0,a.body=null,!0)},_.prototype.updateMassProperties=function(){if(this.type===_.STATIC||this.type===_.KINEMATIC)this.mass=z,this.invMass=0,this.inertia=z,this.invInertia=0;else{var n=this.shapes,t=n.length,e=this.mass/t,o=0;if(this.fixedRotation)this.inertia=z,this.invInertia=0;else{for(var i=0;i<t;i++){var a=n[i],r=R.squaredLength(a.position);o+=a.computeMomentOfInertia(e)+e*r}this.inertia=o,this.invInertia=0<o?1/o:0}this.invMass=1/this.mass,R.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}},R.create(),_.prototype.applyForce=function(a,t){if(R.add(this.force,this.force,a),t){var e=R.crossLength(t,a);this.angularForce+=e}};var c=R.create(),d=R.create(),u=R.create();_.prototype.applyForceLocal=function(a,t){t=t||u;var e=c,r=d;this.vectorToWorldFrame(e,a),this.vectorToWorldFrame(r,t),this.applyForce(e,r)};var h=R.create();_.prototype.applyImpulse=function(a,t){if(this.type===_.DYNAMIC){var e=h;if(R.scale(e,a,this.invMass),R.multiply(e,this.massMultiplier,e),R.add(this.velocity,e,this.velocity),t){var r=R.crossLength(t,a);r*=this.invInertia,this.angularVelocity+=r}}};var y=R.create(),m=R.create(),g=R.create();_.prototype.applyImpulseLocal=function(a,t){t=t||g;var e=y,r=m;this.vectorToWorldFrame(e,a),this.vectorToWorldFrame(r,t),this.applyImpulse(e,r)},_.prototype.toLocalFrame=function(a,t){R.toLocalFrame(a,t,this.position,this.angle)},_.prototype.toWorldFrame=function(a,t){R.toGlobalFrame(a,t,this.position,this.angle)},_.prototype.vectorToLocalFrame=function(a,t){R.vectorToLocalFrame(a,t,this.angle)},_.prototype.vectorToWorldFrame=function(a,t){R.vectorToGlobalFrame(a,t,this.angle)},_.prototype.fromPolygon=function(a,t){for(t=t||{},r=this.shapes.length;0<=r;--r)this.removeShape(this.shapes[r]);var s=new n.Polygon;if(s.vertices=a,s.makeCCW(),"number"==typeof t.removeCollinearPoints&&s.removeCollinearPoints(t.removeCollinearPoints),void 0===t.skipSimpleCheck&&!s.isSimple())return!1;for(this.concavePath=s.vertices.slice(0),r=0;r<this.concavePath.length;r++)l=[0,0],R.copy(l,this.concavePath[r]),this.concavePath[r]=l;var o=t.optimalDecomp?s.decomp():s.quickDecomp();for(var i=R.create(),r=0;r!==o.length;r++){for(var d=new e({vertices:o[r].vertices}),c=0,l;c!==d.vertices.length;c++)l=d.vertices[c],R.sub(l,l,d.centerOfMass);R.scale(i,d.centerOfMass,1),d.updateTriangles(),d.updateCenterOfMass(),d.updateBoundingRadius(),this.addShape(d,i)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0},R.fromValues(0,0);var f=R.fromValues(0,0),v=R.fromValues(0,0),b=R.fromValues(0,0);_.prototype.adjustCenterOfMass=function(){var r=f,t=v,e=b,o=0;for(R.set(t,0,0),i=0;i!==this.shapes.length;i++)n=this.shapes[i],R.scale(r,n.position,n.area),R.add(t,t,r),o+=n.area;for(R.scale(e,t,1/o),i=0;i!==this.shapes.length;i++){var n=this.shapes[i];R.sub(n.position,n.position,e)}R.add(this.position,this.position,e);for(var i=0;this.concavePath&&i<this.concavePath.length;i++)R.sub(this.concavePath[i],this.concavePath[i],e);this.updateMassProperties(),this.updateBoundingRadius()},_.prototype.setZeroForce=function(){R.set(this.force,0,0),this.angularForce=0},_.prototype.resetConstraintVelocity=function(){var a=this,t=a.vlambda;R.set(t,0,0),a.wlambda=0},_.prototype.addConstraintVelocity=function(){var a=this,t=a.velocity;R.add(t,t,a.vlambda),a.angularVelocity+=a.wlambda},_.prototype.applyDamping=function(a){if(this.type===_.DYNAMIC){var t=this.velocity;R.scale(t,t,T(1-this.damping,a)),this.angularVelocity*=T(1-this.angularDamping,a)}},_.prototype.wakeUp=function(){var e=this.sleepState;this.sleepState=_.AWAKE,this.idleTime=0,e!==_.AWAKE&&this.emit(_.wakeUpEvent)},_.prototype.sleep=function(){this.sleepState=_.SLEEPING,this.angularVelocity=0,this.angularForce=0,R.set(this.velocity,0,0),R.set(this.force,0,0),this.emit(_.sleepEvent)},_.prototype.sleepTick=function(a,t,e){this.allowSleep&&this.type!==_.SLEEPING&&(this.wantsToSleep=!1,this.sleepState,R.squaredLength(this.velocity)+T(this.angularVelocity,2)>=T(this.sleepSpeedLimit,2)?(this.idleTime=0,this.sleepState=_.AWAKE):(this.idleTime+=e,this.sleepState=_.SLEEPY),this.idleTime>this.sleepTimeLimit&&(t?this.wantsToSleep=!0:this.sleep()))},_.prototype.overlaps=function(e){return this.world.overlapKeeper.bodiesAreOverlapping(this,e)};var E=R.create(),A=R.create();_.prototype.integrate=function(a){var t=this.invMass,e=this.force,r=this.position,o=this.velocity;R.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*a),R.scale(E,e,a*t),R.multiply(E,this.massMultiplier,E),R.add(o,E,o),this.integrateToTimeOfImpact(a)||(R.scale(A,o,a),R.add(r,r,A),this.fixedRotation||(this.angle+=this.angularVelocity*a)),this.aabbNeedsUpdate=!0};var P=new a,w=new r({mode:r.ALL}),S=R.create(),C=R.create(),M=R.create(),x=R.create();_.prototype.integrateToTimeOfImpact=function(n){if(0>this.ccdSpeedThreshold||R.squaredLength(this.velocity)<T(this.ccdSpeedThreshold,2))return!1;R.normalize(S,this.velocity),R.scale(C,this.velocity,n),R.add(C,C,this.position),R.sub(M,C,this.position);var t=this.angularVelocity*n,o=R.length(M),i=1,s=this,a;if(P.reset(),w.callback=function(e){e.body!==s&&(a=e.body,e.getHitPoint(C,w),R.sub(M,C,s.position),i=R.length(M)/o,e.stop())},R.copy(w.from,this.position),R.copy(w.to,C),w.update(),this.world.raycast(P,w),!a)return!1;var d=this.angle;R.copy(x,this.position);for(var r=0,c=0,u=0,l=i;l>=c&&r<this.ccdIterations;)r++,u=(l-c)/2,R.scale(A,M,i),R.add(this.position,x,A),this.angle=d+t*i,this.updateAABB(),this.aabb.overlaps(a.aabb)&&this.world.narrowphase.bodiesOverlap(this,a)?c=u:l=u;return i=u,R.copy(this.position,x),this.angle=d,R.scale(A,M,i),R.add(this.position,this.position,A),this.fixedRotation||(this.angle+=t*i),!0},_.prototype.getVelocityAtPoint=function(a,t){return R.crossVZ(a,t,this.angularVelocity),R.subtract(a,this.velocity,a),a},_.sleepyEvent={type:"sleepy"},_.sleepEvent={type:"sleep"},_.wakeUpEvent={type:"wakeup"},_.DYNAMIC=1,_.STATIC=2,_.KINEMATIC=4,_.AWAKE=0,_.SLEEPY=1,_.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(o,t){function e(s,t,e){e=e||{},n.call(this,s,t,e),this.localAnchorA=x.fromValues(0,0),this.localAnchorB=x.fromValues(0,0),e.localAnchorA&&x.copy(this.localAnchorA,e.localAnchorA),e.localAnchorB&&x.copy(this.localAnchorB,e.localAnchorB),e.worldAnchorA&&this.setWorldAnchorA(e.worldAnchorA),e.worldAnchorB&&this.setWorldAnchorB(e.worldAnchorB);var o=x.create(),d=x.create();this.getWorldAnchorA(o),this.getWorldAnchorB(d);var a=x.distance(o,d);this.restLength="number"==typeof e.restLength?e.restLength:a}var x=o("../math/vec2"),n=o("./Spring");o("../utils/Utils"),t.exports=e,(e.prototype=new n).constructor=e,e.prototype.setWorldAnchorA=function(e){this.bodyA.toLocalFrame(this.localAnchorA,e)},e.prototype.setWorldAnchorB=function(e){this.bodyB.toLocalFrame(this.localAnchorB,e)},e.prototype.getWorldAnchorA=function(e){this.bodyA.toWorldFrame(e,this.localAnchorA)},e.prototype.getWorldAnchorB=function(e){this.bodyB.toWorldFrame(e,this.localAnchorB)};var _=x.create(),a=x.create(),r=x.create(),c=x.create(),h=x.create(),l=x.create(),p=x.create(),u=x.create(),d=x.create();e.prototype.applyForce=function(){var n=this.stiffness,f=this.damping,e=this.restLength,o=this.bodyA,i=this.bodyB,s=_,v=a,y=r,m=c,g=d,T=h,b=l,E=p,C=u;this.getWorldAnchorA(T),this.getWorldAnchorB(b),x.sub(E,T,o.position),x.sub(C,b,i.position),x.sub(s,b,T);var A=x.len(s);x.normalize(v,s),x.sub(y,i.velocity,o.velocity),x.crossZV(g,i.angularVelocity,C),x.add(y,y,g),x.crossZV(g,o.angularVelocity,E),x.sub(y,y,g),x.scale(m,v,-n*(A-e)-f*x.dot(y,v)),x.sub(o.force,o.force,m),x.add(i.force,i.force,m);var P=x.crossLength(E,m),w=x.crossLength(C,m);o.angularForce-=P,i.angularForce+=w}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(a,t){function e(a,t,e){e=e||{},r.call(this,a,t,e),this.restAngle="number"==typeof e.restAngle?e.restAngle:t.angle-a.angle}a("../math/vec2");var r=a("./Spring");t.exports=e,(e.prototype=new r).constructor=e,e.prototype.applyForce=function(){var a=this.stiffness,r=this.damping,e=this.restAngle,o=this.bodyA,i=this.bodyB,n=-a*(i.angle-o.angle-e)-0*(r*(i.angularVelocity-o.angularVelocity));o.angularForce-=n,i.angularForce+=n}},{"../math/vec2":30,"./Spring":34}],34:[function(a,t){function e(a,t,e){e=r.defaults(e,{stiffness:100,damping:1}),this.stiffness=e.stiffness,this.damping=e.damping,this.bodyA=a,this.bodyB=t}a("../math/vec2");var r=a("../utils/Utils");t.exports=e,e.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(o,t){function e(a,t){t=t||{},this.chassisBody=a,this.wheels=[],this.groundBody=new r({mass:0}),this.world=null;var e=this;this.preStepCallback=function(){e.update()}}function i(r,t){t=t||{},this.vehicle=r,this.forwardEquation=new a(r.chassisBody,r.groundBody),this.sideEquation=new a(r.chassisBody,r.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0===t.sideFriction?5:t.sideFriction),this.localForwardVector=n.fromValues(0,1),t.localForwardVector&&n.copy(this.localForwardVector,t.localForwardVector),this.localPosition=n.fromValues(0,0),t.localPosition&&n.copy(this.localPosition,t.localPosition),s.apply(this,r.chassisBody,r.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var n=o("../math/vec2"),s=(o("../utils/Utils"),o("../constraints/Constraint")),a=o("../equations/FrictionEquation"),r=o("../objects/Body");t.exports=e,e.prototype.addToWorld=function(a){this.world=a,a.addBody(this.groundBody),a.on("preStep",this.preStepCallback);for(var t=0,e;t<this.wheels.length;t++)e=this.wheels[t],a.addConstraint(e)},e.prototype.removeFromWorld=function(){var a=this.world;a.removeBody(this.groundBody),a.off("preStep",this.preStepCallback);for(var t=0,e;t<this.wheels.length;t++)e=this.wheels[t],a.removeConstraint(e);this.world=null},e.prototype.addWheel=function(a){var t=new i(this,a);return this.wheels.push(t),t},e.prototype.update=function(){for(var e=0;e<this.wheels.length;e++)this.wheels[e].update()},(i.prototype=new s).setBrakeForce=function(e){this.forwardEquation.setSlipForce(e)},i.prototype.setSideFriction=function(e){this.sideEquation.setSlipForce(e)};var d=n.create(),c=n.create();i.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(c,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(d,c),n.dot(d,c)};var l=n.create();i.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),n.rotate(this.sideEquation.t,this.localForwardVector,P/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),n.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),n.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),n.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),n.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),n.normalize(l,this.forwardEquation.t),n.scale(l,l,this.engineForce),this.vehicle.chassisBody.applyForce(l,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(a,t){var e=t.exports={AABB:a("./collision/AABB"),AngleLockEquation:a("./equations/AngleLockEquation"),Body:a("./objects/Body"),Broadphase:a("./collision/Broadphase"),Capsule:a("./shapes/Capsule"),Circle:a("./shapes/Circle"),Constraint:a("./constraints/Constraint"),ContactEquation:a("./equations/ContactEquation"),ContactEquationPool:a("./utils/ContactEquationPool"),ContactMaterial:a("./material/ContactMaterial"),Convex:a("./shapes/Convex"),DistanceConstraint:a("./constraints/DistanceConstraint"),Equation:a("./equations/Equation"),EventEmitter:a("./events/EventEmitter"),FrictionEquation:a("./equations/FrictionEquation"),FrictionEquationPool:a("./utils/FrictionEquationPool"),GearConstraint:a("./constraints/GearConstraint"),GSSolver:a("./solver/GSSolver"),Heightfield:a("./shapes/Heightfield"),Line:a("./shapes/Line"),LockConstraint:a("./constraints/LockConstraint"),Material:a("./material/Material"),Narrowphase:a("./collision/Narrowphase"),NaiveBroadphase:a("./collision/NaiveBroadphase"),Particle:a("./shapes/Particle"),Plane:a("./shapes/Plane"),Pool:a("./utils/Pool"),RevoluteConstraint:a("./constraints/RevoluteConstraint"),PrismaticConstraint:a("./constraints/PrismaticConstraint"),Ray:a("./collision/Ray"),RaycastResult:a("./collision/RaycastResult"),Box:a("./shapes/Box"),RotationalVelocityEquation:a("./equations/RotationalVelocityEquation"),SAPBroadphase:a("./collision/SAPBroadphase"),Shape:a("./shapes/Shape"),Solver:a("./solver/Solver"),Spring:a("./objects/Spring"),TopDownVehicle:a("./objects/TopDownVehicle"),LinearSpring:a("./objects/LinearSpring"),RotationalSpring:a("./objects/RotationalSpring"),Utils:a("./utils/Utils"),World:a("./world/World"),vec2:a("./math/vec2"),version:a("../package.json").version};Object.defineProperty(e,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(r,t){function e(a){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(a={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),a=a||{};var t=this.width=a.width||1,l=this.height=a.height||1,p=[d.fromValues(-t/2,-l/2),d.fromValues(t/2,-l/2),d.fromValues(t/2,l/2),d.fromValues(-t/2,l/2)],c=[d.fromValues(1,0),d.fromValues(0,1)];a.vertices=p,a.axes=c,a.type=n.BOX,s.call(this,a)}var d=r("../math/vec2"),n=r("./Shape"),s=r("./Convex");t.exports=e,(e.prototype=new s).constructor=e,e.prototype.computeMomentOfInertia=function(a){var t=this.width,e=this.height;return a*(e*e+t*t)/12},e.prototype.updateBoundingRadius=function(){var a=this.width,t=this.height;this.boundingRadius=x(a*a+t*t)/2},d.create(),d.create(),d.create(),d.create(),e.prototype.computeAABB=function(a,t,e){a.setFromPoints(this.vertices,t,e,0)},e.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(o,t){function e(e){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(e={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),e=e||{},this.length=e.length||1,this.radius=e.radius||1,e.type=i.CAPSULE,i.call(this,e)}var i=o("./Shape"),_=o("../math/vec2");t.exports=e,(e.prototype=new i).constructor=e,e.prototype.computeMomentOfInertia=function(a){var t=this.radius,e=this.length+t,r=2*t;return a*(r*r+e*e)/12},e.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},e.prototype.updateArea=function(){this.area=P*this.radius*this.radius+2*this.radius*this.length};var n=_.create();e.prototype.computeAABB=function(a,t,e){var r=this.radius;_.set(n,this.length/2,0),0!==e&&_.rotate(n,n,e),_.set(a.upperBound,d(n[0]+r,-n[0]+r),d(n[1]+r,-n[1]+r)),_.set(a.lowerBound,l(n[0]-r,-n[0]-r),l(n[1]-r,-n[1]-r)),_.add(a.lowerBound,a.lowerBound,t),_.add(a.upperBound,a.upperBound,t)};var s=_.create(),r=_.create(),c=_.create(),u=_.create(),h=_.fromValues(0,1);e.prototype.raycast=function(l,t,e,o){for(var i=t.from,n=t.to,a=(t.direction,s),p=r,d=c,f=u,v=this.length/2,R=0,m;2>R;R++)if(m=this.radius*(2*R-1),_.set(d,-v,m),_.set(f,v,m),_.toGlobalFrame(d,d,e,o),_.toGlobalFrame(f,f,e,o),0<=(L=_.getLineSegmentsIntersectionFraction(i,n,d,f))&&(_.rotate(p,h,o),_.scale(p,p,2*R-1),t.reportIntersection(l,L,p,-1),l.shouldStop(t)))return;for(var g=T(this.radius,2)+T(v,2),R=0;2>R;R++){_.set(d,v*(2*R-1),0),_.toGlobalFrame(d,d,e,o);var A=T(n[0]-i[0],2)+T(n[1]-i[1],2),b=2*((n[0]-i[0])*(i[0]-d[0])+(n[1]-i[1])*(i[1]-d[1])),M=T(i[0]-d[0],2)+T(i[1]-d[1],2)-T(this.radius,2),L=T(b,2)-4*A*M;if(!(0>L))if(!(0===L)){var B=x(L),P=1/(2*A),w=(-b-B)*P,S=(-b+B)*P;if(0<=w&&1>=w&&(_.lerp(a,i,n,w),_.squaredDistance(a,e)>g&&(_.sub(p,a,d),_.normalize(p,p),t.reportIntersection(l,w,p,-1),l.shouldStop(t))))return;if(0<=S&&1>=S&&(_.lerp(a,i,n,S),_.squaredDistance(a,e)>g&&(_.sub(p,a,d),_.normalize(p,p),t.reportIntersection(l,S,p,-1),l.shouldStop(t))))return}else if(_.lerp(a,i,n,L),_.squaredDistance(a,e)>g&&(_.sub(p,a,d),_.normalize(p,p),t.reportIntersection(l,L,p,-1),l.shouldStop(t)))return}}},{"../math/vec2":30,"./Shape":45}],39:[function(o,t){function e(e){"number"==typeof arguments[0]&&(e={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),e=e||{},this.radius=e.radius||1,e.type=i.CIRCLE,i.call(this,e)}var i=o("./Shape"),_=o("../math/vec2");t.exports=e,(e.prototype=new i).constructor=e,e.prototype.computeMomentOfInertia=function(a){var t=this.radius;return a*t*t/2},e.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},e.prototype.updateArea=function(){this.area=P*this.radius*this.radius},e.prototype.computeAABB=function(a,t){var e=this.radius;_.set(a.upperBound,e,e),_.set(a.lowerBound,-e,-e),t&&(_.add(a.lowerBound,a.lowerBound,t),_.add(a.upperBound,a.upperBound,t))};var s=_.create(),a=_.create();e.prototype.raycast=function(r,t,e){var o=t.from,n=t.to,i=this.radius,c=T(n[0]-o[0],2)+T(n[1]-o[1],2),l=2*((n[0]-o[0])*(o[0]-e[0])+(n[1]-o[1])*(o[1]-e[1])),h=T(o[0]-e[0],2)+T(o[1]-e[1],2)-T(i,2),u=T(l,2)-4*c*h,d=s,f=a;if(!(0>u))if(0==u)_.lerp(d,o,n,u),_.sub(f,d,e),_.normalize(f,f),t.reportIntersection(r,u,f,-1);else{var v=x(u),y=1/(2*c),m=(-l-v)*y,g=(-l+v)*y;if(0<=m&&1>=m&&(_.lerp(d,o,n,m),_.sub(f,d,e),_.normalize(f,f),t.reportIntersection(r,m,f,-1),r.shouldStop(t)))return;0<=g&&1>=g&&(_.lerp(d,o,n,g),_.sub(f,d,e),_.normalize(f,f),t.reportIntersection(r,g,f,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(o,t){function _(n){Array.isArray(arguments[0])&&(n={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),n=n||{},this.vertices=[];for(var t=void 0===n.vertices?[]:n.vertices,e=0,o;e<t.length;e++)o=b.create(),b.copy(o,t[e]),this.vertices.push(o);if(this.axes=[],n.axes)for(e=0;e<n.axes.length;e++){var s=b.create();b.copy(s,n.axes[e]),this.axes.push(s)}else for(e=0;e<this.vertices.length;e++){var a=this.vertices[e],r=this.vertices[(e+1)%this.vertices.length],d=b.create();b.sub(d,r,a),b.rotate90cw(d,d),b.normalize(d,d),this.axes.push(d)}if(this.centerOfMass=b.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,n.type=m.CONVEX,m.call(this,n),this.updateBoundingRadius(),this.updateArea(),0>this.area)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var m=o("./Shape"),b=o("../math/vec2"),g=o("../math/polyk");o("poly-decomp"),t.exports=_,(_.prototype=new m).constructor=_;var e=b.create(),r=b.create();_.prototype.projectOntoLocalAxis=function(r,t){for(var s=null,n=null,a=0,d,o;a<this.vertices.length;a++)d=this.vertices[a],o=b.dot(d,e),(null===s||o>s)&&(s=o),(null===n||o<n)&&(n=o);if(n>s){var i=n;n=s,s=i}b.set(t,n,s)},_.prototype.projectOntoWorldAxis=function(s,t,e,o){var i=r;this.projectOntoLocalAxis(s,o),0===e?i=s:b.rotate(i,s,e);var n=b.dot(t,i);b.set(o,o[0]+n,o[1]+n)},_.prototype.updateTriangles=function(){this.triangles.length=0;for(var a=[],t=0,e;t<this.vertices.length;t++)e=this.vertices[t],a.push(e[0],e[1]);for(var o=g.Triangulate(a),t=0;t<o.length;t+=3){var i=o[t],n=o[t+1],s=o[t+2];this.triangles.push([i,n,s])}};var i=b.create(),s=b.create(),l=b.create(),p=b.create(),u=b.create();b.create(),b.create(),b.create(),b.create(),_.prototype.updateCenterOfMass=function(){var d=this.triangles,t=this.vertices,e=this.centerOfMass,o=i,n=l,a=p,r=u,c=s;b.set(e,0,0);for(var h=0,f=0;f!==d.length;f++){var y=d[f],n=t[y[0]],a=t[y[1]],r=t[y[2]];b.centroid(o,n,a,r);var m=_.triangleArea(n,a,r);h+=m,b.scale(c,o,m),b.add(e,e,c)}b.scale(e,e,1/h)},_.prototype.computeMomentOfInertia=function(s){for(var t=0,e=0,o=this.vertices.length,i=o-1,n=0;n<o;i=n,n++){var a=this.vertices[i],r=this.vertices[n],d=$(b.crossLength(a,r));t+=d*(b.dot(r,r)+b.dot(r,a)+b.dot(a,a)),e+=d}return s/6*(t/e)},_.prototype.updateBoundingRadius=function(){for(var a=this.vertices,t=0,e=0,r;e!==a.length;e++)r=b.squaredLength(a[e]),r>t&&(t=r);this.boundingRadius=x(t)},_.triangleArea=function(a,t,e){return .5*((t[0]-a[0])*(e[1]-a[1])-(e[0]-a[0])*(t[1]-a[1]))},_.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var i=this.triangles,t=this.vertices,e=0;e!==i.length;e++){var o=i[e],n=t[o[0]],s=t[o[1]],a=t[o[2]],r=_.triangleArea(n,s,a);this.area+=r}},_.prototype.computeAABB=function(a,t,e){a.setFromPoints(this.vertices,t,e,0)};var T=b.create(),f=b.create(),v=b.create();_.prototype.raycast=function(s,t,e,o){var i=T,n=f,a=v,r=this.vertices;b.toLocalFrame(i,t.from,e,o),b.toLocalFrame(n,t.to,e,o);for(var c=r.length,m=0;m<c&&!s.shouldStop(t);m++){var l=r[m],p=r[(m+1)%c],u=b.getLineSegmentsIntersectionFraction(i,n,l,p);0<=u&&(b.sub(a,p,l),b.rotate(a,a,-P/2+o),b.normalize(a,a),t.reportIntersection(s,u,a,m))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(o,t){function e(a){if(Array.isArray(arguments[0])){if(a={heights:arguments[0]},"object"==typeof arguments[1])for(var t in arguments[1])a[t]=arguments[1][t];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}a=a||{},this.heights=a.heights?a.heights.slice(0):[],this.maxValue=a.maxValue||null,this.minValue=a.minValue||null,this.elementWidth=a.elementWidth||.1,void 0!==a.maxValue&&void 0!==a.minValue||this.updateMaxMinValues(),a.type=i.HEIGHTFIELD,i.call(this,a)}var i=o("./Shape"),x=o("../math/vec2");o("../utils/Utils"),t.exports=e,(e.prototype=new i).constructor=e,e.prototype.updateMaxMinValues=function(){for(var a=this.heights,t=a[0],e=a[0],r=0,o;r!==a.length;r++)o=a[r],o>t&&(t=o),o<e&&(e=o);this.maxValue=t,this.minValue=e},e.prototype.computeMomentOfInertia=function(){return z},e.prototype.updateBoundingRadius=function(){this.boundingRadius=z},e.prototype.updateArea=function(){for(var a=this.heights,t=0,e=0;e<a.length-1;e++)t+=(a[e]+a[e+1])/2*this.elementWidth;this.area=t};var n=[x.create(),x.create(),x.create(),x.create()];e.prototype.computeAABB=function(a,t,e){x.set(n[0],0,this.maxValue),x.set(n[1],this.elementWidth*this.heights.length,this.maxValue),x.set(n[2],this.elementWidth*this.heights.length,this.minValue),x.set(n[3],0,this.minValue),a.setFromPoints(n,t,e)},e.prototype.getLineSegment=function(a,t,e){var r=this.heights,o=this.elementWidth;x.set(a,e*o,r[e]),x.set(t,(e+1)*o,r[e+1])},e.prototype.getSegmentIndex=function(e){return R(e[0]/this.elementWidth)},e.prototype.getClampedSegmentIndex=function(a){var t=this.getSegmentIndex(a);return t=l(this.heights.length,d(t,0))},x.create();var s=x.create(),r=x.create(),c=x.create(),h=x.create(),_=x.create();x.fromValues(0,1),e.prototype.raycast=function(l,t,e,o){var i=t.from,n=t.to,a=(t.direction,s),p=r,d=c,u=h,f=_;x.toLocalFrame(u,i,e,o),x.toLocalFrame(f,n,e,o);var y=this.getClampedSegmentIndex(u),m=this.getClampedSegmentIndex(f);if(y>m){var g=y;y=m,m=g}for(var v=0;v<this.heights.length-1;v++){this.getLineSegment(p,d,v);var b=x.getLineSegmentsIntersectionFraction(u,f,p,d);if(0<=b&&(x.sub(a,d,p),x.rotate(a,a,o+P/2),x.normalize(a,a),t.reportIntersection(l,b,a,-1),l.shouldStop(t)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(o,t){function e(e){"number"==typeof arguments[0]&&(e={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),e=e||{},this.length=e.length||1,e.type=i.LINE,i.call(this,e)}var i=o("./Shape"),m=o("../math/vec2");t.exports=e,(e.prototype=new i).constructor=e,e.prototype.computeMomentOfInertia=function(e){return e*T(this.length,2)/12},e.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var n=[m.create(),m.create()];e.prototype.computeAABB=function(a,t,e){var r=this.length/2;m.set(n[0],-r,0),m.set(n[1],r,0),a.setFromPoints(n,t,e,0)},m.create();var a=m.create(),r=m.create(),s=m.create(),d=m.fromValues(0,1);e.prototype.raycast=function(l,t,e,o){var i=t.from,n=t.to,c=r,p=s,u=this.length/2;m.set(c,-u,0),m.set(p,u,0),m.toGlobalFrame(c,c,e,o),m.toGlobalFrame(p,p,e,o);var g=m.getLineSegmentsIntersectionFraction(c,p,i,n);if(0<=g){var h=a;m.rotate(h,d,o),t.reportIntersection(l,g,h,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(a,t){function e(e){(e=e||{}).type=r.PARTICLE,r.call(this,e)}var r=a("./Shape"),o=a("../math/vec2");t.exports=e,(e.prototype=new r).constructor=e,e.prototype.computeMomentOfInertia=function(){return 0},e.prototype.updateBoundingRadius=function(){this.boundingRadius=0},e.prototype.computeAABB=function(a,t){o.copy(a.lowerBound,t),o.copy(a.upperBound,t)}},{"../math/vec2":30,"./Shape":45}],44:[function(o,t){function e(e){(e=e||{}).type=i.PLANE,i.call(this,e)}var i=o("./Shape"),m=o("../math/vec2");o("../utils/Utils"),t.exports=e,(e.prototype=new i).constructor=e,e.prototype.computeMomentOfInertia=function(){return 0},e.prototype.updateBoundingRadius=function(){this.boundingRadius=z},e.prototype.computeAABB=function(s,t,e){var o=e%(2*P),i=m.set,n=s.lowerBound,a=s.upperBound;i(n,-1e7,-1e7),i(a,1e7,1e7),0==o?a[1]=0:o==P/2?n[0]=0:o===P?n[1]=0:o==3*P/2&&(a[0]=0)},e.prototype.updateArea=function(){this.area=z};var s=m.create(),a=(m.create(),m.create(),m.create()),r=m.create();e.prototype.raycast=function(c,t,e,o){var i=t.from,n=t.to,g=t.direction,l=s,p=a,u=r;m.set(p,0,1),m.rotate(p,p,o),m.sub(u,i,e);var d=m.dot(u,p);if(m.sub(u,n,e),!(0<d*m.dot(u,p)||m.squaredDistance(i,n)<d*d)){var h=m.dot(p,g);m.sub(l,i,e);var f=-m.dot(p,l)/h/t.length;t.reportIntersection(c,f,p,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(a,t){function e(a){a=a||{},this.body=null,this.position=r.fromValues(0,0),a.position&&r.copy(this.position,a.position),this.angle=a.angle||0,this.type=a.type||0,this.id=e.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0===a.collisionGroup?1:a.collisionGroup,this.collisionResponse=void 0===a.collisionResponse||a.collisionResponse,this.collisionMask=void 0===a.collisionMask?1:a.collisionMask,this.material=a.material||null,this.area=0,this.sensor=void 0!==a.sensor&&a.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}t.exports=e;var r=a("../math/vec2");e.idCounter=0,e.CIRCLE=1,e.PARTICLE=2,e.PLANE=4,e.CONVEX=8,e.LINE=16,e.BOX=32,e.CAPSULE=64,e.HEIGHTFIELD=128,e.prototype.computeMomentOfInertia=function(){},e.prototype.updateBoundingRadius=function(){},e.prototype.updateArea=function(){},e.prototype.computeAABB=function(){},e.prototype.raycast=function(){}},{"../math/vec2":30}],46:[function(o,t){function e(e){s.call(this,e,s.GS),e=e||{},this.iterations=e.iterations||10,this.tolerance=e.tolerance||1e-7,this.arrayStep=30,this.lambda=new x.ARRAY_TYPE(this.arrayStep),this.Bs=new x.ARRAY_TYPE(this.arrayStep),this.invCs=new x.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0===e.frictionIterations?e.frictionIterations:0,this.usedIterations=0}function i(a){for(var t=a.length;t--;)a[t]=0}var n=o("../math/vec2"),s=o("./Solver"),x=o("../utils/Utils"),a=o("../equations/FrictionEquation");t.exports=e,(e.prototype=new s).constructor=e,e.prototype.solve=function(r,t){this.sortEquations();var s=0,o=this.iterations,c=this.frictionIterations,h=this.equations,l=h.length,p=T(this.tolerance*l,2),u=t.bodies,d=t.bodies.length,f=(n.add,n.set,this.useZeroRHS),v=this.lambda;if(this.usedIterations=0,l)for(g=0;g!==d;g++)(A=u[g]).updateSolveMassProperties();v.length<l&&(v=this.lambda=new x.ARRAY_TYPE(l+this.arrayStep),this.Bs=new x.ARRAY_TYPE(l+this.arrayStep),this.invCs=new x.ARRAY_TYPE(l+this.arrayStep)),i(v);for(var y=this.invCs,m=this.Bs,v=this.lambda,g=0;g!==h.length;g++)((_=h[g]).timeStep!==r||_.needsUpdate)&&(_.timeStep=r,_.update()),m[g]=_.computeB(_.a,_.b,r),y[g]=_.computeInvC(_.epsilon);var _,b,E;if(0!==l){for(g=0;g!==d;g++){var A=u[g];A.resetConstraintVelocity()}if(c){for(s=0;s!==c;s++){for(b=0,E=0;E!==l;E++)_=h[E],S=e.iterateEquation(E,_,_.epsilon,m,y,v,f,r,s),b+=$(S);if(this.usedIterations++,b*b<=p)break}for(e.updateMultipliers(h,v,1/r),E=0;E!==l;E++){var R=h[E];if(R instanceof a){for(var P=0,M=0;M!==R.contactEquations.length;M++)P+=R.contactEquations[M].multiplier;P*=R.frictionCoefficient/R.contactEquations.length,R.maxForce=P,R.minForce=-P}}}for(s=0;s!==o;s++){for(b=0,E=0;E!==l;E++){_=h[E];var S=e.iterateEquation(E,_,_.epsilon,m,y,v,f,r,s);b+=$(S)}if(this.usedIterations++,b*b<=p)break}for(g=0;g!==d;g++)u[g].addConstraintVelocity();e.updateMultipliers(h,v,1/r)}},e.updateMultipliers=function(a,t,e){for(var r=a.length;r--;)a[r].multiplier=t[r]*e},e.iterateEquation=function(c,t,e,o,i,n,s,a){var r=o[c],m=i[c],l=n[c],p=t.computeGWlambda(),u=t.maxForce,d=t.minForce;s&&(r=0);var g=m*(r-p-e*l),h=l+g;return h<d*a?g=d*a-l:h>u*a&&(g=u*a-l),n[c]+=g,t.addToWlambda(g),g}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(a,t){function e(a,t){a=a||{},r.call(this),this.type=t,this.equations=[],this.equationSortFunction=a.equationSortFunction||!1}a("../utils/Utils");var r=a("../events/EventEmitter");t.exports=e,(e.prototype=new r).constructor=e,e.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")};var o={bodies:[]};e.prototype.solveIsland=function(a,t){this.removeAllEquations(),t.equations.length&&(this.addEquations(t.equations),o.bodies.length=0,t.getBodies(o.bodies),o.bodies.length&&this.solve(a,o))},e.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},e.prototype.addEquation=function(e){e.enabled&&this.equations.push(e)},e.prototype.addEquations=function(a){for(var t=0,e=a.length,r;t!==e;t++)r=a[t],r.enabled&&this.equations.push(r)},e.prototype.removeEquation=function(a){var t=this.equations.indexOf(a);-1!==t&&this.equations.splice(t,1)},e.prototype.removeAllEquations=function(){this.equations.length=0},e.GS=1,e.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(a,t){function e(){o.apply(this,arguments)}var r=a("../equations/ContactEquation"),o=a("./Pool");t.exports=e,(e.prototype=new o).constructor=e,e.prototype.create=function(){return new r},e.prototype.destroy=function(e){return e.bodyA=e.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(a,t){function e(){o.apply(this,arguments)}var r=a("../equations/FrictionEquation"),o=a("./Pool");t.exports=e,(e.prototype=new o).constructor=e,e.prototype.create=function(){return new r},e.prototype.destroy=function(e){return e.bodyA=e.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(a,t){function e(){o.apply(this,arguments)}var r=a("../world/IslandNode"),o=a("./Pool");t.exports=e,(e.prototype=new o).constructor=e,e.prototype.create=function(){return new r},e.prototype.destroy=function(e){return e.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(a,t){function e(){o.apply(this,arguments)}var r=a("../world/Island"),o=a("./Pool");t.exports=e,(e.prototype=new o).constructor=e,e.prototype.create=function(){return new r},e.prototype.destroy=function(e){return e.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(a,t){function e(){this.overlappingShapesLastState=new r,this.overlappingShapesCurrentState=new r,this.recordPool=new o({size:16}),this.tmpDict=new r,this.tmpArray1=[]}var r=a("./TupleDictionary"),o=(a("./OverlapKeeperRecord"),a("./OverlapKeeperRecordPool"));a("./Utils"),t.exports=e,e.prototype.tick=function(){for(var a=this.overlappingShapesLastState,t=this.overlappingShapesCurrentState,e=a.keys.length;e--;){var r=a.keys[e],o=a.getByKey(r);t.getByKey(r),o&&this.recordPool.release(o)}a.reset(),a.copy(t),t.reset()},e.prototype.setOverlapping=function(a,t,e,r){this.overlappingShapesLastState;var o=this.overlappingShapesCurrentState;if(!o.get(t.id,r.id)){var n=this.recordPool.get();n.set(a,t,e,r),o.set(t.id,r.id,n)}},e.prototype.getNewOverlaps=function(e){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,e)},e.prototype.getEndOverlaps=function(e){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,e)},e.prototype.bodiesAreOverlapping=function(a,t){for(var e=this.overlappingShapesCurrentState,r=e.keys.length;r--;){var o=e.keys[r],n=e.data[o];if(n.bodyA===a&&n.bodyB===t||n.bodyA===t&&n.bodyB===a)return!0}return!1},e.prototype.getDiff=function(i,t,e){var o=t;(e=e||[]).length=0;for(var n=o.keys.length;n--;){var s=o.keys[n],a=o.data[s];if(!a)throw new Error("Key "+s+" had no data!");i.data[s]||e.push(a)}return e},e.prototype.isNewOverlap=function(a,t){var e=0|a.id,r=0|t.id,o=this.overlappingShapesLastState,n=this.overlappingShapesCurrentState;return!o.get(e,r)&&!!n.get(e,r)},e.prototype.getNewBodyOverlaps=function(a){this.tmpArray1.length=0;var t=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(t,a)},e.prototype.getEndBodyOverlaps=function(a){this.tmpArray1.length=0;var t=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(t,a)},e.prototype.getBodyDiff=function(a,t){t=t||[];for(var e=this.tmpDict,r=a.length,o;r--;)o=a[r],e.set(0|o.bodyA.id,0|o.bodyB.id,o);for(r=e.keys.length;r--;)(o=e.getByKey(e.keys[r]))&&t.push(o.bodyA,o.bodyB);return e.reset(),t}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(a,t){function r(a,t,e,r){this.shapeA=t,this.shapeB=r,this.bodyA=a,this.bodyB=e}t.exports=r,r.prototype.set=function(a,t,e,o){r.call(this,a,t,e,o)}},{}],54:[function(a,t){function e(){o.apply(this,arguments)}var r=a("./OverlapKeeperRecord"),o=a("./Pool");t.exports=e,(e.prototype=new o).constructor=e,e.prototype.create=function(){return new r},e.prototype.destroy=function(e){return e.bodyA=e.bodyB=e.shapeA=e.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(a,t){function e(e){e=e||{},this.objects=[],void 0!==e.size&&this.resize(e.size)}t.exports=e,e.prototype.resize=function(a){for(var t=this.objects;t.length>a;)t.pop();for(;t.length<a;)t.push(this.create());return this},e.prototype.get=function(){var e=this.objects;return e.length?e.pop():this.create()},e.prototype.release=function(e){return this.destroy(e),this.objects.push(e),this}},{}],56:[function(a,t){function e(){this.data={},this.keys=[]}var r=a("./Utils");t.exports=e,e.prototype.getKey=function(a,t){return a|=0,t|=0,(0|a)==(0|t)?-1:0|((0|a)>(0|t)?a<<16|65535&t:t<<16|65535&a)},e.prototype.getByKey=function(e){return e|=0,this.data[e]},e.prototype.get=function(a,t){return this.data[this.getKey(a,t)]},e.prototype.set=function(a,t,e){if(!e)throw new Error("No data!");var r=this.getKey(a,t);return this.data[r]||this.keys.push(r),this.data[r]=e,r},e.prototype.reset=function(){for(var a=this.data,t=this.keys,e=t.length;e--;)delete a[t[e]];t.length=0},e.prototype.copy=function(a){this.reset(),r.appendArray(this.keys,a.keys);for(var t=a.keys.length,e;t--;)e=a.keys[t],this.data[e]=a.data[e]}},{"./Utils":57}],57:[function(a,t){function e(){}t.exports=e,e.appendArray=function(a,t){if(15e4>t.length)a.push.apply(a,t);else for(var e=0,r=t.length;e!==r;++e)a.push(t[e])},e.splice=function(a,t,e){e=e||1;for(var r=t,o=a.length-e;r<o;r++)a[r]=a[r+e];a.length=o},e.ARRAY_TYPE="undefined"==typeof P2_ARRAY_TYPE?"undefined"==typeof Float32Array?Array:Float32Array:P2_ARRAY_TYPE,e.extend=function(a,t){for(var e in t)a[e]=t[e]},e.defaults=function(a,t){for(var e in a=a||{},t)e in a||(a[e]=t[e]);return a}},{}],58:[function(a,t){function e(){this.equations=[],this.bodies=[]}var r=a("../objects/Body");t.exports=e,e.prototype.reset=function(){this.equations.length=this.bodies.length=0};var d=[];e.prototype.getBodies=function(a){var t=a||[],e=this.equations;d.length=0;for(var r=0,o;r!==e.length;r++)o=e[r],-1===d.indexOf(o.bodyA.id)&&(t.push(o.bodyA),d.push(o.bodyA.id)),-1===d.indexOf(o.bodyB.id)&&(t.push(o.bodyB),d.push(o.bodyB.id));return t},e.prototype.wantsToSleep=function(){for(var a=0,t;a<this.bodies.length;a++)if(t=this.bodies[a],t.type===r.DYNAMIC&&!t.wantsToSleep)return!1;return!0},e.prototype.sleep=function(){for(var e=0;e<this.bodies.length;e++)this.bodies[e].sleep();return!0}},{"../objects/Body":31}],59:[function(r,t){function l(){this.nodePool=new e({size:16}),this.islandPool=new o({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}r("../math/vec2"),r("./Island"),r("./IslandNode");var e=r("./../utils/IslandNodePool"),o=r("./../utils/IslandPool"),d=r("../objects/Body");t.exports=l,l.getUnvisitedNode=function(a){for(var t=a.length,e=0,r;e!==t;e++)if(r=a[e],!r.visited&&r.body.type===d.DYNAMIC)return r;return!1},l.prototype.visit=function(a,t,e){t.push(a.body);for(var r=a.equations.length,o=0,n;o!==r;o++)n=a.equations[o],-1===e.indexOf(n)&&e.push(n)},l.prototype.bfs=function(a,t,e){var o=this.queue;for(o.length=0,o.push(a),a.visited=!0,this.visit(a,t,e);o.length;)for(var n=o.pop(),r;r=l.getUnvisitedNode(n.neighbors);)r.visited=!0,this.visit(r,t,e),r.body.type===d.DYNAMIC&&o.push(r)},l.prototype.split=function(i){for(var t=i.bodies,e=this.nodes,o=this.equations;e.length;)this.nodePool.release(e.pop());for(r=0;r!==t.length;r++){var n=this.nodePool.get();n.body=t[r],e.push(n)}for(var s=0;s!==o.length;s++){var a=o[s],r=t.indexOf(a.bodyA),c=t.indexOf(a.bodyB),m=e[r],g=e[c];m.neighbors.push(g),g.neighbors.push(m),m.equations.push(a),g.equations.push(a)}for(var p=this.islands,r=0;r<p.length;r++)this.islandPool.release(p[r]);p.length=0;for(var u,d;u=l.getUnvisitedNode(e);)d=this.islandPool.get(),this.bfs(u,d.bodies,d.equations),p.push(d);return p}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(a,t){function e(e){this.body=e,this.neighbors=[],this.equations=[],this.visited=!1}t.exports=e,e.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(o,t){function J(a){n.apply(this),a=a||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=a.solver||new e,this.narrowphase=new u(this),this.islandManager=new y,this.gravity=Q.fromValues(0,-9.78),a.gravity&&Q.copy(this.gravity,a.gravity),this.frictionGravity=Q.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=a.broadphase||new p,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new i,this.defaultContactMaterial=new d(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit=void 0===a.islandSplit||!!a.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=J.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new g}var e=o("../solver/GSSolver"),Q=(o("../solver/Solver"),o("../collision/Ray"),o("../math/vec2")),s=o("../shapes/Circle"),a=o("../shapes/Convex"),r=(o("../shapes/Line"),o("../shapes/Plane")),c=o("../shapes/Capsule"),h=o("../shapes/Particle"),n=o("../events/EventEmitter"),x=o("../objects/Body"),i=(o("../shapes/Shape"),o("../objects/LinearSpring"),o("../material/Material")),d=o("../material/ContactMaterial"),l=(o("../constraints/DistanceConstraint"),o("../constraints/Constraint"),o("../constraints/LockConstraint"),o("../constraints/RevoluteConstraint"),o("../constraints/PrismaticConstraint"),o("../constraints/GearConstraint"),o("../../package.json"),o("../collision/Broadphase"),o("../collision/AABB")),p=o("../collision/SAPBroadphase"),u=o("../collision/Narrowphase"),m=o("../utils/Utils"),g=o("../utils/OverlapKeeper"),y=o("./IslandManager");o("../objects/RotationalSpring"),t.exports=J,J.prototype=Object(n.prototype),J.prototype.constructor=J,J.NO_SLEEPING=1,J.BODY_SLEEPING=2,J.ISLAND_SLEEPING=4,J.prototype.addConstraint=function(e){this.constraints.push(e)},J.prototype.addContactMaterial=function(e){this.contactMaterials.push(e)},J.prototype.removeContactMaterial=function(a){var t=this.contactMaterials.indexOf(a);-1!==t&&m.splice(this.contactMaterials,t,1)},J.prototype.getContactMaterial=function(a,t){for(var e=this.contactMaterials,r=0,o=e.length,n;r!==o;r++)if(n=e[r],n.materialA.id===a.id&&n.materialB.id===t.id||n.materialA.id===t.id&&n.materialB.id===a.id)return n;return!1},J.prototype.removeConstraint=function(a){var t=this.constraints.indexOf(a);-1!==t&&m.splice(this.constraints,t,1)},Q.create(),Q.create(),Q.create(),Q.create(),Q.create(),Q.create();var $=Q.create(),_=Q.fromValues(0,0),R=Q.fromValues(0,0);Q.fromValues(0,0),Q.fromValues(0,0),J.prototype.step=function(s,t,e){if(e=e||10,0===(t=t||0))this.internalStep(s),this.time+=s;else{this.accumulator+=t;for(var o=0;this.accumulator>=s&&o<e;)this.internalStep(s),this.time+=s,this.accumulator-=s,o++;for(var i=this.accumulator%s/s,n=0,a;n!==this.bodies.length;n++)a=this.bodies[n],Q.lerp(a.interpolatedPosition,a.previousPosition,a.position,i),a.interpolatedAngle=a.previousAngle+i*(a.angle-a.previousAngle)}};var f=[];J.prototype.internalStep=function(i){this.stepping=!0;var t=this.springs.length,e=this.springs,o=this.bodies,n=this.gravity,a=this.solver,r=this.bodies.length,s=this.broadphase,c=this.narrowphase,l=this.constraints,p=$,d=(Q.scale,Q.add),u=(Q.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=i,this.useWorldGravityAsFrictionGravity){var g=Q.length(this.gravity);0===g&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=g)}if(this.applyGravity)for(E=0;E!==r;E++){var h=(y=o[E]).force;y.type===x.DYNAMIC&&y.sleepState!==x.SLEEPING&&(Q.scale(p,n,y.mass*y.gravityScale),d(h,h,p))}if(this.applySpringForces)for(E=0;E!==t;E++)e[E].applyForce();if(this.applyDamping)for(E=0;E!==r;E++){var y=o[E];y.type===x.DYNAMIC&&y.applyDamping(i)}for(var v=s.getCollisionPairs(this),b=this.disabledBodyCollisionPairs,E=b.length-2;0<=E;E-=2)for(w=v.length-2;0<=w;w-=2)(b[E]===v[w]&&b[E+1]===v[w+1]||b[E+1]===v[w]&&b[E]===v[w+1])&&v.splice(w,2);for(V=l.length,E=0;E!==V;E++){var P=l[E];if(!P.collideConnected)for(var w=v.length-2;0<=w;w-=2)(P.bodyA===v[w]&&P.bodyB===v[w+1]||P.bodyB===v[w]&&P.bodyA===v[w+1])&&v.splice(w,2)}this.postBroadphaseEvent.pairs=v,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,c.reset(this);for(var E=0,S=v.length;E!==S;E+=2)for(var C=v[E],A=v[E+1],L=0,B=C.shapes.length;L!==B;L++)for(var M=C.shapes[L],I=M.position,R=M.angle,F=0,T=A.shapes.length;F!==T;F++){var N=A.shapes[F],G=N.position,O=N.angle,U=this.defaultContactMaterial;if(M.material&&N.material){var k=this.getContactMaterial(M.material,N.material);k&&(U=k)}this.runNarrowphase(c,C,M,I,R,A,N,G,O,U,this.frictionGravity)}for(E=0;E!==r;E++)(X=o[E])._wakeUpAfterNarrowphase&&(X.wakeUp(),X._wakeUpAfterNarrowphase=!1);if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(f);for(var _=this.endContactEvent,F=f.length,D;F--;)D=f[F],_.shapeA=D.shapeA,_.shapeB=D.shapeB,_.bodyA=D.bodyA,_.bodyB=D.bodyB,this.emit(_);f.length=0}var W=this.preSolveEvent;W.contactEquations=c.contactEquations,W.frictionEquations=c.frictionEquations,this.emit(W),W.contactEquations=W.frictionEquations=null;var V=l.length;for(E=0;E!==V;E++)l[E].update();if(c.contactEquations.length||c.frictionEquations.length||V)if(this.islandSplit){for(u.equations.length=0,m.appendArray(u.equations,c.contactEquations),m.appendArray(u.equations,c.frictionEquations),E=0;E!==V;E++)m.appendArray(u.equations,l[E].equations);for(u.split(this),E=0;E!==u.islands.length;E++)(q=u.islands[E]).equations.length&&a.solveIsland(i,q)}else{for(a.addEquations(c.contactEquations),a.addEquations(c.frictionEquations),E=0;E!==V;E++)a.addEquations(l[E].equations);this.solveConstraints&&a.solve(i,this),a.removeAllEquations()}for(E=0;E!==r;E++){var X=o[E];X.integrate(i)}for(E=0;E!==r;E++)o[E].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var z=this.impactEvent,E=0,j;E!==c.contactEquations.length;E++)j=c.contactEquations[E],j.firstImpact&&(z.bodyA=j.bodyA,z.bodyB=j.bodyB,z.shapeA=j.shapeA,z.shapeB=j.shapeB,z.contactEquation=j,this.emit(z));if(this.sleepMode===J.BODY_SLEEPING)for(E=0;E!==r;E++)o[E].sleepTick(this.time,!1,i);else if(this.sleepMode===J.ISLAND_SLEEPING&&this.islandSplit){for(E=0;E!==r;E++)o[E].sleepTick(this.time,!0,i);for(E=0;E<this.islandManager.islands.length;E++){var q=this.islandManager.islands[E];q.wantsToSleep()&&q.sleep()}}this.stepping=!1;for(var H=this.bodiesToBeRemoved,E=0;E!==H.length;E++)this.removeBody(H[E]);H.length=0,this.emit(this.postStepEvent)},J.prototype.runNarrowphase=function(s,t,e,o,i,n,a,r,c,u,l){if(0!=(e.collisionGroup&a.collisionMask)&&0!=(a.collisionGroup&e.collisionMask)){Q.rotate(_,o,t.angle),Q.rotate(R,r,n.angle),Q.add(_,_,t.position),Q.add(R,R,n.position);var p=i+t.angle,d=c+n.angle;s.enableFriction=0<u.friction,s.frictionCoefficient=u.friction;var h;h=t.type===x.STATIC||t.type===x.KINEMATIC?n.mass:n.type===x.STATIC||n.type===x.KINEMATIC?t.mass:t.mass*n.mass/(t.mass+n.mass),s.slipForce=u.friction*l*h,s.restitution=u.restitution,s.surfaceVelocity=u.surfaceVelocity,s.frictionStiffness=u.frictionStiffness,s.frictionRelaxation=u.frictionRelaxation,s.stiffness=u.stiffness,s.relaxation=u.relaxation,s.contactSkinSize=u.contactSkinSize,s.enabledEquations=t.collisionResponse&&n.collisionResponse&&e.collisionResponse&&a.collisionResponse;var f=s[e.type|a.type],y=0;if(f){var v=e.sensor||a.sensor,g=s.frictionEquations.length;y=e.type<a.type?f.call(s,t,e,_,p,n,a,R,d,v):f.call(s,n,a,R,d,t,e,_,p,v);var S=s.frictionEquations.length-g;if(y){if(t.allowSleep&&t.type===x.DYNAMIC&&t.sleepState===x.SLEEPING&&n.sleepState===x.AWAKE&&n.type!==x.STATIC&&Q.squaredLength(n.velocity)+T(n.angularVelocity,2)>=2*T(n.sleepSpeedLimit,2)&&(t._wakeUpAfterNarrowphase=!0),n.allowSleep&&n.type===x.DYNAMIC&&n.sleepState===x.SLEEPING&&t.sleepState===x.AWAKE&&t.type!==x.STATIC&&Q.squaredLength(t.velocity)+T(t.angularVelocity,2)>=2*T(t.sleepSpeedLimit,2)&&(n._wakeUpAfterNarrowphase=!0),this.overlapKeeper.setOverlapping(t,e,n,a),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(e,a)){var b=this.beginContactEvent;if(b.shapeA=e,b.shapeB=a,b.bodyA=t,b.bodyB=n,b.contactEquations.length=0,"number"==typeof y)for(E=s.contactEquations.length-y;E<s.contactEquations.length;E++)b.contactEquations.push(s.contactEquations[E]);this.emit(b)}if("number"==typeof y&&1<S)for(var E=s.frictionEquations.length-S,C;E<s.frictionEquations.length;E++)C=s.frictionEquations[E],C.setSlipForce(C.getSlipForce()/S)}}}},J.prototype.addSpring=function(a){this.springs.push(a);var t=this.addSpringEvent;t.spring=a,this.emit(t),t.spring=null},J.prototype.removeSpring=function(a){var t=this.springs.indexOf(a);-1!==t&&m.splice(this.springs,t,1)},J.prototype.addBody=function(a){if(-1===this.bodies.indexOf(a)){this.bodies.push(a),a.world=this;var t=this.addBodyEvent;t.body=a,this.emit(t),t.body=null}},J.prototype.removeBody=function(a){if(this.stepping)this.bodiesToBeRemoved.push(a);else{a.world=null;var t=this.bodies.indexOf(a);-1!==t&&(m.splice(this.bodies,t,1),this.removeBodyEvent.body=a,a.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},J.prototype.getBodyById=function(a){for(var t=this.bodies,e=0,r;e<t.length;e++)if(r=t[e],r.id===a)return r;return!1},J.prototype.disableBodyCollision=function(a,t){this.disabledBodyCollisionPairs.push(a,t)},J.prototype.enableBodyCollision=function(a,t){for(var e=this.disabledBodyCollisionPairs,r=0;r<e.length;r+=2)if(e[r]===a&&e[r+1]===t||e[r+1]===a&&e[r]===t)return void e.splice(r,2)},J.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var a=this.constraints,t=a.length-1;0<=t;t--)this.removeConstraint(a[t]);for(var e=this.bodies,t=e.length-1;0<=t;t--)this.removeBody(e[t]);for(var r=this.springs,t=r.length-1;0<=t;t--)this.removeSpring(r[t]);for(var o=this.contactMaterials,t=o.length-1;0<=t;t--)this.removeContactMaterial(o[t]);J.apply(this)};var P=Q.create(),E=(Q.fromValues(0,0),Q.fromValues(0,0));J.prototype.hitTest=function(l,u,e){e=e||0;var o=new x({position:l}),i=new h,n=l,p=P;o.addShape(i);for(var d=this.narrowphase,f=[],y=0,m=u.length;y!==m;y++)for(var g=u[y],v=0,_=g.shapes.length,b;v!==_;v++){b=g.shapes[v],Q.rotate(p,b.position,g.angle),Q.add(p,p,g.position);var T=b.angle+g.angle;(b instanceof s&&d.circleParticle(g,b,p,T,o,i,n,0,!0)||b instanceof a&&d.particleConvex(o,i,n,0,g,b,p,T,!0)||b instanceof r&&d.particlePlane(o,i,n,0,g,b,p,T,!0)||b instanceof c&&d.particleCapsule(o,i,n,0,g,b,p,T,!0)||b instanceof h&&Q.squaredLength(Q.sub(E,p,l))<e*e)&&f.push(g)}return f},J.prototype.setGlobalStiffness=function(r){for(var t=this.constraints,e=0;e!==t.length;e++)for(var o=t[e],i=0,n;i!==o.equations.length;i++)n=o.equations[i],n.stiffness=r,n.needsUpdate=!0;for(var s=this.contactMaterials,e=0;e!==s.length;e++)(o=s[e]).stiffness=o.frictionStiffness=r;(o=this.defaultContactMaterial).stiffness=o.frictionStiffness=r},J.prototype.setGlobalRelaxation=function(a){for(o=0;o!==this.constraints.length;o++)for(var t=this.constraints[o],e=0,r;e!==t.equations.length;e++)r=t.equations[e],r.relaxation=a,r.needsUpdate=!0;for(var o=0;o!==this.contactMaterials.length;o++)(t=this.contactMaterials[o]).relaxation=t.frictionRelaxation=a;(t=this.defaultContactMaterial).relaxation=t.frictionRelaxation=a};var v=new l,b=[];J.prototype.raycast=function(a,t){return t.getAABB(v),this.broadphase.aabbQuery(this,v,b),t.intersectBodies(a,b),b.length=0,a.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)})},521:function(e,t,a){(function(t){e.exports=t.Phaser=a(522)}).call(t,a(45))},522:function(a,r,e){var d=Number.MAX_VALUE,o=Math.asin,T=Math.sin,S=Math.cos,_=Math.atan2,E=Math.abs,F=Math.sqrt,y=Math.ceil,l=Math.pow,f=Math.round,C=Math.max,A=Math.min,R=Math.PI,x=Math.floor;(function(e){(function(){function p(a,r){this._scaleFactor=a,this._deltaMode=r,this.originalEvent=null}var c=String.fromCharCode,u=Number.POSITIVE_INFINITY,t=Math.trunc,m=this,z=z||{VERSION:"2.10.6",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,WEBGL_MULTI:4,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{},_UID:0};if(t||(t=function(e){return 0>e?y(e):x(e)}),Function.prototype.bind||(Function.prototype.bind=function(){var a=Array.prototype.slice;return function(t){function e(){var n=i.concat(a.call(arguments));r.apply(this instanceof e?this:t,n)}var r=this,i=a.call(arguments,1);if("function"!=typeof r)throw new TypeError;return e.prototype=function a(t){if(t&&(a.prototype=t),!(this instanceof a))return new a}(r.prototype),e}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.forEach||(Array.prototype.forEach=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var r=Object(this),e=r.length>>>0;if("function"!=typeof a)throw new TypeError;for(var o=2<=arguments.length?arguments[1]:void 0,i=0;i<e;i++)i in r&&a.call(o,r[i],i,r)}),"function"!=typeof window.Uint32Array&&"object"!=typeof window.Uint32Array){var i=function(e){window[e]=function(a){if("number"==typeof a)for(Array.call(this,a),this.length=a,r=0;r<this.length;r++)this[r]=0;else{Array.call(this,a.length),this.length=a.length;for(var r=0;r<this.length;r++)this[r]=a[r]}},window[e].prototype=[],window[e].constructor=window[e]};i("Float32Array"),i("Uint32Array"),i("Uint16Array"),i("Int16Array"),i("ArrayBuffer")}for(var s in window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),Object.assign||(Object.assign=function(e){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),a=Object.prototype.hasOwnProperty,i=1,n;i<arguments.length;i++)if(n=arguments[i],null!=n)for(var o in n)a.call(n,o)&&(t[o]=n[o]);return t}),z.Utils={reverseString:function(e){return e.split("").reverse().join("")},getProperty:function(a,t){var e=t.split(".");switch(e.length){case 1:return a[t];case 2:return a[e[0]][e[1]];case 3:return a[e[0]][e[1]][e[2]];case 4:return a[e[0]][e[1]][e[2]][e[3]];default:return this._getProperty(a,t);}},setProperties:function(a,t){for(var e in t)this.setProperty(a,e,t[e]);return a},setProperty:function(a,t,e){var r=t.split(".");switch(r.length){case 1:a[t]=e;break;case 2:a[r[0]][r[1]]=e;break;case 3:a[r[0]][r[1]][r[2]]=e;break;case 4:a[r[0]][r[1]][r[2]][r[3]]=e;break;default:this._setProperty(a,t,e);}},_getProperty:function(a,t){for(var e=t.split("."),i=e.length,s=0,n=a,o;s<i;){if(o=e[s],null==n)return;n=n[o],s++}return n},_setProperty:function(d,t,e){var i=t.split("."),s=i.length,n=0,o=d,r=i[0];if(1===s)d[t]=e;else{for(;n<s-1;)o=o[r],r=i[++n];o[r]=e}return d},chanceRoll:function(e){return void 0===e&&(e=50),0<e&&100*Math.random()<=e},randomChoice:function(a,t){return .5>Math.random()?a:t},parseDimension:function(a,r){var e=0,o=0;return"string"==typeof a?"%"===a.substr(-1)?(e=parseInt(a,10)/100,o=0===r?window.innerWidth*e:window.innerHeight*e):o=parseInt(a,10):o=a,o},pad:function(a,t,e,i){if(void 0===t)var t=0;if(void 0===e)var e=" ";if(void 0===i)var i=3;var s=0;if(t+1>=(a=a.toString()).length)switch(i){case 1:a=Array(t+1-a.length).join(e)+a;break;case 3:var n=y((s=t-a.length)/2),o=s-n;a=Array(o+1).join(e)+a+Array(n+1).join(e);break;default:a+=Array(t+1-a.length).join(e);}return a},isPlainObject:function(e){if("object"!=typeof e||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!{}.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},extend:function(){var i=arguments[0]||{},d=1,p=arguments.length,l=!1,c,t,e,s,n,o;for("boolean"==typeof i&&(l=i,i=arguments[1]||{},d=2),p===d&&(i=this,--d);d<p;d++)if(null!=(c=arguments[d]))for(t in c)e=i[t],i!==(s=c[t])&&(l&&s&&(z.Utils.isPlainObject(s)||(n=Array.isArray(s)))?(n?(n=!1,o=e&&Array.isArray(e)?e:[]):o=e&&z.Utils.isPlainObject(e)?e:{},i[t]=z.Utils.extend(l,o,s)):void 0!==s&&(i[t]=s));return i},mixinPrototype:function(a,t,e){void 0===e&&(e=!1);for(var d=Object.keys(t),s=0;s<d.length;s++){var n=d[s],o=t[n];!e&&n in a||(o&&("function"==typeof o.get||"function"==typeof o.set)?"function"==typeof o.clone?a[n]=o.clone():Object.defineProperty(a,n,o):a[n]=o)}},mixin:function(a,r){if(!a||"object"!=typeof a)return r;for(var e in a){var i=a[e];if(!i.childNodes&&!i.cloneNode){var n=typeof a[e];r[e]=a[e]&&"object"==n?typeof r[e]==n?z.Utils.mixin(a[e],r[e]):z.Utils.mixin(a[e],new i.constructor):a[e]}}return r}},z.Circle=function(a,t,e){a=a||0,t=t||0,e=e||0,this.x=a,this.y=t,this._diameter=e,this._radius=0,0<e&&(this._radius=.5*e),this.type=z.CIRCLE},z.Circle.prototype={circumference:function(){return 2*(R*this._radius)},random:function(a){void 0===a&&(a=new z.Point);var t=2*R*Math.random(),e=Math.random()+Math.random(),i=1<e?2-e:e,n=i*S(t),o=i*T(t);return a.x=this.x+n*this.radius,a.y=this.y+o*this.radius,a},getBounds:function(){return new z.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(a,t,e){return this.x=a,this.y=t,this._diameter=e,this._radius=.5*e,this},copyFrom:function(e){return this.setTo(e.x,e.y,e.diameter)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.diameter=this._diameter,e},distance:function(a,t){var e=z.Math.distance(this.x,this.y,a.x,a.y);return t?f(e):e},clone:function(e){return void 0===e||null===e?e=new z.Circle(this.x,this.y,this.diameter):e.setTo(this.x,this.y,this.diameter),e},contains:function(a,t){return z.Circle.contains(this,a,t)},circumferencePoint:function(a,t,e){return z.Circle.circumferencePoint(this,a,t,e)},sample:function(a,t,e,i,n){a||(a=60),null==t&&(t=0),null==e&&(e=z.Math.PI2),n||(n=[]);for(var o=0;o<a;)this.circumferencePoint(z.Math.linear(t,e,o/a),i,n[o]||(n[o]=new z.Point)),o+=1;return n},offset:function(a,t){return this.x+=a,this.y+=t,this},offsetPoint:function(e){return this.offset(e.x,e.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},z.Circle.prototype.constructor=z.Circle,Object.defineProperty(z.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(e){0<e&&(this._diameter=e,this._radius=.5*e)}}),Object.defineProperty(z.Circle.prototype,"radius",{get:function(){return this._radius},set:function(e){0<e&&(this._radius=e,this._diameter=2*e)}}),Object.defineProperty(z.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(e){e>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-e}}),Object.defineProperty(z.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(e){e<this.x?(this._radius=0,this._diameter=0):this.radius=e-this.x}}),Object.defineProperty(z.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(e){e>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-e}}),Object.defineProperty(z.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(e){e<this.y?(this._radius=0,this._diameter=0):this.radius=e-this.y}}),Object.defineProperty(z.Circle.prototype,"area",{get:function(){return 0<this._radius?R*this._radius*this._radius:0}}),Object.defineProperty(z.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(e){!0===e&&this.setTo(0,0,0)}}),z.Circle.contains=function(a,t,e){return 0<a.radius&&t>=a.left&&t<=a.right&&e>=a.top&&e<=a.bottom&&(a.x-t)*(a.x-t)+(a.y-e)*(a.y-e)<=a.radius*a.radius},z.Circle.equals=function(a,t){return a.x===t.x&&a.y===t.y&&a.diameter===t.diameter},z.Circle.intersects=function(a,t){return z.Math.distance(a.x,a.y,t.x,t.y)<=a.radius+t.radius},z.Circle.circumferencePoint=function(a,t,e,r){return void 0===e&&(e=!1),void 0===r&&(r=new z.Point),!0===e&&(t=z.Math.degToRad(t)),r.x=a.x+a.radius*S(t),r.y=a.y+a.radius*T(t),r},z.Circle.intersectsRectangle=function(a,t){var e=E(a.x-t.x-t.halfWidth);if(e>t.halfWidth+a.radius)return!1;var r=E(a.y-t.y-t.halfHeight);if(r>t.halfHeight+a.radius)return!1;if(e<=t.halfWidth||r<=t.halfHeight)return!0;var i=e-t.halfWidth,n=r-t.halfHeight;return i*i+n*n<=a.radius*a.radius},z.Circle.intersectsLine=function(i,t,e){var p=i.x,n=i.y,o=(t.end.y-t.start.y)/(t.end.x-t.start.x),r=t.end.y-o*t.end.x,a=i.radius,h=i.radius,l=r+o*p,c=(p*(h*h)-o*(a*a)*(r-n)+a*h*F(a*a*(o*o)+h*h-l*l-n*n+2*l*n))/(a*a*(o*o)+h*h),u=(p*(h*h)-o*(a*a)*(r-n)-a*h*F(a*a*(o*o)+h*h-l*l-n*n+2*l*n))/(a*a*(o*o)+h*h),d=new z.Point(c,o*c+r),g=new z.Point(u,o*u+r),m=t.pointOnSegment(d.x,d.y,.01),y=t.pointOnSegment(g.x,g.y,.01);return m&&y?!e||[d,g]:m?!e||[d]:y?!e||[g]:!!e&&[]},PIXI.Circle=z.Circle,z.Ellipse=function(a,t,e,r){a=a||0,t=t||0,e=e||0,r=r||0,this.x=a,this.y=t,this.width=e,this.height=r,this.type=z.ELLIPSE},z.Ellipse.prototype={setTo:function(a,t,e,r){return this.x=a,this.y=t,this.width=e,this.height=r,this},getBounds:function(){return new z.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(e){return this.setTo(e.x,e.y,e.width,e.height)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},clone:function(e){return void 0===e||null===e?e=new z.Ellipse(this.x,this.y,this.width,this.height):e.setTo(this.x,this.y,this.width,this.height),e},contains:function(a,t){return z.Ellipse.contains(this,a,t)},random:function(a){void 0===a&&(a=new z.Point);var t=2*(Math.random()*R),e=F(Math.random());return a.x=this.centerX+.5*e*S(t)*this.width,a.y=this.centerY+.5*e*T(t)*this.height,a},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}},z.Ellipse.prototype.constructor=z.Ellipse,Object.defineProperty(z.Ellipse.prototype,"left",{get:function(){return this.x},set:function(e){this.x=e}}),Object.defineProperty(z.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(e){this.width=e<this.x?0:e-this.x}}),Object.defineProperty(z.Ellipse.prototype,"top",{get:function(){return this.y},set:function(e){this.y=e}}),Object.defineProperty(z.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){this.height=e<this.y?0:e-this.y}}),Object.defineProperty(z.Ellipse.prototype,"centerX",{get:function(){return this.x+.5*this.width}}),Object.defineProperty(z.Ellipse.prototype,"centerY",{get:function(){return this.y+.5*this.height}}),Object.defineProperty(z.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},set:function(e){!0===e&&this.setTo(0,0,0,0)}}),z.Ellipse.contains=function(a,t,e){if(0>=a.width||0>=a.height)return!1;var r=(t-a.x)/a.width-.5,o=(e-a.y)/a.height-.5;return r*=r,o*=o,.25>r+o},z.Ellipse.intersectsLine=function(i,t,e){var p=i.x,n=i.y,o=(t.end.y-t.start.y)/(t.end.x-t.start.x),r=t.end.y-o*t.end.x,a=i.width/2,h=i.height/2,l=r+o*p,c=(p*(h*h)-o*(a*a)*(r-n)+a*h*F(a*a*(o*o)+h*h-l*l-n*n+2*l*n))/(a*a*(o*o)+h*h),u=(p*(h*h)-o*(a*a)*(r-n)-a*h*F(a*a*(o*o)+h*h-l*l-n*n+2*l*n))/(a*a*(o*o)+h*h),d=new z.Point(c,o*c+r),g=new z.Point(u,o*u+r),m=t.pointOnSegment(d.x,d.y,.01),y=t.pointOnSegment(g.x,g.y,.01);return m&&y?!e||[d,g]:m?!e||[d]:y?!e||[g]:!!e&&[]},PIXI.Ellipse=z.Ellipse,z.Line=function(a,t,e,r){a=a||0,t=t||0,e=e||0,r=r||0,this.start=new z.Point(a,t),this.end=new z.Point(e,r),this.type=z.LINE},z.Line.prototype={setTo:function(a,t,e,r){return this.start.setTo(a,t),this.end.setTo(e,r),this},fromPoints:function(a,t){return this.setTo(a.x,a.y,t.x,t.y),this},fromSprite:function(a,t,e){return void 0===e&&(e=!1),e?this.setTo(a.centerX,a.centerY,t.centerX,t.centerY):this.fromPoints(a,t)},fromAngle:function(a,t,e,r){return this.start.setTo(a,t),this.end.setTo(a+S(e)*r,t+T(e)*r),this},rotate:function(a,t){var e=(this.start.x+this.end.x)/2,r=(this.start.y+this.end.y)/2;return this.start.rotate(e,r,a,t),this.end.rotate(e,r,a,t),this},rotateAround:function(a,t,e,r){return this.start.rotate(a,t,e,r),this.end.rotate(a,t,e,r),this},intersects:function(a,t,e){return z.Line.intersectsPoints(this.start,this.end,a.start,a.end,t,e)},reflect:function(e){return z.Line.reflect(this,e)},midPoint:function(e){return void 0===e&&(e=new z.Point),e.x=(this.start.x+this.end.x)/2,e.y=(this.start.y+this.end.y)/2,e},centerOn:function(a,t){var e=a-(this.start.x+this.end.x)/2,r=t-(this.start.y+this.end.y)/2;this.start.add(e,r),this.end.add(e,r)},pointOnLine:function(a,t,e){return z.Math.fuzzyEqual((a-this.start.x)*(this.end.y-this.start.y),(this.end.x-this.start.x)*(t-this.start.y),e||0)},pointOnSegment:function(a,t,e){var i=A(this.start.x,this.end.x),s=C(this.start.x,this.end.x),n=A(this.start.y,this.end.y),o=C(this.start.y,this.end.y);return this.pointOnLine(a,t,e)&&a>=i&&a<=s&&t>=n&&t<=o},random:function(a){void 0===a&&(a=new z.Point);var t=Math.random();return a.x=this.start.x+t*(this.end.x-this.start.x),a.y=this.start.y+t*(this.end.y-this.start.y),a},coordinatesOnLine:function(p,t){void 0===p&&(p=1),void 0===t&&(t=[]);var e=f(this.start.x),i=f(this.start.y),s=f(this.end.x),n=f(this.end.y),o=E(s-e),r=E(n-i),m=e<s?1:-1,g=i<n?1:-1,l=o-r;t.push([e,i]);for(var c=1,u;e!==s||i!==n;)u=l<<1,u>-r&&(l-=r,e+=m),u<o&&(l+=o,i+=g),0==c%p&&t.push([e,i]),c++;return t},clone:function(e){return void 0===e||null===e?e=new z.Line(this.start.x,this.start.y,this.end.x,this.end.y):e.setTo(this.start.x,this.start.y,this.end.x,this.end.y),e}},Object.defineProperty(z.Line.prototype,"length",{get:function(){return F((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(z.Line.prototype,"angle",{get:function(){return z.Point.angle(this.end,this.start)}}),Object.defineProperty(z.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(z.Line.prototype,"perpSlope",{get:function(){return-(this.end.x-this.start.x)/(this.end.y-this.start.y)}}),Object.defineProperty(z.Line.prototype,"x",{get:function(){return A(this.start.x,this.end.x)}}),Object.defineProperty(z.Line.prototype,"y",{get:function(){return A(this.start.y,this.end.y)}}),Object.defineProperty(z.Line.prototype,"left",{get:function(){return A(this.start.x,this.end.x)}}),Object.defineProperty(z.Line.prototype,"right",{get:function(){return C(this.start.x,this.end.x)}}),Object.defineProperty(z.Line.prototype,"top",{get:function(){return A(this.start.y,this.end.y)}}),Object.defineProperty(z.Line.prototype,"bottom",{get:function(){return C(this.start.y,this.end.y)}}),Object.defineProperty(z.Line.prototype,"width",{get:function(){return E(this.start.x-this.end.x)}}),Object.defineProperty(z.Line.prototype,"height",{get:function(){return E(this.start.y-this.end.y)}}),Object.defineProperty(z.Line.prototype,"normalX",{get:function(){return S(this.angle-1.5707963267948966)}}),Object.defineProperty(z.Line.prototype,"normalY",{get:function(){return T(this.angle-1.5707963267948966)}}),Object.defineProperty(z.Line.prototype,"normalAngle",{get:function(){return z.Math.wrap(this.angle-1.5707963267948966,-R,Math.PI)}}),z.Line.intersectsPoints=function(i,t,e,s,n,o){void 0===n&&(n=!0),void 0===o&&(o=new z.Point);var r=t.y-i.y,a=s.y-e.y,h=i.x-t.x,l=e.x-s.x,c=t.x*i.y-i.x*t.y,u=s.x*e.y-e.x*s.y,d=r*l-a*h;if(0==d)return null;if(o.x=(h*u-l*c)/d,o.y=(a*c-r*u)/d,n){var p=(s.y-e.y)*(t.x-i.x)-(s.x-e.x)*(t.y-i.y),y=((s.x-e.x)*(i.y-e.y)-(s.y-e.y)*(i.x-e.x))/p,g=((t.x-i.x)*(i.y-e.y)-(t.y-i.y)*(i.x-e.x))/p;return 0<=y&&1>=y&&0<=g&&1>=g?o:null}return o},z.Line.intersects=function(a,t,e,r){return z.Line.intersectsPoints(a.start,a.end,t.start,t.end,e,r)},z.Line.intersectsRectangle=function(d,t){if(0===d.length||t.empty)return!1;var e=d.start.x,i=d.start.y,s=d.end.x,n=d.end.y,o=t.x,r=t.y,a=t.right,p=t.bottom,l=0;if(e>=o&&e<=a&&i>=r&&i<=p||s>=o&&s<=a&&n>=r&&n<=p)return!0;if(e<o&&s>=o){if((l=i+(n-i)*(o-e)/(s-e))>r&&l<=p)return!0;}else if(e>a&&s<=a&&(l=i+(n-i)*(a-e)/(s-e))>=r&&l<=p)return!0;if(i<r&&n>=r){if((l=e+(s-e)*(r-i)/(n-i))>=o&&l<=a)return!0;}else if(i>p&&n<=p&&(l=e+(s-e)*(p-i)/(n-i))>=o&&l<=a)return!0;return!1},z.Line.intersectionWithRectangle=function(i,t,e){var s=z.Line.intersectionWithRectangle;e||(e=new z.Point),s.edges||(s.edges=[new z.Line,new z.Line,new z.Line,new z.Line]),s.edgeIntersection||(s.edgeIntersection=new z.Point);var n=s.edges,o=s.edgeIntersection.set(0),r=t.x,a=t.y,m=t.right,l=t.bottom,c=1/0;n[0].setTo(r,a,m,a),n[1].setTo(r,l,m,l),n[2].setTo(r,a,r,l),n[3].setTo(m,a,m,l);for(var u=0,p;p=n[u];u++)if(i.intersects(p,!0,o)){var d=i.start.distance(o);d<c&&(c=d,e.copyFrom(o))}return null==d?null:e},z.Line.reflect=function(a,t){return 2*t.normalAngle-3.141592653589793-a.angle},z.Matrix=function(a,t,e,i,n,o){void 0!==a&&null!==a||(a=1),void 0!==t&&null!==t||(t=0),void 0!==e&&null!==e||(e=0),void 0!==i&&null!==i||(i=1),void 0!==n&&null!==n||(n=0),void 0!==o&&null!==o||(o=0),this.a=a,this.b=t,this.c=e,this.d=i,this.tx=n,this.ty=o,this.type=z.MATRIX},z.Matrix.prototype={fromArray:function(e){return this.setTo(e[0],e[1],e[3],e[4],e[2],e[5])},setTo:function(a,t,e,r,i,n){return this.a=a,this.b=t,this.c=e,this.d=r,this.tx=i,this.ty=n,this},clone:function(e){return void 0===e||null===e?e=new z.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty):(e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty),e},copyTo:function(e){return e.copyFrom(this),e},copyFrom:function(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},toArray:function(a,t){return void 0===t&&(t=new Float32Array(9)),a?(t[0]=this.a,t[1]=this.b,t[2]=0,t[3]=this.c,t[4]=this.d,t[5]=0,t[6]=this.tx,t[7]=this.ty,t[8]=1):(t[0]=this.a,t[1]=this.c,t[2]=this.tx,t[3]=this.b,t[4]=this.d,t[5]=this.ty,t[6]=0,t[7]=0,t[8]=1),t},apply:function(a,t){return void 0===t&&(t=new z.Point),t.x=this.a*a.x+this.c*a.y+this.tx,t.y=this.b*a.x+this.d*a.y+this.ty,t},applyInverse:function(a,t){void 0===t&&(t=new z.Point);var e=1/(this.a*this.d+this.c*-this.b),r=a.x,n=a.y;return t.x=this.d*e*r+-this.c*e*n+(this.ty*this.c-this.tx*this.d)*e,t.y=this.a*e*n+-this.b*e*r+(-this.ty*this.a+this.tx*this.b)*e,t},translate:function(a,t){return this.tx+=a,this.ty+=t,this},scale:function(a,t){return this.a*=a,this.d*=t,this.c*=a,this.b*=t,this.tx*=a,this.ty*=t,this},rotate:function(a){var t=S(a),e=T(a),r=this.a,i=this.c,n=this.tx;return this.a=r*t-this.b*e,this.b=r*e+this.b*t,this.c=i*t-this.d*e,this.d=i*e+this.d*t,this.tx=n*t-this.ty*e,this.ty=n*e+this.ty*t,this},append:function(a){var t=this.a,e=this.b,r=this.c,o=this.d;return this.a=a.a*t+a.b*r,this.b=a.a*e+a.b*o,this.c=a.c*t+a.d*r,this.d=a.c*e+a.d*o,this.tx=a.tx*t+a.ty*r+this.tx,this.ty=a.tx*e+a.ty*o+this.ty,this},identity:function(){return this.setTo(1,0,0,1,0,0)}},z.identityMatrix=new z.Matrix,z.Point=function(a,t){a=a||0,t=t||0,this.x=a,this.y=t,this.type=z.POINT},z.Point.prototype={copyFrom:function(e){return this.setTo(e.x,e.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(a,t){return z.Point.set(this,a,t)},set:function(a,t){return z.Point.set(this,a,t)},setToPolar:function(a,t,e){return null==t&&(t=1),e&&(a=z.Math.degToRad(a)),this.setTo(S(a)*t,T(a)*t)},add:function(a,t){return this.x+=a,this.y+=t,this},subtract:function(a,t){return this.x-=a,this.y-=t,this},multiply:function(a,t){return this.x*=a,this.y*=t,this},divide:function(a,t){return this.x/=a,this.y/=t,this},clampX:function(a,t){return this.x=z.Math.clamp(this.x,a,t),this},clampY:function(a,t){return this.y=z.Math.clamp(this.y,a,t),this},clamp:function(a,t){return this.x=z.Math.clamp(this.x,a,t),this.y=z.Math.clamp(this.y,a,t),this},clip:function(a){var t=a.left,e=a.top,r=a.right,o=a.bottom;return this.x<t?this.x=t:this.x>r&&(this.x=r),this.y<e?this.y=e:this.y>o&&(this.y=o),this},clone:function(e){return void 0===e||null===e?e=new z.Point(this.x,this.y):e.setTo(this.x,this.y),e},copyTo:function(e){return e.x=this.x,e.y=this.y,e},distance:function(a,t){return z.Point.distance(this,a,t)},equals:function(e){return e.x===this.x&&e.y===this.y},equalsXY:function(a,t){return this.x===a&&this.y===t},fuzzyEquals:function(a,t){return z.Point.fuzzyEquals(this,a,t)},fuzzyEqualsXY:function(a,t,e){return z.Point.fuzzyEqualsXY(this,a,t,e)},angle:function(a,t){return this.angleXY(a.x,a.y,t)},angleXY:function(a,t,e){var r=_(t-this.y,a-this.x);return e?z.Math.radToDeg(r):r},atan:function(a){var t=_(this.y,this.x);return a?z.Math.radToDeg(t):t},rotate:function(a,t,e,r,n){return z.Point.rotate(this,a,t,e,r,n)},getMagnitude:function(){return F(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(e){return this.normalize().multiply(e,e)},normalize:function(){if(!this.isZero()){var e=this.getMagnitude();this.x/=e,this.y/=e}return this},limit:function(e){return this.getMagnitudeSq()>e*e&&this.setMagnitude(e),this},expand:function(e){return this.getMagnitudeSq()<e*e&&this.setMagnitude(e),this},isZero:function(){return 0===this.x&&0===this.y},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},floor:function(){return this.setTo(x(this.x),x(this.y))},ceil:function(){return this.setTo(y(this.x),y(this.y))},round:function(){return this.setTo(f(this.x),f(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},z.Point.prototype.constructor=z.Point,z.Point.add=function(a,t,e){return void 0===e&&(e=new z.Point),e.x=a.x+t.x,e.y=a.y+t.y,e},z.Point.subtract=function(a,t,e){return void 0===e&&(e=new z.Point),e.x=a.x-t.x,e.y=a.y-t.y,e},z.Point.multiply=function(a,t,e){return void 0===e&&(e=new z.Point),e.x=a.x*t.x,e.y=a.y*t.y,e},z.Point.divide=function(a,t,e){return void 0===e&&(e=new z.Point),e.x=a.x/t.x,e.y=a.y/t.y,e},z.Point.equals=function(a,t){return a.x===t.x&&a.y===t.y},z.Point.equalsXY=function(a,t,e){return a.x===t&&a.y===e},z.Point.fuzzyEquals=function(a,t,e){return z.Math.fuzzyEquals(a.x,t.x,e)&&z.Math.fuzzyEquals(a.y,t.y,e)},z.Point.fuzzyEqualsXY=function(a,t,e,r){return z.Math.fuzzyEquals(a.x,t,r)&&z.Math.fuzzyEquals(a.y,e,r)},z.Point.angle=function(a,t){return _(a.y-t.y,a.x-t.x)},z.Point.negative=function(a,t){return void 0===t&&(t=new z.Point),t.setTo(-a.x,-a.y)},z.Point.multiplyAdd=function(a,t,e,r){return void 0===r&&(r=new z.Point),r.setTo(a.x+t.x*e,a.y+t.y*e)},z.Point.interpolate=function(a,t,e,r){return void 0===r&&(r=new z.Point),r.setTo(a.x+(t.x-a.x)*e,a.y+(t.y-a.y)*e)},z.Point.perp=function(a,t){return void 0===t&&(t=new z.Point),t.setTo(-a.y,a.x)},z.Point.rperp=function(a,t){return void 0===t&&(t=new z.Point),t.setTo(a.y,-a.x)},z.Point.distance=function(a,t,e){var r=z.Math.distance(a.x,a.y,t.x,t.y);return e?f(r):r},z.Point.project=function(a,t,e){void 0===e&&(e=new z.Point);var r=a.dot(t)/t.getMagnitudeSq();return 0!=r&&e.setTo(r*t.x,r*t.y),e},z.Point.projectUnit=function(a,t,e){void 0===e&&(e=new z.Point);var r=a.dot(t);return 0!==r&&e.setTo(r*t.x,r*t.y),e},z.Point.normalRightHand=function(a,t){return void 0===t&&(t=new z.Point),t.setTo(-1*a.y,a.x)},z.Point.normalize=function(a,t){void 0===t&&(t=new z.Point);var e=a.getMagnitude();return 0!==e&&t.setTo(a.x/e,a.y/e),t},z.Point.rotate=function(i,t,e,s,n,o){if(n&&(s=z.Math.degToRad(s)),void 0===o){i.subtract(t,e);var r=T(s),a=S(s),d=a*i.x-r*i.y,l=r*i.x+a*i.y;i.x=d+t,i.y=l+e}else{var p=s+_(i.y-e,i.x-t);i.x=t+o*S(p),i.y=e+o*T(p)}return i},z.Point.centroid=function(a,t){if(void 0===t&&(t=new z.Point),"[object Array]"!==Object.prototype.toString.call(a))throw new Error("Phaser.Point. Parameter 'points' must be an array");var e=a.length;if(1>e)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===e)return t.copyFrom(a[0]),t;for(var r=0;r<e;r++)z.Point.add(t,a[r],t);return t.divide(e,e),t},z.Point.parse=function(a,t,e){t=t||"x",e=e||"y";var r=new z.Point;return a[t]&&(r.x=parseInt(a[t],10)),a[e]&&(r.y=parseInt(a[e],10)),r},z.Point.isPoint=function(e){return null!=e&&"number"==typeof e.x&&"number"==typeof e.y},z.Point.set=function(a,t,e){return a.x=t||0,a.y=e||(0===e?0:a.x),a},z.Point.sortClockwise=function(a,t){t||(t=this.centroid(a));var r=t.x,o=t.y;return a.sort(function(a,t){if(0<=a.x-r&&0>t.x-r)return-1;if(0>a.x-r&&0<=t.x-r)return 1;if(0==a.x-r&&0==t.x-r)return 0<=a.y-o||0<=t.y-o?a.y>t.y?1:-1:t.y>a.y?1:-1;var e=(a.x-r)*-(t.y-o)-(t.x-r)*-(a.y-o);return 0>e?-1:0<e?1:(a.x-r)*(a.x-r)+(a.y-o)*(a.y-o)>(t.x-r)*(t.x-r)+(t.y-o)*(t.y-o)?-1:1})},PIXI.Point=z.Point,z.Polygon=function(){this.area=0,this._points=[],0<arguments.length&&this.setTo.apply(this,arguments),this.closed=!0,this.flattened=!1,this.type=z.POLYGON},z.Polygon.prototype={toNumberArray:function(a){void 0===a&&(a=[]);for(var t=0;t<this._points.length;t++)"number"==typeof this._points[t]?(a.push(this._points[t]),a.push(this._points[t+1]),t++):(a.push(this._points[t].x),a.push(this._points[t].y));return a},flatten:function(){return this._points=this.toNumberArray(),this.flattened=!0,this},clone:function(a){var t=this._points.slice();return void 0===a||null===a?a=new z.Polygon(t):a.setTo(t),a},contains:function(d,t){var e=!1;if(this.flattened)for(var l=-2,s=this._points.length-2;(l+=2)<this._points.length;s=l){var n=this._points[l],o=this._points[l+1],r=this._points[s],a=this._points[s+1];(o<=t&&t<a||a<=t&&t<o)&&d<(r-n)*(t-o)/(a-o)+n&&(e=!e)}else for(var l=-1,s=this._points.length-1;++l<this._points.length;s=l){var n=this._points[l].x,o=this._points[l].y,r=this._points[s].x,a=this._points[s].y;(o<=t&&t<a||a<=t&&t<o)&&d<(r-n)*(t-o)/(a-o)+n&&(e=!e)}return e},setTo:function(a){if(this.area=0,this._points=[],0<arguments.length){Array.isArray(a)||(a=Array.prototype.slice.call(arguments));for(var t=d,e=0,r=a.length;e<r;e++){if("number"==typeof a[e])o=new PIXI.Point(a[e],a[e+1]),e++;else if(Array.isArray(a[e]))o=new PIXI.Point(a[e][0],a[e][1]);else var o=new PIXI.Point(a[e].x,a[e].y);this._points.push(o),o.y<t&&(t=o.y)}this.calculateArea(t)}return this},calculateArea:function(a){for(var t=0,o=this._points.length,r,e,i,s;t<o;t++)r=this._points[t],e=t===o-1?this._points[0]:this._points[t+1],i=(r.y-a+(e.y-a))/2,s=r.x-e.x,this.area+=i*s;return this.area}},z.Polygon.prototype.constructor=z.Polygon,Object.defineProperty(z.Polygon.prototype,"points",{get:function(){return this._points}}),PIXI.Polygon=z.Polygon,z.Rectangle=function(a,t,e,r){a=a||0,t=t||0,e=e||0,r=r||0,this.x=a,this.y=t,this.width=e,this.height=r,this.type=z.RECTANGLE},z.Rectangle.prototype={offset:function(a,t){return this.x+=a,this.y+=t,this},offsetPoint:function(e){return this.offset(e.x,e.y)},setTo:function(a,t,e,r){return this.x=a,this.y=t,this.width=e,this.height=r,this},scale:function(a,t){return void 0===t&&(t=a),this.width*=a,this.height*=t,this},centerOn:function(a,t){return this.centerX=a,this.centerY=t,this},floor:function(){this.x=x(this.x),this.y=x(this.y)},floorAll:function(){this.x=x(this.x),this.y=x(this.y),this.width=x(this.width),this.height=x(this.height)},ceil:function(){this.x=y(this.x),this.y=y(this.y)},ceilAll:function(){this.x=y(this.x),this.y=y(this.y),this.width=y(this.width),this.height=y(this.height)},copyFrom:function(e){return this.setTo(e.x,e.y,e.width,e.height)},copyFromBounds:function(e){return this.setTo(e.left,e.top,e.width,e.height)},copyTo:function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},inflate:function(a,t){return z.Rectangle.inflate(this,a,t)},size:function(e){return z.Rectangle.size(this,e)},resize:function(a,t){return this.width=a,this.height=t,this},clone:function(e){return z.Rectangle.clone(this,e)},contains:function(a,t){return z.Rectangle.contains(this,a,t)},containsRect:function(e){return z.Rectangle.containsRect(e,this)},equals:function(e){return z.Rectangle.equals(this,e)},intersection:function(a,t){return z.Rectangle.intersection(this,a,t)},intersects:function(e){return z.Rectangle.intersects(this,e)},intersectsRaw:function(a,t,e,r,n){return z.Rectangle.intersectsRaw(this,a,t,e,r,n)},union:function(a,t){return z.Rectangle.union(this,a,t)},random:function(e){return void 0===e&&(e=new z.Point),e.x=this.randomX,e.y=this.randomY,e},getPoint:function(a,t){switch(void 0===t&&(t=new z.Point),a){default:case z.TOP_LEFT:return t.set(this.x,this.y);case z.TOP_CENTER:return t.set(this.centerX,this.y);case z.TOP_RIGHT:return t.set(this.right,this.y);case z.LEFT_CENTER:return t.set(this.x,this.centerY);case z.CENTER:return t.set(this.centerX,this.centerY);case z.RIGHT_CENTER:return t.set(this.right,this.centerY);case z.BOTTOM_LEFT:return t.set(this.x,this.bottom);case z.BOTTOM_CENTER:return t.set(this.centerX,this.bottom);case z.BOTTOM_RIGHT:return t.set(this.right,this.bottom);}},sides:function(i,t,e,s){arguments.length||(i=new z.Line,t=new z.Line,e=new z.Line,s=new z.Line);var n=this.x,o=this.y,r=this.right,a=this.bottom;return i.setTo(n,o,r,o),t.setTo(r,o,r,a),e.setTo(n,a,r,a),s.setTo(n,o,n,a),arguments.length?null:[i,t,e,s]},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(z.Rectangle.prototype,"halfWidth",{get:function(){return f(this.width/2)}}),Object.defineProperty(z.Rectangle.prototype,"halfHeight",{get:function(){return f(this.height/2)}}),Object.defineProperty(z.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(e){this.height=e<=this.y?0:e-this.y}}),Object.defineProperty(z.Rectangle.prototype,"bottomLeft",{get:function(){return new z.Point(this.x,this.bottom)},set:function(e){this.x=e.x,this.bottom=e.y}}),Object.defineProperty(z.Rectangle.prototype,"bottomRight",{get:function(){return new z.Point(this.right,this.bottom)},set:function(e){this.right=e.x,this.bottom=e.y}}),Object.defineProperty(z.Rectangle.prototype,"left",{get:function(){return this.x},set:function(e){this.width=e>=this.right?0:this.right-e,this.x=e}}),Object.defineProperty(z.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(e){this.width=e<=this.x?0:e-this.x}}),Object.defineProperty(z.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(z.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}}),Object.defineProperty(z.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(e){this.x=e-this.halfWidth}}),Object.defineProperty(z.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(e){this.y=e-this.halfHeight}}),Object.defineProperty(z.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}}),Object.defineProperty(z.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}}),Object.defineProperty(z.Rectangle.prototype,"top",{get:function(){return this.y},set:function(e){e>=this.bottom?(this.height=0,this.y=e):this.height=this.bottom-e}}),Object.defineProperty(z.Rectangle.prototype,"topLeft",{get:function(){return new z.Point(this.x,this.y)},set:function(e){this.x=e.x,this.y=e.y}}),Object.defineProperty(z.Rectangle.prototype,"topRight",{get:function(){return new z.Point(this.x+this.width,this.y)},set:function(e){this.right=e.x,this.y=e.y}}),Object.defineProperty(z.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(e){!0===e&&this.setTo(0,0,0,0)}}),z.Rectangle.prototype.constructor=z.Rectangle,z.Rectangle.inflate=function(a,t,e){return a.x-=t,a.width+=2*t,a.y-=e,a.height+=2*e,a},z.Rectangle.inflatePoint=function(a,t){return z.Rectangle.inflate(a,t.x,t.y)},z.Rectangle.size=function(a,t){return void 0===t||null===t?t=new z.Point(a.width,a.height):t.setTo(a.width,a.height),t},z.Rectangle.clone=function(a,t){return void 0===t||null===t?t=new z.Rectangle(a.x,a.y,a.width,a.height):t.setTo(a.x,a.y,a.width,a.height),t},z.Rectangle.createFromBounds=function(a,t){return void 0!==t&&null!==t||(t=new z.Rectangle(a.x,a.y,a.width,a.height)),t.copyFromBounds(a)},z.Rectangle.contains=function(a,t,e){return!(0>=a.width||0>=a.height)&&t>=a.x&&t<a.right&&e>=a.y&&e<a.bottom},z.Rectangle.containsRaw=function(a,t,e,r,i,n){return i>=a&&i<a+e&&n>=t&&n<t+r},z.Rectangle.containsPoint=function(a,t){return z.Rectangle.contains(a,t.x,t.y)},z.Rectangle.containsRect=function(a,t){return!(a.volume>t.volume)&&a.x>=t.x&&a.y>=t.y&&a.right<t.right&&a.bottom<t.bottom},z.Rectangle.equals=function(a,t){return a.x===t.x&&a.y===t.y&&a.width===t.width&&a.height===t.height},z.Rectangle.sameDimensions=function(a,t){return a.width===t.width&&a.height===t.height},z.Rectangle.intersection=function(a,t,e){return void 0===e&&(e=new z.Rectangle),z.Rectangle.intersects(a,t)&&(e.x=C(a.x,t.x),e.y=C(a.y,t.y),e.width=A(a.right,t.right)-e.x,e.height=A(a.bottom,t.bottom)-e.y),e},z.Rectangle.intersects=function(a,t){return!(0>=a.width||0>=a.height||0>=t.width||0>=t.height)&&!(a.right<t.x||a.bottom<t.y||a.x>t.right||a.y>t.bottom)},z.Rectangle.intersectsRaw=function(a,t,e,r,i,n){return void 0===n&&(n=0),!(t>a.right+n||e<a.left-n||r>a.bottom+n||i<a.top-n)},z.Rectangle.union=function(a,t,e){return void 0===e&&(e=new z.Rectangle),e.setTo(A(a.x,t.x),A(a.y,t.y),C(a.right,t.right)-A(a.left,t.left),C(a.bottom,t.bottom)-A(a.top,t.top))},z.Rectangle.aabb=function(a,t){var e=Number.NEGATIVE_INFINITY;void 0===t&&(t=new z.Rectangle);var i=e,s=u,n=e,o=u;return a.forEach(function(e){e.x>i&&(i=e.x),e.x<s&&(s=e.x),e.y>n&&(n=e.y),e.y<o&&(o=e.y)}),t.setTo(s,o,i-s,n-o),t},PIXI.Rectangle=z.Rectangle,PIXI.EmptyRectangle=new z.Rectangle(0,0,0,0),z.RoundedRectangle=function(a,t,e,r,n){void 0===a&&(a=0),void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=20),this.x=a,this.y=t,this.width=e,this.height=r,this.radius=n||20,this.type=z.ROUNDEDRECTANGLE},z.RoundedRectangle.prototype={clone:function(){return new z.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(a,t){if(0>=this.width||0>=this.height)return!1;var e=this.x;if(a>=e&&a<=e+this.width){var r=this.y;if(t>=r&&t<=r+this.height)return!0}return!1}},z.RoundedRectangle.prototype.constructor=z.RoundedRectangle,PIXI.RoundedRectangle=z.RoundedRectangle,z.Camera=function(a,t,e,i,n,o){this.game=a,this.world=a.world,this.id=0,this.view=new z.Rectangle(e,i,n,o),this.bounds=new z.Rectangle(e,i,n,o),this.deadzone=null,this.visible=!0,this.roundPx=!0,this.atLimit={x:!1,y:!1},this.target=null,this.displayObject=null,this.scale=null,this.totalInView=0,this.lerp=new z.Point(1,1),this.onShakeComplete=new z.Signal,this.onFlashComplete=new z.Signal,this.onFadeComplete=new z.Signal,this.fx=null,this._targetPosition=new z.Point,this._edge=0,this._position=new z.Point,this._shake={intensity:0,duration:0,horizontal:!1,vertical:!1,shakeBounds:!0,x:0,y:0},this._fxDuration=0,this._fxType=0,this._fixedView=new z.Rectangle},z.Camera.FOLLOW_LOCKON=0,z.Camera.FOLLOW_PLATFORMER=1,z.Camera.FOLLOW_TOPDOWN=2,z.Camera.FOLLOW_TOPDOWN_TIGHT=3,z.Camera.SHAKE_BOTH=4,z.Camera.SHAKE_HORIZONTAL=5,z.Camera.SHAKE_VERTICAL=6,z.Camera.ENABLE_FX=!0,z.Camera.prototype={boot:function(){this.displayObject=this.game.world,this.scale=this.game.world.scale,this.game.camera=this,z.Graphics&&z.Camera.ENABLE_FX&&(this.fx=new z.Graphics(this.game),this.game.stage.addChild(this.fx))},preUpdate:function(){this.totalInView=0},follow:function(i,t,e,s){void 0===t&&(t=z.Camera.FOLLOW_LOCKON),void 0===e&&(e=1),void 0===s&&(s=1),this.target=i,this.lerp.set(e,s);var n;switch(t){case z.Camera.FOLLOW_PLATFORMER:var o=this.width/8,r=this.height/3;this.deadzone=new z.Rectangle((this.width-o)/2,(this.height-r)/2-.25*r,o,r);break;case z.Camera.FOLLOW_TOPDOWN:n=C(this.width,this.height)/4,this.deadzone=new z.Rectangle((this.width-n)/2,(this.height-n)/2,n,n);break;case z.Camera.FOLLOW_TOPDOWN_TIGHT:n=C(this.width,this.height)/8,this.deadzone=new z.Rectangle((this.width-n)/2,(this.height-n)/2,n,n);break;case z.Camera.FOLLOW_LOCKON:default:this.deadzone=null;}},unfollow:function(){this.target=null},focusOn:function(e){this.setPosition(f(e.x-this.view.halfWidth),f(e.y-this.view.halfHeight))},focusOnXY:function(a,t){this.setPosition(f(a-this.view.halfWidth),f(t-this.view.halfHeight))},shake:function(a,t,e,r,n){return void 0===a&&(a=.05),void 0===t&&(t=500),void 0===e&&(e=!0),void 0===r&&(r=z.Camera.SHAKE_BOTH),void 0===n&&(n=!0),(e||!(0<this._shake.duration))&&(this._shake.intensity=a,this._shake.duration=t,this._shake.shakeBounds=n,this._shake.x=0,this._shake.y=0,this._shake.horizontal=r===z.Camera.SHAKE_BOTH||r===z.Camera.SHAKE_HORIZONTAL,this._shake.vertical=r===z.Camera.SHAKE_BOTH||r===z.Camera.SHAKE_VERTICAL,!0)},flash:function(a,t,e,r){return void 0===a&&(a=16777215),void 0===t&&(t=500),void 0===e&&(e=!1),void 0===r&&(r=1),this.fx&&(e||!(0<this._fxDuration))&&(this.fx.clear(),this.fx.beginFill(a,r),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=1,this._fxDuration=t,this._fxType=0,!0)},fade:function(a,t,e,r){return void 0===a&&(a=0),void 0===t&&(t=500),void 0===e&&(e=!1),void 0===r&&(r=1),this.fx&&(e||!(0<this._fxDuration))&&(this.fx.clear(),this.fx.beginFill(a,r),this.fx.drawRect(0,0,this.width,this.height),this.fx.endFill(),this.fx.alpha=0,this._fxDuration=t,this._fxType=1,!0)},update:function(){0<this._fxDuration&&this.updateFX(),0<this._shake.duration&&this.updateShake(),this.bounds&&this.checkBounds(),this.roundPx&&(this.view.floor(),this._shake.x=x(this._shake.x),this._shake.y=x(this._shake.y)),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},updateFX:function(){0===this._fxType?(this.fx.alpha-=this.game.time.elapsedMS/this._fxDuration,0>=this.fx.alpha&&(this._fxDuration=0,this.fx.alpha=0,this.onFlashComplete.dispatch())):(this.fx.alpha+=this.game.time.elapsedMS/this._fxDuration,1<=this.fx.alpha&&(this._fxDuration=0,this.fx.alpha=1,this.onFadeComplete.dispatch()))},updateShake:function(){this._shake.duration-=this.game.time.elapsedMS,0>=this._shake.duration?(this.onShakeComplete.dispatch(),this._shake.x=0,this._shake.y=0):(this._shake.horizontal&&(this._shake.x=2*(this.game.rnd.frac()*this._shake.intensity*this.view.width)-this._shake.intensity*this.view.width),this._shake.vertical&&(this._shake.y=2*(this.game.rnd.frac()*this._shake.intensity*this.view.height)-this._shake.intensity*this.view.height))},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x,this._targetPosition.y=this.view.y+this.target.worldPosition.y,this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x):this._edge>this.deadzone.right&&(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y):this._edge>this.deadzone.bottom&&(this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y))):(this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x),this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y)),this.bounds&&this.checkBounds(),this.roundPx&&this.view.floor(),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){this.bounds&&this.bounds.copyFrom(this.game.world.bounds)},checkBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1;var a=this.view.x+this._shake.x,t=this.view.right+this._shake.x,e=this.view.y+this._shake.y,r=this.view.bottom+this._shake.y;a<=this.bounds.x*this.scale.x?(this.atLimit.x=!0,this.view.x=this.bounds.x*this.scale.x,this._shake.shakeBounds||(this._shake.x=0)):t>=this.bounds.right*this.scale.x&&(this.atLimit.x=!0,this.view.x=this.bounds.right*this.scale.x-this.width,this._shake.shakeBounds||(this._shake.x=0)),e<=this.bounds.top*this.scale.y?(this.atLimit.y=!0,this.view.y=this.bounds.top*this.scale.y,this._shake.shakeBounds||(this._shake.y=0)):r>=this.bounds.bottom*this.scale.y&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom*this.scale.y-this.height,this._shake.shakeBounds||(this._shake.y=0))},setPosition:function(a,t){this.view.x=a,this.view.y=t,this.bounds&&this.checkBounds()},setSize:function(a,t){this.view.width=a,this.view.height=t},reset:function(){this.target=null,this.view.x=0,this.view.y=0,this._shake.duration=0,this._shake.x=0,this._shake.y=0,this.resetFX()},resetFX:function(){this.fx&&(this.fx.clear(),this.fx.alpha=0),this._fxDuration=0}},z.Camera.prototype.constructor=z.Camera,Object.defineProperty(z.Camera.prototype,"x",{get:function(){return this.view.x},set:function(e){this.view.x=e,this.bounds&&this.checkBounds()}}),Object.defineProperty(z.Camera.prototype,"y",{get:function(){return this.view.y},set:function(e){this.view.y=e,this.bounds&&this.checkBounds()}}),Object.defineProperty(z.Camera.prototype,"position",{get:function(){return this._position.set(this.view.x,this.view.y),this._position},set:function(e){void 0!==e.x&&(this.view.x=e.x),void 0!==e.y&&(this.view.y=e.y),this.bounds&&this.checkBounds()}}),Object.defineProperty(z.Camera.prototype,"width",{get:function(){return this.view.width},set:function(e){this.view.width=e}}),Object.defineProperty(z.Camera.prototype,"height",{get:function(){return this.view.height},set:function(e){this.view.height=e}}),Object.defineProperty(z.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(e){this._shake.intensity=e}}),Object.defineProperty(z.Camera.prototype,"fixedView",{get:function(){return this._fixedView.setTo(0,0,this.view.width,this.view.height),this._fixedView}}),z.State=function(){this.game=null,this.key="",this.add=null,this.make=null,this.camera=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.sound=null,this.scale=null,this.stage=null,this.state=null,this.time=null,this.tweens=null,this.world=null,this.particles=null,this.physics=null,this.rnd=null},z.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}},z.State.prototype.constructor=z.State,z.StateManager=function(a,t){this.game=a,this.states={},this._pendingState=null,void 0!==t&&null!==t&&(this._pendingState=t),this._clearWorld=!1,this._clearCache=!1,this._created=!1,this._args=[],this.current="",this.onStateChange=new z.Signal,this.onInitCallback=null,this.onPreloadCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPreRenderCallback=null,this.onLoadUpdateCallback=null,this.onLoadRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.onShutDownCallback=null},z.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this),this.game.onResume.add(this.resume,this),null!==this._pendingState&&"string"!=typeof this._pendingState&&this.add("default",this._pendingState,!0)},add:function(a,t,r){void 0===r&&(r=!1);var o;return t instanceof z.State?o=t:"object"==typeof t?(o=t).game=this.game:"function"==typeof t&&(o=new t(this.game)),this.states[a]=o,r&&(this.game.isBooted?this.start(a):this._pendingState=a),o},remove:function(e){this.current===e&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onPreRenderCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null),delete this.states[e]},start:function(a,t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),this.checkState(a)&&(this._pendingState=a,this._clearWorld=t,this._clearCache=e,3<arguments.length&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(a,t){void 0===a&&(a=!0),void 0===t&&(t=!1),this._pendingState=this.current,this._clearWorld=a,this._clearCache=t,2<arguments.length&&(this._args=Array.prototype.slice.call(arguments,2))},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){var e=this.current;if(this.clearCurrentState(),this.setCurrentState(this._pendingState),this.onStateChange.dispatch(this.current,e),this.current!==this._pendingState)return;this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(!0),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete()}},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache&&this.game.cache.destroy()))},checkState:function(a){var t=this.states[a];return t?!!(t.preload||t.create||t.update||t.render)||(console.warn("Invalid Phaser State object given. Must contain at least one of the required functions: preload, create, update or render"),!1):(console.warn("Phaser.StateManager - No state found with the key: "+a),!1)},link:function(a){var t=this.states[a];t.game=this.game,t.add=this.game.add,t.make=this.game.make,t.camera=this.game.camera,t.cache=this.game.cache,t.input=this.game.input,t.load=this.game.load,t.math=this.game.math,t.sound=this.game.sound,t.scale=this.game.scale,t.state=this,t.stage=this.game.stage,t.time=this.game.time,t.tweens=this.game.tweens,t.world=this.game.world,t.particles=this.game.particles,t.rnd=this.game.rnd,t.physics=this.game.physics,t.key=a},unlink:function(a){var t=this.states[a];t&&(t.game=null,t.add=null,t.make=null,t.camera=null,t.cache=null,t.input=null,t.load=null,t.math=null,t.sound=null,t.scale=null,t.state=null,t.stage=null,t.time=null,t.tweens=null,t.world=null,t.particles=null,t.rnd=null,t.physics=null)},setCurrentState:function(a){var t=this.states[a];this.callbackContext=t,this.link(a),this.onInitCallback=t.init||this.dummy,this.onPreloadCallback=t.preload||null,this.onLoadRenderCallback=t.loadRender||null,this.onLoadUpdateCallback=t.loadUpdate||null,this.onCreateCallback=t.create||null,this.onUpdateCallback=t.update||null,this.onPreRenderCallback=t.preRender||null,this.onRenderCallback=t.render||null,this.onResizeCallback=t.resize||null,this.onPausedCallback=t.paused||null,this.onResumedCallback=t.resumed||null,this.onPauseUpdateCallback=t.pauseUpdate||null,this.onShutDownCallback=t.shutdown||this.dummy,""!==this.current&&this.game.physics.reset(),this.current=a,this._created=!1,this.onInitCallback.apply(this.callbackContext,this._args),a===this._pendingState&&(this._args=[]),this.game._kickstart=!0},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){!1===this._created&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},loadUpdate:function(){!1===this._created&&this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created?this.onUpdateCallback&&this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created?this.onPauseUpdateCallback&&this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(e){this._created&&this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game,e)},resize:function(a,t){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,a,t)},render:function(){this._created?this.onRenderCallback&&(this.game.renderType===z.CANVAS?(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0),this.onRenderCallback.call(this.callbackContext,this.game),this.game.context.restore()):this.onRenderCallback.call(this.callbackContext,this.game)):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this._clearWorld=!0,this._clearCache=!0,this.clearCurrentState(),this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.game=null,this.states={},this._pendingState=null,this.current=""}},z.StateManager.prototype.constructor=z.StateManager,Object.defineProperty(z.StateManager.prototype,"created",{get:function(){return this._created}}),z.Signal=function(){},z.Signal.prototype={_bindings:null,_prevParams:null,memorize:!1,_shouldPropagate:!0,active:!0,_boundDispatch:!1,validateListener:function(a,r){if("function"!=typeof a)throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",r))},_registerListener:function(i,t,e,s,n){var o=this._indexOfListener(i,e),a;if(-1===o)a=new z.SignalBinding(this,i,t,e,s,n),this._addBinding(a);else if((a=this._bindings[o]).isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.");return this.memorize&&this._prevParams&&a.execute(this._prevParams),a},_addBinding:function(a){this._bindings||(this._bindings=[]);var t=this._bindings.length;do t--;while(this._bindings[t]&&a._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,a)},_indexOfListener:function(a,t){if(!this._bindings)return-1;void 0===t&&(t=null);for(var e=this._bindings.length,r;e--;)if((r=this._bindings[e])._listener===a&&r.context===t)return e;return-1},has:function(a,t){return-1!==this._indexOfListener(a,t)},add:function(a,t,e){this.validateListener(a,"add");var r=[];if(3<arguments.length)for(var o=3;o<arguments.length;o++)r.push(arguments[o]);return this._registerListener(a,!1,t,e,r)},addOnce:function(a,t,e){this.validateListener(a,"addOnce");var r=[];if(3<arguments.length)for(var o=3;o<arguments.length;o++)r.push(arguments[o]);return this._registerListener(a,!0,t,e,r)},remove:function(a,t){this.validateListener(a,"remove");var e=this._indexOfListener(a,t);return-1!==e&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)),a},removeAll:function(a){if(void 0===a&&(a=null),this._bindings){for(var t=this._bindings.length;t--;)a?this._bindings[t].context===a&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();a||(this._bindings.length=0)}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active&&(this._bindings||this.memorize)){var a=Array.prototype.slice.call(arguments);this.memorize&&(this._prevParams=a);var t=this._bindings?this._bindings.length:0;if(t){var e=this._bindings.slice();this._shouldPropagate=!0;do t--;while(e[t]&&this._shouldPropagate&&!1!==e[t].execute(a))}}},forget:function(){this._prevParams&&(this._prevParams=null)},dispose:function(){this.removeAll(),this._bindings=null,this._prevParams&&(this._prevParams=null)},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},Object.defineProperty(z.Signal.prototype,"boundDispatch",{get:function(){var e=this;return this._boundDispatch||(this._boundDispatch=function(){return e.dispatch.apply(e,arguments)})}}),z.Signal.prototype.constructor=z.Signal,z.SignalBinding=function(a,t,e,r,i,n){this._listener=t,e&&(this._isOnce=!0),null!=r&&(this.context=r),this._signal=a,i&&(this._priority=i),n&&n.length&&(this._args=n)},z.SignalBinding.prototype={context:null,_isOnce:!1,_priority:0,_args:null,callCount:0,active:!0,params:null,execute:function(a){var t,e;return this.active&&this._listener&&(e=this.params?this.params.concat(a):a,this._args&&(e=e.concat(this._args)),t=this._listener.apply(this.context,e),this.callCount++,this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},z.SignalBinding.prototype.constructor=z.SignalBinding,z.Filter=function(a,t,e){this.game=a,this.type=z.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.prevPoint=new z.Point;var r=new Date;if(this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[r.getFullYear(),r.getMonth(),r.getDate(),60*(60*r.getHours())+60*r.getMinutes()+r.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},t)for(var n in t)this.uniforms[n]=t[n];"string"==typeof e&&(e=e.split("\n")),this.fragmentSrc=e||[]},z.Filter.prototype={init:function(){},setResolution:function(a,t){this.uniforms.resolution.value.x=a,this.uniforms.resolution.value.y=t},update:function(a){if(a){var t=a.x/this.game.width,e=1-a.y/this.game.height;t===this.prevPoint.x&&e===this.prevPoint.y||(this.uniforms.mouse.value.x=t.toFixed(2),this.uniforms.mouse.value.y=e.toFixed(2),this.prevPoint.set(t,e))}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(i,t,e,s,n,o){void 0===n&&(n=0),void 0===o&&(o=0),void 0!==e&&null!==e?this.width=e:e=this.width,void 0!==s&&null!==s?this.height=s:s=this.height;var r=this.game.add.image(i,t,z.Cache.DEFAULT);return r.width=e,r.height=s,r.anchor.set(n,o),r.filters=[this],r},syncUniforms:function(){for(var e=0;e<this.shaders.length;e++)this.shaders[e].dirty=!0},destroy:function(){this.passes.length=0,this.shaders.length=0,this.fragmentSrc.length=0,this.game=null,this.uniforms=null,this.prevPoint=null}},z.Filter.prototype.constructor=z.Filter,Object.defineProperty(z.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(e){this.uniforms.resolution.value.x=e}}),Object.defineProperty(z.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(e){this.uniforms.resolution.value.y=e}}),z.Plugin=function(a,t){void 0===t&&(t=null),this.game=a,this.parent=t,this.active=!1,this.visible=!1,this.hasPreUpdate=!1,this.hasUpdate=!1,this.hasPostUpdate=!1,this.hasRender=!1,this.hasPostRender=!1},z.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null,this.parent=null,this.active=!1,this.visible=!1}},z.Plugin.prototype.constructor=z.Plugin,z.PluginManager=function(e){this.game=e,this.plugins=[],this._len=0,this._i=0},z.PluginManager.prototype={add:function(a){var r=Array.prototype.slice.call(arguments,1),e=!1;return"function"==typeof a?a=new a(this.game,this):(a.game=this.game,a.parent=this),"function"==typeof a.preUpdate&&(a.hasPreUpdate=!0,e=!0),"function"==typeof a.update&&(a.hasUpdate=!0,e=!0),"function"==typeof a.postUpdate&&(a.hasPostUpdate=!0,e=!0),"function"==typeof a.render&&(a.hasRender=!0,e=!0),"function"==typeof a.postRender&&(a.hasPostRender=!0,e=!0),e?((a.hasPreUpdate||a.hasUpdate||a.hasPostUpdate)&&(a.active=!0),(a.hasRender||a.hasPostRender)&&(a.visible=!0),this._len=this.plugins.push(a),"function"==typeof a.init&&a.init.apply(a,r),a):null},remove:function(a,t){for(void 0===t&&(t=!0),this._i=this._len;this._i--;)if(this.plugins[this._i]===a)return t&&a.destroy(),this.plugins.splice(this._i,1),void this._len--},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0,this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll(),this.game=null}},z.PluginManager.prototype.constructor=z.PluginManager,z.Stage=function(e){this.game=e,PIXI.DisplayObjectContainer.call(this),this.name="_stage_root",this.disableVisibilityChange=!1,this.exists=!0,this.worldTransform=new z.Matrix,this.stage=this,this.currentRenderOrderID=0,this._hiddenVar="hidden",this._onChange=null,this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"},this.game.transparent||(this._bgColor.a=1),e.config&&this.parseConfig(e.config)},z.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),z.Stage.prototype.constructor=z.Stage,z.Stage.prototype.parseConfig=function(e){e.disableVisibilityChange&&(this.disableVisibilityChange=e.disableVisibilityChange),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor)},z.Stage.prototype.boot=function(){z.DOM.getOffset(this.game.canvas,this.offset),z.Canvas.setUserSelect(this.game.canvas,"none"),z.Canvas.setTouchAction(this.game.canvas,"none"),this.checkVisibility()},z.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var a=0,t;a<this.children.length;)t=this.children[a],t.preUpdate(),this===t.parent&&a++},z.Stage.prototype.update=function(){for(var e=this.children.length;e--;)this.children[e].update()},z.Stage.prototype.postUpdate=function(){this.game.camera.update(),this.game.camera.target&&(this.game.camera.target.postUpdate(),this.updateTransform(),this.game.camera.updateTarget());for(var e=0;e<this.children.length;e++)this.children[e].postUpdate();this.updateTransform()},z.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var e=0;e<this.children.length;e++)this.children[e].updateTransform()},z.Stage.prototype.checkVisibility=function(){this._hiddenVar=void 0===document.hidden?void 0===document.webkitHidden?void 0===document.mozHidden?void 0===document.msHidden?null:"msvisibilitychange":"mozvisibilitychange":"webkitvisibilitychange":"visibilitychange";var a=this;this._onChange=function(t){return a.visibilityChange(t)},this._onChangePause=function(){return a._onChange({type:"pause"})},this._onChangeResume=function(){return a._onChange({type:"resume"})},this._onClick=function(t){void 0===document.hasFocus||document.hasFocus()||a.visibilityChange(t)},this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1),window.onblur=this._onChange,window.onfocus=this._onChange,window.onpagehide=this._onChange,window.onpageshow=this._onChange,window.addEventListener("click",this._onClick),this.game.device.cocoonJSApp&&CocoonJS.App&&(CocoonJS.App.onSuspended&&CocoonJS.App.onSuspended.addEventListener(this._onChangePause),CocoonJS.App.onActivated&&CocoonJS.App.onActivated.addEventListener(this._onChangeResume),CocoonJS.App.on&&(CocoonJS.App.on("activated",this._onChangeResume),CocoonJS.App.on("suspended",this._onChangePause)))},z.Stage.prototype.visibilityChange=function(e){switch(e.type){case"blur":case"pagehide":return void this.game.focusLoss(e);case"click":case"focus":case"pageshow":return void this.game.focusGain(e);}this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===e.type?this.game.gamePaused(e):this.game.gameResumed(e))},z.Stage.prototype.setBackgroundColor=function(e){this.game.transparent||(z.Color.valueToColor(e,this._bgColor),z.Color.updateColor(this._bgColor),this._bgColor.r/=255,this._bgColor.g/=255,this._bgColor.b/=255,this._bgColor.a=1)},z.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1),window.onpagehide=null,window.onpageshow=null,window.onblur=null,window.onfocus=null,window.removeEventListener("click",this._onClick)},z.Stage.prototype.add=function(a,t,e){return a.parent===this?a:(a.body&&a.parent&&a.parent.hash&&a.parent.removeFromHash(a),void 0===e?this.addChild(a):this.addChildAt(a,e),a)},Object.defineProperty(z.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(e){this.setBackgroundColor(e)}}),Object.defineProperty(z.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(e){PIXI.scaleModes.DEFAULT=e?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST}}),z.Group=function(a,t,e,i,n,o){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===o&&(o=z.Physics.ARCADE),this.game=a,void 0===t&&(t=a.world),this.name=e||"group",this.z=0,PIXI.DisplayObjectContainer.call(this),i?(this.game.stage.addChild(this),this.z=this.game.stage.children.length):t&&(t.addChild(this),this.z=t.children.length),this.type=z.GROUP,this.physicsType=z.GROUP,this.alive=!0,this.exists=!0,this.ignoreDestroy=!1,this.pendingDestroy=!1,this.classType=z.Sprite,this.cursor=null,this.inputEnableChildren=!1,this.updateOnlyExistingChildren=!1,this.onChildInputDown=new z.Signal,this.onChildInputUp=new z.Signal,this.onChildInputOver=new z.Signal,this.onChildInputOut=new z.Signal,this.enableBody=n,this.enableBodyDebug=!1,this.physicsBodyType=o,this.physicsSortDirection=null,this.onDestroy=new z.Signal,this.cursorIndex=0,this.fixedToCamera=!1,this.cameraOffset=new z.Point,this.hash=[],this._sortProperty="z"},z.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),z.Group.prototype.constructor=z.Group,z.Group.RETURN_NONE=0,z.Group.RETURN_TOTAL=1,z.Group.RETURN_CHILD=2,z.Group.RETURN_ALL=3,z.Group.SORT_ASCENDING=-1,z.Group.SORT_DESCENDING=1,z.Group.prototype.add=function(a,t,r){return void 0===t&&(t=!1),a.parent===this?a:(a.body&&a.parent&&a.parent.hash&&a.parent.removeFromHash(a),void 0===r?(a.z=this.children.length,this.addChild(a)):(this.addChildAt(a,r),this.updateZ()),this.enableBody&&a.hasOwnProperty("body")&&null===a.body?this.game.physics.enable(a,this.physicsBodyType):a.body&&this.addToHash(a),!this.inputEnableChildren||a.input&&!a.inputEnabled||(a.inputEnabled=!0),!t&&a.events&&a.events.onAddedToGroup$dispatch(a,this),null===this.cursor&&(this.cursor=a),a)},z.Group.prototype.addAt=function(a,t,e){return this.add(a,e,t)},z.Group.prototype.addToHash=function(e){return e.parent===this&&-1===this.hash.indexOf(e)&&(this.hash.push(e),!0)},z.Group.prototype.removeFromHash=function(a){if(a){var t=this.hash.indexOf(a);if(-1!==t)return this.hash.splice(t,1),!0}return!1},z.Group.prototype.addMultiple=function(a,t){if(a instanceof z.Group)a.moveAll(this,t);else if(Array.isArray(a))for(var e=0;e<a.length;e++)this.add(a[e],t);return a},z.Group.prototype.getAt=function(e){return 0>e||e>=this.children.length?-1:this.getChildAt(e)},z.Group.prototype.create=function(a,t,e,i,s,n){void 0===s&&(s=!0);var o=new this.classType(this.game,a,t,e,i);return o.exists=s,o.visible=s,o.alive=s,this.add(o,!1,n)},z.Group.prototype.createMultiple=function(d,t,l,p,s,n){void 0===l&&(l=0),void 0===p&&(p=!1),Array.isArray(t)||(t=[t]),Array.isArray(l)||(l=[l]);var o=this,r=[];return t.forEach(function(t){l.forEach(function(e){for(var a=0,i;a<d;a++)i=o.create(0,0,t,e,p),s&&s.call(n||i,i,a),r.push(i)})}),r},z.Group.prototype.updateZ=function(){for(var e=this.children.length;e--;)this.children[e].z=e},z.Group.prototype.align=function(i,t,e,s,n,o){if(void 0===n&&(n=z.TOP_LEFT),void 0===o&&(o=0),0===this.children.length||o>this.children.length||-1===i&&-1===t)return!1;for(var r=new z.Rectangle(0,0,e,s),a=i*e,d=t*s,l=o,p;l<this.children.length;l++)if(p=this.children[l],p.alignIn)if(p.alignIn(r,n),-1===i)r.y+=s,r.y===d&&(r.x+=e,r.y=0);else if(-1===t)r.x+=e,r.x===a&&(r.x=0,r.y+=s);else if(r.x+=e,r.x===a&&(r.x=0,r.y+=s,r.y===d))return!0;return!0},z.Group.prototype.resetCursor=function(e){if(void 0===e&&(e=0),e>this.children.length-1&&(e=0),this.cursor)return this.cursorIndex=e,this.cursor=this.children[this.cursorIndex],this.cursor},z.Group.prototype.next=function(){if(this.cursor)return this.cursorIndex>=this.children.length-1?this.cursorIndex=0:this.cursorIndex++,this.cursor=this.children[this.cursorIndex],this.cursor},z.Group.prototype.previous=function(){if(this.cursor)return 0===this.cursorIndex?this.cursorIndex=this.children.length-1:this.cursorIndex--,this.cursor=this.children[this.cursorIndex],this.cursor},z.Group.prototype.swap=function(a,t){this.swapChildren(a,t),this.updateZ()},z.Group.prototype.bringToTop=function(e){return e.parent===this&&this.getIndex(e)<this.children.length&&(this.remove(e,!1,!0),this.add(e,!0)),e},z.Group.prototype.sendToBack=function(e){return e.parent===this&&0<this.getIndex(e)&&(this.remove(e,!1,!0),this.addAt(e,0,!0)),e},z.Group.prototype.moveUp=function(a){if(a.parent===this&&this.getIndex(a)<this.children.length-1){var t=this.getIndex(a),e=this.getAt(t+1);e&&this.swap(a,e)}return a},z.Group.prototype.moveDown=function(a){if(a.parent===this&&0<this.getIndex(a)){var t=this.getIndex(a),e=this.getAt(t-1);e&&this.swap(a,e)}return a},z.Group.prototype.xy=function(a,t,e){return 0>a||a>this.children.length?-1:void(this.getChildAt(a).x=t,this.getChildAt(a).y=e)},z.Group.prototype.reverse=function(){this.children.reverse(),this.updateZ()},z.Group.prototype.getIndex=function(e){return this.children.indexOf(e)},z.Group.prototype.getByName=function(a){for(var t=0;t<this.children.length;t++)if(this.children[t].name===a)return this.children[t];return null},z.Group.prototype.replace=function(a,t){var e=this.getIndex(a);if(-1!==e)return t.parent&&(t.parent instanceof z.Group?t.parent.remove(t):t.parent.removeChild(t)),this.remove(a),this.addAt(t,e),a},z.Group.prototype.hasProperty=function(a,t){var e=t.length;return 1===e&&t[0]in a||2===e&&t[0]in a&&t[1]in a[t[0]]||3===e&&t[0]in a&&t[1]in a[t[0]]&&t[2]in a[t[0]][t[1]]||4===e&&t[0]in a&&t[1]in a[t[0]]&&t[2]in a[t[0]][t[1]]&&t[3]in a[t[0]][t[1]][t[2]]},z.Group.prototype.setProperty=function(a,t,e,r,i){if(void 0===i&&(i=!1),r=r||0,!this.hasProperty(a,t)&&(!i||0<r))return!1;var s=t.length;return 1===s?0===r?a[t[0]]=e:1===r?a[t[0]]+=e:2===r?a[t[0]]-=e:3===r?a[t[0]]*=e:4===r&&(a[t[0]]/=e):2===s?0===r?a[t[0]][t[1]]=e:1===r?a[t[0]][t[1]]+=e:2===r?a[t[0]][t[1]]-=e:3===r?a[t[0]][t[1]]*=e:4===r&&(a[t[0]][t[1]]/=e):3===s?0===r?a[t[0]][t[1]][t[2]]=e:1===r?a[t[0]][t[1]][t[2]]+=e:2===r?a[t[0]][t[1]][t[2]]-=e:3===r?a[t[0]][t[1]][t[2]]*=e:4===r&&(a[t[0]][t[1]][t[2]]/=e):4===s&&(0===r?a[t[0]][t[1]][t[2]][t[3]]=e:1===r?a[t[0]][t[1]][t[2]][t[3]]+=e:2===r?a[t[0]][t[1]][t[2]][t[3]]-=e:3===r?a[t[0]][t[1]][t[2]][t[3]]*=e:4===r&&(a[t[0]][t[1]][t[2]][t[3]]/=e)),!0},z.Group.prototype.checkProperty=function(a,t,e,r){if(void 0===r&&(r=!1),this!==a.parent)return!1;var n=z.Utils.getProperty(a,t);return!(void 0===n&&r||n!==e)},z.Group.prototype.set=function(a,t,e,i,s,n,o){if(void 0===o&&(o=!1),t=t.split("."),void 0===i&&(i=!1),void 0===s&&(s=!1),(!1===i||i&&a.alive)&&(!1===s||s&&a.visible))return this.setProperty(a,t,e,n,o)},z.Group.prototype.setAll=function(a,t,e,d,l,n){void 0===e&&(e=!1),void 0===d&&(d=!1),void 0===n&&(n=!1),a=a.split("."),l=l||0;for(var o=0;o<this.children.length;o++)(!e||e&&this.children[o].alive)&&(!d||d&&this.children[o].visible)&&this.setProperty(this.children[o],a,t,l,n)},z.Group.prototype.setAllChildren=function(i,t,e,d,l,o){void 0===e&&(e=!1),void 0===d&&(d=!1),void 0===o&&(o=!1),l=l||0;for(var r=0;r<this.children.length;r++)(!e||e&&this.children[r].alive)&&(!d||d&&this.children[r].visible)&&(this.children[r]instanceof z.Group?this.children[r].setAllChildren(i,t,e,d,l,o):this.setProperty(this.children[r],i.split("."),t,l,o))},z.Group.prototype.checkAll=function(a,t,e,d,l){void 0===e&&(e=!1),void 0===d&&(d=!1),void 0===l&&(l=!1);for(var n=0,o;n<this.children.length;n++)if(o=this.children[n],(!e||e&&o.alive)&&(!d||d&&o.visible)&&!this.checkProperty(o,a,t,l))return!1;return!0},z.Group.prototype.checkAny=function(a,t,e,r){void 0===e&&(e=!1),void 0===r&&(r=!1);for(var d=0,n;d<this.children.length;d++)if(n=this.children[d],(!e||e&&n.alive)&&(!r||r&&n.visible)&&this.checkProperty(n,a,t))return!0;return!1},z.Group.prototype.addAll=function(a,t,e,r){this.setAll(a,t,e,r,1)},z.Group.prototype.subAll=function(a,t,e,r){this.setAll(a,t,e,r,2)},z.Group.prototype.multiplyAll=function(a,t,e,r){this.setAll(a,t,e,r,3)},z.Group.prototype.divideAll=function(a,t,e,r){this.setAll(a,t,e,r,4)},z.Group.prototype.kill=function(){this.alive=!1,this.exists=!1,this.visible=!1},z.Group.prototype.killAll=function(){this.callAllExists("kill",!0)},z.Group.prototype.revive=function(){this.alive=!0,this.exists=!0,this.visible=!0},z.Group.prototype.reviveAll=function(){this.callAllExists("revive",!1)},z.Group.prototype.resetAll=function(a,t,e,r,o){this.forEach(this.resetChild,this,o,a,t,e,r)},z.Group.prototype.callAllExists=function(a,t){var e;if(2<arguments.length)for(e=[],r=2;r<arguments.length;r++)e.push(arguments[r]);for(var r=0;r<this.children.length;r++)this.children[r].exists===t&&this.children[r][a]&&this.children[r][a].apply(this.children[r],e)},z.Group.prototype.callbackFromArray=function(a,t,e){if(1===e){if(a[t[0]])return a[t[0]];}else if(2===e){if(a[t[0]][t[1]])return a[t[0]][t[1]];}else if(3===e){if(a[t[0]][t[1]][t[2]])return a[t[0]][t[1]][t[2]];}else if(4===e){if(a[t[0]][t[1]][t[2]][t[3]])return a[t[0]][t[1]][t[2]][t[3]];}else if(a[t])return a[t];return!1},z.Group.prototype.callAll=function(d,t){if(void 0!==d){var l=(d=d.split(".")).length;if(void 0===t||null===t||""===t)t=null;else if("string"==typeof t)var i=(t=t.split(".")).length;var s;if(2<arguments.length)for(s=[],r=2;r<arguments.length;r++)s.push(arguments[r]);for(var n=null,o=null,r=0;r<this.children.length;r++)n=this.callbackFromArray(this.children[r],d,l),t&&n?(o=this.callbackFromArray(this.children[r],t,i),n&&n.apply(o,s)):n&&n.apply(this.children[r],s)}},z.Group.prototype.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(var a=0,t;a<this.children.length;)t=this.children[a],t.preUpdate(),this===t.parent&&a++;return!0},z.Group.prototype.update=function(){for(var a=this.children.length,t;a--;){t=this.children.length,a>=t&&(a=t-1);var e=this.children[a];this.updateOnlyExistingChildren&&!e.exists||e.update()}},z.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var e=0;e<this.children.length;e++)this.children[e].postUpdate()},z.Group.prototype.filter=function(a,t){for(var i=-1,s=this.children.length,n=[],o;++i<s;)o=this.children[i],(!t||t&&o.exists)&&a(o,i,this.children)&&n.push(o);return new z.ArraySet(n)},z.Group.prototype.forEach=function(a,t,e){if(void 0===e&&(e=!1),3>=arguments.length)for(o=0;o<this.children.length;o++)(!e||e&&this.children[o].exists)&&a.call(t,this.children[o]);else{for(var r=[null],o=3;o<arguments.length;o++)r.push(arguments[o]);for(o=0;o<this.children.length;o++)(!e||e&&this.children[o].exists)&&(r[0]=this.children[o],a.apply(t,r))}},z.Group.prototype.forEachExists=function(a,t){var e;if(2<arguments.length){e=[null];for(var r=2;r<arguments.length;r++)e.push(arguments[r])}this.iterate("exists",!0,z.Group.RETURN_TOTAL,a,t,e)},z.Group.prototype.forEachAlive=function(a,t){var e;if(2<arguments.length){e=[null];for(var r=2;r<arguments.length;r++)e.push(arguments[r])}this.iterate("alive",!0,z.Group.RETURN_TOTAL,a,t,e)},z.Group.prototype.forEachDead=function(a,t){var e;if(2<arguments.length){e=[null];for(var r=2;r<arguments.length;r++)e.push(arguments[r])}this.iterate("alive",!1,z.Group.RETURN_TOTAL,a,t,e)},z.Group.prototype.sort=function(a,t){2>this.children.length||(void 0===a&&(a="z"),void 0===t&&(t=z.Group.SORT_ASCENDING),this._sortProperty=a,t===z.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ())},z.Group.prototype.customSort=function(a,t){2>this.children.length||(this.children.sort(a.bind(t)),this.updateZ())},z.Group.prototype.ascendingSortHandler=function(a,t){return a[this._sortProperty]<t[this._sortProperty]?-1:a[this._sortProperty]>t[this._sortProperty]?1:a.z<t.z?-1:1},z.Group.prototype.descendingSortHandler=function(a,t){return a[this._sortProperty]<t[this._sortProperty]?1:a[this._sortProperty]>t[this._sortProperty]?-1:0},z.Group.prototype.iterate=function(i,t,e,s,n,o){if(0===this.children.length){if(e===z.Group.RETURN_TOTAL)return 0;if(e===z.Group.RETURN_ALL)return[]}var r=0;if(e===z.Group.RETURN_ALL)var a=[];for(var d=0;d<this.children.length;d++)if(this.children[d][i]===t){if(r++,s&&(o?(o[0]=this.children[d],s.apply(n,o)):s.call(n,this.children[d])),e===z.Group.RETURN_CHILD)return this.children[d];e===z.Group.RETURN_ALL&&a.push(this.children[d])}return e===z.Group.RETURN_TOTAL?r:e===z.Group.RETURN_ALL?a:null},z.Group.prototype.getFirst=function(a,t){return this.iterate(a,t,z.Group.RETURN_CHILD)},z.Group.prototype.getFirstExists=function(a,d,e,i,s,n){void 0===d&&(d=!1),"boolean"!=typeof a&&(a=!0);var o=this.getFirst("exists",a);return null===o&&d?this.create(e,i,s,n):this.resetChild(o,e,i,s,n)},z.Group.prototype.getFirstAlive=function(a,t,e,r,i){void 0===a&&(a=!1);var n=this.getFirst("alive",!0);return null===n&&a?this.create(t,e,r,i):this.resetChild(n,t,e,r,i)},z.Group.prototype.getFirstDead=function(a,t,e,r,i){void 0===a&&(a=!1);var n=this.getFirst("alive",!1);return null===n&&a?this.create(t,e,r,i):this.resetChild(n,t,e,r,i)},z.Group.prototype.resetChild=function(a,t,e,r,o){return null===a?null:(void 0===t&&(t=null),void 0===e&&(e=null),null!==t&&null!==e&&a.reset(t,e),void 0!==r&&a.loadTexture(r,o),a)},z.Group.prototype.getTop=function(){if(0<this.children.length)return this.children[this.children.length-1]},z.Group.prototype.getBottom=function(){if(0<this.children.length)return this.children[0]},z.Group.prototype.getClosestTo=function(i,t,l){for(var s=d,n=0,o=null,r=0,a;r<this.children.length;r++)a=this.children[r],a.exists&&(n=E(z.Point.distance(i,a)))<s&&(!t||t.call(l,a,n))&&(s=n,o=a);return o},z.Group.prototype.getFurthestFrom=function(i,t,d){for(var s=0,n=0,o=null,r=0,a;r<this.children.length;r++)a=this.children[r],a.exists&&(n=E(z.Point.distance(i,a)))>s&&(!t||t.call(d,a,n))&&(s=n,o=a);return o},z.Group.prototype.count=function(a,t){return this.iterate(a,t,z.Group.RETURN_TOTAL)},z.Group.prototype.countLiving=function(){return this.count("alive",!0)},z.Group.prototype.countDead=function(){return this.count("alive",!1)},z.Group.prototype.getRandom=function(a,t){return void 0===a&&(a=0),void 0===t&&(t=this.children.length),0===t?null:z.ArrayUtils.getRandomItem(this.children,a,t)},z.Group.prototype.getRandomExists=function(a,t){var e=this.getAll("exists",!0,a,t);return this.game.rnd.pick(e)},z.Group.prototype.getAll=function(a,t,e,i){void 0===e&&(e=0),void 0===i&&(i=this.children.length);for(var s=[],n=e,o;n<i;n++)o=this.children[n],a?o[a]===t&&s.push(o):s.push(o);return s},z.Group.prototype.remove=function(a,t,e){if(void 0===t&&(t=!1),void 0===e&&(e=!1),0===this.children.length||-1===this.children.indexOf(a))return!1;e||!a.events||a.destroyPhase||a.events.onRemovedFromGroup$dispatch(a,this);var r=this.removeChild(a);return this.removeFromHash(a),this.updateZ(),this.cursor===a&&this.next(),t&&r&&r.destroy(!0),!0},z.Group.prototype.moveAll=function(a,t){if(void 0===t&&(t=!1),0<this.children.length&&a instanceof z.Group){do a.add(this.children[0],t);while(0<this.children.length);this.hash=[],this.cursor=null}return a},z.Group.prototype.removeAll=function(a,t,r){if(void 0===a&&(a=!1),void 0===t&&(t=!1),void 0===r&&(r=!1),0!==this.children.length){do{!t&&this.children[0].events&&this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this);var o=this.removeChild(this.children[0]);this.removeFromHash(o),a&&o&&o.destroy(!0,r)}while(0<this.children.length);this.hash=[],this.cursor=null}},z.Group.prototype.removeBetween=function(a,t,e,r){if(void 0===t&&(t=this.children.length-1),void 0===e&&(e=!1),void 0===r&&(r=!1),0!==this.children.length){if(a>t||0>a||t>this.children.length)return!1;for(var i=t;i>=a;){!r&&this.children[i].events&&this.children[i].events.onRemovedFromGroup$dispatch(this.children[i],this);var n=this.removeChild(this.children[i]);this.removeFromHash(n),e&&n&&n.destroy(!0),this.cursor===this.children[i]&&(this.cursor=null),i--}this.updateZ()}},z.Group.prototype.scatter=function(a,t){null==a&&(a=this.game.world.bounds),this.forEach(function(t){t.position.set(a.randomX,a.randomY)},null,t)},z.Group.prototype.shuffle=function(){z.ArrayUtils.shuffle(this.children),this.updateZ()},z.Group.prototype.destroy=function(a,t){null===this.game||this.ignoreDestroy||(void 0===a&&(a=!0),void 0===t&&(t=!1),this.onDestroy.dispatch(this,a,t),this.removeAll(a),this.cursor=null,this.filters=null,this.pendingDestroy=!1,t||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Object.defineProperty(z.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,z.Group.RETURN_TOTAL)}}),Object.defineProperty(z.Group.prototype,"length",{get:function(){return this.children.length}}),Object.defineProperty(z.Group.prototype,"angle",{get:function(){return z.Math.radToDeg(this.rotation)},set:function(e){this.rotation=z.Math.degToRad(e)}}),Object.defineProperty(z.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(a){var t=this.getBounds(this.parent),e=this.x-t.x;this.x=a+e-t.halfWidth}}),Object.defineProperty(z.Group.prototype,"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(a){var t=this.getBounds(this.parent),e=this.y-t.y;this.y=a+e-t.halfHeight}}),Object.defineProperty(z.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(a){var t=this.getBounds(this.parent),e=this.x-t.x;this.x=a+e}}),Object.defineProperty(z.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(a){var t=this.getBounds(this.parent),e=this.x-t.x;this.x=a+e-t.width}}),Object.defineProperty(z.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(a){var t=this.getBounds(this.parent),e=this.y-t.y;this.y=a+e}}),Object.defineProperty(z.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(a){var t=this.getBounds(this.parent),e=this.y-t.y;this.y=a+e-t.height}}),z.World=function(e){z.Group.call(this,e,null,"__world",!1),this.bounds=new z.Rectangle(0,0,e.width,e.height),this.camera=null,this._definedSize=!1,this._width=e.width,this._height=e.height,this.game.state.onStateChange.add(this.stateChange,this)},z.World.prototype=Object.create(z.Group.prototype),z.World.prototype.constructor=z.World,z.World.prototype.boot=function(){this.camera=new z.Camera(this.game,0,0,0,this.game.width,this.game.height),this.game.stage.addChild(this),this.camera.boot()},z.World.prototype.stateChange=function(){this.x=0,this.y=0,this.camera.reset()},z.World.prototype.setBounds=function(a,t,e,r){this._definedSize=!0,this._width=e,this._height=r,this.bounds.setTo(a,t,e,r),this.x=a,this.y=t,this.camera.bounds&&this.camera.bounds.setTo(a,t,C(e,this.game.width),C(r,this.game.height)),this.game.physics.setBoundsToWorld()},z.World.prototype.resize=function(a,t){this._definedSize&&(a<this._width&&(a=this._width),t<this._height&&(t=this._height)),this.bounds.width=a,this.bounds.height=t,this.game.camera.setBoundsToWorld(),this.game.physics.setBoundsToWorld()},z.World.prototype.shutdown=function(){this.destroy(!0,!0)},z.World.prototype.wrap=function(a,t,e,r,o){void 0===t&&(t=0),void 0===e&&(e=!1),void 0===r&&(r=!0),void 0===o&&(o=!0),e?(a.getBounds(),r&&(a.x+a._currentBounds.width<this.bounds.x?a.x=this.bounds.right:a.x>this.bounds.right&&(a.x=this.bounds.left)),o&&(a.y+a._currentBounds.height<this.bounds.top?a.y=this.bounds.bottom:a.y>this.bounds.bottom&&(a.y=this.bounds.top))):(r&&a.x+t<this.bounds.x?a.x=this.bounds.right+t:r&&a.x-t>this.bounds.right&&(a.x=this.bounds.left-t),o&&a.y+t<this.bounds.top?a.y=this.bounds.bottom+t:o&&a.y-t>this.bounds.bottom&&(a.y=this.bounds.top-t))},z.World.prototype.wrapAll=function(a,t,e,r,i,n){a.forEach(this.wrap,this,t,e,r,i,n)},Object.defineProperty(z.World.prototype,"width",{get:function(){return this.bounds.width},set:function(e){e<this.game.width&&(e=this.game.width),this.bounds.width=e,this._width=e,this._definedSize=!0}}),Object.defineProperty(z.World.prototype,"height",{get:function(){return this.bounds.height},set:function(e){e<this.game.height&&(e=this.game.height),this.bounds.height=e,this._height=e,this._definedSize=!0}}),Object.defineProperty(z.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}}),Object.defineProperty(z.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}}),Object.defineProperty(z.World.prototype,"randomX",{get:function(){return 0>this.bounds.x?this.game.rnd.between(this.bounds.x,this.bounds.width-E(this.bounds.x)):this.game.rnd.between(this.bounds.x,this.bounds.width)}}),Object.defineProperty(z.World.prototype,"randomY",{get:function(){return 0>this.bounds.y?this.game.rnd.between(this.bounds.y,this.bounds.height-E(this.bounds.y)):this.game.rnd.between(this.bounds.y,this.bounds.height)}}),z.Game=function(i,t,e,s,n,o,r,a){return this.id=z.GAMES.push(this)-1,this.config=null,this.physicsConfig=a,this.parent="",this.width=800,this.height=600,this.resolution=1,this._width=800,this._height=600,this.transparent=!1,this.antialias=!0,this.multiTexture=!1,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!0,this.renderer=null,this.renderType=z.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.plugins=null,this.rnd=null,this.device=z.Device,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.create=null,this.lockRender=!1,this.pendingDestroy=!1,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this.currentUpdateID=0,this.updatesThisFrame=1,this.rendersThisFrame=1,this._deltaTime=0,this._lastCount=0,this._spiraling=0,this._kickstart=!0,this.fpsProblemNotifier=new z.Signal,this.forceSingleUpdate=!0,this.forceSingleRender=!0,this.dropFrames=!1,this._nextFpsNotification=0,1===arguments.length&&"object"==typeof arguments[0]?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},void 0!==i&&(this._width=i),void 0!==t&&(this._height=t),void 0!==e&&(this.renderType=e),void 0!==s&&(this.parent=s),void 0!==o&&(this.transparent=o),void 0!==r&&(this.antialias=r),this.rnd=new z.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new z.StateManager(this,n)),this.device.whenReady(this.boot,this),this},z.Game.prototype={parseConfig:function(a){this.config=a,void 0===a.enableDebug&&(this.config.enableDebug=!0),a.width&&(this._width=a.width),a.height&&(this._height=a.height),a.renderer&&(this.renderType=a.renderer),a.parent&&(this.parent=a.parent),void 0!==a.transparent&&(this.transparent=a.transparent),void 0!==a.antialias&&(this.antialias=a.antialias),void 0!==a.clearBeforeRender&&(this.clearBeforeRender=a.clearBeforeRender),void 0!==a.multiTexture&&(this.multiTexture=a.multiTexture),a.resolution&&(this.resolution=a.resolution),void 0!==a.preserveDrawingBuffer&&(this.preserveDrawingBuffer=a.preserveDrawingBuffer),a.physicsConfig&&(this.physicsConfig=a.physicsConfig);var t=[(Date.now()*Math.random()).toString()];a.seed&&(t=a.seed),this.rnd=new z.RandomDataGenerator(t);var e=null;a.state&&(e=a.state),this.state=new z.StateManager(this,e)},boot:function(){this.isBooted||(this.onPause=new z.Signal,this.onResume=new z.Signal,this.onBlur=new z.Signal,this.onFocus=new z.Signal,this.isBooted=!0,PIXI.game=this,this.math=z.Math,this.scale=new z.ScaleManager(this,this._width,this._height),this.stage=new z.Stage(this),this.setUpRenderer(),this.world=new z.World(this),this.add=new z.GameObjectFactory(this),this.make=new z.GameObjectCreator(this),this.cache=new z.Cache(this),this.load=new z.Loader(this),this.time=new z.Time(this),this.tweens=new z.TweenManager(this),this.input=new z.Input(this),this.sound=new z.SoundManager(this),this.physics=new z.Physics(this,this.physicsConfig),this.particles=new z.Particles(this),this.create=new z.Create(this),this.plugins=new z.PluginManager(this),this.net=new z.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new z.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){},isDisabled:!0},this.showDebugHeader(),this.isRunning=!0,this.raf=this.config&&this.config.forceSetTimeOut?new z.RequestAnimationFrame(this,this.config.forceSetTimeOut):new z.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)&&window.focus(),this.config.disableStart||(this.cache.isReady?this.raf.start():this.cache.onReady.addOnce(function(){this.raf.start()},this)))},showDebugHeader:function(){if(!window.PhaserGlobal||!window.PhaserGlobal.hideBanner){var a=z.VERSION,t="Canvas",e="HTML Audio",i=1;if(this.renderType===z.WEBGL?(t="WebGL",i++):this.renderType===z.HEADLESS&&(t="Headless"),this.device.webAudio&&(e="WebAudio",i++),this.device.ie)window.console&&console.log("Phaser v"+a+" | Pixi.js | "+t+" | "+e+" | http://phaser.io");else{for(var n=["%c %c %c Phaser CE v"+a+" | Pixi.js | "+t+" | "+e+"  %c %c %c http://phaser.io %c\u2665%c\u2665%c\u2665","background: #fb8cb3","background: #d44a52","color: #ffffff; background: #871905;","background: #d44a52","background: #fb8cb3","background: #ffffff"],o=0;3>o;o++)o<i?n.push("color: #ff2424; background: #fff"):n.push("color: #959595; background: #fff");console.log.apply(console,n)}}},setUpRenderer:function(){if(!this.device.canvas)throw new Error("Phaser.Game - Cannot create Canvas 2d context, aborting.");if(this.canvas=this.config.canvas?this.config.canvas:z.Canvas.create(this,this.width,this.height,this.config.canvasID,!0),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.config.crisp&&z.Canvas.setImageRenderingCrisp(this.canvas),this.renderType===z.WEBGL||this.renderType===z.WEBGL_MULTI||this.renderType===z.AUTO&&this.device.webGL){(this.multiTexture||this.renderType===z.WEBGL_MULTI)&&(PIXI.enableMultiTexture(),this.multiTexture=!0);try{this.renderer=new PIXI.WebGLRenderer(this,this.config),this.renderType=z.WEBGL,this.context=null,this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),!1)}catch(e){if(this.renderer=null,this.multiTexture=!1,PIXI._enableMultiTextureToggle=!1,this.renderType===z.WEBGL)throw e}}this.renderer||(this.renderer=new PIXI.CanvasRenderer(this,this.config),this.context=this.renderer.context,this.renderType===z.AUTO&&(this.renderType=z.CANVAS)),this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===z.CANVAS),this.renderType!==z.HEADLESS&&(this.stage.smoothed=this.antialias,z.Canvas.addToDOM(this.canvas,this.parent,!1),z.Canvas.setTouchAction(this.canvas))},contextLost:function(e){e.preventDefault(),this.renderer.contextLost=!0},contextRestored:function(){this.renderer.initContext(),this.cache.clearGLTextures(),this.renderer.contextLost=!1},update:function(a){if(this.pendingDestroy)this.destroy();else{if(this.time.update(a),this._kickstart)return this.updateLogic(this.time.desiredFpsMult),this.updateRender(this.time.slowMotion*this.time.desiredFps),void(this._kickstart=!1);if(1<this._spiraling&&!this.forceSingleUpdate)this.time.time>this._nextFpsNotification&&(this._nextFpsNotification=this.time.time+1e4,this.fpsProblemNotifier.dispatch()),this._deltaTime=0,this._spiraling=0,this.dropFrames?this.rendersThisFrame=0:(this.updateRender(this.time.slowMotion*this.time.desiredFps),this.rendersThisFrame=1);else{var t=1e3*this.time.slowMotion/this.time.desiredFps;this._deltaTime+=C(A(3*t,this.time.elapsed),0);var e=0;for(this.updatesThisFrame=x(this._deltaTime/t),this.forceSingleUpdate&&(this.updatesThisFrame=A(1,this.updatesThisFrame)),this.rendersThisFrame=this.forceSingleRender?1:A(1,this.updatesThisFrame);this._deltaTime>=t&&(this._deltaTime-=t,this.currentUpdateID=e,this.updateLogic(this.time.desiredFpsMult),e++,!this.forceSingleUpdate||1!=e);)this.time.refresh();e>this._lastCount?this._spiraling++:e<this._lastCount&&(this._spiraling=0),this._lastCount=e,0<this.rendersThisFrame&&this.updateRender(this._deltaTime/t)}}},updateLogic:function(e){this._paused||this.pendingStep?(this.scale.pauseUpdate(),this.state.pauseUpdate(e),this.debug.preUpdate(),this.input.pauseUpdate()):(this.stepping&&(this.pendingStep=!0),this.time.countUpdate(),this.scale.preUpdate(),this.debug.preUpdate(),this.camera.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(e),this.plugins.preUpdate(e),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate()),this.stage.updateTransform()},updateRender:function(e){this.lockRender||(this.time.countRender(),this.state.preRender(e),this.renderType!==z.HEADLESS&&(this.renderer.render(this.stage),this.plugins.render(e),this.state.render(e)),this.plugins.postRender(e))},enableStep:function(){this.stepping=!0,this.pendingStep=!1,this.stepCount=0},disableStep:function(){this.stepping=!1,this.pendingStep=!1},step:function(){this.pendingStep=!1,this.stepCount++},destroy:function(){this.raf.stop(),this.debug.destroy&&this.debug.destroy(),this.state.destroy(),this.sound.destroy(),this.scale.destroy(),this.stage.destroy(),this.input.destroy(),this.physics.destroy(),this.plugins.destroy(),this.debug=null,this.state=null,this.sound=null,this.scale=null,this.stage=null,this.input=null,this.physics=null,this.plugins=null,this.cache=null,this.load=null,this.time=null,this.world=null,this.isBooted=!1,this.renderer.destroy(!1),z.Canvas.removeFromDOM(this.canvas),PIXI.defaultRenderer=null,z.GAMES[this.id]=null},gamePaused:function(e){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.muteOnPause&&this.sound.setMute(),this.onPause.dispatch(e),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},gameResumed:function(e){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.muteOnPause&&this.sound.unsetMute(),this.onResume.dispatch(e),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))},focusLoss:function(e){this.onBlur.dispatch(e),this.stage.disableVisibilityChange||this.gamePaused(e)},focusGain:function(e){this.onFocus.dispatch(e),this.stage.disableVisibilityChange||this.gameResumed(e)}},z.Game.prototype.constructor=z.Game,Object.defineProperty(z.Game.prototype,"paused",{get:function(){return this._paused},set:function(e){!0===e?(!1===this._paused&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}}),z.Input=function(e){this.game=e,this.hitCanvas=null,this.hitContext=null,this.moveCallbacks=[],this.customCandidateHandler=null,this.customCandidateHandlerContext=null,this.pollRate=0,this.enabled=!0,this.multiInputOverride=z.Input.MOUSE_TOUCH_COMBINE,this.position=null,this.speed=null,this.circle=null,this.scale=null,this.maxPointers=-1,this.tapRate=200,this.doubleTapRate=300,this.holdRate=2e3,this.justPressedRate=200,this.justReleasedRate=200,this.recordPointerHistory=!1,this.recordRate=100,this.recordLimit=100,this.touchLockCallbacks=[],this.pointer1=null,this.pointer2=null,this.pointer3=null,this.pointer4=null,this.pointer5=null,this.pointer6=null,this.pointer7=null,this.pointer8=null,this.pointer9=null,this.pointer10=null,this.pointers=[],this.activePointer=null,this.mousePointer=null,this.mouse=null,this.keyboard=null,this.touch=null,this.mspointer=null,this.gamepad=null,this.resetLocked=!1,this.onDown=null,this.onUp=null,this.onTap=null,this.onHold=null,this.minPriorityID=0,this.interactiveItems=new z.ArraySet,this._localPoint=new z.Point,this._pollCounter=0,this._oldPosition=null,this._x=0,this._y=0},z.Input.MOUSE_OVERRIDES_TOUCH=0,z.Input.TOUCH_OVERRIDES_MOUSE=1,z.Input.MOUSE_TOUCH_COMBINE=2,z.Input.MAX_POINTERS=10,z.Input.prototype={boot:function(){this.mousePointer=new z.Pointer(this.game,0,z.PointerMode.CURSOR),this.addPointer(),this.addPointer(),this.mouse=new z.Mouse(this.game),this.touch=new z.Touch(this.game),this.mspointer=new z.MSPointer(this.game),z.Keyboard&&(this.keyboard=new z.Keyboard(this.game)),z.Gamepad&&(this.gamepad=new z.Gamepad(this.game)),this.onDown=new z.Signal,this.onUp=new z.Signal,this.onTap=new z.Signal,this.onHold=new z.Signal,this.scale=new z.Point(1,1),this.speed=new z.Point,this.position=new z.Point,this._oldPosition=new z.Point,this.circle=new z.Circle(0,0,44),this.activePointer=this.mousePointer,this.hitCanvas=z.CanvasPool.create(this,1,1),this.hitContext=this.hitCanvas.getContext("2d"),this.mouse.start(),this.game.device.mspointer||this.touch.start(),this.mspointer.start(),this.mousePointer.active=!0,this.keyboard&&this.keyboard.start();var a=this;this._onClickTrampoline=function(t){a.onClickTrampoline(t)},this.game.canvas.addEventListener("click",this._onClickTrampoline,!1)},destroy:function(){this.mouse.stop(),this.touch.stop(),this.mspointer.stop(),this.keyboard&&this.keyboard.stop(),this.gamepad&&this.gamepad.stop(),this.moveCallbacks=[],z.CanvasPool.remove(this),this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(a,t){this.customCandidateHandler=a,this.customCandidateHandlerContext=t},addMoveCallback:function(a,r){this.moveCallbacks.push({callback:a,context:r})},addTouchLockCallback:function(a,r,o){void 0===o&&(o=!1),this.touchLockCallbacks.push({callback:a,context:r,onEnd:o})},removeTouchLockCallback:function(a,t){for(var e=this.touchLockCallbacks.length;e--;)if(this.touchLockCallbacks[e].callback===a&&this.touchLockCallbacks[e].context===t)return this.touchLockCallbacks.splice(e,1),!0;return!1},executeTouchLockCallbacks:function(a,t){for(var e=this.touchLockCallbacks.length,r;e--;)r=this.touchLockCallbacks[e],r.onEnd===a&&r.callback.call(r.context,this,t)&&this.touchLockCallbacks.splice(e,1)},deleteMoveCallback:function(a,t){for(var e=this.moveCallbacks.length;e--;)if(this.moveCallbacks[e].callback===a&&this.moveCallbacks[e].context===t)return void this.moveCallbacks.splice(e,1)},addPointer:function(){if(this.pointers.length>=z.Input.MAX_POINTERS)return console.warn("Phaser.Input.addPointer: Maximum limit of "+z.Input.MAX_POINTERS+" pointers reached."),null;var a=this.pointers.length+1,t=new z.Pointer(this.game,a,z.PointerMode.CONTACT);return this.pointers.push(t),this["pointer"+a]=t,t},update:function(){if(this.keyboard&&this.keyboard.update(),0<this.pollRate&&this._pollCounter<this.pollRate)this._pollCounter++;else{this.speed.x=this.position.x-this._oldPosition.x,this.speed.y=this.position.y-this._oldPosition.y,this._oldPosition.copyFrom(this.position),this.mousePointer.update(),this.gamepad&&this.gamepad.active&&this.gamepad.update();for(var e=0;e<this.pointers.length;e++)this.pointers[e].update();this._pollCounter=0}},pauseUpdate:function(){this.gamepad&&this.gamepad.active&&this.gamepad.update()},reset:function(a){if(this.game.isBooted&&!this.resetLocked){void 0===a&&(a=!1),this.mousePointer.reset(),this.keyboard&&this.keyboard.reset(a);for(var t=0;t<this.pointers.length;t++)this.pointers[t].reset();"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor=""),a&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new z.Signal,this.onUp=new z.Signal,this.onTap=new z.Signal,this.onHold=new z.Signal,this.moveCallbacks=[]),this._pollCounter=0}},resetSpeed:function(a,t){this._oldPosition.setTo(a,t),this.speed.setTo(0,0)},startPointer:function(a){if(0<=this.maxPointers&&this.countActivePointers(this.maxPointers)>=this.maxPointers)return null;if(!this.pointer1.active)return this.pointer1.start(a);if(!this.pointer2.active)return this.pointer2.start(a);for(var t=2,e;t<this.pointers.length;t++)if(e=this.pointers[t],!e.active)return e.start(a);return null},updatePointer:function(a){if(this.pointer1.active&&this.pointer1.identifier===a.identifier)return this.pointer1.move(a);if(this.pointer2.active&&this.pointer2.identifier===a.identifier)return this.pointer2.move(a);for(var t=2,e;t<this.pointers.length;t++)if(e=this.pointers[t],e.active&&e.identifier===a.identifier)return e.move(a);return null},stopPointer:function(a){if(this.pointer1.active&&this.pointer1.identifier===a.identifier)return this.pointer1.stop(a);if(this.pointer2.active&&this.pointer2.identifier===a.identifier)return this.pointer2.stop(a);for(var t=2,e;t<this.pointers.length;t++)if(e=this.pointers[t],e.active&&e.identifier===a.identifier)return e.stop(a);return null},countActivePointers:function(a){void 0===a&&(a=this.pointers.length);for(var t=a,e=0;e<this.pointers.length&&0<t;e++)this.pointers[e].active&&t--;return a-t},getPointer:function(a){void 0===a&&(a=!1);for(var t=0,e;t<this.pointers.length;t++)if(e=this.pointers[t],e.active===a)return e;return null},getPointerFromIdentifier:function(a){for(var t=0,e;t<this.pointers.length;t++)if(e=this.pointers[t],e.identifier===a)return e;return null},getPointerFromId:function(a){for(var t=0,e;t<this.pointers.length;t++)if(e=this.pointers[t],e.pointerId===a)return e;return null},getLocalPosition:function(a,t,e){void 0===e&&(e=new z.Point);var r=a.worldTransform,n=1/(r.a*r.d+r.c*-r.b);return e.setTo(r.d*n*t.x+-r.c*n*t.y+(r.ty*r.c-r.tx*r.d)*n,r.a*n*t.y+-r.b*n*t.x+(-r.ty*r.a+r.tx*r.b)*n)},hitTest:function(i,t,e){if(!i.worldVisible)return!1;if(this.getLocalPosition(i,t,this._localPoint),e.copyFrom(this._localPoint),i.hitArea&&i.hitArea.contains)return i.hitArea.contains(this._localPoint.x,this._localPoint.y);if(z.Creature&&i instanceof z.Creature){var s=E(i.width),d=E(i.height),p=i.x-s*i.anchorX;if(this.game.camera.x+t.x>=p&&this.game.camera.x+t.x<p+s&&(r=i.y-d*i.anchorY,this.game.camera.y+t.y>=r&&this.game.camera.y+t.y<r+d))return!0}else if(i instanceof z.TileSprite){var s=i.width,d=i.height,p=-s*i.anchor.x;if(this._localPoint.x>=p&&this._localPoint.x<p+s&&(r=-d*i.anchor.y,this._localPoint.y>=r&&this._localPoint.y<r+d))return!0}else if(i instanceof PIXI.Sprite){var s=i.texture.frame.width/i.texture.baseTexture.resolution,d=i.texture.frame.height/i.texture.baseTexture.resolution,p=-s*i.anchor.x;if(this._localPoint.x>=p&&this._localPoint.x<p+s){var r=-d*i.anchor.y;if(this._localPoint.y>=r&&this._localPoint.y<r+d)return!0}}else if(i instanceof z.Graphics)for(c=0;c<i.graphicsData.length;c++){var a=i.graphicsData[c];if(a.fill&&a.shape&&a.shape.contains(this._localPoint.x,this._localPoint.y))return!0}for(var c=0;c<i.children.length;c++)if(this.hitTest(i.children[c],t,e))return!0;return!1},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}},z.Input.prototype.constructor=z.Input,Object.defineProperty(z.Input.prototype,"x",{get:function(){return this._x},set:function(e){this._x=x(e)}}),Object.defineProperty(z.Input.prototype,"y",{get:function(){return this._y},set:function(e){this._y=x(e)}}),Object.defineProperty(z.Input.prototype,"pollLocked",{get:function(){return 0<this.pollRate&&this._pollCounter<this.pollRate}}),Object.defineProperty(z.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}}),Object.defineProperty(z.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}}),Object.defineProperty(z.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(z.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),z.Mouse=function(e){this.game=e,this.input=e.input,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseUpCallback=null,this.mouseOutCallback=null,this.mouseOverCallback=null,this.mouseWheelCallback=null,this.capture=!1,this.button=-1,this.wheelDelta=0,this.enabled=!0,this.locked=!1,this.stopOnGameOut=!1,this.pointerLock=new z.Signal,this.event=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onMouseOut=null,this._onMouseOver=null,this._onMouseWheel=null,this._wheelEvent=null},z.Mouse.NO_BUTTON=-1,z.Mouse.LEFT_BUTTON=0,z.Mouse.MIDDLE_BUTTON=1,z.Mouse.RIGHT_BUTTON=2,z.Mouse.BACK_BUTTON=3,z.Mouse.FORWARD_BUTTON=4,z.Mouse.WHEEL_UP=1,z.Mouse.WHEEL_DOWN=-1,z.Mouse.prototype={start:function(){if((!this.game.device.android||!1!==this.game.device.chrome)&&null===this._onMouseDown){var a=this;this._onMouseDown=function(e){return a.onMouseDown(e)},this._onMouseMove=function(e){return a.onMouseMove(e)},this._onMouseUp=function(e){return a.onMouseUp(e)},this._onMouseUpGlobal=function(e){return a.onMouseUpGlobal(e)},this._onMouseOutGlobal=function(e){return a.onMouseOutGlobal(e)},this._onMouseOut=function(e){return a.onMouseOut(e)},this._onMouseOver=function(e){return a.onMouseOver(e)},this._onMouseWheel=function(e){return a.onMouseWheel(e)};var e=this.game.canvas;e.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("mousemove",this._onMouseMove,!0),e.addEventListener("mouseup",this._onMouseUp,!0),this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),window.addEventListener("mouseout",this._onMouseOutGlobal,!0),e.addEventListener("mouseover",this._onMouseOver,!0),e.addEventListener("mouseout",this._onMouseOut,!0));var t=this.game.device.wheelEvent;t&&(e.addEventListener(t,this._onMouseWheel,!0),"mousewheel"===t?this._wheelEvent=new p(-.025,1):"DOMMouseScroll"===t&&(this._wheelEvent=new p(1,1)))}},onMouseDown:function(e){this.event=e,this.capture&&e.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,e),this.input.enabled&&this.enabled&&(e.identifier=0,this.input.mousePointer.start(e))},onMouseMove:function(e){this.event=e,this.capture&&e.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,e),this.input.enabled&&this.enabled&&(e.identifier=0,this.input.mousePointer.move(e))},onMouseUp:function(e){this.event=e,this.capture&&e.preventDefault(),this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,e),this.input.enabled&&this.enabled&&(e.identifier=0,this.input.mousePointer.stop(e))},onMouseUpGlobal:function(e){this.input.mousePointer.withinGame||(this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,e),e.identifier=0,this.input.mousePointer.stop(e))},onMouseOutGlobal:function(e){this.event=e,this.capture&&e.preventDefault(),this.input.mousePointer.withinGame=!1,this.input.enabled&&this.enabled&&(this.input.mousePointer.stop(e),this.input.mousePointer.resetButtons())},onMouseOut:function(a){if(this.event=a,this.capture&&a.preventDefault(),this.input.mousePointer.withinGame=!1,this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,a),this.input.enabled&&this.enabled)for(var t in this.stopOnGameOut&&(a.identifier=0,this.input.mousePointer.stop(a)),this.input.interactiveItems.list)!0===this.input.interactiveItems.list[t].enabled&&this.input.interactiveItems.list[t]._pointerOutHandler(this.input.mousePointer)},onMouseOver:function(e){this.event=e,this.capture&&e.preventDefault(),this.input.mousePointer.withinGame=!0,this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,e)},onMouseWheel:function(e){this._wheelEvent&&(e=this._wheelEvent.bindEvent(e)),this.event=e,this.capture&&e.preventDefault(),this.wheelDelta=z.Math.clamp(-e.deltaY,-1,1),this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,e)},requestPointerLock:function(){if(this.game.device.pointerLock){var a=this.game.canvas;a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,a.requestPointerLock();var r=this;this._pointerLockChange=function(e){return r.pointerLockChange(e)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},pointerLockChange:function(a){var t=this.game.canvas;document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t?(this.locked=!0,this.pointerLock.dispatch(!0,a)):(this.locked=!1,this.pointerLock.dispatch(!1,a))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){var a=this.game.canvas;a.removeEventListener("mousedown",this._onMouseDown,!0),a.removeEventListener("mousemove",this._onMouseMove,!0),a.removeEventListener("mouseup",this._onMouseUp,!0),a.removeEventListener("mouseover",this._onMouseOver,!0),a.removeEventListener("mouseout",this._onMouseOut,!0);var t=this.game.device.wheelEvent;t&&a.removeEventListener(t,this._onMouseWheel,!0),window.removeEventListener("mouseup",this._onMouseUpGlobal,!0),window.removeEventListener("mouseout",this._onMouseOutGlobal,!0),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},z.Mouse.prototype.constructor=z.Mouse,(p.prototype={}).constructor=p,p.prototype.bindEvent=function(t){if(!p._stubsGenerated&&t){for(var e in t)e in p.prototype||Object.defineProperty(p.prototype,e,{get:function(a){return function(){var t=this.originalEvent[a];return"function"==typeof t?t.bind(this.originalEvent):t}}(e)});p._stubsGenerated=!0}return this.originalEvent=t,this},Object.defineProperties(p.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}}),z.MSPointer=function(e){this.game=e,this.input=e.input,this.callbackContext=this.game,this.pointerDownCallback=null,this.pointerMoveCallback=null,this.pointerUpCallback=null,this.capture=!0,this.button=-1,this.event=null,this.enabled=!0,this._onMSPointerDown=null,this._onMSPointerMove=null,this._onMSPointerUp=null,this._onMSPointerUpGlobal=null,this._onMSPointerOut=null,this._onMSPointerOver=null},z.MSPointer.prototype={start:function(){if(null===this._onMSPointerDown){var a=this;if(this.game.device.mspointer){this._onMSPointerDown=function(t){return a.onPointerDown(t)},this._onMSPointerMove=function(t){return a.onPointerMove(t)},this._onMSPointerUp=function(t){return a.onPointerUp(t)},this._onMSPointerUpGlobal=function(t){return a.onPointerUpGlobal(t)},this._onMSPointerOut=function(t){return a.onPointerOut(t)},this._onMSPointerOver=function(t){return a.onPointerOver(t)};var t=this.game.canvas;t.addEventListener("MSPointerDown",this._onMSPointerDown,!1),t.addEventListener("MSPointerMove",this._onMSPointerMove,!1),t.addEventListener("MSPointerUp",this._onMSPointerUp,!1),t.addEventListener("pointerdown",this._onMSPointerDown,!1),t.addEventListener("pointermove",this._onMSPointerMove,!1),t.addEventListener("pointerup",this._onMSPointerUp,!1),t.style["-ms-content-zooming"]="none",t.style["-ms-touch-action"]="none",this.game.device.cocoonJS||(window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),t.addEventListener("MSPointerOver",this._onMSPointerOver,!0),t.addEventListener("MSPointerOut",this._onMSPointerOut,!0),window.addEventListener("pointerup",this._onMSPointerUpGlobal,!0),t.addEventListener("pointerover",this._onMSPointerOver,!0),t.addEventListener("pointerout",this._onMSPointerOut,!0))}}},onPointerDown:function(e){this.game.input.executeTouchLockCallbacks(!1,e),this.event=e,this.capture&&e.preventDefault(),this.pointerDownCallback&&this.pointerDownCallback.call(this.callbackContext,e),this.input.enabled&&this.enabled&&(e.identifier=e.pointerId,"mouse"===e.pointerType||4===e.pointerType?this.input.mousePointer.start(e):this.input.startPointer(e))},onPointerMove:function(e){this.event=e,this.capture&&e.preventDefault(),this.pointerMoveCallback&&this.pointerMoveCallback.call(this.callbackContext,e),this.input.enabled&&this.enabled&&(e.identifier=e.pointerId,"mouse"===e.pointerType||4===e.pointerType?this.input.mousePointer.move(e):this.input.updatePointer(e))},onPointerUp:function(e){this.game.input.executeTouchLockCallbacks(!0,e),this.event=e,this.capture&&e.preventDefault(),this.pointerUpCallback&&this.pointerUpCallback.call(this.callbackContext,e),this.input.enabled&&this.enabled&&(e.identifier=e.pointerId,"mouse"===e.pointerType||4===e.pointerType?this.input.mousePointer.stop(e):this.input.stopPointer(e))},onPointerUpGlobal:function(a){if("mouse"!==a.pointerType&&4!==a.pointerType||this.input.mousePointer.withinGame){var t=this.input.getPointerFromIdentifier(a.identifier);t&&t.withinGame&&this.onPointerUp(a)}else this.onPointerUp(a)},onPointerOut:function(a){if(this.event=a,this.capture&&a.preventDefault(),"mouse"===a.pointerType||4===a.pointerType)this.input.mousePointer.withinGame=!1;else{var t=this.input.getPointerFromIdentifier(a.identifier);t&&(t.withinGame=!1)}this.input.mouse.mouseOutCallback&&this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,a),this.input.enabled&&this.enabled&&this.input.mouse.stopOnGameOut&&(a.identifier=0,t?t.stop(a):this.input.mousePointer.stop(a))},onPointerOver:function(a){if(this.event=a,this.capture&&a.preventDefault(),"mouse"===a.pointerType||4===a.pointerType)this.input.mousePointer.withinGame=!0;else{var t=this.input.getPointerFromIdentifier(a.identifier);t&&(t.withinGame=!0)}this.input.mouse.mouseOverCallback&&this.input.mouse.mouseOverCallback.call(this.input.mouse.callbackContext,a)},stop:function(){var e=this.game.canvas;e.removeEventListener("MSPointerDown",this._onMSPointerDown,!1),e.removeEventListener("MSPointerMove",this._onMSPointerMove,!1),e.removeEventListener("MSPointerUp",this._onMSPointerUp,!1),e.removeEventListener("pointerdown",this._onMSPointerDown,!1),e.removeEventListener("pointermove",this._onMSPointerMove,!1),e.removeEventListener("pointerup",this._onMSPointerUp,!1),window.removeEventListener("MSPointerUp",this._onMSPointerUpGlobal,!0),e.removeEventListener("MSPointerOver",this._onMSPointerOver,!0),e.removeEventListener("MSPointerOut",this._onMSPointerOut,!0),window.removeEventListener("pointerup",this._onMSPointerUpGlobal,!0),e.removeEventListener("pointerover",this._onMSPointerOver,!0),e.removeEventListener("pointerout",this._onMSPointerOut,!0)}},z.MSPointer.prototype.constructor=z.MSPointer,z.DeviceButton=function(a,t){this.parent=a,this.game=a.game,this.event=null,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1,this.value=0,this.buttonCode=t,this.onDown=new z.Signal,this.onUp=new z.Signal,this.onFloat=new z.Signal},z.DeviceButton.prototype={start:function(a,t){this.isDown||(this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.repeats=0,this.event=a,this.value=t,a&&(this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.ctrlKey=a.ctrlKey),this.onDown.dispatch(this,t))},stop:function(a,t){this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.event=a,this.value=t,a&&(this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.ctrlKey=a.ctrlKey),this.onUp.dispatch(this,t))},startStop:function(a,t,e){a?this.start(t,e):this.stop(t,e)},padFloat:function(e){this.isDown=!1,this.isUp=!1,this.value=e,this.onFloat.dispatch(this,e)},justPressed:function(e){return e=e||250,this.isDown&&this.timeDown+e>this.game.time.time},justReleased:function(e){return e=e||250,this.isUp&&this.timeUp+e>this.game.time.time},reset:function(){this.isDown=!1,this.isUp=!0,this.timeDown=this.game.time.time,this.repeats=0,this.altKey=!1,this.shiftKey=!1,this.ctrlKey=!1},destroy:function(){this.onDown.dispose(),this.onUp.dispose(),this.onFloat.dispose(),this.parent=null,this.game=null}},z.DeviceButton.prototype.constructor=z.DeviceButton,Object.defineProperty(z.DeviceButton.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),z.Pointer=function(a,t,e){this.game=a,this.id=t,this.type=z.POINTER,this.exists=!0,this.identifier=0,this.pointerId=null,this.pointerMode=e||z.PointerMode.CURSOR|z.PointerMode.CONTACT,this.target=null,this.button=null,this.leftButton=new z.DeviceButton(this,z.Pointer.LEFT_BUTTON),this.middleButton=new z.DeviceButton(this,z.Pointer.MIDDLE_BUTTON),this.rightButton=new z.DeviceButton(this,z.Pointer.RIGHT_BUTTON),this.backButton=new z.DeviceButton(this,z.Pointer.BACK_BUTTON),this.forwardButton=new z.DeviceButton(this,z.Pointer.FORWARD_BUTTON),this.eraserButton=new z.DeviceButton(this,z.Pointer.ERASER_BUTTON),this._holdSent=!1,this._history=[],this._nextDrop=0,this._stateReset=!1,this.withinGame=!1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.rawMovementX=0,this.rawMovementY=0,this.movementX=0,this.movementY=0,this.x=-1,this.y=-1,this.isMouse=0===t,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.previousTapTime=0,this.totalTouches=0,this.msSinceLastClick=d,this.targetObject=null,this.interactiveCandidates=[],this.active=!1,this.dirty=!1,this.position=new z.Point,this.positionDown=new z.Point,this.positionUp=new z.Point,this.circle=new z.Circle(0,0,44),this._clickTrampolines=null,this._trampolineTargetObject=null},z.Pointer.NO_BUTTON=0,z.Pointer.LEFT_BUTTON=1,z.Pointer.RIGHT_BUTTON=2,z.Pointer.MIDDLE_BUTTON=4,z.Pointer.BACK_BUTTON=8,z.Pointer.FORWARD_BUTTON=16,z.Pointer.ERASER_BUTTON=32,z.Pointer.prototype={resetButtons:function(){this.isDown=!1,this.isUp=!0,this.isMouse&&(this.leftButton.reset(),this.middleButton.reset(),this.rightButton.reset(),this.backButton.reset(),this.forwardButton.reset(),this.eraserButton.reset())},processButtonsDown:function(a,t){a===z.Mouse.LEFT_BUTTON&&this.leftButton.start(t),a===z.Mouse.RIGHT_BUTTON&&this.rightButton.start(t),a===z.Mouse.MIDDLE_BUTTON&&this.middleButton.start(t),a===z.Mouse.BACK_BUTTON&&this.backButton.start(t),a===z.Mouse.FORWARD_BUTTON&&this.forwardButton.start(t)},processButtonsUp:function(a,t){a===z.Mouse.LEFT_BUTTON&&this.leftButton.stop(t),a===z.Mouse.RIGHT_BUTTON&&this.rightButton.stop(t),a===z.Mouse.MIDDLE_BUTTON&&this.middleButton.stop(t),a===z.Mouse.BACK_BUTTON&&this.backButton.stop(t),a===z.Mouse.FORWARD_BUTTON&&this.forwardButton.stop(t)},processButtonsUpDown:function(a,t){var e="down"===t.type.toLowerCase().substr(-4),r="move"===t.type.toLowerCase().substr(-4);void 0===a?void 0===t.button?e?t.ctrlKey?this.rightButton.start(t):this.leftButton.start(t):(this.leftButton.stop(t),this.rightButton.stop(t)):e&&t.ctrlKey&&0===t.button?this.rightButton.start(t):e?this.processButtonsDown(t.button,t):r||this.processButtonsUp(t.button,t):(e&&1===a&&t.ctrlKey&&(a=2),this.leftButton.startStop(z.Pointer.LEFT_BUTTON&a,t),this.rightButton.startStop(z.Pointer.RIGHT_BUTTON&a,t),this.middleButton.startStop(z.Pointer.MIDDLE_BUTTON&a,t),this.backButton.startStop(z.Pointer.BACK_BUTTON&a,t),this.forwardButton.startStop(z.Pointer.FORWARD_BUTTON&a,t),this.eraserButton.startStop(z.Pointer.ERASER_BUTTON&a,t))},updateButtons:function(e){this.button=e.button,this.processButtonsUpDown(e.buttons,e),this.isUp=!0,this.isDown=!1,(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown)&&(this.isUp=!1,this.isDown=!0)},start:function(a){var t=this.game.input;return a.pointerId&&(this.pointerId=a.pointerId),this.identifier=a.identifier,this.target=a.target,this.isMouse?this.updateButtons(a):(this.isDown=!0,this.isUp=!1),this.active=!0,this.withinGame=!0,this.dirty=!1,this._history=[],this._clickTrampolines=null,this._trampolineTargetObject=null,this.msSinceLastClick=this.game.time.time-this.timeDown,this.timeDown=this.game.time.time,this._holdSent=!1,this.move(a,!0),this.positionDown.setTo(this.x,this.y),(t.multiInputOverride===z.Input.MOUSE_OVERRIDES_TOUCH||t.multiInputOverride===z.Input.MOUSE_TOUCH_COMBINE||t.multiInputOverride===z.Input.TOUCH_OVERRIDES_MOUSE&&0===t.totalActivePointers)&&(t.x=this.x,t.y=this.y,t.position.setTo(this.x,this.y),t.onDown.dispatch(this,a),t.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){var e=this.game.input;this.active&&(this.dirty&&(0<e.interactiveItems.total&&this.processInteractiveObjects(!1),this.dirty=!1),!1===this._holdSent&&this.duration>=e.holdRate&&((e.multiInputOverride===z.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===z.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===z.Input.TOUCH_OVERRIDES_MOUSE&&0===e.totalActivePointers)&&e.onHold.dispatch(this),this._holdSent=!0),e.recordPointerHistory&&this.game.time.time>=this._nextDrop&&(this._nextDrop=this.game.time.time+e.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>e.recordLimit&&this._history.shift()))},move:function(a,t){var r=this.game.input;if(!r.pollLocked){void 0===t&&(t=!1),void 0!==a.button&&(this.button=a.button),this.isMouse&&this.updateButtons(a),this.clientX=a.clientX,this.clientY=a.clientY,this.pageX=a.pageX,this.pageY=a.pageY,this.screenX=a.screenX,this.screenY=a.screenY,this.isMouse&&r.mouse.locked&&!t&&(this.rawMovementX=a.movementX||a.mozMovementX||a.webkitMovementX||0,this.rawMovementY=a.movementY||a.mozMovementY||a.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*r.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*r.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(r.multiInputOverride===z.Input.MOUSE_OVERRIDES_TOUCH||r.multiInputOverride===z.Input.MOUSE_TOUCH_COMBINE||r.multiInputOverride===z.Input.TOUCH_OVERRIDES_MOUSE&&0===r.totalActivePointers)&&(r.activePointer=this,r.x=this.x,r.y=this.y,r.position.setTo(r.x,r.y),r.circle.x=r.x,r.circle.y=r.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);for(var o=r.moveCallbacks.length;o--;)r.moveCallbacks[o].callback.call(r.moveCallbacks[o].context,this,this.x,this.y,t,a);return null===this.targetObject||this.game.paused&&!this.targetObject.noPause||!0!==this.targetObject.isDragged?0<r.interactiveItems.total&&this.processInteractiveObjects(t):!1===this.targetObject.update(this)&&(this.targetObject=null),this}},processInteractiveObjects:function(a){var r=0,e=-1,o=null,i=this.game.input.interactiveItems.first;for(this.interactiveCandidates=[];i;)i.checked=!1,i.validForInput(e,r,!1)&&(!this.game.paused||i.sprite.noPause)&&(i.checked=!0,(a&&i.checkPointerDown(this,!0)||!a&&i.checkPointerOver(this,!0))&&(r=i.sprite.renderOrderID,e=i.priorityID,o=i,this.interactiveCandidates.push(i))),i=this.game.input.interactiveItems.next;for(i=this.game.input.interactiveItems.first;i;)!i.checked&&i.validForInput(e,r,!0)&&(a&&i.checkPointerDown(this,!1)||!a&&i.checkPointerOver(this,!1))&&(r=i.sprite.renderOrderID,e=i.priorityID,o=i,this.interactiveCandidates.push(i)),i=this.game.input.interactiveItems.next;return this.game.input.customCandidateHandler&&(o=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,o)),this.swapTarget(o,!1),null!==this.targetObject},swapTarget:function(a,t){void 0===t&&(t=!1),null===a?this.targetObject&&(this.targetObject._pointerOutHandler(this,t),this.targetObject=null):null===this.targetObject?(this.targetObject=a,a._pointerOverHandler(this,t)):this.targetObject===a?!1===a.update(this)&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this,t),this.targetObject=a,this.targetObject._pointerOverHandler(this,t))},leave:function(e){this.withinGame=!1,this.move(e,!1)},stop:function(a){var t=this.game.input;{if(!this._stateReset||!this.withinGame)return this.timeUp=this.game.time.time,(t.multiInputOverride===z.Input.MOUSE_OVERRIDES_TOUCH||t.multiInputOverride===z.Input.MOUSE_TOUCH_COMBINE||t.multiInputOverride===z.Input.TOUCH_OVERRIDES_MOUSE&&0===t.totalActivePointers)&&(t.onUp.dispatch(this,a),0<=this.duration&&this.duration<=t.tapRate&&(this.timeUp-this.previousTapTime<t.doubleTapRate?t.onTap.dispatch(this,!0):t.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.isMouse?this.updateButtons(a):(this.isDown=!1,this.isUp=!0),0<this.id&&(this.active=!1),this.withinGame=this.game.scale.bounds.contains(a.pageX,a.pageY),this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),!1===this.isMouse&&t.currentPointers--,t.interactiveItems.callAll("_releasedHandler",this),this._clickTrampolines&&(this._trampolineTargetObject=this.targetObject),this.targetObject=null,this;a.preventDefault()}},justPressed:function(e){return e=e||this.game.input.justPressedRate,!0===this.isDown&&this.timeDown+e>this.game.time.time},justReleased:function(e){return e=e||this.game.input.justReleasedRate,this.isUp&&this.timeUp+e>this.game.time.time},addClickTrampoline:function(a,r,d,l){if(this.isDown){for(var p=this._clickTrampolines=this._clickTrampolines||[],n=0;n<p.length;n++)if(p[n].name===a){p.splice(n,1);break}p.push({name:a,targetObject:this.targetObject,callback:r,callbackContext:d,callbackArgs:l})}},processClickTrampolines:function(){var a=this._clickTrampolines;if(a){for(var t=0,e;t<a.length;t++)e=a[t],e.targetObject===this._trampolineTargetObject&&e.callback.apply(e.callbackContext,e.callbackArgs);this._clickTrampolines=null,this._trampolineTargetObject=null}},reset:function(){!1===this.isMouse&&(this.active=!1),this.pointerId=null,this.identifier=null,this.dirty=!1,this.totalTouches=0,this._holdSent=!1,this._history.length=0,this._stateReset=!0,this.resetButtons(),this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null},resetMovement:function(){this.movementX=0,this.movementY=0}},z.Pointer.prototype.constructor=z.Pointer,Object.defineProperty(z.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.time-this.timeDown}}),Object.defineProperty(z.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(z.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),z.PointerMode={CURSOR:1,CONTACT:2},z.Touch=function(e){this.game=e,this.enabled=!0,this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null,this.preventDefault=!0,this.event=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchCancel=null,this._onTouchMove=null},z.Touch.prototype={start:function(){if(null===this._onTouchStart){var a=this;this.game.device.touch&&(this._onTouchStart=function(t){return a.onTouchStart(t)},this._onTouchMove=function(t){return a.onTouchMove(t)},this._onTouchEnd=function(t){return a.onTouchEnd(t)},this._onTouchEnter=function(t){return a.onTouchEnter(t)},this._onTouchLeave=function(t){return a.onTouchLeave(t)},this._onTouchCancel=function(t){return a.onTouchCancel(t)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))}},consumeDocumentTouches:function(){this._documentTouchMove=function(e){e.preventDefault()},document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(a){if(this.game.input.executeTouchLockCallbacks(!1,a),this.event=a,this.game.input.enabled&&this.enabled){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,a),this.preventDefault&&a.preventDefault();for(var t=0;t<a.changedTouches.length;t++)this.game.input.startPointer(a.changedTouches[t])}},onTouchCancel:function(a){if(this.event=a,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,a),this.game.input.enabled&&this.enabled){this.preventDefault&&a.preventDefault();for(var t=0;t<a.changedTouches.length;t++)this.game.input.stopPointer(a.changedTouches[t])}},onTouchEnter:function(e){this.event=e,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,e),this.game.input.enabled&&this.enabled&&this.preventDefault&&e.preventDefault()},onTouchLeave:function(e){this.event=e,this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,e),this.preventDefault&&e.preventDefault()},onTouchMove:function(a){this.event=a,this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,a),this.preventDefault&&a.preventDefault();for(var t=0;t<a.changedTouches.length;t++)this.game.input.updatePointer(a.changedTouches[t])},onTouchEnd:function(a){this.game.input.executeTouchLockCallbacks(!0,a),this.event=a,this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,a),this.preventDefault&&a.preventDefault();for(var t=0;t<a.changedTouches.length;t++)this.game.input.stopPointer(a.changedTouches[t])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},z.Touch.prototype.constructor=z.Touch,z.InputHandler=function(e){this.sprite=e,this.game=e.game,this.enabled=!1,this.checked=!1,this.priorityID=0,this.useHandCursor=!1,this._setHandCursor=!1,this.isDragged=!1,this.allowHorizontalDrag=!0,this.allowVerticalDrag=!0,this.bringToTop=!1,this.snapOffset=null,this.snapOnDrag=!1,this.snapOnRelease=!1,this.snapX=0,this.snapY=0,this.snapOffsetX=0,this.snapOffsetY=0,this.pixelPerfectOver=!1,this.pixelPerfectClick=!1,this.pixelPerfectAlpha=255,this.draggable=!1,this.boundsRect=null,this.boundsSprite=null,this.scaleLayer=!1,this.dragOffset=new z.Point,this.dragFromCenter=!1,this.dragStopBlocksInputUp=!1,this.dragStartPoint=new z.Point,this.dragDistanceThreshold=0,this.dragTimeThreshold=0,this.downPoint=new z.Point,this.snapPoint=new z.Point,this._dragPoint=new z.Point,this._dragPhase=!1,this._pendingDrag=!1,this._dragTimePass=!1,this._dragDistancePass=!1,this._wasEnabled=!1,this._tempPoint=new z.Point,this._pointerData=[],this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},z.InputHandler.prototype={start:function(a,t){if(a=a||0,void 0===t&&(t=!1),!1===this.enabled){this.game.input.interactiveItems.add(this),this.useHandCursor=t,this.priorityID=a;for(var e=0;10>e;e++)this._pointerData[e]={id:e,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new z.Point,this.enabled=!0,this._wasEnabled=!0}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1;for(var e=0;10>e;e++)this._pointerData[e]={id:e,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){!1!==this.enabled&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(a,t,e){return void 0===e&&(e=!0),!(!this.enabled||0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID||this.sprite.parent&&this.sprite.parent.ignoreChildInput)&&!(!e&&(this.pixelPerfectClick||this.pixelPerfectOver))&&(this.priorityID>a||this.priorityID===a&&this.sprite.renderOrderID>t)},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(e){return e=e||0,this._pointerData[e].x},pointerY:function(e){return e=e||0,this._pointerData[e].y},pointerDown:function(e){return e=e||0,this._pointerData[e].isDown},pointerUp:function(e){return e=e||0,this._pointerData[e].isUp},pointerTimeDown:function(e){return e=e||0,this._pointerData[e].timeDown},pointerTimeUp:function(e){return e=e||0,this._pointerData[e].timeUp},pointerOver:function(a){if(!this.enabled)return!1;if(void 0===a){for(var t=0;10>t;t++)if(this._pointerData[t].isOver)return!0;return!1}return this._pointerData[a].isOver},pointerOut:function(a){if(!this.enabled)return!1;if(void 0!==a)return this._pointerData[a].isOut;for(var t=0;10>t;t++)if(this._pointerData[t].isOut)return!0},pointerTimeOver:function(e){return e=e||0,this._pointerData[e].timeOver},pointerTimeOut:function(e){return e=e||0,this._pointerData[e].timeOut},pointerDragged:function(e){return e=e||0,this._pointerData[e].isDragged},checkPointerDown:function(a,t){return!!(a.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y)&&!!this.game.input.hitTest(this.sprite,a,this._tempPoint)&&(void 0===t&&(t=!1),t||!this.pixelPerfectClick||this.checkPixel(this._tempPoint.x,this._tempPoint.y))},checkPointerOver:function(a,t){return!!(this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&0!==this.sprite.worldScale.x&&0!==this.sprite.worldScale.y)&&!!this.game.input.hitTest(this.sprite,a,this._tempPoint)&&(void 0===t&&(t=!1),t||!this.pixelPerfectOver||this.checkPixel(this._tempPoint.x,this._tempPoint.y))},checkPixel:function(a,t,e){if(this.sprite.texture.baseTexture.source){if(null===a&&null===t){this.game.input.getLocalPosition(this.sprite,e,this._tempPoint);var a=this._tempPoint.x,t=this._tempPoint.y}if(0!==this.sprite.anchor.x&&(a-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(t-=-this.sprite.texture.frame.height*this.sprite.anchor.y),a+=this.sprite.texture.frame.x,t+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(a-=this.sprite.texture.trim.x,t-=this.sprite.texture.trim.y,a<this.sprite.texture.crop.x||a>this.sprite.texture.crop.right||t<this.sprite.texture.crop.y||t>this.sprite.texture.crop.bottom))return this._dx=a,this._dy=t,!1;if(this._dx=a,this._dy=t,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,a,t,1,1,0,0,1,1),this.game.input.hitContext.getImageData(0,0,1,1).data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(e){if(null!==this.sprite&&void 0!==this.sprite.parent)return this.enabled&&this.sprite.visible&&this.sprite.parent.visible?this._pendingDrag?(this._dragDistancePass||(this._dragDistancePass=z.Math.distance(e.x,e.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold),this._dragDistancePass&&this._dragTimePass&&this.startDrag(e),!0):this.draggable&&this._draggedPointerID===e.id?this.updateDrag(e,!1):this._pointerData[e.id].isOver?this.checkPointerOver(e)?(this._pointerData[e.id].x=e.x-this.sprite.x,this._pointerData[e.id].y=e.y-this.sprite.y,!0):(this._pointerOutHandler(e),!1):void 0:(this._pointerOutHandler(e),!1)},_pointerOverHandler:function(a,t){if(null!==this.sprite){var r=this._pointerData[a.id];if(!1===r.isOver||a.dirty){var o=!1===r.isOver;r.isOver=!0,r.isOut=!1,r.timeOver=this.game.time.time,r.x=a.x-this.sprite.x,r.y=a.y-this.sprite.y,this.useHandCursor&&!1===r.isDragged&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),!t&&o&&this.sprite&&this.sprite.events&&this.sprite.events.onInputOver$dispatch(this.sprite,a),this.sprite.parent&&this.sprite.parent.onChildInputOver&&this.sprite.parent.onChildInputOver.dispatch(this.sprite,a)}}},_pointerOutHandler:function(a,t){if(null!==this.sprite){var r=this._pointerData[a.id];r.isOver=!1,r.isOut=!0,r.timeOut=this.game.time.time,this.useHandCursor&&!1===r.isDragged&&(this.game.canvas.style.cursor="",this._setHandCursor=!1),!t&&this.sprite&&this.sprite.events&&(this.sprite.events.onInputOut$dispatch(this.sprite,a),this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputOut&&this.sprite.parent.onChildInputOut.dispatch(this.sprite,a))}},_touchedHandler:function(a){if(null!==this.sprite){var t=this._pointerData[a.id];if(!t.isDown&&t.isOver){if(this.pixelPerfectClick&&!this.checkPixel(null,null,a))return;if(t.isDown=!0,t.isUp=!1,t.timeDown=this.game.time.time,this.downPoint.set(a.x,a.y),a.dirty=!0,this.sprite&&this.sprite.events&&(this.sprite.events.onInputDown$dispatch(this.sprite,a),this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputDown&&this.sprite.parent.onChildInputDown.dispatch(this.sprite,a),null===this.sprite))return;this.draggable&&!1===this.isDragged&&(0===this.dragTimeThreshold&&0===this.dragDistanceThreshold?this.startDrag(a):(this._pendingDrag=!0,this._dragDistancePass=0===this.dragDistanceThreshold,0<this.dragTimeThreshold?(this._dragTimePass=!1,this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,a)):this._dragTimePass=!0)),this.bringToTop&&this.sprite.bringToTop()}}},dragTimeElapsed:function(e){this._dragTimePass=!0,this._pendingDrag&&this.sprite&&this._dragDistancePass&&this.startDrag(e)},_releasedHandler:function(a){if(null!==this.sprite){var t=this._pointerData[a.id];if(t.isDown&&a.isUp){t.isDown=!1,t.isUp=!0,t.timeUp=this.game.time.time,t.downDuration=t.timeUp-t.timeDown;var e=this.checkPointerOver(a);this.sprite&&this.sprite.events&&(this.dragStopBlocksInputUp&&(!this.dragStopBlocksInputUp||this.draggable&&this.isDragged&&this._draggedPointerID===a.id)||this.sprite.events.onInputUp$dispatch(this.sprite,a,e),this.sprite&&this.sprite.parent&&this.sprite.parent.onChildInputUp&&this.sprite.parent.onChildInputUp.dispatch(this.sprite,a,e),e&&(e=this.checkPointerOver(a))),t.isOver=e,!e&&this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),a.dirty=!0,this._pendingDrag=!1,this.draggable&&this.isDragged&&this._draggedPointerID===a.id&&this.stopDrag(a)}}},updateDrag:function(a,t){if(void 0===t&&(t=!1),a.isUp)return this.stopDrag(a),!1;var e=this.globalToLocal(a);if(this.sprite.fixedToCamera)var i=this.game.camera.scale.x*e.x+this._dragPoint.x+this.dragOffset.x,s=this.game.camera.scale.y*e.y+this._dragPoint.y+this.dragOffset.y;else var i=e.x+this._dragPoint.x+this.dragOffset.x,s=e.y+this._dragPoint.y+this.dragOffset.y;if(this.sprite.fixedToCamera)this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=i-this.game.camera.x),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=s-this.game.camera.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=f((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=f((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.cameraOffset.x,this.sprite.cameraOffset.y));else{var n=this.game.camera.x-this._pointerData[a.id].camX,o=this.game.camera.y-this._pointerData[a.id].camY;this.allowHorizontalDrag&&(this.sprite.x=i+n),this.allowVerticalDrag&&(this.sprite.y=s+o),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=f((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=f((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY,this.snapPoint.set(this.sprite.x,this.sprite.y))}return this.sprite.events.onDragUpdate.dispatch(this.sprite,a,i,s,this.snapPoint,t),!0},justOver:function(a,t){return a=a||0,t=t||500,this._pointerData[a].isOver&&this.overDuration(a)<t},justOut:function(a,t){return a=a||0,t=t||500,this._pointerData[a].isOut&&this.game.time.time-this._pointerData[a].timeOut<t},justPressed:function(a,t){return a=a||0,t=t||500,this._pointerData[a].isDown&&this.downDuration(a)<t},justReleased:function(a,t){return a=a||0,t=t||500,this._pointerData[a].isUp&&this.game.time.time-this._pointerData[a].timeUp<t},overDuration:function(e){return e=e||0,this._pointerData[e].isOver?this.game.time.time-this._pointerData[e].timeOver:-1},downDuration:function(e){return e=e||0,this._pointerData[e].isDown?this.game.time.time-this._pointerData[e].timeDown:-1},enableDrag:function(a,t,e,i,n,o){void 0===a&&(a=!1),void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=255),void 0===n&&(n=null),void 0===o&&(o=null),this._dragPoint=new z.Point,this.draggable=!0,this.bringToTop=t,this.dragOffset=new z.Point,this.dragFromCenter=a,this.pixelPerfectClick=e,this.pixelPerfectAlpha=i,n&&(this.boundsRect=n),o&&(this.boundsSprite=o)},disableDrag:function(){if(this._pointerData)for(var e=0;10>e;e++)this._pointerData[e].isDragged=!1;this.draggable=!1,this.isDragged=!1,this._draggedPointerID=-1,this._pendingDrag=!1},startDrag:function(a){var t=this.sprite.x,e=this.sprite.y,i=this.globalToLocal(a);if(this.isDragged=!0,this._draggedPointerID=a.id,this._pointerData[a.id].camX=this.game.camera.x,this._pointerData[a.id].camY=this.game.camera.y,this._pointerData[a.id].isDragged=!0,this.sprite.fixedToCamera){if(this.dragFromCenter){var n=this.sprite.getBounds(),o=this.globalToLocal(new z.Point(n.centerX,n.centerY));this.sprite.cameraOffset.x=i.x+(this.sprite.cameraOffset.x-o.x),this.sprite.cameraOffset.y=i.y+(this.sprite.cameraOffset.y-o.y)}this._dragPoint.setTo(this.sprite.cameraOffset.x-a.x,this.sprite.cameraOffset.y-a.y)}else{if(this.dragFromCenter){var n=this.sprite.getBounds(),o=this.globalToLocal(new z.Point(n.centerX,n.centerY));this.sprite.x=i.x+(this.sprite.x-o.x),this.sprite.y=i.y+(this.sprite.y-o.y)}this._dragPoint.setTo(this.sprite.x-i.x,this.sprite.y-i.y)}this.updateDrag(a,!0),this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop()),this.dragStartPoint.set(t,e),this.sprite.events.onDragStart$dispatch(this.sprite,a,t,e),this._pendingDrag=!1},globalToLocalX:function(e){return this.scaleLayer&&(e-=this.game.scale.grid.boundsFluid.x,e*=this.game.scale.grid.scaleFluidInversed.x),e},globalToLocalY:function(e){return this.scaleLayer&&(e-=this.game.scale.grid.boundsFluid.y,e*=this.game.scale.grid.scaleFluidInversed.y),e},globalToLocal:function(e){return this.sprite.parent?this.game.input.getLocalPosition(this.sprite.parent,{x:e.x,y:e.y}):e},stopDrag:function(e){this.isDragged=!1,this._draggedPointerID=-1,this._pointerData[e.id].isDragged=!1,this._dragPhase=!1,this._pendingDrag=!1,this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=f((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=f((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=f((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=f((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),this.sprite.events.onDragStop$dispatch(this.sprite,e),!1===this.checkPointerOver(e)&&this._pointerOutHandler(e)},setDragLock:function(a,t){void 0===a&&(a=!0),void 0===t&&(t=!0),this.allowHorizontalDrag=a,this.allowVerticalDrag=t},enableSnap:function(a,t,e,r,i,n){void 0===e&&(e=!0),void 0===r&&(r=!1),void 0===i&&(i=0),void 0===n&&(n=0),this.snapX=a,this.snapY=t,this.snapOffsetX=i,this.snapOffsetY=n,this.snapOnDrag=e,this.snapOnRelease=r},disableSnap:function(){this.snapOnDrag=!1,this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.left<this.boundsRect.left?this.sprite.x=this.boundsRect.x+this.sprite.offsetX:this.sprite.right>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsRect.top?this.sprite.y=this.boundsRect.top+this.sprite.offsetY:this.sprite.bottom>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.left<this.boundsSprite.left?this.sprite.x=this.boundsSprite.left+this.sprite.offsetX:this.sprite.right>this.boundsSprite.right&&(this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)),this.sprite.top<this.boundsSprite.top?this.sprite.y=this.boundsSprite.top+this.sprite.offsetY:this.sprite.bottom>this.boundsSprite.bottom&&(this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)))}},z.InputHandler.prototype.constructor=z.InputHandler,z.Gamepad=function(e){this.game=e,this._gamepadIndexMap={},this._rawPads=[],this._active=!1,this.enabled=!0,this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!==navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads,this._prevRawGamepadTypes=[],this._prevTimestamps=[],this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this._ongamepadconnected=null,this._gamepaddisconnected=null,this._gamepads=[new z.SinglePad(e,this),new z.SinglePad(e,this),new z.SinglePad(e,this),new z.SinglePad(e,this)]},z.Gamepad.prototype={addCallbacks:function(a,t){void 0!==t&&(this.onConnectCallback="function"==typeof t.onConnect?t.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof t.onDisconnect?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof t.onDown?t.onDown:this.onDownCallback,this.onUpCallback="function"==typeof t.onUp?t.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof t.onAxis?t.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof t.onFloat?t.onFloat:this.onFloatCallback,this.callbackContext=a)},start:function(){if(!this._active){this._active=!0;var a=this;this._onGamepadConnected=function(t){return a.onGamepadConnected(t)},this._onGamepadDisconnected=function(t){return a.onGamepadDisconnected(t)},window.addEventListener("gamepadconnected",this._onGamepadConnected,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1)}},onGamepadConnected:function(a){var t=a.gamepad;this._rawPads.push(t),this._gamepads[t.index].connect(t)},onGamepadDisconnected:function(a){var t=a.gamepad;for(var e in this._rawPads)this._rawPads[e].index===t.index&&this._rawPads.splice(e,1);this._gamepads[t.index].disconnect()},update:function(){this._pollGamepads(),this.pad1.pollStatus(),this.pad2.pollStatus(),this.pad3.pollStatus(),this.pad4.pollStatus()},_pollGamepads:function(){if(this._active){if(navigator.getGamepads)d=navigator.getGamepads();else if(navigator.webkitGetGamepads)d=navigator.webkitGetGamepads();else if(navigator.webkitGamepads)var d=navigator.webkitGamepads();if(d){this._rawPads=[];for(var t=!1,e=0;e<d.length&&(typeof d[e]!==this._prevRawGamepadTypes[e]&&(t=!0,this._prevRawGamepadTypes[e]=typeof d[e]),d[e]&&this._rawPads.push(d[e]),3!==e);e++);for(var i=0;i<this._gamepads.length;i++)this._gamepads[i]._rawPad=this._rawPads[i];if(t){for(var s={rawIndices:{},padIndices:{}},o=0,r;o<this._gamepads.length;o++)if((r=this._gamepads[o]).connected)for(var n=0;n<this._rawPads.length;n++)this._rawPads[n].index===r.index&&(s.rawIndices[r.index]=!0,s.padIndices[o]=!0);for(var a=0;a<this._gamepads.length;a++)if(r=this._gamepads[a],!s.padIndices[a]){1>this._rawPads.length&&r.disconnect();for(var p=0,l;p<this._rawPads.length&&!s.padIndices[a];p++)if(l=this._rawPads[p],l){if(s.rawIndices[l.index]){r.disconnect();continue}r.connect(l),s.rawIndices[l.index]=!0,s.padIndices[a]=!0}else r.disconnect()}}}}},setDeadZones:function(a){for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].deadZone=a},stop:function(){this._active=!1,window.removeEventListener("gamepadconnected",this._onGamepadConnected),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var e=0;e<this._gamepads.length;e++)this._gamepads[e].reset()},justPressed:function(a,t){for(var e=0;e<this._gamepads.length;e++)if(!0===this._gamepads[e].justPressed(a,t))return!0;return!1},justReleased:function(a,t){for(var e=0;e<this._gamepads.length;e++)if(!0===this._gamepads[e].justReleased(a,t))return!0;return!1},isDown:function(a){for(var t=0;t<this._gamepads.length;t++)if(!0===this._gamepads[t].isDown(a))return!0;return!1},destroy:function(){this.stop();for(var e=0;e<this._gamepads.length;e++)this._gamepads[e].destroy()}},z.Gamepad.prototype.constructor=z.Gamepad,Object.defineProperty(z.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(z.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(z.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(z.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),Object.defineProperty(z.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(z.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(z.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),z.Gamepad.BUTTON_0=0,z.Gamepad.BUTTON_1=1,z.Gamepad.BUTTON_2=2,z.Gamepad.BUTTON_3=3,z.Gamepad.BUTTON_4=4,z.Gamepad.BUTTON_5=5,z.Gamepad.BUTTON_6=6,z.Gamepad.BUTTON_7=7,z.Gamepad.BUTTON_8=8,z.Gamepad.BUTTON_9=9,z.Gamepad.BUTTON_10=10,z.Gamepad.BUTTON_11=11,z.Gamepad.BUTTON_12=12,z.Gamepad.BUTTON_13=13,z.Gamepad.BUTTON_14=14,z.Gamepad.BUTTON_15=15,z.Gamepad.AXIS_0=0,z.Gamepad.AXIS_1=1,z.Gamepad.AXIS_2=2,z.Gamepad.AXIS_3=3,z.Gamepad.AXIS_4=4,z.Gamepad.AXIS_5=5,z.Gamepad.AXIS_6=6,z.Gamepad.AXIS_7=7,z.Gamepad.AXIS_8=8,z.Gamepad.AXIS_9=9,z.Gamepad.XBOX360_A=0,z.Gamepad.XBOX360_B=1,z.Gamepad.XBOX360_X=2,z.Gamepad.XBOX360_Y=3,z.Gamepad.XBOX360_LEFT_BUMPER=4,z.Gamepad.XBOX360_RIGHT_BUMPER=5,z.Gamepad.XBOX360_LEFT_TRIGGER=6,z.Gamepad.XBOX360_RIGHT_TRIGGER=7,z.Gamepad.XBOX360_BACK=8,z.Gamepad.XBOX360_START=9,z.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,z.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,z.Gamepad.XBOX360_DPAD_LEFT=14,z.Gamepad.XBOX360_DPAD_RIGHT=15,z.Gamepad.XBOX360_DPAD_UP=12,z.Gamepad.XBOX360_DPAD_DOWN=13,z.Gamepad.XBOX360_STICK_LEFT_X=0,z.Gamepad.XBOX360_STICK_LEFT_Y=1,z.Gamepad.XBOX360_STICK_RIGHT_X=2,z.Gamepad.XBOX360_STICK_RIGHT_Y=3,z.Gamepad.PS3XC_X=0,z.Gamepad.PS3XC_CIRCLE=1,z.Gamepad.PS3XC_SQUARE=2,z.Gamepad.PS3XC_TRIANGLE=3,z.Gamepad.PS3XC_L1=4,z.Gamepad.PS3XC_R1=5,z.Gamepad.PS3XC_L2=6,z.Gamepad.PS3XC_R2=7,z.Gamepad.PS3XC_SELECT=8,z.Gamepad.PS3XC_START=9,z.Gamepad.PS3XC_STICK_LEFT_BUTTON=10,z.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11,z.Gamepad.PS3XC_DPAD_UP=12,z.Gamepad.PS3XC_DPAD_DOWN=13,z.Gamepad.PS3XC_DPAD_LEFT=14,z.Gamepad.PS3XC_DPAD_RIGHT=15,z.Gamepad.PS3XC_STICK_LEFT_X=0,z.Gamepad.PS3XC_STICK_LEFT_Y=1,z.Gamepad.PS3XC_STICK_RIGHT_X=2,z.Gamepad.PS3XC_STICK_RIGHT_Y=3,z.SinglePad=function(a,t){this.game=a,this.index=null,this.connected=!1,this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this.deadZone=.26,this._padParent=t,this._rawPad=null,this._prevTimestamp=null,this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0},z.SinglePad.prototype={addCallbacks:function(a,t){void 0!==t&&(this.onConnectCallback="function"==typeof t.onConnect?t.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof t.onDisconnect?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof t.onDown?t.onDown:this.onDownCallback,this.onUpCallback="function"==typeof t.onUp?t.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof t.onAxis?t.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof t.onFloat?t.onFloat:this.onFloatCallback,this.callbackContext=a)},getButton:function(e){return this._buttons[e]?this._buttons[e]:null},pollStatus:function(){if(this.connected&&this.game.input.enabled&&this.game.input.gamepad.enabled&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(var a=0,t;a<this._buttonsLen;a++)t=isNaN(this._rawPad.buttons[a])?this._rawPad.buttons[a].value:this._rawPad.buttons[a],t!==this._buttons[a].value&&(1===t?this.processButtonDown(a,t):0===t?this.processButtonUp(a,t):this.processButtonFloat(a,t));for(var e=0,r;e<this._axesLen;e++)r=this._rawPad.axes[e],0<r&&r>this.deadZone||0>r&&r<-this.deadZone?this.processAxisChange(e,r):this.processAxisChange(e,0);this._prevTimestamp=this._rawPad.timestamp}},connect:function(a){var t=!this.connected;this.connected=!0,this.index=a.index,this._rawPad=a,this._buttons=[],this._buttonsLen=a.buttons.length,this._axes=[],this._axesLen=a.axes.length;for(var e=0;e<this._axesLen;e++)this._axes[e]=a.axes[e];for(var r in a.buttons)r=parseInt(r,10),this._buttons[r]=new z.DeviceButton(this,r);t&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index),t&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var a=this.connected,t=this.index;this.connected=!1,this.index=null,this._rawPad=void 0;for(var e=0;e<this._buttonsLen;e++)this._buttons[e].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,a&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,t),a&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=void 0;for(var e=0;e<this._buttonsLen;e++)this._buttons[e].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null},processAxisChange:function(a,t){this._axes[a]!==t&&(this._axes[a]=t,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,a,t),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,a,t))},processButtonDown:function(a,t){this._buttons[a]&&this._buttons[a].start(null,t),this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,a,t,this.index),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,a,t)},processButtonUp:function(a,t){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,a,t,this.index),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,a,t),this._buttons[a]&&this._buttons[a].stop(null,t)},processButtonFloat:function(a,t){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,a,t,this.index),this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,a,t),this._buttons[a]&&this._buttons[a].padFloat(t)},axis:function(e){return!!this._axes[e]&&this._axes[e]},isDown:function(e){return!!this._buttons[e]&&this._buttons[e].isDown},isUp:function(e){return!!this._buttons[e]&&this._buttons[e].isUp},justReleased:function(a,t){if(this._buttons[a])return this._buttons[a].justReleased(t)},justPressed:function(a,t){if(this._buttons[a])return this._buttons[a].justPressed(t)},buttonValue:function(e){return this._buttons[e]?this._buttons[e].value:null},reset:function(){for(var e=0;e<this._axes.length;e++)this._axes[e]=0}},z.SinglePad.prototype.constructor=z.SinglePad,z.Key=function(a,t){this.game=a,this._enabled=!0,this.event=null,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.duration=0,this.timeUp=-2500,this.durationUp=-2500,this.repeats=0,this.keyCode=t,this.onDown=new z.Signal,this.onHoldCallback=null,this.onHoldContext=null,this.onUp=new z.Signal,this._justDown=!1,this._justUp=!1},z.Key.prototype={update:function(){this._enabled&&(this.isDown?(this.duration=this.game.time.time-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this)):this.durationUp=this.game.time.time-this.timeUp)},processKeyDown:function(e){this._enabled&&(this.event=e,this.isDown||(this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.shiftKey=e.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.time,this.duration=0,this.durationUp=this.game.time.time-this.timeUp,this.repeats=0,this._justDown=!0,this.onDown.dispatch(this)))},processKeyUp:function(e){this._enabled&&(this.event=e,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=this.game.time.time-this.timeDown,this.durationUp=0,this._justUp=!0,this.onUp.dispatch(this)))},reset:function(e){void 0===e&&(e=!0),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.time,this.duration=0,this.durationUp=-2500,this._enabled=!0,this._justDown=!1,this._justUp=!1,e&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},downDuration:function(e){return void 0===e&&(e=50),this.isDown&&this.duration<e},upDuration:function(e){return void 0===e&&(e=50),!this.isDown&&this.game.time.time-this.timeUp<e},justPressed:function(){return this.isDown&&0===this.duration},justReleased:function(){return!this.isDown&&0===this.durationUp}},Object.defineProperty(z.Key.prototype,"justDown",{get:function(){var e=this._justDown;return this._justDown=!1,e}}),Object.defineProperty(z.Key.prototype,"justUp",{get:function(){var e=this._justUp;return this._justUp=!1,e}}),Object.defineProperty(z.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(e){(e=!!e)!==this._enabled&&(e||this.reset(!1),this._enabled=e)}}),z.Key.prototype.constructor=z.Key,z.Keyboard=function(e){this.game=e,this.enabled=!0,this.event=null,this.pressEvent=null,this.callbackContext=this,this.onDownCallback=null,this.onPressCallback=null,this.onUpCallback=null,this._keys=[],this._capture=[],this._onKeyDown=null,this._onKeyPress=null,this._onKeyUp=null,this._i=0,this._k=0},z.Keyboard.prototype={addCallbacks:function(a,t,e,r){this.callbackContext=a,void 0!==t&&null!==t&&(this.onDownCallback=t),void 0!==e&&null!==e&&(this.onUpCallback=e),void 0!==r&&null!==r&&(this.onPressCallback=r)},removeCallbacks:function(){this.callbackContext=this,this.onDownCallback=null,this.onUpCallback=null,this.onPressCallback=null},addKey:function(e){return this._keys[e]||(this._keys[e]=new z.Key(this.game,e),this.addKeyCapture(e)),this._keys[e]},addKeys:function(a){var t={};for(var e in a)t[e]=this.addKey(a[e]);return t},removeKey:function(e){this._keys[e]&&(this._keys[e]=null,this.removeKeyCapture(e))},createCursorKeys:function(){return this.addKeys({up:z.KeyCode.UP,down:z.KeyCode.DOWN,left:z.KeyCode.LEFT,right:z.KeyCode.RIGHT})},start:function(){if(!this.game.device.cocoonJS&&null===this._onKeyDown){var a=this;this._onKeyDown=function(t){return a.processKeyDown(t)},this._onKeyUp=function(t){return a.processKeyUp(t)},this._onKeyPress=function(t){return a.processKeyPress(t)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keypress",this._onKeyPress),this._onKeyDown=null,this._onKeyUp=null,this._onKeyPress=null},destroy:function(){this.stop(),this.clearCaptures(),this._keys.length=0,this._i=0},addKeyCapture:function(a){if("object"==typeof a)for(var r in a)this._capture[a[r]]=!0;else this._capture[a]=!0},removeKeyCapture:function(e){delete this._capture[e]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(a){if(this.event=a,this.game.input.enabled&&this.enabled){var t=a.keyCode;this._capture[t]&&a.preventDefault(),this._keys[t]||(this._keys[t]=new z.Key(this.game,t)),this._keys[t].processKeyDown(a),this._k=t,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,a)}},processKeyPress:function(e){this.pressEvent=e,this.game.input.enabled&&this.enabled&&this.onPressCallback&&this.onPressCallback.call(this.callbackContext,c(e.charCode),e)},processKeyUp:function(a){if(this.event=a,this.game.input.enabled&&this.enabled){var t=a.keyCode;this._capture[t]&&a.preventDefault(),this._keys[t]||(this._keys[t]=new z.Key(this.game,t)),this._keys[t].processKeyUp(a),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,a)}},reset:function(a){void 0===a&&(a=!0),this.event=null;for(var t=this._keys.length;t--;)this._keys[t]&&this._keys[t].reset(a)},downDuration:function(a,t){return this._keys[a]?this._keys[a].downDuration(t):null},upDuration:function(a,t){return this._keys[a]?this._keys[a].upDuration(t):null},justPressed:function(e){return this._keys[e]?this._keys[e].justPressed():null},justReleased:function(e){return this._keys[e]?this._keys[e].justReleased():null},isDown:function(e){return this._keys[e]?this._keys[e].isDown:null}},Object.defineProperty(z.Keyboard.prototype,"lastChar",{get:function(){return this.event&&32===this.event.charCode?"":this.pressEvent?c(this.pressEvent.charCode):null}}),Object.defineProperty(z.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}}),z.Keyboard.prototype.constructor=z.Keyboard,z.KeyCode={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144},z.KeyCode)z.KeyCode.hasOwnProperty(s)&&!s.match(/[a-z]/)&&(z.Keyboard[s]=z.KeyCode[s]);for(var n in z.Component=function(){},z.Component.Angle=function(){},z.Component.Angle.prototype={angle:{get:function(){return z.Math.wrapAngle(z.Math.radToDeg(this.rotation))},set:function(e){this.rotation=z.Math.degToRad(z.Math.wrapAngle(e))}}},z.Component.Animation=function(){},z.Component.Animation.prototype={play:function(a,t,e,r){if(this.animations)return this.animations.play(a,t,e,r)}},z.Component.AutoCull=function(){},z.Component.AutoCull.prototype={autoCull:!1,inCamera:{get:function(){return this.autoCull||this.checkWorldBounds||(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y),this.game.world.camera.view.intersects(this._bounds)}}},z.Component.Bounds=function(){},z.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return this.x-this.offsetX+.5*this.width},set:function(e){this.x=e+this.offsetX-.5*this.width}},centerY:{get:function(){return this.y-this.offsetY+.5*this.height},set:function(e){this.y=e+this.offsetY-.5*this.height}},left:{get:function(){return this.x-this.offsetX},set:function(e){this.x=e+this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX},set:function(e){this.x=e-this.width+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(e){this.y=e+this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY},set:function(e){this.y=e-this.height+this.offsetY}},alignIn:function(a,t,e,r){switch(void 0===e&&(e=0),void 0===r&&(r=0),t){default:case z.TOP_LEFT:this.left=a.left-e,this.top=a.top-r;break;case z.TOP_CENTER:this.centerX=a.centerX+e,this.top=a.top-r;break;case z.TOP_RIGHT:this.right=a.right+e,this.top=a.top-r;break;case z.LEFT_CENTER:this.left=a.left-e,this.centerY=a.centerY+r;break;case z.CENTER:this.centerX=a.centerX+e,this.centerY=a.centerY+r;break;case z.RIGHT_CENTER:this.right=a.right+e,this.centerY=a.centerY+r;break;case z.BOTTOM_LEFT:this.left=a.left-e,this.bottom=a.bottom+r;break;case z.BOTTOM_CENTER:this.centerX=a.centerX+e,this.bottom=a.bottom+r;break;case z.BOTTOM_RIGHT:this.right=a.right+e,this.bottom=a.bottom+r;}return this},alignTo:function(a,t,e,r){switch(void 0===e&&(e=0),void 0===r&&(r=0),t){default:case z.TOP_LEFT:this.left=a.left-e,this.bottom=a.top-r;break;case z.TOP_CENTER:this.centerX=a.centerX+e,this.bottom=a.top-r;break;case z.TOP_RIGHT:this.right=a.right+e,this.bottom=a.top-r;break;case z.LEFT_TOP:this.right=a.left-e,this.top=a.top-r;break;case z.LEFT_CENTER:this.right=a.left-e,this.centerY=a.centerY+r;break;case z.LEFT_BOTTOM:this.right=a.left-e,this.bottom=a.bottom+r;break;case z.RIGHT_TOP:this.left=a.right+e,this.top=a.top-r;break;case z.RIGHT_CENTER:this.left=a.right+e,this.centerY=a.centerY+r;break;case z.RIGHT_BOTTOM:this.left=a.right+e,this.bottom=a.bottom+r;break;case z.BOTTOM_LEFT:this.left=a.left-e,this.top=a.bottom+r;break;case z.BOTTOM_CENTER:this.centerX=a.centerX+e,this.top=a.bottom+r;break;case z.BOTTOM_RIGHT:this.right=a.right+e,this.top=a.bottom+r;}return this}},z.Group.prototype.alignIn=z.Component.Bounds.prototype.alignIn,z.Group.prototype.alignTo=z.Component.Bounds.prototype.alignTo,z.Component.BringToTop=function(){},z.Component.BringToTop.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},z.Component.BringToTop.prototype.sendToBack=function(){return this.parent&&this.parent.sendToBack(this),this},z.Component.BringToTop.prototype.moveUp=function(){return this.parent&&this.parent.moveUp(this),this},z.Component.BringToTop.prototype.moveDown=function(){return this.parent&&this.parent.moveDown(this),this},z.Component.Core=function(){},z.Component.Core.skipTypeChecks=!1,z.Component.Core.install=function(a){z.Utils.mixinPrototype(this,z.Component.Core.prototype),this.components={};for(var t=0;t<a.length;t++){var e=a[t],r=!1;"Destroy"===e&&(r=!0),z.Utils.mixinPrototype(this,z.Component[e].prototype,r),this.components[e]=!0}},z.Component.Core.init=function(a,t,r,i,n){if(!z.Component.Core.skipTypeChecks){if(!(a instanceof z.Game))throw new Error("The value passed as the `game` argument ("+a+") is not an instance of Phaser.Game.");"number"!=typeof t&&(console.warn("The `x` argument value (%s) should be a number.",t),t=0),"number"!=typeof r&&(console.warn("The `y` argument value (%s) should be a number.",r),r=0)}this.game=a,this.key=i,this.data={},this.position.set(t,r),this.world=new z.Point(t,r),this.previousPosition=new z.Point(t,r),this.events=new z.Events(this),this._bounds=new z.Rectangle,this.components.PhysicsBody&&(this.body=this.body),this.components.Animation&&(this.animations=new z.AnimationManager(this)),this.components.LoadTexture&&null!==i&&this.loadTexture(i,n),this.components.FixedToCamera&&(this.cameraOffset=new z.Point(t,r))},z.Component.Core.preUpdate=function(){return this.pendingDestroy?(this.destroy(),!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.exists&&this.parent.exists?(this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this.renderOrderID=this.game.stage.currentRenderOrderID++),this.animations&&this.animations.update(),this.body&&this.body.preUpdate(),this.preUpdateChildren(),!0):(this.renderOrderID=-1,!1))},z.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:void 0,animations:void 0,key:"",world:null,debug:!1,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:!0,pendingDestroy:!1,_bounds:null,_exists:!0,exists:{get:function(){return this._exists},set:function(e){e?(this._exists=!0,this.body&&this.body.type===z.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._exists=!1,this.body&&this.body.type===z.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}},preUpdateChildren:function(){for(var a=0,t;a<this.children.length;)t=this.children[a],t.preUpdate(),this===t.parent&&a++},update:function(){},postUpdate:function(){this.customRender&&this.key.render(),this.components.PhysicsBody&&z.Component.PhysicsBody.postUpdate.call(this),this.components.FixedToCamera&&z.Component.FixedToCamera.postUpdate.call(this);for(var e=0;e<this.children.length;e++)this.children[e].postUpdate()}},z.Component.Crop=function(){},z.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(a,t){void 0===t&&(t=!1),a?(t&&null!==this.cropRect?this.cropRect.setTo(a.x,a.y,a.width,a.height):t&&null===this.cropRect?this.cropRect=new z.Rectangle(a.x,a.y,a.width,a.height):this.cropRect=a,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},updateCrop:function(){if(this.cropRect){var i=this.texture.crop.x,t=this.texture.crop.y,e=this.texture.crop.width,s=this.texture.crop.height;this._crop=z.Rectangle.clone(this.cropRect,this._crop),this._crop.x+=this._frame.x,this._crop.y+=this._frame.y;var n=C(this._frame.x,this._crop.x),o=C(this._frame.y,this._crop.y),r=A(this._frame.right,this._crop.right)-n,a=A(this._frame.bottom,this._crop.bottom)-o;this.texture.crop.x=n,this.texture.crop.y=o,this.texture.crop.width=r,this.texture.crop.height=a,this.texture.frame.width=A(r,this.cropRect.width),this.texture.frame.height=A(a,this.cropRect.height),this.texture.width=this.texture.frame.width,this.texture.height=this.texture.frame.height,this.texture._updateUvs(),16777215===this.tint||i===n&&t===o&&e===r&&s===a||(this.texture.requiresReTint=!0)}}},z.Component.Delta=function(){},z.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}},z.Component.Destroy=function(){},z.Component.Destroy.prototype={destroyPhase:!1,destroy:function(a,t){if(null!==this.game&&!this.destroyPhase){void 0===a&&(a=!0),void 0===t&&(t=!1),this.destroyPhase=!0,this.events&&this.events.onDestroy$dispatch(this),this.parent&&(this.parent instanceof z.Group?this.parent.remove(this):this.parent.removeChild(this)),this.input&&this.input.destroy(),this.animations&&this.animations.destroy(),this.body&&this.body.destroy(),this.events&&this.events.destroy(),this.game.tweens.removeFrom(this);var e=this.children.length;if(a)for(;e--;)this.children[e].destroy(a);else for(;e--;)this.removeChild(this.children[e]);this._crop&&(this._crop=null,this.cropRect=null),this._frame&&(this._frame=null),z.Video&&this.key instanceof z.Video&&this.key.onChangeSource.remove(this.resizeFrame,this),z.BitmapText&&this._glyphs&&(this._glyphs=[]),this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this.data={},this.renderable=!1,this.transformCallback&&(this.transformCallback=null,this.transformCallbackContext=null),this.hitArea=null,this.parent=null,this.stage=null,this.worldTransform=null,this.filterArea=null,this._bounds=null,this._currentBounds=null,this._mask=null,this._destroyCachedSprite(),t&&this.texture.destroy(!0),this.destroyPhase=!1,this.pendingDestroy=!1}}},z.Events=function(e){this.parent=e},z.Events.prototype={destroy:function(){this._parent=null,this._onDestroy&&this._onDestroy.dispose(),this._onAddedToGroup&&this._onAddedToGroup.dispose(),this._onRemovedFromGroup&&this._onRemovedFromGroup.dispose(),this._onKilled&&this._onKilled.dispose(),this._onRevived&&this._onRevived.dispose(),this._onEnterBounds&&this._onEnterBounds.dispose(),this._onOutOfBounds&&this._onOutOfBounds.dispose(),this._onInputOver&&this._onInputOver.dispose(),this._onInputOut&&this._onInputOut.dispose(),this._onInputDown&&this._onInputDown.dispose(),this._onInputUp&&this._onInputUp.dispose(),this._onDragStart&&this._onDragStart.dispose(),this._onDragUpdate&&this._onDragUpdate.dispose(),this._onDragStop&&this._onDragStop.dispose(),this._onAnimationStart&&this._onAnimationStart.dispose(),this._onAnimationComplete&&this._onAnimationComplete.dispose(),this._onAnimationLoop&&this._onAnimationLoop.dispose()},onAddedToGroup:null,onRemovedFromGroup:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null},z.Events.prototype.constructor=z.Events,z.Events.prototype)z.Events.prototype.hasOwnProperty(n)&&0===n.indexOf("on")&&null===z.Events.prototype[n]&&function(a,t){"use strict";Object.defineProperty(z.Events.prototype,a,{get:function(){return this[t]||(this[t]=new z.Signal)}}),z.Events.prototype[a+"$dispatch"]=function(){return this[t]?this[t].dispatch.apply(this[t],arguments):null}}(n,"_"+n);return z.Component.FixedToCamera=function(){},z.Component.FixedToCamera.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},z.Component.FixedToCamera.prototype={_fixedToCamera:!1,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(e){e?(this._fixedToCamera=!0,this.cameraOffset.set(this.x,this.y)):this._fixedToCamera=!1}},cameraOffset:new z.Point},z.Component.Health=function(){},z.Component.Health.prototype={health:1,maxHealth:100,damage:function(e){return this.alive&&(this.health-=e,0>=this.health&&this.kill()),this},setHealth:function(e){return this.health=e,this.health>this.maxHealth&&(this.health=this.maxHealth),this},heal:function(e){return this.alive&&(this.health+=e,this.health>this.maxHealth&&(this.health=this.maxHealth)),this}},z.Component.InCamera=function(){},z.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}},z.Component.InputEnabled=function(){},z.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(e){e?null===this.input?(this.input=new z.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}},z.Component.InWorld=function(){},z.Component.InWorld.preUpdate=function(){if(this.pendingDestroy)return this.destroy(),!1;if(this.autoCull||this.checkWorldBounds){if(this._bounds.copyFrom(this.getBounds()),this._bounds.x+=this.game.camera.view.x,this._bounds.y+=this.game.camera.view.y,this.autoCull)if(this.game.world.camera.view.intersects(this._bounds))this.renderable=!0,this.game.world.camera.totalInView++;else if(this.renderable=!1,this.outOfCameraBoundsKill)return this.kill(),!1;if(this.checkWorldBounds)if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds))this._outOfBoundsFired=!1,this.events.onEnterBounds$dispatch(this);else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)&&(this._outOfBoundsFired=!0,this.events.onOutOfBounds$dispatch(this),this.outOfBoundsKill))return this.kill(),!1}return!0},z.Component.InWorld.prototype={checkWorldBounds:!1,outOfBoundsKill:!1,outOfCameraBoundsKill:!1,_outOfBoundsFired:!1,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}},z.Component.LifeSpan=function(){},z.Component.LifeSpan.preUpdate=function(){return this.pendingDestroy?(this.destroy(),!1):!(0<this.lifespan&&(this.lifespan-=this.game.time.physicsElapsedMS,0>=this.lifespan))||(this.kill(),!1)},z.Component.LifeSpan.prototype={alive:!0,lifespan:0,revive:function(e){return void 0===e&&(e=100),this.alive=!0,this.exists=!0,this.visible=!0,"function"==typeof this.setHealth&&this.setHealth(e),this.events&&this.events.onRevived$dispatch(this),this},kill:function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled$dispatch(this),this}},z.Component.LoadTexture=function(){},z.Component.LoadTexture.prototype={customRender:!1,_frame:null,loadTexture:function(i,t,e){i===z.PENDING_ATLAS?(i=t,t=0):t=t||0,(e||void 0===e)&&this.animations&&this.animations.stop(),this.key=i,this.customRender=!1;var s=this.game.cache,n=!0,o=!this.texture.baseTexture.scaleMode;if(z.RenderTexture&&i instanceof z.RenderTexture)this.key=i.key,this.setTexture(i);else if(z.BitmapData&&i instanceof z.BitmapData)this.customRender=!0,this.setTexture(i.texture),n=s.hasFrameData(i.key,z.Cache.BITMAPDATA)?!this.animations.loadFrameData(s.getFrameData(i.key,z.Cache.BITMAPDATA),t):!this.animations.loadFrameData(i.frameData,0);else if(z.Video&&i instanceof z.Video){this.customRender=!0;var r=i.texture.valid;this.setTexture(i.texture),this.setFrame(i.texture.frame.clone()),i.onChangeSource.add(this.resizeFrame,this),this.texture.valid=r}else if(z.Tilemap&&i instanceof z.TilemapLayer)this.setTexture(PIXI.Texture.fromCanvas(i.canvas));else if(i instanceof PIXI.Texture)this.setTexture(i);else{var a=s.getImage(i,!0);this.key=a.key,this.setTexture(new PIXI.Texture(a.base)),this.texture.baseTexture.skipRender="__default"===i,n=!this.animations.loadFrameData(a.frameData,t)}n&&(this._frame=z.Rectangle.clone(this.texture.frame)),o||(this.texture.baseTexture.scaleMode=1)},setFrame:function(e){this._frame=e,this.texture.frame.x=e.x,this.texture.frame.y=e.y,this.texture.frame.width=e.width,this.texture.frame.height=e.height,this.texture.crop.x=e.x,this.texture.crop.y=e.y,this.texture.crop.width=e.width,this.texture.crop.height=e.height,e.trimmed?(this.texture.trim?(this.texture.trim.x=e.spriteSourceSizeX,this.texture.trim.y=e.spriteSourceSizeY,this.texture.trim.width=e.sourceSizeW,this.texture.trim.height=e.sourceSizeH):this.texture.trim={x:e.spriteSourceSizeX,y:e.spriteSourceSizeY,width:e.sourceSizeW,height:e.sourceSizeH},this.texture.width=e.sourceSizeW,this.texture.height=e.sourceSizeH,this.texture.frame.width=e.sourceSizeW,this.texture.frame.height=e.sourceSizeH):!e.trimmed&&this.texture.trim&&(this.texture.trim=null),e.rotated&&(this.texture.rotated=!0),this.cropRect&&this.updateCrop(),this.texture.requiresReTint=!0,this.texture._updateUvs(),this.tilingTexture&&(this.refreshTexture=!0)},resizeFrame:function(a,t,e){this.texture.frame.resize(t,e),this.texture.setFrame(this.texture.frame)},resetFrame:function(){this._frame&&this.setFrame(this._frame)},frame:{get:function(){return this.animations.frame},set:function(e){this.animations.frame=e}},frameName:{get:function(){return this.animations.frameName},set:function(e){this.animations.frameName=e}}},z.Component.Overlap=function(){},z.Component.Overlap.prototype={overlap:function(e){return z.Rectangle.intersects(this.getBounds(),e.getBounds())}},z.Component.PhysicsBody=function(){},z.Component.PhysicsBody.preUpdate=function(){return this.pendingDestroy?(this.destroy(),!1):this.fresh&&this.exists?(this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.body&&this.body.preUpdate(),this.fresh=!1,this.preUpdateChildren(),!1):(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this._exists&&this.parent.exists||(this.renderOrderID=-1,!1))},z.Component.PhysicsBody.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate()},z.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(e){this.position.x=e,this.body&&!this.body.dirty&&(this.body._reset=!0)}},y:{get:function(){return this.position.y},set:function(e){this.position.y=e,this.body&&!this.body.dirty&&(this.body._reset=!0)}}},z.Component.Reset=function(){},z.Component.Reset.prototype.reset=function(a,t,e){return void 0===e&&(e=1),this.world.set(a,t),this.position.set(a,t),this.fresh=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this.components.InWorld&&(this._outOfBoundsFired=!1),this.components.LifeSpan&&(this.alive=!0,this.health=e),this.components.PhysicsBody&&this.body&&this.body.reset(a,t,!1,!1),this},z.Component.ScaleMinMax=function(){},z.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(e){this.scaleMin&&(e.a<this.scaleMin.x&&(e.a=this.scaleMin.x),e.d<this.scaleMin.y&&(e.d=this.scaleMin.y)),this.scaleMax&&(e.a>this.scaleMax.x&&(e.a=this.scaleMax.x),e.d>this.scaleMax.y&&(e.d=this.scaleMax.y))},setScaleMinMax:function(a,t,e,r){void 0===t?t=e=r=a:void 0===e&&(e=r=t,t=a),null===a?this.scaleMin=null:this.scaleMin?this.scaleMin.set(a,t):this.scaleMin=new z.Point(a,t),null===e?this.scaleMax=null:this.scaleMax?this.scaleMax.set(e,r):this.scaleMax=new z.Point(e,r),null===this.scaleMin?this.transformCallback=null:(this.transformCallback=this.checkTransform,this.transformCallbackContext=this)}},z.Component.Smoothed=function(){},z.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(e){e?this.texture&&(this.texture.baseTexture.scaleMode=0,this.texture.baseTexture.dirty()):this.texture&&(this.texture.baseTexture.scaleMode=1,this.texture.baseTexture.dirty())}}},z.GameObjectFactory=function(e){this.game=e,this.world=this.game.world},z.GameObjectFactory.prototype={existing:function(e){return this.world.add(e)},weapon:function(a,t,e,i,n){var o=this.game.plugins.add(z.Weapon);return n&&(o.bulletClass=n),o.createBullets(a,t,e,i),o},image:function(a,t,e,r,n){return void 0===n&&(n=this.world),n.add(new z.Image(this.game,a,t,e,r))},sprite:function(a,t,e,r,n){return void 0===n&&(n=this.world),n.add(new z.Sprite(this.game,a,t,e,r))},creature:function(a,t,e,i,n){void 0===n&&(n=this.world);var o=new z.Creature(this.game,a,t,e,i);return n.add(o),o},tween:function(e){return this.game.tweens.create(e)},group:function(a,t,e,r,n){return new z.Group(this.game,a,t,e,r,n)},physicsGroup:function(a,t,e,r){return new z.Group(this.game,t,e,r,!0,a)},spriteBatch:function(a,t,e){return void 0===a&&(a=null),void 0===t&&(t="group"),void 0===e&&(e=!1),new z.SpriteBatch(this.game,a,t,e)},audio:function(a,t,e,r){return this.game.sound.add(a,t,e,r)},sound:function(a,t,e,r){return this.game.sound.add(a,t,e,r)},audioSprite:function(e){return this.game.sound.addSprite(e)},tileSprite:function(i,t,e,s,n,o,r){return void 0===r&&(r=this.world),r.add(new z.TileSprite(this.game,i,t,e,s,n,o))},rope:function(a,t,e,i,n,o){return void 0===o&&(o=this.world),o.add(new z.Rope(this.game,a,t,e,i,n))},text:function(a,t,e,r,n){return void 0===n&&(n=this.world),n.add(new z.Text(this.game,a,t,e,r))},button:function(i,t,e,s,n,o,r,a,d,l){return void 0===l&&(l=this.world),l.add(new z.Button(this.game,i,t,e,s,n,o,r,a,d))},graphics:function(a,t,e){return void 0===e&&(e=this.world),e.add(new z.Graphics(this.game,a,t))},emitter:function(a,t,e){return this.game.particles.add(new z.Particles.Arcade.Emitter(this.game,a,t,e))},retroFont:function(i,t,e,s,n,o,r,a,d){return new z.RetroFont(this.game,i,t,e,s,n,o,r,a,d)},bitmapText:function(a,t,e,i,n,o){return void 0===o&&(o=this.world),o.add(new z.BitmapText(this.game,a,t,e,i,n))},tilemap:function(a,t,e,r,n){return new z.Tilemap(this.game,a,t,e,r,n)},renderTexture:function(a,t,e,r){void 0!==e&&""!==e||(e=this.game.rnd.uuid()),void 0===r&&(r=!1);var n=new z.RenderTexture(this.game,a,t,e);return r&&this.game.cache.addRenderTexture(e,n),n},video:function(a,t){return new z.Video(this.game,a,t)},bitmapData:function(a,t,e,r){void 0===r&&(r=!1),void 0!==e&&""!==e||(e=this.game.rnd.uuid());var n=new z.BitmapData(this.game,e,a,t);return r&&this.game.cache.addBitmapData(e,n),n},filter:function(a){var t=Array.prototype.slice.call(arguments,1);return(a=new z.Filter[a](this.game)).init.apply(a,t),a},plugin:function(){return this.game.plugins.add.apply(this.game.plugins,arguments)}},z.GameObjectFactory.prototype.constructor=z.GameObjectFactory,z.GameObjectCreator=function(e){this.game=e,this.world=this.game.world},z.GameObjectCreator.prototype={image:function(a,t,e,r){return new z.Image(this.game,a,t,e,r)},sprite:function(a,t,e,r){return new z.Sprite(this.game,a,t,e,r)},tween:function(e){return new z.Tween(e,this.game,this.game.tweens)},group:function(a,t,e,r,n){return new z.Group(this.game,a,t,e,r,n)},spriteBatch:function(a,t,e){return void 0===t&&(t="group"),void 0===e&&(e=!1),new z.SpriteBatch(this.game,a,t,e)},audio:function(a,t,e,r){return this.game.sound.add(a,t,e,r)},audioSprite:function(e){return this.game.sound.addSprite(e)},sound:function(a,t,e,r){return this.game.sound.add(a,t,e,r)},tileSprite:function(a,t,e,i,n,o){return new z.TileSprite(this.game,a,t,e,i,n,o)},rope:function(a,t,e,r,n){return new z.Rope(this.game,a,t,e,r,n)},text:function(a,t,e,r){return new z.Text(this.game,a,t,e,r)},button:function(i,t,e,s,n,o,r,a,d){return new z.Button(this.game,i,t,e,s,n,o,r,a,d)},graphics:function(a,t){return new z.Graphics(this.game,a,t)},emitter:function(a,t,e){return new z.Particles.Arcade.Emitter(this.game,a,t,e)},retroFont:function(i,t,e,s,n,o,r,a,d){return new z.RetroFont(this.game,i,t,e,s,n,o,r,a,d)},bitmapText:function(a,t,e,i,n,o){return new z.BitmapText(this.game,a,t,e,i,n,o)},tilemap:function(a,t,e,r,n){return new z.Tilemap(this.game,a,t,e,r,n)},renderTexture:function(a,t,e,r){void 0!==e&&""!==e||(e=this.game.rnd.uuid()),void 0===r&&(r=!1);var n=new z.RenderTexture(this.game,a,t,e);return r&&this.game.cache.addRenderTexture(e,n),n},bitmapData:function(a,t,e,r){void 0===r&&(r=!1),void 0!==e&&""!==e||(e=this.game.rnd.uuid());var n=new z.BitmapData(this.game,e,a,t);return r&&this.game.cache.addBitmapData(e,n),n},filter:function(a){var t=Array.prototype.slice.call(arguments,1);return(a=new z.Filter[a](this.game)).init.apply(a,t),a}},z.GameObjectCreator.prototype.constructor=z.GameObjectCreator,z.Sprite=function(a,t,e,r,n){t=t||0,e=e||0,r=r||null,n=n||null,this.type=z.SPRITE,this.physicsType=z.SPRITE,PIXI.Sprite.call(this,z.Cache.DEFAULT),z.Component.Core.init.call(this,a,t,e,r,n)},z.Sprite.prototype=Object.create(PIXI.Sprite.prototype),z.Sprite.prototype.constructor=z.Sprite,z.Component.Core.install.call(z.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),z.Sprite.prototype.preUpdatePhysics=z.Component.PhysicsBody.preUpdate,z.Sprite.prototype.preUpdateLifeSpan=z.Component.LifeSpan.preUpdate,z.Sprite.prototype.preUpdateInWorld=z.Component.InWorld.preUpdate,z.Sprite.prototype.preUpdateCore=z.Component.Core.preUpdate,z.Sprite.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},z.Image=function(a,t,e,r,n){t=t||0,e=e||0,r=r||null,n=n||null,this.type=z.IMAGE,PIXI.Sprite.call(this,z.Cache.DEFAULT),z.Component.Core.init.call(this,a,t,e,r,n)},z.Image.prototype=Object.create(PIXI.Sprite.prototype),z.Image.prototype.constructor=z.Image,z.Component.Core.install.call(z.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","ScaleMinMax","Smoothed"]),z.Image.prototype.preUpdateLifeSpan=z.Component.LifeSpan.preUpdate,z.Image.prototype.preUpdateInWorld=z.Component.InWorld.preUpdate,z.Image.prototype.preUpdateCore=z.Component.Core.preUpdate,z.Image.prototype.preUpdate=function(){return this.preUpdateInWorld()&&this.preUpdateLifeSpan()&&this.preUpdateCore()},z.Button=function(i,t,e,s,n,o,r,a,d,l){t=t||0,e=e||0,s=s||null,n=n||null,o=o||this,z.Image.call(this,i,t,e,s,a),this.type=z.BUTTON,this.physicsType=z.SPRITE,this._onOverFrame=null,this._onOutFrame=null,this._onDownFrame=null,this._onUpFrame=null,this.onOverSound=null,this.onOutSound=null,this.onDownSound=null,this.onUpSound=null,this.onOverSoundMarker="",this.onOutSoundMarker="",this.onDownSoundMarker="",this.onUpSoundMarker="",this.onInputOver=new z.Signal,this.onInputOut=new z.Signal,this.onInputDown=new z.Signal,this.onInputUp=new z.Signal,this.onOverMouseOnly=!0,this.justReleasedPreventsOver=z.PointerMode.CONTACT,this.freezeFrames=!1,this.forceOut=!1,this.inputEnabled=!0,this.input.start(0,!0),this.input.useHandCursor=!0,this.setFrames(r,a,d,l),null!==n&&this.onInputUp.add(n,o),this.events.onInputOver.add(this.onInputOverHandler,this),this.events.onInputOut.add(this.onInputOutHandler,this),this.events.onInputDown.add(this.onInputDownHandler,this),this.events.onInputUp.add(this.onInputUpHandler,this)},z.Button.prototype=Object.create(z.Image.prototype),z.Button.prototype.constructor=z.Button,(z.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)},z.Button.prototype.setStateFrame=function(a,t,e){var r="_on"+a+"Frame";null===t?this[r]=null:(this[r]=t,e&&this.changeStateFrame(a))},z.Button.prototype.changeStateFrame=function(a){if(this.freezeFrames)return!1;var t=this["_on"+a+"Frame"];return"string"==typeof t?(this.frameName=t,!0):"number"==typeof t&&(this.frame=t,!0)},z.Button.prototype.setFrames=function(a,t,e,r){this.setStateFrame("Over",a,this.input.pointerOver()),this.setStateFrame("Out",t,!this.input.pointerOver()),this.setStateFrame("Down",e,this.input.pointerDown()),this.setStateFrame("Up",r,this.input.pointerUp())},z.Button.prototype.setStateSound=function(a,t,e){var r="on"+a+"Sound",n="on"+a+"SoundMarker";t instanceof z.Sound||t instanceof z.AudioSprite?(this[r]=t,this[n]="string"==typeof e?e:""):(this[r]=null,this[n]="")},z.Button.prototype.playStateSound=function(a){var t=this["on"+a+"Sound"];if(t){var e=this["on"+a+"SoundMarker"];return t.play(e),!0}return!1},z.Button.prototype.setSounds=function(d,t,e,i,s,n,o,r){this.setStateSound("Over",d,t),this.setStateSound("Out",s,n),this.setStateSound("Down",e,i),this.setStateSound("Up",o,r)},z.Button.prototype.setOverSound=function(a,t){this.setStateSound("Over",a,t)},z.Button.prototype.setOutSound=function(a,t){this.setStateSound("Out",a,t)},z.Button.prototype.setDownSound=function(a,t){this.setStateSound("Down",a,t)},z.Button.prototype.setUpSound=function(a,t){this.setStateSound("Up",a,t)},z.Button.prototype.onInputOverHandler=function(a,t){t.justReleased()&&(this.justReleasedPreventsOver&t.pointerMode)===t.pointerMode||(this.changeStateFrame("Over"),this.onOverMouseOnly&&!t.isMouse||(this.playStateSound("Over"),this.onInputOver&&this.onInputOver.dispatch(this,t)))},z.Button.prototype.onInputOutHandler=function(a,t){this.changeStateFrame("Out"),this.playStateSound("Out"),this.onInputOut&&this.onInputOut.dispatch(this,t)},z.Button.prototype.onInputDownHandler=function(a,t){this.changeStateFrame("Down"),this.playStateSound("Down"),this.onInputDown&&this.onInputDown.dispatch(this,t)},z.Button.prototype.onInputUpHandler=function(a,t,e){this.playStateSound("Up"),this.onInputUp&&this.onInputUp.dispatch(this,t,e),this.freezeFrames||(!0===this.forceOut||(this.forceOut&t.pointerMode)===t.pointerMode?this.changeStateFrame("Out"):this.changeStateFrame("Up")||(e?this.changeStateFrame("Over"):this.changeStateFrame("Out")))},z.SpriteBatch=function(a,t,e,r){void 0!==t&&null!==t||(t=a.world),z.Group.call(this,a,t,e,r),this.type=z.SPRITEBATCH,this.fastSpriteBatch=null,this.ready=!1},z.SpriteBatch.prototype=Object.create(z.Group.prototype),z.SpriteBatch.prototype.constructor=z.SpriteBatch,z.SpriteBatch.prototype._renderWebGL=function(e){this.visible&&!(0>=this.alpha)&&this.children.length&&(this.ready||(this.fastSpriteBatch=new PIXI.WebGLFastSpriteBatch(e.gl),this.ready=!0),this.fastSpriteBatch.gl!==e.gl&&this.fastSpriteBatch.setContext(e.gl),e.spriteBatch.stop(),e.shaderManager.setShader(e.shaderManager.fastShader),this.fastSpriteBatch.begin(this,e),this.fastSpriteBatch.render(this),e.spriteBatch.start())},z.SpriteBatch.prototype._renderCanvas=function(d){if(this.visible&&!(0>=this.alpha)&&this.children.length){var t=d.context;t.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var e=this.worldTransform,i=!0,s=0,n;s<this.children.length;s++)if(n=this.children[s],n.visible){var o=n.texture,r=o.frame;if(t.globalAlpha=this.worldAlpha*n.alpha,0==n.rotation%(2*R))i&&(t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),i=!1),t.drawImage(o.baseTexture.source,r.x,r.y,r.width,r.height,0|n.anchor.x*(-r.width*n.scale.x)+n.position.x+.5+d.shakeX,0|n.anchor.y*(-r.height*n.scale.y)+n.position.y+.5+d.shakeY,r.width*n.scale.x,r.height*n.scale.y);else{i||(i=!0),n.displayObjectUpdateTransform();var a=n.worldTransform,p=a.tx*d.resolution+d.shakeX,l=a.ty*d.resolution+d.shakeY;d.roundPixels?t.setTransform(a.a,a.b,a.c,a.d,0|p,0|l):t.setTransform(a.a,a.b,a.c,a.d,p,l),t.drawImage(o.baseTexture.source,r.x,r.y,r.width,r.height,0|n.anchor.x*-r.width+.5,0|n.anchor.y*-r.height+.5,r.width,r.height)}}}},z.BitmapData=function(a,t,e,r,n){void 0!==e&&0!==e||(e=256),void 0!==r&&0!==r||(r=256),void 0===n&&(n=!1),this.game=a,this.key=t,this.width=e,this.height=r,this.canvas=z.Canvas.create(this,e,r,null,n),this.context=this.canvas.getContext("2d",{alpha:!0}),this.ctx=this.context,this.smoothProperty=a.renderType===z.CANVAS?a.renderer.renderSession.smoothProperty:z.Canvas.getSmoothingPrefix(this.context),this.imageData=this.context.getImageData(0,0,e,r),this.data=null,this.imageData&&(this.data=this.imageData.data),this.pixels=null,this.data&&(this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data),this.baseTexture=new PIXI.BaseTexture(this.canvas,null,this.game.resolution),this.texture=new PIXI.Texture(this.baseTexture),this.frameData=new z.FrameData,this.textureFrame=this.frameData.addFrame(new z.Frame(0,0,0,e,r,"bitmapData")),this.texture.frame=this.textureFrame,this.type=z.BITMAPDATA,this.disableTextureUpload=!1,this.dirty=!1,this.cls=this.clear,this._image=null,this._pos=new z.Point,this._size=new z.Point,this._scale=new z.Point,this._rotate=0,this._alpha={prev:1,current:1},this._anchor=new z.Point,this._tempR=0,this._tempG=0,this._tempB=0,this._circle=new z.Circle,this._swapCanvas=void 0},z.BitmapData.prototype={move:function(a,t,e){return 0!==a&&this.moveH(a,e),0!==t&&this.moveV(t,e),this},moveH:function(a,t){void 0===t&&(t=!0),void 0===this._swapCanvas&&(this._swapCanvas=z.CanvasPool.create(this,this.width,this.height));var e=this._swapCanvas.getContext("2d"),i=this.height,n=this.canvas;if(e.clearRect(0,0,this.width,this.height),0>a)a=E(a),o=this.width-a,t&&e.drawImage(n,0,0,a,i,o,0,a,i),e.drawImage(n,a,0,o,i,0,0,o,i);else{var o=this.width-a;t&&e.drawImage(n,o,0,a,i,0,0,a,i),e.drawImage(n,0,0,o,i,a,0,o,i)}return this.clear(),this.copy(this._swapCanvas)},moveV:function(a,t){void 0===t&&(t=!0),void 0===this._swapCanvas&&(this._swapCanvas=z.CanvasPool.create(this,this.width,this.height));var e=this._swapCanvas.getContext("2d"),i=this.width,n=this.canvas;if(e.clearRect(0,0,this.width,this.height),0>a)a=E(a),o=this.height-a,t&&e.drawImage(n,0,0,i,a,0,o,i,a),e.drawImage(n,0,a,i,o,0,0,i,o);else{var o=this.height-a;t&&e.drawImage(n,0,o,i,a,0,0,i,a),e.drawImage(n,0,0,i,o,0,a,i,o)}return this.clear(),this.copy(this._swapCanvas)},add:function(a){if(Array.isArray(a))for(var t=0;t<a.length;t++)a[t].loadTexture&&a[t].loadTexture(this);else a.loadTexture(this);return this},load:function(e){if("string"==typeof e&&(e=this.game.cache.getImage(e)),e)return this.resize(e.width,e.height),this.cls(),this.draw(e),this.update(),this},clear:function(a,t,e,r){return void 0===a&&(a=0),void 0===t&&(t=0),void 0===e&&(e=this.width),void 0===r&&(r=this.height),this.context.clearRect(a,t,e,r),this.dirty=!0,this},fill:function(a,t,e,r){return void 0===r&&(r=1),this.context.fillStyle="rgba("+a+","+t+","+e+","+r+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},generateTexture:function(a,t,d){var i=this.game.cache,s=new Image;if(t&&(s.onload=function(){var e=i.addImage(a,"",s),o=new PIXI.Texture(e.base);t.call(d||null,o),s.onload=null}),s.src=this.canvas.toDataURL("image/png"),!t){var r=i.addImage(a,"",s);return new PIXI.Texture(r.base)}return null},resize:function(a,t){return a===this.width&&t===this.height||(this.width=a,this.height=t,this.canvas.width=a,this.canvas.height=t,void 0!==this._swapCanvas&&(this._swapCanvas.width=a,this._swapCanvas.height=t),this.baseTexture.width=a,this.baseTexture.height=t,this.textureFrame.width=a,this.textureFrame.height=t,this.texture.width=a,this.texture.height=t,this.texture.crop.width=a,this.texture.crop.height=t,this.update(),this.dirty=!0),this},update:function(a,t,e,r){return void 0===a&&(a=0),void 0===t&&(t=0),void 0===e&&(e=C(1,this.width)),void 0===r&&(r=C(1,this.height)),this.imageData=this.context.getImageData(a,t,e,r),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(i,t,e,s,n,o){void 0===e&&(e=0),void 0===s&&(s=0),void 0===n&&(n=this.width),void 0===o&&(o=this.height);for(var r=e+n,a=s+o,m=z.Color.createColor(),l={r:0,g:0,b:0,a:0},c=!1,u=s;u<a;u++)for(var d=e;d<r;d++)z.Color.unpackPixel(this.getPixel32(d,u),m),!1!==(l=i.call(t,m,d,u))&&null!==l&&void 0!==l&&(this.setPixel32(d,u,l.r,l.g,l.b,l.a,!1),c=!0);return c&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(p,t,e,i,s,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=this.width),void 0===n&&(n=this.height);for(var o=e+s,r=i+n,a=0,m=0,l=!1,c=i;c<r;c++)for(var u=e;u<o;u++)a=this.getPixel32(u,c),(m=p.call(t,a,u,c))!==a&&(this.pixels[c*this.width+u]=m,l=!0);return l&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(i,t,e,s,n,o,r,a,h){var l=0,c=0,u=this.width,d=this.height,p=z.Color.packPixel(i,t,e,s);void 0!==h&&h instanceof z.Rectangle&&(l=h.x,c=h.y,u=h.width,d=h.height);for(var y=0;y<d;y++)for(var g=0;g<u;g++)this.getPixel32(l+g,c+y)===p&&this.setPixel32(l+g,c+y,n,o,r,a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(i,t,e,s){var n=i||0===i,o=t||0===t,r=e||0===e;if(n||o||r){void 0===s&&(s=new z.Rectangle(0,0,this.width,this.height));for(var a=z.Color.createColor(),d=s.y;d<s.bottom;d++)for(var l=s.x;l<s.right;l++)z.Color.unpackPixel(this.getPixel32(l,d),a,!0),n&&(a.h=i),o&&(a.s=t),r&&(a.l=e),z.Color.HSLtoRGB(a.h,a.s,a.l,a),this.setPixel32(l,d,a.r,a.g,a.b,a.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(i,t,e,s){if(void 0!==i&&null!==i||(i=!1),void 0!==t&&null!==t||(t=!1),void 0!==e&&null!==e||(e=!1),i||t||e){void 0===s&&(s=new z.Rectangle(0,0,this.width,this.height));for(var n=z.Color.createColor(),o=s.y;o<s.bottom;o++)for(var r=s.x;r<s.right;r++)z.Color.unpackPixel(this.getPixel32(r,o),n,!0),i&&(n.h=this.game.math.wrap(n.h+i,0,1)),t&&(n.s=this.game.math.clamp(n.s+t,0,1)),e&&(n.l=this.game.math.clamp(n.l+e,0,1)),z.Color.HSLtoRGB(n.h,n.s,n.l,n),this.setPixel32(r,o,n.r,n.g,n.b,n.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(i,t,e,s,n,o,r){return void 0===r&&(r=!0),0<=i&&i<=this.width&&0<=t&&t<=this.height&&(this.pixels[t*this.width+i]=z.Device.LITTLE_ENDIAN?o<<24|n<<16|s<<8|e:e<<24|s<<16|n<<8|o,r&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(a,t,e,r,i,n){return this.setPixel32(a,t,e,r,i,255,n)},getPixel:function(a,t,e){e||(e=z.Color.createColor());var r=~~(a+t*this.width);return r*=4,e.r=this.data[r],e.g=this.data[++r],e.b=this.data[++r],e.a=this.data[++r],e},getPixel32:function(a,t){if(0<=a&&a<=this.width&&0<=t&&t<=this.height)return this.pixels[t*this.width+a]},getPixelRGB:function(a,t,e,r,n){return z.Color.unpackPixel(this.getPixel32(a,t),e,r,n)},getPixels:function(e){return this.context.getImageData(e.x,e.y,e.width,e.height)},getFirstPixel:function(a){void 0===a&&(a=0);var t=z.Color.createColor(),e=0,i=0,n=1,o=!1;1===a?(n=-1,i=this.height):3==a&&(n=-1,e=this.width);do z.Color.unpackPixel(this.getPixel32(e,i),t),0===a||1===a?++e===this.width&&(e=0,((i+=n)>=this.height||0>=i)&&(o=!0)):2!=a&&3!=a||++i===this.height&&(i=0,((e+=n)>=this.width||0>=e)&&(o=!0));while(0===t.a&&!o);return t.x=e,t.y=i,t},getBounds:function(e){return void 0===e&&(e=new z.Rectangle),e.x=this.getFirstPixel(2).x,e.x===this.width?e.setTo(0,0,0,0):(e.y=this.getFirstPixel(0).y,e.width=this.getFirstPixel(3).x-e.x+1,e.height=this.getFirstPixel(1).y-e.y+1,e)},addToWorld:function(a,t,e,i,s,n){s=s||1,n=n||1;var o=this.game.add.image(a,t,this);return o.anchor.set(e,i),o.scale.set(s,n),o},copy:function(i,x,e,s,n,o,r,a,_,b,T,S,E,C,P,w,m){if(void 0!==i&&null!==i||(i=this),i instanceof z.RenderTexture&&(i=i.getCanvas()),this._image=i,i instanceof z.Sprite||i instanceof z.Image||i instanceof z.Text||i instanceof PIXI.Sprite)this._pos.set(i.texture.crop.x,i.texture.crop.y),this._size.set(i.texture.crop.width,i.texture.crop.height),this._scale.set(i.scale.x,i.scale.y),this._anchor.set(i.anchor.x,i.anchor.y),this._rotate=i.rotation,this._alpha.current=i.alpha,this._image=i.texture instanceof z.RenderTexture?i.texture.getCanvas():i.texture.baseTexture.source,void 0!==o&&null!==o||(o=i.x),void 0!==r&&null!==r||(r=i.y),i.texture.trim&&(o+=i.texture.trim.x-i.anchor.x*i.texture.trim.width,r+=i.texture.trim.y-i.anchor.y*i.texture.trim.height),16777215!==i.tint&&(i.cachedTint!==i.tint&&(i.cachedTint=i.tint,i.tintedTexture=PIXI.CanvasTinter.getTintedTexture(i,i.tint)),this._image=i.tintedTexture,this._pos.set(0));else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,i instanceof z.BitmapData)this._image=i.canvas;else if("string"==typeof i){if(null===(i=this.game.cache.getImage(i)))return;this._image=i}this._size.set(this._image.width,this._image.height)}if(void 0!==x&&null!==x||(x=0),void 0!==e&&null!==e||(e=0),s&&(this._size.x=s),n&&(this._size.y=n),void 0!==o&&null!==o||(o=x),void 0!==r&&null!==r||(r=e),void 0!==a&&null!==a||(a=this._size.x),void 0!==_&&null!==_||(_=this._size.y),"number"==typeof b&&(this._rotate=b),"number"==typeof T&&(this._anchor.x=T),"number"==typeof S&&(this._anchor.y=S),"number"==typeof E&&(this._scale.x=E),"number"==typeof C&&(this._scale.y=C),"number"==typeof P&&(this._alpha.current=P),void 0===w&&(w=null),void 0===m&&(m=!1),!(0>=this._alpha.current||0===this._scale.x||0===this._scale.y||0===this._size.x||0===this._size.y)){var y=this.context;return this._alpha.prev=y.globalAlpha,y.save(),y.globalAlpha=this._alpha.current,w&&(this.op=w),m&&(o|=0,r|=0),y.translate(o,r),y.scale(this._scale.x,this._scale.y),y.rotate(this._rotate),y.drawImage(this._image,this._pos.x+x,this._pos.y+e,this._size.x,this._size.y,-a*this._anchor.x,-_*this._anchor.y,a,_),y.restore(),y.globalAlpha=this._alpha.prev,this.dirty=!0,this}},copyTransform:function(i,t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),!i.hasOwnProperty("worldTransform")||!i.worldVisible||0===i.worldAlpha)return this;var s=i.worldTransform;if(this._pos.set(i.texture.crop.x,i.texture.crop.y),this._size.set(i.texture.crop.width,i.texture.crop.height),0===s.a||0===s.d||0===this._size.x||0===this._size.y)return this;this._image=i.texture instanceof z.RenderTexture?i.texture.getCanvas():i.texture.baseTexture.source;var n=s.tx,o=s.ty;i.texture.trim&&(n+=i.texture.trim.x-i.anchor.x*i.texture.trim.width,o+=i.texture.trim.y-i.anchor.y*i.texture.trim.height),16777215!==i.tint&&(i.cachedTint!==i.tint&&(i.cachedTint=i.tint,i.tintedTexture=PIXI.CanvasTinter.getTintedTexture(i,i.tint)),this._image=i.tintedTexture,this._pos.set(0)),e&&(n|=0,o|=0);var r=this.context;return this._alpha.prev=r.globalAlpha,r.save(),r.globalAlpha=this._alpha.current,t&&(this.op=t),r[this.smoothProperty]=i.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR,r.setTransform(s.a,s.b,s.c,s.d,n,o),r.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*i.anchor.x,-this._size.y*i.anchor.y,this._size.x,this._size.y),r.restore(),r.globalAlpha=this._alpha.prev,this.dirty=!0,this},copyRect:function(a,t,e,i,s,n,o){return this.copy(a,t.x,t.y,t.width,t.height,e,i,t.width,t.height,0,0,0,1,1,s,n,o)},draw:function(a,t,e,i,s,n,o){return this.copy(a,null,null,null,null,t,e,i,s,null,null,null,null,null,null,n,o)},drawGroup:function(a,t,e){return 0<a.total&&a.forEachExists(this.drawGroupProxy,this,t,e),this},drawGroupProxy:function(a,t,e){if(a.hasOwnProperty("texture")&&this.copyTransform(a,t,e),a.type===z.GROUP&&a.exists)this.drawGroup(a,t,e);else if(a.hasOwnProperty("children")&&0<a.children.length)for(var r=0;r<a.children.length;r++)a.children[r].exists&&this.copyTransform(a.children[r],t,e)},drawFull:function(a,t,e){if(!1===a.worldVisible||0===a.worldAlpha||a.hasOwnProperty("exists")&&!1===a.exists)return this;if(a.type!==z.GROUP&&a.type!==z.EMITTER&&a.type!==z.BITMAPTEXT)if(a.type===z.GRAPHICS){var r=a.getBounds();this.ctx.save(),this.ctx.translate(r.x,r.y),PIXI.CanvasGraphics.renderGraphics(a,this.ctx),this.ctx.restore()}else this.copy(a,null,null,null,null,a.worldPosition.x,a.worldPosition.y,null,null,a.worldRotation,null,null,a.worldScale.x,a.worldScale.y,a.worldAlpha,t,e);if(a.children)for(var n=0;n<a.children.length;n++)this.drawFull(a.children[n],t,e);return this},shadow:function(a,t,e,r){var o=this.context;return void 0===a||null===a?o.shadowColor="rgba(0,0,0,0)":(o.shadowColor=a,o.shadowBlur=t||5,o.shadowOffsetX=e||10,o.shadowOffsetY=r||10),this},alphaMask:function(a,t,e,r){return void 0===r||null===r?this.draw(t).blendSourceAtop():this.draw(t,r.x,r.y,r.width,r.height).blendSourceAtop(),void 0===e||null===e?this.draw(a).blendReset():this.draw(a,e.x,e.y,e.width,e.height).blendReset(),this},extract:function(d,t,e,i,s,n,p,r,a){return void 0===s&&(s=255),void 0===n&&(n=!1),void 0===p&&(p=t),void 0===r&&(r=e),void 0===a&&(a=i),n&&d.resize(this.width,this.height),this.processPixelRGB(function(n,o,l){return n.r===t&&n.g===e&&n.b===i&&d.setPixel32(o,l,p,r,a,s,!1),!1},this),d.context.putImageData(d.imageData,0,0),d.dirty=!0,d},rect:function(a,t,e,r,o){return void 0!==o&&(this.context.fillStyle=o),this.context.fillRect(a,t,e,r),this},text:function(d,t,e,i,s,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="14px Courier"),void 0===s&&(s="rgb(255,255,255)"),void 0===n&&(n=!0);var o=this.context,r=o.font;return o.font=i,n&&(o.fillStyle="rgb(0,0,0)",o.fillText(d,t+1,e+1)),o.fillStyle=s,o.fillText(d,t,e),o.font=r,this},circle:function(a,t,e,r){var o=this.context;return void 0!==r&&(o.fillStyle=r),o.beginPath(),o.arc(a,t,e,0,2*R,!1),o.closePath(),o.fill(),this},line:function(a,t,e,i,s,n){void 0===s&&(s="#fff"),void 0===n&&(n=1);var o=this.context;return o.beginPath(),o.moveTo(a,t),o.lineTo(e,i),o.lineWidth=n,o.strokeStyle=s,o.stroke(),o.closePath(),this},polygon:function(d,t,e,i){void 0===i&&(i="#fff"),void 0===e&&(e=0);var s=this.context;t&&(s.fillStyle=t),e&&(s.lineWidth=e,s.strokeStyle=i),s.beginPath(),s.moveTo(d[0].x,d[0].y);for(var n=1,o=d.length,r;n<o;n++)r=d[n],s.lineTo(r.x,r.y);return s.closePath(),t&&s.fill(),e&&s.stroke(),this},textureLine:function(a,t,r){if(void 0===r&&(r="repeat-x"),"string"!=typeof t||(t=this.game.cache.getImage(t))){var i=a.length;"no-repeat"===r&&i>t.width&&(i=t.width);var n=this.context;return n.fillStyle=n.createPattern(t,r),this._circle=new z.Circle(a.start.x,a.start.y,t.height),this._circle.circumferencePoint(a.angle-1.5707963267948966,!1,this._pos),n.save(),n.translate(this._pos.x,this._pos.y),n.rotate(a.angle),n.fillRect(0,0,i,t.height),n.restore(),this.dirty=!0,this}},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},destroy:function(){this.frameData.destroy(),this.texture.destroy(!0),z.CanvasPool.remove(this)},blendReset:function(){return this.op="source-over",this},blendSourceOver:function(){return this.op="source-over",this},blendSourceIn:function(){return this.op="source-in",this},blendSourceOut:function(){return this.op="source-out",this},blendSourceAtop:function(){return this.op="source-atop",this},blendDestinationOver:function(){return this.op="destination-over",this},blendDestinationIn:function(){return this.op="destination-in",this},blendDestinationOut:function(){return this.op="destination-out",this},blendDestinationAtop:function(){return this.op="destination-atop",this},blendXor:function(){return this.op="xor",this},blendAdd:function(){return this.op="lighter",this},blendMultiply:function(){return this.op="multiply",this},blendScreen:function(){return this.op="screen",this},blendOverlay:function(){return this.op="overlay",this},blendDarken:function(){return this.op="darken",this},blendLighten:function(){return this.op="lighten",this},blendColorDodge:function(){return this.op="color-dodge",this},blendColorBurn:function(){return this.op="color-burn",this},blendHardLight:function(){return this.op="hard-light",this},blendSoftLight:function(){return this.op="soft-light",this},blendDifference:function(){return this.op="difference",this},blendExclusion:function(){return this.op="exclusion",this},blendHue:function(){return this.op="hue",this},blendSaturation:function(){return this.op="saturation",this},blendColor:function(){return this.op="color",this},blendLuminosity:function(){return this.op="luminosity",this},copyBitmapData:function(a,t,e){a.update();for(var r=0,n;r<a.height;r++){n=(e+r)*this.width+t;for(var i=0;i<a.width;i++)this.pixels[n+i]=a.pixels[r*a.width+i]}return this}},Object.defineProperty(z.BitmapData.prototype,"smoothed",{get:function(){z.Canvas.getSmoothingEnabled(this.context)},set:function(e){z.Canvas.setSmoothingEnabled(this.context,e)}}),Object.defineProperty(z.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(e){this.context.globalCompositeOperation=e}}),z.BitmapData.getTransform=function(a,r,d,l,p,c){return"number"!=typeof a&&(a=0),"number"!=typeof r&&(r=0),"number"!=typeof d&&(d=1),"number"!=typeof l&&(l=1),"number"!=typeof p&&(p=0),"number"!=typeof c&&(c=0),{sx:d,sy:l,scaleX:d,scaleY:l,skewX:p,skewY:c,translateX:a,translateY:r,tx:a,ty:r}},z.BitmapData.prototype.constructor=z.BitmapData,z.EarCut={},z.EarCut.Triangulate=function(i,t,e){e=e||2;var s=t&&t.length,n=s?t[0]*e:i.length,o=z.EarCut.linkedList(i,0,n,e,!0),m=[];if(!o)return m;var a,h,l,c,u,d,p;if(s&&(o=z.EarCut.eliminateHoles(i,t,o,e)),i.length>80*e){a=l=i[0],h=c=i[1];for(var y=e;y<n;y+=e)u=i[y],d=i[y+1],u<a&&(a=u),d<h&&(h=d),u>l&&(l=u),d>c&&(c=d);p=C(l-a,c-h)}return z.EarCut.earcutLinked(o,m,e,a,h,p),m},z.EarCut.linkedList=function(i,t,e,s,n){var o=0,d,r,a;for(d=t,r=e-s;d<e;d+=s)o+=(i[r]-i[d])*(i[d+1]+i[r+1]),r=d;if(n===0<o)for(d=t;d<e;d+=s)a=z.EarCut.insertNode(d,i[d],i[d+1],a);else for(d=e-s;d>=t;d-=s)a=z.EarCut.insertNode(d,i[d],i[d+1],a);return a},z.EarCut.filterPoints=function(a,r){if(!a)return a;r||(r=a);var e=a,o;do if(o=!1,e.steiner||!z.EarCut.equals(e,e.next)&&0!==z.EarCut.area(e.prev,e,e.next))e=e.next;else{if(z.EarCut.removeNode(e),(e=r=e.prev)===e.next)return null;o=!0}while(o||e!==r);return r},z.EarCut.earcutLinked=function(i,t,e,s,n,o,r){if(i){!r&&o&&z.EarCut.indexCurve(i,s,n,o);for(var d=i,p,c;i.prev!==i.next;)if(p=i.prev,c=i.next,o?z.EarCut.isEarHashed(i,s,n,o):z.EarCut.isEar(i))t.push(p.i/e),t.push(i.i/e),t.push(c.i/e),z.EarCut.removeNode(i),i=c.next,d=c.next;else if((i=c)===d){r?1===r?(i=z.EarCut.cureLocalIntersections(i,t,e),z.EarCut.earcutLinked(i,t,e,s,n,o,2)):2==r&&z.EarCut.splitEarcut(i,t,e,s,n,o):z.EarCut.earcutLinked(z.EarCut.filterPoints(i),t,e,s,n,o,1);break}}},z.EarCut.isEar=function(a){var t=a.prev,e=a,r=a.next;if(0<=z.EarCut.area(t,e,r))return!1;for(var n=a.next.next;n!==a.prev;){if(z.EarCut.pointInTriangle(t.x,t.y,e.x,e.y,r.x,r.y,n.x,n.y)&&0<=z.EarCut.area(n.prev,n,n.next))return!1;n=n.next}return!0},z.EarCut.isEarHashed=function(i,t,e,s){var n=i.prev,o=i,r=i.next;if(0<=z.EarCut.area(n,o,r))return!1;for(var a=n.x<o.x?n.x<r.x?n.x:r.x:o.x<r.x?o.x:r.x,m=n.y<o.y?n.y<r.y?n.y:r.y:o.y<r.y?o.y:r.y,l=n.x>o.x?n.x>r.x?n.x:r.x:o.x>r.x?o.x:r.x,c=n.y>o.y?n.y>r.y?n.y:r.y:o.y>r.y?o.y:r.y,u=z.EarCut.zOrder(a,m,t,e,s),d=z.EarCut.zOrder(l,c,t,e,s),p=i.nextZ;p&&p.z<=d;){if(p!==i.prev&&p!==i.next&&z.EarCut.pointInTriangle(n.x,n.y,o.x,o.y,r.x,r.y,p.x,p.y)&&0<=z.EarCut.area(p.prev,p,p.next))return!1;p=p.nextZ}for(p=i.prevZ;p&&p.z>=u;){if(p!==i.prev&&p!==i.next&&z.EarCut.pointInTriangle(n.x,n.y,o.x,o.y,r.x,r.y,p.x,p.y)&&0<=z.EarCut.area(p.prev,p,p.next))return!1;p=p.prevZ}return!0},z.EarCut.cureLocalIntersections=function(a,t,e){var i=a;do{var n=i.prev,o=i.next.next;z.EarCut.intersects(n,i,i.next,o)&&z.EarCut.locallyInside(n,o)&&z.EarCut.locallyInside(o,n)&&(t.push(n.i/e),t.push(i.i/e),t.push(o.i/e),z.EarCut.removeNode(i),z.EarCut.removeNode(i.next),i=a=o),i=i.next}while(i!==a);return i},z.EarCut.splitEarcut=function(i,t,e,s,n,o){var r=i;do{for(var a=r.next.next;a!==r.prev;){if(r.i!==a.i&&z.EarCut.isValidDiagonal(r,a)){var d=z.EarCut.splitPolygon(r,a);return r=z.EarCut.filterPoints(r,r.next),d=z.EarCut.filterPoints(d,d.next),z.EarCut.earcutLinked(r,t,e,s,n,o),void z.EarCut.earcutLinked(d,t,e,s,n,o)}a=a.next}r=r.next}while(r!==i)},z.EarCut.eliminateHoles=function(i,t,e,s){var n=[],d,o,r,a,p;for(d=0,o=t.length;d<o;d++)r=t[d]*s,a=d<o-1?t[d+1]*s:i.length,(p=z.EarCut.linkedList(i,r,a,s,!1))===p.next&&(p.steiner=!0),n.push(z.EarCut.getLeftmost(p));for(n.sort(z.EarCut.compareX),d=0;d<n.length;d++)z.EarCut.eliminateHole(n[d],e),e=z.EarCut.filterPoints(e,e.next);return e},z.EarCut.compareX=function(a,t){return a.x-t.x},z.EarCut.eliminateHole=function(a,t){if(t=z.EarCut.findHoleBridge(a,t)){var e=z.EarCut.splitPolygon(t,a);z.EarCut.filterPoints(e,e.next)}},z.EarCut.findHoleBridge=function(i,t){var e=t,n=i.x,o=i.y,r=-1/0,a;do{if(o<=e.y&&o>=e.next.y){var d=e.x+(o-e.y)*(e.next.x-e.x)/(e.next.y-e.y);d<=n&&d>r&&(r=d,a=e.x<e.next.x?e:e.next)}e=e.next}while(e!==t);if(!a)return null;if(i.x===a.x)return a.prev;var p=a,c=1/0,u;for(e=a.next;e!==p;)n>=e.x&&e.x>=a.x&&z.EarCut.pointInTriangle(o<a.y?n:r,o,a.x,a.y,o<a.y?r:n,o,e.x,e.y)&&((u=E(o-e.y)/(n-e.x))<c||u===c&&e.x>a.x)&&z.EarCut.locallyInside(e,i)&&(a=e,c=u),e=e.next;return a},z.EarCut.indexCurve=function(a,t,e,r){var n=a;do null===n.z&&(n.z=z.EarCut.zOrder(n.x,n.y,t,e,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==a);n.prevZ.nextZ=null,n.prevZ=null,z.EarCut.sortLinked(n)},z.EarCut.sortLinked=function(d){var t=1,l,e,i,s,n,o,r,a;do{for(e=d,d=null,n=null,o=0;e;){for(o++,i=e,r=0,l=0;l<t&&(r++,i=i.nextZ);l++);for(a=t;0<r||0<a&&i;)0===r?(s=i,i=i.nextZ,a--):0!==a&&i?e.z<=i.z?(s=e,e=e.nextZ,r--):(s=i,i=i.nextZ,a--):(s=e,e=e.nextZ,r--),n?n.nextZ=s:d=s,s.prevZ=n,n=s;e=i}n.nextZ=null,t*=2}while(1<o);return d},z.EarCut.zOrder=function(a,t,e,r,o){return a=32767*(a-e)/o,t=32767*(t-r)/o,a=16711935&(a|a<<8),a=252645135&(a|a<<4),a=858993459&(a|a<<2),a=1431655765&(a|a<<1),t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),a|t<<1},z.EarCut.getLeftmost=function(a){var t=a,e=a;do t.x<e.x&&(e=t),t=t.next;while(t!==a);return e},z.EarCut.pointInTriangle=function(d,t,e,i,s,n,o,r){return 0<=(s-o)*(t-r)-(d-o)*(n-r)&&0<=(d-o)*(i-r)-(e-o)*(t-r)&&0<=(e-o)*(n-r)-(s-o)*(i-r)},z.EarCut.isValidDiagonal=function(a,t){return z.EarCut.equals(a,t)||a.next.i!==t.i&&a.prev.i!==t.i&&!z.EarCut.intersectsPolygon(a,t)&&z.EarCut.locallyInside(a,t)&&z.EarCut.locallyInside(t,a)&&z.EarCut.middleInside(a,t)},z.EarCut.area=function(a,t,e){return(t.y-a.y)*(e.x-t.x)-(t.x-a.x)*(e.y-t.y)},z.EarCut.equals=function(a,t){return a.x===t.x&&a.y===t.y},z.EarCut.intersects=function(a,t,e,r){return 0<z.EarCut.area(a,t,e)!=0<z.EarCut.area(a,t,r)&&0<z.EarCut.area(e,r,a)!=0<z.EarCut.area(e,r,t)},z.EarCut.intersectsPolygon=function(a,t){var e=a;do{if(e.i!==a.i&&e.next.i!==a.i&&e.i!==t.i&&e.next.i!==t.i&&z.EarCut.intersects(e,e.next,a,t))return!0;e=e.next}while(e!==a);return!1},z.EarCut.locallyInside=function(a,t){return 0>z.EarCut.area(a.prev,a,a.next)?0<=z.EarCut.area(a,t,a.next)&&0<=z.EarCut.area(a,a.prev,t):0>z.EarCut.area(a,t,a.prev)||0>z.EarCut.area(a,a.next,t)},z.EarCut.middleInside=function(a,t){var e=a,r=!1,i=(a.x+t.x)/2,n=(a.y+t.y)/2;do e.y>n!=e.next.y>n&&i<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==a);return r},z.EarCut.splitPolygon=function(a,t){var e=new z.EarCut.Node(a.i,a.x,a.y),i=new z.EarCut.Node(t.i,t.x,t.y),n=a.next,o=t.prev;return a.next=t,t.prev=a,e.next=n,n.prev=e,i.next=e,e.prev=i,o.next=i,i.prev=o,i},z.EarCut.insertNode=function(a,t,e,r){var n=new z.EarCut.Node(a,t,e);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n},z.EarCut.removeNode=function(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)},z.EarCut.Node=function(a,t,e){this.i=a,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1},PIXI.WebGLGraphics=function(){},PIXI.WebGLGraphics.stencilBufferLimit=6,PIXI.WebGLGraphics.renderGraphics=function(i,t){var e=t.gl,n=t.projection,o=t.offset,r=t.shaderManager.primitiveShader,a;i.dirty&&PIXI.WebGLGraphics.updateGraphics(i,e);var s=i._webGL[e.id];if(s)for(var d=0;d<s.data.length;d++)1===s.data[d].mode?(a=s.data[d],t.stencilManager.pushStencil(i,a,t),e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_SHORT,2*(a.indices.length-4)),t.stencilManager.popStencil(i,a,t)):(a=s.data[d],t.shaderManager.setShader(r),r=t.shaderManager.primitiveShader,e.uniformMatrix3fv(r.translationMatrix,!1,i.worldTransform.toArray(!0)),e.uniform1f(r.flipY,1),e.uniform2f(r.projectionVector,n.x,-n.y),e.uniform2f(r.offsetVector,-o.x,-o.y),e.uniform3fv(r.tintColor,z.Color.hexToRGBArray(i.tint)),e.uniform1f(r.alpha,i.worldAlpha),e.bindBuffer(e.ARRAY_BUFFER,a.buffer),e.vertexAttribPointer(r.aVertexPosition,2,e.FLOAT,!1,24,0),e.vertexAttribPointer(r.colorAttribute,4,e.FLOAT,!1,24,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a.indexBuffer),e.drawElements(e.TRIANGLE_STRIP,a.indices.length,e.UNSIGNED_SHORT,0))},PIXI.WebGLGraphics.updateGraphics=function(i,t){var d=i._webGL[t.id];d||(d=i._webGL[t.id]={lastIndex:0,data:[],gl:t}),i.dirty=!1;var s;if(i.clearDirty){for(i.clearDirty=!1,s=0;s<d.data.length;s++){var n=d.data[s];n.reset(),PIXI.WebGLGraphics.graphicsDataPool.push(n)}d.data=[],d.lastIndex=0}var o;for(s=d.lastIndex;s<i.graphicsData.length;s++){var r=i.graphicsData[s];r.type===z.POLYGON?(r.points=r.shape.points.slice(),r.shape.closed&&(r.points[0]===r.points[r.points.length-2]&&r.points[1]===r.points[r.points.length-1]||r.points.push(r.points[0],r.points[1])),r.fill&&r.points.length>=PIXI.WebGLGraphics.stencilBufferLimit&&(r.points.length<2*PIXI.WebGLGraphics.stencilBufferLimit?(o=PIXI.WebGLGraphics.switchMode(d,0),PIXI.WebGLGraphics.buildPoly(r,o)||(o=PIXI.WebGLGraphics.switchMode(d,1),PIXI.WebGLGraphics.buildComplexPoly(r,o))):(o=PIXI.WebGLGraphics.switchMode(d,1),PIXI.WebGLGraphics.buildComplexPoly(r,o))),0<r.lineWidth&&(o=PIXI.WebGLGraphics.switchMode(d,0),PIXI.WebGLGraphics.buildLine(r,o))):(o=PIXI.WebGLGraphics.switchMode(d,0),r.type===z.RECTANGLE?PIXI.WebGLGraphics.buildRectangle(r,o):r.type===z.CIRCLE||r.type===z.ELLIPSE?PIXI.WebGLGraphics.buildCircle(r,o):r.type===z.ROUNDEDRECTANGLE&&PIXI.WebGLGraphics.buildRoundedRectangle(r,o)),d.lastIndex++}for(s=0;s<d.data.length;s++)(o=d.data[s]).dirty&&o.upload()},PIXI.WebGLGraphics.switchMode=function(a,t){var e;return a.data.length?(e=a.data[a.data.length-1]).mode===t&&1!==t||((e=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(a.gl)).mode=t,a.data.push(e)):((e=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(a.gl)).mode=t,a.data.push(e)),e.dirty=!0,e},PIXI.WebGLGraphics.buildRectangle=function(i,t){var e=i.shape,s=e.x,n=e.y,o=e.width,r=e.height;if(i.fill){var a=z.Color.hexToRGBArray(i.fillColor),h=i.fillAlpha,l=a[0]*h,c=a[1]*h,u=a[2]*h,d=t.points,p=t.indices,y=d.length/6;d.push(s,n),d.push(l,c,u,h),d.push(s+o,n),d.push(l,c,u,h),d.push(s,n+r),d.push(l,c,u,h),d.push(s+o,n+r),d.push(l,c,u,h),p.push(y,y,y+1,y+2,y+3,y+3)}if(i.lineWidth){var g=i.points;i.points=[s,n,s+o,n,s+o,n+r,s,n+r,s,n],PIXI.WebGLGraphics.buildLine(i,t),i.points=g}},PIXI.WebGLGraphics.buildRoundedRectangle=function(i,t){var e=i.shape,s=e.x,n=e.y,o=e.width,r=e.height,a=e.radius,h=[];if(h.push(s,n+a),h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(s,n+r-a,s,n+r,s+a,n+r)),h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(s+o-a,n+r,s+o,n+r,s+o,n+r-a)),h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(s+o,n+a,s+o,n,s+o-a,n)),h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(s+a,n,s,n,s,n+a)),i.fill){var l=z.Color.hexToRGBArray(i.fillColor),c=i.fillAlpha,u=l[0]*c,d=l[1]*c,p=l[2]*c,f=t.points,g=t.indices,m=f.length/6,y=z.EarCut.Triangulate(h,null,2),v=0;for(v=0;v<y.length;v+=3)g.push(y[v]+m),g.push(y[v]+m),g.push(y[v+1]+m),g.push(y[v+2]+m),g.push(y[v+2]+m);for(v=0;v<h.length;v++)f.push(h[v],h[++v],u,d,p,c)}if(i.lineWidth){var x=i.points;i.points=h,PIXI.WebGLGraphics.buildLine(i,t),i.points=x}},PIXI.WebGLGraphics.quadraticBezierCurve=function(m,t,e,i,s,n){function o(a,t,e){return a+(t-a)*e}for(var r=[],p=0,y=0,g,a,h,l,c,u;20>=y;y++)g=o(m,e,p=y/20),a=o(t,i,p),h=o(e,s,p),l=o(i,n,p),c=o(g,h,p),u=o(a,l,p),r.push(c,u);return r},PIXI.WebGLGraphics.buildCircle=function(i,t){var e=i.shape,o=e.x,r=e.y,a,s;i.type===z.CIRCLE?(a=e.radius,s=e.radius):(a=e.width,s=e.height);var n=2*R/40,h=0;if(i.fill){var l=z.Color.hexToRGBArray(i.fillColor),c=i.fillAlpha,u=l[0]*c,d=l[1]*c,p=l[2]*c,f=t.points,g=t.indices,m=f.length/6;for(g.push(m),h=0;41>h;h++)f.push(o,r,u,d,p,c),f.push(o+T(n*h)*a,r+S(n*h)*s,u,d,p,c),g.push(m++,m++);g.push(m-1)}if(i.lineWidth){var y=i.points;for(i.points=[],h=0;41>h;h++)i.points.push(o+T(n*h)*a,r+S(n*h)*s);PIXI.WebGLGraphics.buildLine(i,t),i.points=y}},PIXI.WebGLGraphics.buildLine=function(i,t){var e=0,s=i.points;if(0!==s.length){if(i.lineWidth%2)for(e=0;e<s.length;e++)s[e]+=.5;var n=new PIXI.Point(s[0],s[1]),o=new PIXI.Point(s[s.length-2],s[s.length-1]);if(n.x===o.x&&n.y===o.y){(s=s.slice()).pop(),s.pop();var r=(o=new PIXI.Point(s[s.length-2],s[s.length-1])).x+.5*(n.x-o.x),a=o.y+.5*(n.y-o.y);s.unshift(r,a),s.push(r,a)}var h=t.points,I=t.indices,W=s.length/2,R=s.length,L=h.length/6,D=i.lineWidth/2,B=z.Color.hexToRGBArray(i.lineColor),H=i.lineAlpha,U=B[0]*H,G=B[1]*H,N=B[2]*H,V,l,c,u,d,p,f,g,m,X,j,q,Y,_,w,T,P,C,S,k,A,M;for(c=s[0],u=s[1],d=s[2],m=-(u-(p=s[3])),X=c-d,m/=M=F(m*m+X*X),X/=M,m*=D,X*=D,h.push(c-m,u-X,U,G,N,H),h.push(c+m,u+X,U,G,N,H),e=1;e<W-1;e++)c=s[2*(e-1)],u=s[2*(e-1)+1],d=s[2*e],p=s[2*e+1],f=s[2*(e+1)],g=s[2*(e+1)+1],m=-(u-p),X=c-d,m/=M=F(m*m+X*X),X/=M,m*=D,X*=D,j=-(p-g),q=d-f,j/=M=F(j*j+q*q),q/=M,P=(-m+c)*(-X+p)-(-m+d)*(-X+u),k=(-(j*=D)+f)*(-(q*=D)+p)-(-j+d)*(-q+g),A=(w=-X+u-(-X+p))*(S=-j+d-(-j+f))-(C=-q+g-(-q+p))*(T=-m+d-(-m+c)),.1>E(A)?(A+=10.1,h.push(d-m,p-X,U,G,N,H),h.push(d+m,p+X,U,G,N,H)):19600<((V=(T*k-S*P)/A)-d)*(V-d)+((l=(C*P-w*k)/A)-p)+(l-p)?(Y=m-j,_=X-q,Y/=M=F(Y*Y+_*_),_/=M,Y*=D,_*=D,h.push(d-Y,p-_),h.push(U,G,N,H),h.push(d+Y,p+_),h.push(U,G,N,H),h.push(d-Y,p-_),h.push(U,G,N,H),R++):(h.push(V,l),h.push(U,G,N,H),h.push(d-(V-d),p-(l-p)),h.push(U,G,N,H));for(c=s[2*(W-2)],u=s[2*(W-2)+1],d=s[2*(W-1)],m=-(u-(p=s[2*(W-1)+1])),X=c-d,m/=M=F(m*m+X*X),X/=M,m*=D,X*=D,h.push(d-m,p-X),h.push(U,G,N,H),h.push(d+m,p+X),h.push(U,G,N,H),I.push(L),e=0;e<R;e++)I.push(L++);I.push(L-1)}},PIXI.WebGLGraphics.buildComplexPoly=function(i,t){var e=i.points.slice();if(!(6>e.length)){var s=t.indices;t.points=e,t.alpha=i.fillAlpha,t.color=z.Color.hexToRGBArray(i.fillColor);for(var n=1/0,a=-1/0,p=1/0,l=-1/0,c=0,u,o;c<e.length;c+=2)u=e[c],o=e[c+1],n=u<n?u:n,a=u>a?u:a,p=o<p?o:p,l=o>l?o:l;e.push(n,p,a,p,a,l,n,l);var r=e.length/2;for(c=0;c<r;c++)s.push(c)}},PIXI.WebGLGraphics.buildPoly=function(i,t){var e=i.points;if(!(6>e.length)){var s=t.points,n=t.indices,o=e.length/2,r=z.Color.hexToRGBArray(i.fillColor),a=i.fillAlpha,m=r[0]*a,l=r[1]*a,c=r[2]*a,u=z.EarCut.Triangulate(e,null,2);if(!u)return!1;var g=s.length/6,p=0;for(p=0;p<u.length;p+=3)n.push(u[p]+g),n.push(u[p]+g),n.push(u[p+1]+g),n.push(u[p+2]+g),n.push(u[p+2]+g);for(p=0;p<o;p++)s.push(e[2*p],e[2*p+1],m,l,c,a);return!0}},PIXI.WebGLGraphics.graphicsDataPool=[],PIXI.WebGLGraphicsData=function(e){this.gl=e,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[]},PIXI.WebGLGraphicsData.prototype.upload=function(){var e=this.gl;this.glPoints=new Float32Array(this.points),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.glPoints,e.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.glIndicies,e.STATIC_DRAW),this.dirty=!1},PIXI.CanvasGraphics=function(){},PIXI.CanvasGraphics.renderGraphics=function(i,t){var e=i.worldAlpha;i.dirty&&(this.updateGraphicsTint(i),i.dirty=!1);for(var s=0;s<i.graphicsData.length;s++){var n=i.graphicsData[s],o=n.shape,r=n._fillTint,a=n._lineTint;if(t.lineWidth=n.lineWidth,n.type===z.POLYGON){t.beginPath();var h=o.points;t.moveTo(h[0],h[1]);for(var l=1;l<h.length/2;l++)t.lineTo(h[2*l],h[2*l+1]);o.closed&&t.lineTo(h[0],h[1]),h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&t.closePath(),n.fill&&(t.globalAlpha=n.fillAlpha*e,t.fillStyle="#"+("00000"+(0|r).toString(16)).substr(-6),t.fill()),n.lineWidth&&(t.globalAlpha=n.lineAlpha*e,t.strokeStyle="#"+("00000"+(0|a).toString(16)).substr(-6),t.stroke())}else if(n.type===z.RECTANGLE)(n.fillColor||0===n.fillColor)&&(t.globalAlpha=n.fillAlpha*e,t.fillStyle="#"+("00000"+(0|r).toString(16)).substr(-6),t.fillRect(o.x,o.y,o.width,o.height)),n.lineWidth&&(t.globalAlpha=n.lineAlpha*e,t.strokeStyle="#"+("00000"+(0|a).toString(16)).substr(-6),t.strokeRect(o.x,o.y,o.width,o.height));else if(n.type===z.CIRCLE)t.beginPath(),t.arc(o.x,o.y,o.radius,0,2*R),t.closePath(),n.fill&&(t.globalAlpha=n.fillAlpha*e,t.fillStyle="#"+("00000"+(0|r).toString(16)).substr(-6),t.fill()),n.lineWidth&&(t.globalAlpha=n.lineAlpha*e,t.strokeStyle="#"+("00000"+(0|a).toString(16)).substr(-6),t.stroke());else if(n.type===z.ELLIPSE){var c=2*o.width,u=2*o.height,d=o.x-c/2,p=o.y-u/2;t.beginPath();var f=.5522848*(c/2),g=.5522848*(u/2),m=d+c,y=p+u,v=d+c/2,x=p+u/2;t.moveTo(d,x),t.bezierCurveTo(d,x-g,v-f,p,v,p),t.bezierCurveTo(v+f,p,m,x-g,m,x),t.bezierCurveTo(m,x+g,v+f,y,v,y),t.bezierCurveTo(v-f,y,d,x+g,d,x),t.closePath(),n.fill&&(t.globalAlpha=n.fillAlpha*e,t.fillStyle="#"+("00000"+(0|r).toString(16)).substr(-6),t.fill()),n.lineWidth&&(t.globalAlpha=n.lineAlpha*e,t.strokeStyle="#"+("00000"+(0|a).toString(16)).substr(-6),t.stroke())}else if(n.type===z.ROUNDEDRECTANGLE){var b=o.x,_=o.y,E=o.width,T=o.height,P=o.radius,C=0|A(E,T)/2;P=P>C?C:P,t.beginPath(),t.moveTo(b,_+P),t.lineTo(b,_+T-P),t.quadraticCurveTo(b,_+T,b+P,_+T),t.lineTo(b+E-P,_+T),t.quadraticCurveTo(b+E,_+T,b+E,_+T-P),t.lineTo(b+E,_+P),t.quadraticCurveTo(b+E,_,b+E-P,_),t.lineTo(b+P,_),t.quadraticCurveTo(b,_,b,_+P),t.closePath(),(n.fillColor||0===n.fillColor)&&(t.globalAlpha=n.fillAlpha*e,t.fillStyle="#"+("00000"+(0|r).toString(16)).substr(-6),t.fill()),n.lineWidth&&(t.globalAlpha=n.lineAlpha*e,t.strokeStyle="#"+("00000"+(0|a).toString(16)).substr(-6),t.stroke())}}},PIXI.CanvasGraphics.renderGraphicsMask=function(i,t){var e=i.graphicsData.length;if(0!==e){t.beginPath();for(var s=0;s<e;s++){var n=i.graphicsData[s],o=n.shape;if(n.type===z.POLYGON){var r=o.points;t.moveTo(r[0],r[1]);for(var a=1;a<r.length/2;a++)t.lineTo(r[2*a],r[2*a+1]);r[0]===r[r.length-2]&&r[1]===r[r.length-1]&&t.closePath()}else if(n.type===z.RECTANGLE)t.rect(o.x,o.y,o.width,o.height),t.closePath();else if(n.type===z.CIRCLE)t.arc(o.x,o.y,o.radius,0,2*R),t.closePath();else if(n.type===z.ELLIPSE){var h=2*o.width,l=2*o.height,c=o.x-h/2,u=o.y-l/2,d=.5522848*(h/2),p=.5522848*(l/2),f=c+h,g=u+l,m=c+h/2,y=u+l/2;t.moveTo(c,y),t.bezierCurveTo(c,y-p,m-d,u,m,u),t.bezierCurveTo(m+d,u,f,y-p,f,y),t.bezierCurveTo(f,y+p,m+d,g,m,g),t.bezierCurveTo(m-d,g,c,y+p,c,y),t.closePath()}else if(n.type===z.ROUNDEDRECTANGLE){var v=o.x,x=o.y,b=o.width,_=o.height,S=o.radius,T=0|A(b,_)/2;S=S>T?T:S,t.moveTo(v,x+S),t.lineTo(v,x+_-S),t.quadraticCurveTo(v,x+_,v+S,x+_),t.lineTo(v+b-S,x+_),t.quadraticCurveTo(v+b,x+_,v+b,x+_-S),t.lineTo(v+b,x+S),t.quadraticCurveTo(v+b,x,v+b-S,x),t.lineTo(v+S,x),t.quadraticCurveTo(v,x,v,x+S),t.closePath()}}}},PIXI.CanvasGraphics.updateGraphicsTint=function(d){if(16777215!==d.tint)for(var t=(255&d.tint>>16)/255,e=(255&d.tint>>8)/255,i=(255&d.tint)/255,s=0;s<d.graphicsData.length;s++){var n=d.graphicsData[s],o=0|n.fillColor,r=0|n.lineColor;n._fillTint=(255*((255&o>>16)/255*t)<<16)+(255*((255&o>>8)/255*e)<<8)+255*((255&o)/255*i),n._lineTint=(255*((255&r>>16)/255*t)<<16)+(255*((255&r>>8)/255*e)<<8)+255*((255&r)/255*i)}},z.GraphicsData=function(a,t,e,i,s,n,o){this.lineWidth=a,this.lineColor=t,this.lineAlpha=e,this._lineTint=t,this.fillColor=i,this.fillAlpha=s,this._fillTint=i,this.fill=n,this.shape=o,this.type=o.type},z.GraphicsData.prototype.constructor=z.GraphicsData,z.GraphicsData.prototype.clone=function(){return new z.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},z.Graphics=function(a,t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.type=z.GRAPHICS,this.physicsType=z.SPRITE,this.anchor=new z.Point,PIXI.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=PIXI.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this._localBounds=new z.Rectangle(0,0,1,1),this.dirty=!0,this._boundsDirty=!1,this.webGLDirty=!1,this.cachedSpriteDirty=!1,z.Component.Core.init.call(this,a,t,e,"",null)},z.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),z.Graphics.prototype.constructor=z.Graphics,z.Component.Core.install.call(z.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),z.Graphics.prototype.preUpdatePhysics=z.Component.PhysicsBody.preUpdate,z.Graphics.prototype.preUpdateLifeSpan=z.Component.LifeSpan.preUpdate,z.Graphics.prototype.preUpdateInWorld=z.Component.InWorld.preUpdate,z.Graphics.prototype.preUpdateCore=z.Component.Core.preUpdate,z.Graphics.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},z.Graphics.prototype.postUpdate=function(){z.Component.PhysicsBody.postUpdate.call(this),z.Component.FixedToCamera.postUpdate.call(this),this._boundsDirty&&(this.updateLocalBounds(),this._boundsDirty=!1);for(var e=0;e<this.children.length;e++)this.children[e].postUpdate()},z.Graphics.prototype.destroy=function(e){this.clear(),z.Component.Destroy.prototype.destroy.call(this,e)},z.Graphics.prototype.drawTriangle=function(a,t){void 0===t&&(t=!1);var e=new z.Polygon(a);if(t){var i=new z.Point(this.game.camera.x-a[0].x,this.game.camera.y-a[0].y),n=new z.Point(a[1].x-a[0].x,a[1].y-a[0].y),o=new z.Point(a[1].x-a[2].x,a[1].y-a[2].y).cross(n);0<i.dot(o)&&this.drawPolygon(e)}else this.drawPolygon(e)},z.Graphics.prototype.drawTriangles=function(i,t,e){void 0===e&&(e=!1);var s=new z.Point,o=new z.Point,r=new z.Point,a=[],d;if(t){if(i[0]instanceof z.Point)for(d=0;d<t.length/3;d++)a.push(i[t[3*d]]),a.push(i[t[3*d+1]]),a.push(i[t[3*d+2]]),3===a.length&&(this.drawTriangle(a,e),a=[]);else for(d=0;d<t.length;d++)s.x=i[2*t[d]],s.y=i[2*t[d]+1],a.push(s.copyTo({})),3===a.length&&(this.drawTriangle(a,e),a=[]);}else if(i[0]instanceof z.Point)for(d=0;d<i.length/3;d++)this.drawTriangle([i[3*d],i[3*d+1],i[3*d+2]],e);else for(d=0;d<i.length/6;d++)s.x=i[6*d+0],s.y=i[6*d+1],o.x=i[6*d+2],o.y=i[6*d+3],r.x=i[6*d+4],r.y=i[6*d+5],this.drawTriangle([s,o,r],e)},z.Graphics.prototype.lineStyle=function(a,t,e){return this.lineWidth=a||0,this.lineColor=t||0,this.lineAlpha=void 0===e?1:e,this.currentPath&&(this.currentPath.shape.points.length?this.drawShape(new z.Polygon(this.currentPath.shape.points.slice(-2))):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha)),this},z.Graphics.prototype.moveTo=function(a,t){return this.drawShape(new z.Polygon([a,t])),this},z.Graphics.prototype.lineTo=function(a,t){return this.currentPath||this.moveTo(0,0),this.currentPath.shape.points.push(a,t),this.dirty=!0,this._boundsDirty=!0,this},z.Graphics.prototype.quadraticCurveTo=function(d,t,e,i){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var s=this.currentPath.shape.points,r,n;0===s.length&&this.moveTo(0,0);for(var o=s[s.length-2],a=s[s.length-1],p=0,l=1;20>=l;++l)r=o+(d-o)*(p=l/20),n=a+(t-a)*p,s.push(r+(d+(e-d)*p-r)*p,n+(t+(i-t)*p-n)*p);return this.dirty=!0,this._boundsDirty=!0,this},z.Graphics.prototype.bezierCurveTo=function(m,t,e,i,s,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var o=this.currentPath.shape.points,u=o[o.length-2],d=o[o.length-1],p=0,y=1,g,r,a,h,l;20>=y;++y)a=(r=(g=1-(p=y/20))*g)*g,l=(h=p*p)*p,o.push(a*u+3*r*p*m+3*g*h*e+l*s,a*d+3*r*p*t+3*g*h*i+l*n);return this.dirty=!0,this._boundsDirty=!0,this},z.Graphics.prototype.arcTo=function(T,t,e,i,s){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(T,t):this.moveTo(T,t);var n=this.currentPath.shape.points,o=n[n.length-2],r=n[n.length-1]-t,a=o-T,h=i-t,l=e-T,c=E(r*l-a*h);if(1e-8>c||0===s)n[n.length-2]===T&&n[n.length-1]===t||n.push(T,t);else{var u=r*r+a*a,d=h*h+l*l,p=r*h+a*l,f=s*F(u)/c,g=s*F(d)/c,m=f*p/u,y=g*p/d,v=f*l+g*a,x=f*h+g*r,b=_(r*(g+m)-x,a*(g+m)-v),C=_(h*(f+y)-x,l*(f+y)-v);this.arc(v+T,x+t,s,b,C,a*h>l*r)}return this.dirty=!0,this._boundsDirty=!0,this},z.Graphics.prototype.arc=function(p,t,e,i,s,n,C){if(i===s)return this;void 0===n&&(n=!1),void 0===C&&(C=40),!n&&s<=i?s+=2*R:n&&i<=s&&(i+=2*R);var r=n?-1*(i-s):s-i,a=y(E(r)/(2*R))*C;if(0==r)return this;var h=p+S(i)*e,l=t+T(i)*e;n&&this.filling?this.moveTo(p,t):this.moveTo(h,l);for(var c=this.currentPath.shape.points,u=r/(2*a),d=S(u),f=T(u),g=a-1,m=0;m<=g;m++){var v=u+i+2*u*(m+g%1/g*m),x=S(v),b=-T(v);c.push((d*x+f*b)*e+p,(d*-b+f*x)*e+t)}return this.dirty=!0,this._boundsDirty=!0,this},z.Graphics.prototype.beginFill=function(a,t){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=void 0===t?1:t,this.currentPath&&2>=this.currentPath.shape.points.length&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},z.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},z.Graphics.prototype.drawRect=function(a,t,e,r){return this.drawShape(new z.Rectangle(a,t,e,r)),this},z.Graphics.prototype.drawRoundedRect=function(a,t,e,r,n){return this.drawShape(new z.RoundedRectangle(a,t,e,r,n)),this},z.Graphics.prototype.drawCircle=function(a,t,e){return this.drawShape(new z.Circle(a,t,e)),this},z.Graphics.prototype.drawEllipse=function(a,r,o,i){return this.drawShape({x:a,y:r,width:o,height:i,type:z.ELLIPSE}),this},z.Graphics.prototype.drawPolygon=function(a){a instanceof z.Polygon&&(a=a.points);var t=a;if(!Array.isArray(t)){t=Array(arguments.length);for(var e=0;e<t.length;++e)t[e]=arguments[e]}return this.drawShape(new z.Polygon(t)),this},z.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this._boundsDirty=!0,this.clearDirty=!0,this.graphicsData=[],this.updateLocalBounds(),this},z.Graphics.prototype.generateTexture=function(a,t,e){void 0===a&&(a=1),void 0===t&&(t=PIXI.scaleModes.DEFAULT),void 0===e&&(e=0);var r=this.getBounds();r.width+=e,r.height+=e;var i=new PIXI.CanvasBuffer(r.width*a,r.height*a),n=PIXI.Texture.fromCanvas(i.canvas,t);return n.baseTexture.resolution=a,i.context.scale(a,a),i.context.translate(-r.x,-r.y),PIXI.CanvasGraphics.renderGraphics(this,i.context),n},z.Graphics.prototype._renderWebGL=function(a){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.worldAlpha=this.worldAlpha,void PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,a);if(a.spriteBatch.stop(),a.blendModeManager.setBlendMode(this.blendMode),this._mask&&a.maskManager.pushMask(this._mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var t=PIXI.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(t[0],t[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),PIXI.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(var e=0;e<this.children.length;e++)this.children[e]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(this.mask,a),a.drawCount++,a.spriteBatch.start()}},z.Graphics.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._prevTint!==this.tint&&(this.dirty=!0,this._prevTint=this.tint),this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,a);var t=a.context,e=this.worldTransform;this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,t.globalCompositeOperation=PIXI.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a);var i=a.resolution,s=e.tx*a.resolution+a.shakeX,n=e.ty*a.resolution+a.shakeY;t.setTransform(e.a*i,e.b*i,e.c*i,e.d*i,s,n),PIXI.CanvasGraphics.renderGraphics(this,t);for(var o=0;o<this.children.length;o++)this.children[o]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}},z.Graphics.prototype.getBounds=function(i){if(this._currentBounds)return this._currentBounds;if(!this.renderable)return z.EmptyRectangle;this.dirty&&(this.updateLocalBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var t=this._localBounds,e=t.x,s=t.width+t.x,n=t.y,o=t.height+t.y,r=i||this.worldTransform,a=r.a,h=r.b,l=r.c,c=r.d,u=r.tx,d=r.ty,p=a*s+l*o+u,f=c*o+h*s+d,g=a*e+l*o+u,m=c*o+h*e+d,y=a*e+l*n+u,v=c*n+h*e+d,x=a*s+l*n+u,b=c*n+h*s+d,_=p,S=f,T=p,E=f;return T=g<T?g:T,T=y<T?y:T,T=x<T?x:T,E=m<E?m:E,E=v<E?v:E,E=b<E?b:E,_=g>_?g:_,_=y>_?y:_,_=x>_?x:_,S=m>S?m:S,S=v>S?v:S,S=b>S?b:S,this._bounds.x=T,this._bounds.width=_-T,this._bounds.y=E,this._bounds.height=S-E,this._currentBounds=this._bounds,this._currentBounds},z.Graphics.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=z.identityMatrix;for(var t=0;t<this.children.length;t++)this.children[t].updateTransform();var e=this.getBounds();for(this.worldTransform=a,t=0;t<this.children.length;t++)this.children[t].updateTransform();return e},z.Graphics.prototype.containsPoint=function(a,t){void 0===t&&(t=new z.Point),this.worldTransform.applyInverse(a,t);for(var e=this.graphicsData,r=0,n;r<e.length;r++)if(n=e[r],n.fill&&n.shape&&n.shape.contains(t.x,t.y))return!0;return!1},z.Graphics.prototype.updateLocalBounds=function(){var i=1/0,t=-1/0,e=1/0,s=-1/0;if(this.graphicsData.length)for(var n=0,u,o,r,a,h,l;n<this.graphicsData.length;n++){var c=this.graphicsData[n],d=c.type,p=c.lineWidth;if(u=c.shape,d===z.RECTANGLE||d===z.ROUNDEDRECTANGLE)r=u.x-p/2,a=u.y-p/2,h=u.width+p,l=u.height+p,i=r<i?r:i,t=r+h>t?r+h:t,e=a<e?a:e,s=a+l>s?a+l:s;else if(d===z.CIRCLE)r=u.x,a=u.y,h=u.radius+p/2,l=u.radius+p/2,i=r-h<i?r-h:i,t=r+h>t?r+h:t,e=a-l<e?a-l:e,s=a+l>s?a+l:s;else if(d===z.ELLIPSE)r=u.x,a=u.y,h=u.width+p/2,l=u.height+p/2,i=r-h<i?r-h:i,t=r+h>t?r+h:t,e=a-l<e?a-l:e,s=a+l>s?a+l:s;else{o=u.points;for(var y=0;y<o.length;y++)o[y]instanceof z.Point?(r=o[y].x,a=o[y].y):(r=o[y],a=o[y+1],y<o.length-1&&y++),i=r-p<i?r-p:i,t=r+p>t?r+p:t,e=a-p<e?a-p:e,s=a+p>s?a+p:s}}else i=0,t=0,e=0,s=0;var g=this.boundsPadding;this._localBounds.x=i-g,this._localBounds.width=t-i+2*g,this._localBounds.y=e-g,this._localBounds.height=s-e+2*g},z.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var t=new PIXI.CanvasBuffer(a.width,a.height),e=PIXI.Texture.fromCanvas(t.canvas);this._cachedSprite=new PIXI.Sprite(e),this._cachedSprite.buffer=t,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-a.x/a.width,this._cachedSprite.anchor.y=-a.y/a.height,this._cachedSprite.buffer.context.translate(-a.x,-a.y),this.worldAlpha=1,PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},z.Graphics.prototype.updateCachedSpriteTexture=function(){var a=this._cachedSprite,t=a.texture,e=a.buffer.canvas;t.baseTexture.width=e.width,t.baseTexture.height=e.height,t.crop.width=t.frame.width=e.width,t.crop.height=t.frame.height=e.height,a._width=e.width,a._height=e.height,t.baseTexture.dirty()},z.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},z.Graphics.prototype.drawShape=function(a){this.currentPath&&2>=this.currentPath.shape.points.length&&this.graphicsData.pop(),this.currentPath=null,a instanceof z.Polygon&&(a=a.clone()).flatten();var t=new z.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,a);return this.graphicsData.push(t),t.type===z.POLYGON&&(t.shape.closed=this.filling,this.currentPath=t),this.dirty=!0,this._boundsDirty=!0,t},Object.defineProperty(z.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap=e,this._cacheAsBitmap?this._generateCachedSprite():this.destroyCachedSprite(),this.dirty=!0,this.webGLDirty=!0}}),z.RenderTexture=function(i,t,e,s,n,o,r,a){if(void 0===t&&(t=100),void 0===e&&(e=100),void 0===s&&(s=""),void 0===n&&(n=z.scaleModes.DEFAULT),void 0===o&&(o=1),void 0===r&&(r=PIXI.defaultRenderer),void 0===a&&(a=0),this.game=i,this.key=s,this.type=z.RENDERTEXTURE,this._tempMatrix=new z.Matrix,this.width=t,this.height=e,this.resolution=o,this.frame=new z.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=this.frame.clone(),this.baseTexture=new PIXI.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=n,this.baseTexture.hasLoaded=!0,PIXI.Texture.call(this,this.baseTexture,this.frame.clone()),this.renderer=r,this.renderer.type===z.WEBGL){var d=this.renderer.gl;this.baseTexture.textureIndex=a,this.baseTexture._dirty[d.id]=!1,this.textureBuffer=new PIXI.FilterTexture(d,this.width,this.height,this.baseTexture.scaleMode,a),this.baseTexture._glTextures[d.id]=this.textureBuffer.texture,this.projection=new z.Point(.5*this.width,.5*-this.height)}else this.textureBuffer=new PIXI.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this.tempMatrix=new z.Matrix,this._updateUvs()},z.RenderTexture.prototype=Object.create(PIXI.Texture.prototype),z.RenderTexture.prototype.constructor=z.RenderTexture,z.RenderTexture.prototype.renderXY=function(a,t,e,r){a.updateTransform(),this._tempMatrix.copyFrom(a.worldTransform),this._tempMatrix.tx=t,this._tempMatrix.ty=e,this.renderer.type===z.WEBGL?this._renderWebGL(a,this._tempMatrix,r):this._renderCanvas(a,this._tempMatrix,r)},z.RenderTexture.prototype.renderRawXY=function(a,t,e,r){this._tempMatrix.identity().translate(t,e),this.renderer.type===z.WEBGL?this._renderWebGL(a,this._tempMatrix,r):this._renderCanvas(a,this._tempMatrix,r)},z.RenderTexture.prototype.render=function(a,t,e){void 0===t||null===t?this._tempMatrix.copyFrom(a.worldTransform):this._tempMatrix.copyFrom(t),this.renderer.type===z.WEBGL?this._renderWebGL(a,this._tempMatrix,e):this._renderCanvas(a,this._tempMatrix,e)},z.RenderTexture.prototype.resize=function(a,t,e){a===this.width&&t===this.height||(this.valid=0<a&&0<t,this.width=a,this.height=t,this.frame.width=this.crop.width=a*this.resolution,this.frame.height=this.crop.height=t*this.resolution,e&&(this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution),this.renderer.type===z.WEBGL&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width,this.height))},z.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===z.WEBGL&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},z.RenderTexture.prototype._renderWebGL=function(a,t,e){if(this.valid&&0!==a.alpha){var r=a.worldTransform;r.identity(),r.translate(0,2*this.projection.y),t&&r.append(t),r.scale(1,-1);for(var i=0;i<a.children.length;i++)a.children[i].updateTransform();var n=this.renderer.gl;n.viewport(0,0,this.width*this.resolution,this.height*this.resolution),n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer),e&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer,t),this.renderer.spriteBatch.dirty=!0,n.bindFramebuffer(n.FRAMEBUFFER,null)}},z.RenderTexture.prototype._renderCanvas=function(a,t,e){if(this.valid&&0!==a.alpha){var r=a.worldTransform;r.identity(),t&&r.append(t);for(var i=0;i<a.children.length;i++)a.children[i].updateTransform();e&&this.textureBuffer.clear();var n=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(a,this.textureBuffer.context,t),this.renderer.resolution=n}},z.RenderTexture.prototype.getImage=function(){var e=new Image;return e.src=this.getBase64(),e},z.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},z.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===z.WEBGL){var a=this.renderer.gl,t=this.textureBuffer.width,e=this.textureBuffer.height,i=new Uint8Array(4*t*e);a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer),a.readPixels(0,0,t,e,a.RGBA,a.UNSIGNED_BYTE,i),a.bindFramebuffer(a.FRAMEBUFFER,null);var n=new PIXI.CanvasBuffer(t,e),o=n.context.getImageData(0,0,t,e);return o.data.set(i),n.context.putImageData(o,0,0),n.canvas}return this.textureBuffer.canvas},z.Text=function(a,t,e,r,n){t=t||0,e=e||0,r=void 0===r||null===r?"":r.toString(),this.canvas=z.CanvasPool.create(this),z.Sprite.call(this,a,t,e,PIXI.Texture.fromCanvas(this.canvas)),this.type=z.TEXT,this.physicsType=z.SPRITE,this.padding=new z.Point,this.textBounds=null,this.context=this.canvas.getContext("2d"),this.colors=[],this.strokeColors=[],this.fontStyles=[],this.fontWeights=[],this.autoRound=!1,this.useAdvancedWrap=!1,this.splitRegExp=/(?:\r\n|\r|\n)/,this.characterLimitSize=-1,this.characterLimitSuffix="",this._testString="|M\xC9q",this._res=a.renderer.resolution,this._text=r,this._fontComponents=null,this._lineSpacing=0,this._charCount=0,this._width=0,this._height=0,this.style={},this.setStyle(n||{}),""!==r&&this.updateText()},z.Text.prototype=Object.create(z.Sprite.prototype),z.Text.prototype.constructor=z.Text,z.Text.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},z.Text.prototype.update=function(){},z.Text.prototype.destroy=function(e){this.texture.destroy(!0),z.Component.Destroy.prototype.destroy.call(this,e)},z.Text.prototype.setShadow=function(a,t,e,r,i,n){return void 0===a&&(a=0),void 0===t&&(t=0),void 0===e&&(e="rgba(0, 0, 0, 1)"),void 0===r&&(r=0),void 0===i&&(i=!0),void 0===n&&(n=!0),this.style.shadowOffsetX=a,this.style.shadowOffsetY=t,this.style.shadowColor=e,this.style.shadowBlur=r,this.style.shadowStroke=i,this.style.shadowFill=n,this.dirty=!0,this},z.Text.prototype.setStyle=function(a,t){void 0===t&&(t=!1);var e=Object.assign({},a);e.font=a.font||"bold 20pt Arial",e.backgroundColor=a.backgroundColor||null,e.fill=a.fill||"black",e.align=(a.align||"left").toLowerCase(),e.boundsAlignH=(a.boundsAlignH||"left").toLowerCase(),e.boundsAlignV=(a.boundsAlignV||"top").toLowerCase(),e.stroke=a.stroke||"black",e.strokeThickness=+a.strokeThickness||0,e.wordWrap=a.wordWrap||!1,e.wordWrapWidth=a.wordWrapWidth||100,e.maxLines=a.maxLines||0,e.shadowOffsetX=a.shadowOffsetX||0,e.shadowOffsetY=a.shadowOffsetY||0,e.shadowColor=a.shadowColor||"rgba(0,0,0,0)",e.shadowBlur=a.shadowBlur||0,e.tabs=a.tabs||0;var r=this.fontToComponents(e.font);return e.fontStyle&&(r.fontStyle=e.fontStyle),e.fontVariant&&(r.fontVariant=e.fontVariant),e.fontWeight&&(r.fontWeight=e.fontWeight),e.fontSize&&("number"==typeof e.fontSize&&(e.fontSize+="px"),r.fontSize=e.fontSize),this._fontComponents=r,e.font=this.componentsToFont(this._fontComponents),this.style=e,this.dirty=!0,t&&this.updateText(),this},z.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var x=this.text;-1<this.characterLimitSize&&this.characterLimitSize<x.length&&(x=this.text.substring(0,this.characterLimitSize)+this.characterLimitSuffix),this.style.wordWrap&&(x=this.runWordWrap(this.text));var t=x.split(this.splitRegExp),e=this.style.tabs,i=[],s=0,n=this.determineFontProperties(this.style.font),o=t.length;0<this.style.maxLines&&this.style.maxLines<t.length&&(o=this.style.maxLines),this._charCount=0;for(var r=0;r<o;r++){if(0===e)h=this.style.strokeThickness+this.padding.x,h+=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.measureLine(t[r]):this.context.measureText(t[r]).width,this.style.wordWrap&&(h-=this.context.measureText(" ").width);else{var a=t[r].split(/(?:\t)/),h=this.padding.x+this.style.strokeThickness;if(Array.isArray(e))for(var l=0,c=0,u;c<a.length;c++)u=0,u=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.measureLine(a[c]):y(this.context.measureText(a[c]).width),0<c&&(l+=e[c-1]),h=l+u;else for(c=0;c<a.length;c++)h+=0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.measureLine(a[c]):y(this.context.measureText(a[c]).width),h+=this.game.math.snapToCeil(h,e)-h}i[r]=y(h),s=C(s,i[r])}this.canvas.width=s*this._res;var d=n.fontSize+this.style.strokeThickness+this.padding.y,v=d*o,_=this._lineSpacing;0>_&&E(_)>d&&(_=-d),0!==_&&(v+=0<_?_*t.length:_*(t.length-1)),this.canvas.height=v*this._res,this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round";var g,m;for(this._charCount=0,r=0;r<o;r++)g=this.style.strokeThickness/2,m=this.style.strokeThickness/2+r*d+n.ascent,0<r&&(m+=_*r),"right"===this.style.align?g+=s-i[r]:"center"===this.style.align&&(g+=(s-i[r])/2),this.autoRound&&(g=f(g),m=f(m)),0<this.colors.length||0<this.strokeColors.length||0<this.fontWeights.length||0<this.fontStyles.length?this.updateLine(t[r],g,m):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),0===e?this.context.strokeText(t[r],g,m):this.renderTabLine(t[r],g,m,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===e?this.context.fillText(t[r],g,m):this.renderTabLine(t[r],g,m,!0)));this.updateTexture(),this.dirty=!1},z.Text.prototype.renderTabLine=function(d,t,e,i){var s=d.split(/(?:\t)/),n=this.style.tabs,o=0;if(Array.isArray(n))for(var r=0,a=0;a<s.length;a++)0<a&&(r+=n[a-1]),o=t+r,i?this.context.fillText(s[a],o,e):this.context.strokeText(s[a],o,e);else for(a=0;a<s.length;a++){var p=y(this.context.measureText(s[a]).width);o=this.game.math.snapToCeil(t,n),i?this.context.fillText(s[a],o,e):this.context.strokeText(s[a],o,e),t=o+p}},z.Text.prototype.updateShadow=function(e){e?(this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur):(this.context.shadowOffsetX=0,this.context.shadowOffsetY=0,this.context.shadowColor=0,this.context.shadowBlur=0)},z.Text.prototype.measureLine=function(a){for(var t=0,e=0,r;e<a.length;e++){if(r=a[e],0<this.fontWeights.length||0<this.fontStyles.length){var o=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(o.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(o.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(o)}this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill)),t+=this.context.measureText(r).width,this._charCount++}return y(t)},z.Text.prototype.updateLine=function(a,t,e){for(var r=0,i;r<a.length;r++){if(i=a[r],0<this.fontWeights.length||0<this.fontStyles.length){var n=this.fontToComponents(this.context.font);this.fontStyles[this._charCount]&&(n.fontStyle=this.fontStyles[this._charCount]),this.fontWeights[this._charCount]&&(n.fontWeight=this.fontWeights[this._charCount]),this.context.font=this.componentsToFont(n)}this.style.stroke&&this.style.strokeThickness&&(this.strokeColors[this._charCount]&&(this.context.strokeStyle=this.strokeColors[this._charCount]),this.updateShadow(this.style.shadowStroke),this.context.strokeText(i,t,e)),this.style.fill&&(this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount]),this.updateShadow(this.style.shadowFill),this.context.fillText(i,t,e)),t+=this.context.measureText(i).width,this._charCount++}},z.Text.prototype.clearColors=function(){return this.colors=[],this.strokeColors=[],this.dirty=!0,this},z.Text.prototype.clearFontValues=function(){return this.fontStyles=[],this.fontWeights=[],this.dirty=!0,this},z.Text.prototype.addColor=function(a,t){return this.colors[t]=a,this.dirty=!0,this},z.Text.prototype.addStrokeColor=function(a,t){return this.strokeColors[t]=a,this.dirty=!0,this},z.Text.prototype.addFontStyle=function(a,t){return this.fontStyles[t]=a,this.dirty=!0,this},z.Text.prototype.addFontWeight=function(a,t){return this.fontWeights[t]=a,this.dirty=!0,this},z.Text.prototype.precalculateWordWrap=function(e){return this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font,this.runWordWrap(e).split(/(?:\r\n|\r|\n)/)},z.Text.prototype.runWordWrap=function(e){return this.useAdvancedWrap?this.advancedWordWrap(e):this.basicWordWrap(e)},z.Text.prototype.advancedWordWrap=function(x){for(var t=this.context,e=this.style.wordWrapWidth,i="",s=x.replace(/ +/gi," ").split(/\r?\n/gi),n=s.length,o=0;o<n;o++){var r=s[o],a="";if(r=r.replace(/^ *|\s*$/gi,""),t.measureText(r).width<e)i+=r+"\n";else{for(var h=e,l=r.split(" "),c=0;c<l.length;c++){var u=l[c],d=u+" ",p=t.measureText(d).width;if(p>h){if(0===c){for(var f=d;f.length&&(f=f.slice(0,-1),!((p=t.measureText(f).width)<=h)););if(!f.length)throw new Error("This text's wordWrapWidth setting is less than a single character!");var g=u.substr(f.length);l[c]=g,a+=f}var m=l[c].length?c:c+1,y=l.slice(m).join(" ").replace(/[ \n]*$/gi,"");s[o+1]=y+" "+(s[o+1]||""),n=s.length;break}a+=d,h-=p}i+=a.replace(/[ \n]*$/gi,"")+"\n"}}return i=i.replace(/[\s|\n]*$/gi,"")},z.Text.prototype.basicWordWrap=function(d){for(var t="",e=d.split("\n"),i=0;i<e.length;i++){for(var s=this.style.wordWrapWidth,n=e[i].split(" "),o=0;o<n.length;o++){var r=this.context.measureText(n[o]).width,a=r+this.context.measureText(" ").width;a>s?(0<o&&(t+="\n"),t+=n[o]+" ",s=this.style.wordWrapWidth-r):(s-=a,t+=n[o]+" ")}i<e.length-1&&(t+="\n")}return t},z.Text.prototype.updateFont=function(a){var t=this.componentsToFont(a);this.style.font!==t&&(this.style.font=t,this.dirty=!0,this.parent&&this.updateTransform())},z.Text.prototype.fontToComponents=function(a){var r=a.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(r){var e=r[5].trim();return /^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(e)||/['",]/.exec(e)||(e="'"+e+"'"),{font:a,fontStyle:r[1]||"normal",fontVariant:r[2]||"normal",fontWeight:r[3]||"normal",fontSize:r[4]||"medium",fontFamily:e}}return console.warn("Phaser.Text - unparsable CSS font: "+a),{font:a}},z.Text.prototype.componentsToFont=function(a){var t=[],r;return(r=a.fontStyle)&&"normal"!==r&&t.push(r),(r=a.fontVariant)&&"normal"!==r&&t.push(r),(r=a.fontWeight)&&"normal"!==r&&t.push(r),(r=a.fontSize)&&"medium"!==r&&t.push(r),(r=a.fontFamily)&&t.push(r),t.length||t.push(a.font),t.join(" ")},z.Text.prototype.setText=function(a,t){return void 0===t&&(t=!1),(a=a.toString()||"")===this._text?this:(this.text=a,t?this.updateText():this.dirty=!0,this)},z.Text.prototype.parseList=function(a){if(!Array.isArray(a))return this;for(var t="",e=0;e<a.length;e++)Array.isArray(a[e])?(t+=a[e].join("\t"),e<a.length-1&&(t+="\n")):(t+=a[e],e<a.length-1&&(t+="\t"));return this.text=t,this.dirty=!0,this},z.Text.prototype.setTextBounds=function(a,t,e,r){return void 0===a?this.textBounds=null:(this.textBounds?this.textBounds.setTo(a,t,e,r):this.textBounds=new z.Rectangle(a,t,e,r),this.style.wordWrapWidth>e&&(this.style.wordWrapWidth=e)),this.updateTexture(),this},z.Text.prototype.updateTexture=function(){var a=this.texture.baseTexture,t=this.texture.crop,e=this.texture.frame,i=this.canvas.width,s=this.canvas.height;if(a.width=i,a.height=s,t.width=i,t.height=s,e.width=i,e.height=s,this.texture.width=i,this.texture.height=s,this._width=i,this._height=s,this.textBounds){var n=this.textBounds.x,d=this.textBounds.y;"right"===this.style.boundsAlignH?n+=this.textBounds.width-this.canvas.width/this.resolution:"center"===this.style.boundsAlignH&&(n+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2),"bottom"===this.style.boundsAlignV?d+=this.textBounds.height-this.canvas.height/this.resolution:"middle"===this.style.boundsAlignV&&(d+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2),this.pivot.x=-n,this.pivot.y=-d}this.renderable=0!==i&&0!==s,this.texture.requiresReTint=!0,this.texture.baseTexture.dirty()},z.Text.prototype._renderWebGL=function(e){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderWebGL.call(this,e)},z.Text.prototype._renderCanvas=function(e){this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype._renderCanvas.call(this,e)},z.Text.prototype.determineFontProperties=function(i){var t=z.Text.fontPropertiesCache[i],m=this.testString||"|M\xC9q";if(!t){t={};var s=z.Text.fontPropertiesCanvas,n=z.Text.fontPropertiesContext;n.font=i;var o=y(n.measureText(m).width),r=y(n.measureText(m).width),a=2*r;if(r=0|1.4*r,s.width=o,s.height=a,n.fillStyle="#f00",n.fillRect(0,0,o,a),n.font=i,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(m,0,r),!n.getImageData(0,0,o,a))return t.ascent=r,t.descent=r+6,t.fontSize=t.ascent+t.descent,z.Text.fontPropertiesCache[i]=t,t;var h=n.getImageData(0,0,o,a).data,u=h.length,d=4*o,p=0,f=!1,g,l;for(g=0;g<r;g++){for(l=0;l<d;l+=4)if(255!==h[p+l]){f=!0;break}if(f)break;p+=d}for(t.ascent=r-g,p=u-d,f=!1,g=a;g>r;g--){for(l=0;l<d;l+=4)if(255!==h[p+l]){f=!0;break}if(f)break;p-=d}t.descent=g-r,t.descent+=6,t.fontSize=t.ascent+t.descent,z.Text.fontPropertiesCache[i]=t}return t},z.Text.prototype.getBounds=function(e){return this.dirty&&(this.updateText(),this.dirty=!1),PIXI.Sprite.prototype.getBounds.call(this,e)},z.Text.prototype.setCharacterLimit=function(a,t){this.characterLimitSuffix=void 0===t?"":t,this.characterLimitSize=a,this.updateText()},Object.defineProperty(z.Text.prototype,"text",{get:function(){return this._text},set:function(e){e!==this._text&&(this._text=e.toString()||"",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(z.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(e){e=e||"bold 20pt Arial",this._fontComponents=this.fontToComponents(e),this.updateFont(this._fontComponents)}}),Object.defineProperty(z.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(e){e=(e=e||"Arial").trim(),/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(e)||/['",]/.exec(e)||(e="'"+e+"'"),this._fontComponents.fontFamily=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(z.Text.prototype,"fontSize",{get:function(){var e=this._fontComponents.fontSize;return e&&/(?:^0$|px$)/.exec(e)?parseInt(e,10):e},set:function(e){"number"==typeof(e=e||"0")&&(e+="px"),this._fontComponents.fontSize=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(z.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(e){e=e||"normal",this._fontComponents.fontWeight=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(z.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(e){e=e||"normal",this._fontComponents.fontStyle=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(z.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(e){e=e||"normal",this._fontComponents.fontVariant=e,this.updateFont(this._fontComponents)}}),Object.defineProperty(z.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(e){e!==this.style.fill&&(this.style.fill=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"align",{get:function(){return this.style.align},set:function(e){(e=e.toLowerCase())!==this.style.align&&(this.style.align=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"resolution",{get:function(){return this._res},set:function(e){e!==this._res&&(this._res=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(e){e!==this.style.tabs&&(this.style.tabs=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(e){(e=e.toLowerCase())!==this.style.boundsAlignH&&(this.style.boundsAlignH=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(e){(e=e.toLowerCase())!==this.style.boundsAlignV&&(this.style.boundsAlignV=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(e){e!==this.style.stroke&&(this.style.stroke=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(e){e!==this.style.strokeThickness&&(this.style.strokeThickness=+e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(e){e!==this.style.wordWrap&&(this.style.wordWrap=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(e){e!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(e){e!==this._lineSpacing&&(this._lineSpacing=parseFloat(e),this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(z.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(e){e!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(e){e!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(e){e!==this.style.shadowColor&&(this.style.shadowColor=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(e){e!==this.style.shadowBlur&&(this.style.shadowBlur=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(e){e!==this.style.shadowStroke&&(this.style.shadowStroke=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(e){e!==this.style.shadowFill&&(this.style.shadowFill=e,this.dirty=!0)}}),Object.defineProperty(z.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*(this.texture.frame.width/this.resolution)},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(z.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*(this.texture.frame.height/this.resolution)},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),Object.defineProperty(z.Text.prototype,"testString",{get:function(){return this._testString},set:function(e){this._testString=e,this.updateText()}}),z.Text.fontPropertiesCache={},z.Text.fontPropertiesCanvas=document.createElement("canvas"),z.Text.fontPropertiesContext=z.Text.fontPropertiesCanvas.getContext("2d"),z.BitmapText=function(i,t,e,s,n,o,r){t=t||0,e=e||0,s=s||"",n=n||"",o=o||32,r=r||"left",PIXI.DisplayObjectContainer.call(this),this.type=z.BITMAPTEXT,this.physicsType=z.SPRITE,this.textWidth=0,this.textHeight=0,this.anchor=new z.Point,this._prevAnchor=new z.Point,this._glyphs=[],this._maxWidth=0,this._text=n.toString()||"",this._data=i.cache.getBitmapFont(s),this._font=s,this._fontSize=o,this._align=r,this._tint=16777215,this.updateText(),this.dirty=!1,z.Component.Core.init.call(this,i,t,e,"",null)},z.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),z.BitmapText.prototype.constructor=z.BitmapText,z.Component.Core.install.call(z.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]),z.BitmapText.prototype.preUpdatePhysics=z.Component.PhysicsBody.preUpdate,z.BitmapText.prototype.preUpdateLifeSpan=z.Component.LifeSpan.preUpdate,z.BitmapText.prototype.preUpdateInWorld=z.Component.InWorld.preUpdate,z.BitmapText.prototype.preUpdateCore=z.Component.Core.preUpdate,z.BitmapText.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},z.BitmapText.prototype.postUpdate=function(){z.Component.PhysicsBody.postUpdate.call(this),z.Component.FixedToCamera.postUpdate.call(this),this.body&&this.body.type===z.Physics.ARCADE&&(this.textWidth===this.body.sourceWidth&&this.textHeight===this.body.sourceHeight||this.body.setSize(this.textWidth,this.textHeight))},z.BitmapText.prototype.setText=function(e){this.text=e},z.BitmapText.prototype.scanLine=function(m,t,e){for(var y=0,s=0,x=-1,o=0,r=null,a=0<this._maxWidth?this._maxWidth:null,h=[],v=0,c;v<e.length;v++){if(c=v===e.length-1,/(?:\r\n|\r|\n)/.test(e.charAt(v)))return{width:s,text:e.substr(0,v),end:c,chars:h};var _=e.charCodeAt(v),d=m.chars[_],p=0;void 0===d&&(_=32,d=m.chars[_]);var f=r&&d.kerning[r]?d.kerning[r]:0;if(/(\s)/.test(e.charAt(v))&&(x=v,o=s),p=(f+d.texture.width+d.xOffset)*t,a&&s+p>=a&&-1<x)return{width:o||s,text:e.substr(0,v-(v-x)),end:!1,chars:h};s+=(d.xAdvance+f)*t,h.push(y+(d.xOffset+f)*t),y+=(d.xAdvance+f)*t,r=_}return{width:s,text:e,end:c,chars:h}},z.BitmapText.prototype.cleanText=function(d,t){void 0===t&&(t="");var e=this._data.font;if(!e)return"";for(var l=/\r\n|\n\r|\n|\r/g,s=d.replace(l,"\n").split("\n"),n=0;n<s.length;n++){for(var o="",r=s[n],a=0;a<r.length;a++)o=e.chars[r.charCodeAt(a)]?o.concat(r[a]):o.concat(t);s[n]=o}return s.join("\n")},z.BitmapText.prototype.updateText=function(){var m=this._data.font;if(m){var t=this.text,e=this._fontSize/m.size,i=[],s=0;this.textWidth=0;do(l=this.scanLine(m,e,t)).y=s,i.push(l),l.width>this.textWidth&&(this.textWidth=l.width),s+=m.lineHeight*e,t=t.substr(l.text.length+1);while(!1===l.end);this.textHeight=s;for(var n=0,o=0,r=this.textWidth*this.anchor.x,a=this.textHeight*this.anchor.y,g=0,l;g<i.length;g++){l=i[g],"right"===this._align?o=this.textWidth-l.width:"center"===this._align&&(o=(this.textWidth-l.width)/2);for(var c=0;c<l.text.length;c++){var u=l.text.charCodeAt(c),d=m.chars[u];void 0===d&&(u=32,d=m.chars[u]);var p=this._glyphs[n];p?p.texture=d.texture:((p=new PIXI.Sprite(d.texture)).name=l.text[c],this._glyphs.push(p)),p.position.x=l.chars[c]+o-r,p.position.y=l.y+d.yOffset*e-a,p.scale.set(e),p.tint=this.tint,p.texture.requiresReTint=!0,p.cachedTint=16777215,p.parent||this.addChild(p),n++}}for(g=n;g<this._glyphs.length;g++)this.removeChild(this._glyphs[g])}},z.BitmapText.prototype.purgeGlyphs=function(){for(var a=this._glyphs.length,t=[],e=0;e<this._glyphs.length;e++)this._glyphs[e].parent===this?t.push(this._glyphs[e]):this._glyphs[e].destroy();return this._glyphs=[],this._glyphs=t,this.updateText(),a-t.length},z.BitmapText.prototype.updateTransform=function(){!this.dirty&&this.anchor.equals(this._prevAnchor)||(this.updateText(),this.dirty=!1,this._prevAnchor.copyFrom(this.anchor)),PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},Object.defineProperty(z.BitmapText.prototype,"align",{get:function(){return this._align},set:function(e){e===this._align||"left"!==e&&"center"!==e&&"right"!==e||(this._align=e,this.updateText())}}),Object.defineProperty(z.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(e){e!==this._tint&&(this._tint=e,this.updateText())}}),Object.defineProperty(z.BitmapText.prototype,"font",{get:function(){return this._font},set:function(e){e!==this._font&&(this._font=e.trim(),this._data=this.game.cache.getBitmapFont(this._font),this.updateText())}}),Object.defineProperty(z.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){(e=parseInt(e,10))!==this._fontSize&&0<e&&(this._fontSize=e,this.updateText())}}),Object.defineProperty(z.BitmapText.prototype,"text",{get:function(){return this._text},set:function(e){e!==this._text&&(this._text=e.toString()||"",this.updateText())}}),Object.defineProperty(z.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(e){e!==this._maxWidth&&(this._maxWidth=e,this.updateText())}}),Object.defineProperty(z.BitmapText.prototype,"smoothed",{get:function(){return!this._data.base.scaleMode},set:function(e){this._data.base.scaleMode=e?0:1,this._data.base.dirty()}}),z.RetroFont=function(i,t,e,s,n,o,r,a,m,l){if(!i.cache.checkImageKey(t))return!1;void 0!==o&&null!==o||(o=i.cache.getImage(t).width/e),this.characterWidth=e,this.characterHeight=s,this.characterSpacingX=r||0,this.characterSpacingY=a||0,this.characterPerRow=o,this.offsetX=m||0,this.offsetY=l||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=i.cache.getImage(t),this._text="",this.grabData=[],this.frameData=new z.FrameData;for(var c=this.offsetX,u=this.offsetY,d=0,p=0,h;p<n.length;p++)h=this.frameData.addFrame(new z.Frame(p,c,u,this.characterWidth,this.characterHeight)),this.grabData[n.charCodeAt(p)]=h.index,++d===this.characterPerRow?(d=0,c=this.offsetX,u+=this.characterHeight+this.characterSpacingY):c+=this.characterWidth+this.characterSpacingX;i.cache.updateFrameData(t,this.frameData),this.stamp=new z.Image(i,0,0,t,0),z.RenderTexture.call(this,i,100,100,"",z.scaleModes.NEAREST),this.type=z.RETROFONT},z.RetroFont.prototype=Object.create(z.RenderTexture.prototype),z.RetroFont.prototype.constructor=z.RetroFont,z.RetroFont.ALIGN_LEFT="left",z.RetroFont.ALIGN_RIGHT="right",z.RetroFont.ALIGN_CENTER="center",z.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",z.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",z.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",z.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",z.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",z.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",z.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",z.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",z.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",z.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ",z.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789",z.RetroFont.prototype.setFixedWidth=function(a,t){void 0===t&&(t="left"),this.fixedWidth=a,this.align=t},z.RetroFont.prototype.setText=function(a,t,e,r,i,n){this.multiLine=t||!1,this.customSpacingX=e||0,this.customSpacingY=r||0,this.align=i||"left",this.autoUpperCase=!n,0<a.length&&(this.text=a)},z.RetroFont.prototype.buildRetroFontText=function(){var a=0,t=0;if(this.clear(),this.multiLine){var e=this._text.split("\n");0<this.fixedWidth?this.resize(this.fixedWidth,e.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),e.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var r=0;r<e.length;r++)a=0,this.align===z.RetroFont.ALIGN_RIGHT?a=this.width-e[r].length*(this.characterWidth+this.customSpacingX):this.align===z.RetroFont.ALIGN_CENTER&&(a=this.width/2-e[r].length*(this.characterWidth+this.customSpacingX)/2,a+=this.customSpacingX/2),0>a&&(a=0),this.pasteLine(e[r],a,t,this.customSpacingX),t+=this.characterHeight+this.customSpacingY}else 0<this.fixedWidth?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),a=0,this.align===z.RetroFont.ALIGN_RIGHT?a=this.width-this._text.length*(this.characterWidth+this.customSpacingX):this.align===z.RetroFont.ALIGN_CENTER&&(a=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,a+=this.customSpacingX/2),0>a&&(a=0),this.pasteLine(this._text,a,0,this.customSpacingX);this.requiresReTint=!0},z.RetroFont.prototype.pasteLine=function(a,t,e,r){for(var o=0;o<a.length;o++)if(" "===a.charAt(o))t+=this.characterWidth+r;else if(0<=this.grabData[a.charCodeAt(o)]&&(this.stamp.frame=this.grabData[a.charCodeAt(o)],this.renderXY(this.stamp,t,e,!1),(t+=this.characterWidth+r)>this.width))break},z.RetroFont.prototype.getLongestLine=function(){var a=0;if(0<this._text.length)for(var t=this._text.split("\n"),e=0;e<t.length;e++)t[e].length>a&&(a=t[e].length);return a},z.RetroFont.prototype.removeUnsupportedCharacters=function(a){for(var r="",e=0;e<this._text.length;e++){var o=this._text[e],i=o.charCodeAt(0);(0<=this.grabData[i]||!a&&"\n"===o)&&(r=r.concat(o))}return r},z.RetroFont.prototype.updateOffset=function(a,t){if(this.offsetX!==a||this.offsetY!==t){for(var e=a-this.offsetX,r=t-this.offsetY,i=this.game.cache.getFrameData(this.stamp.key).getFrames(),n=i.length;n--;)i[n].x+=e,i[n].y+=r;this.buildRetroFontText()}},Object.defineProperty(z.RetroFont.prototype,"text",{get:function(){return this._text},set:function(a){var t;(t=this.autoUpperCase?a.toUpperCase():a)!==this._text&&(this._text=t,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}}),Object.defineProperty(z.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(e){this.stamp.smoothed=e,this.buildRetroFontText()}}),z.Rope=function(a,t,e,i,n,o){this.points=o||[],this._hasUpdateAnimation=!1,this._updateAnimationCallback=null,t=t||0,e=e||0,i=i||null,n=n||null,this.type=z.ROPE,PIXI.DisplayObjectContainer.call(this),this.texture=z.Cache.DEFAULT,this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.vertices=new Float32Array([0,0,100,0,100,100,0,100]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3]),o&&(this.vertices=new Float32Array(4*o.length),this.uvs=new Float32Array(4*o.length),this.colors=new Float32Array(2*o.length),this.indices=new Uint16Array(2*o.length)),this.dirty=!0,this.canvasPadding=0,this.drawMode=z.Rope.TRIANGLE_STRIP,z.Component.Core.init.call(this,a,t,e,i,n),this.refresh()},z.Rope.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),z.Rope.prototype.constructor=z.Rope,z.Component.Core.install.call(z.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]),z.Rope.prototype.preUpdatePhysics=z.Component.PhysicsBody.preUpdate,z.Rope.prototype.preUpdateLifeSpan=z.Component.LifeSpan.preUpdate,z.Rope.prototype.preUpdateInWorld=z.Component.InWorld.preUpdate,z.Rope.prototype.preUpdateCore=z.Component.Core.preUpdate,z.Rope.TRIANGLE_STRIP=0,z.Rope.TRIANGLES=1,z.Rope.prototype.preUpdate=function(){return!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},z.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)},z.Rope.prototype.reset=function(a,t){return z.Component.Reset.prototype.reset.call(this,a,t),this},z.Rope.prototype.refresh=function(){var d=this.points;if(!(1>d.length)){var t=this.uvs,e=this.indices,i=this.colors;this.count-=.2,t[0]=0,t[1]=0,t[2]=0,t[3]=1,i[0]=1,i[1]=1,e[0]=0,e[1]=1;for(var s=d.length,r=1,a,n;r<s;r++)n=r/(s-1),t[a=4*r]=n,t[a+1]=0,t[a+2]=n,t[a+3]=1,i[a=2*r]=1,i[a+1]=1,e[a=2*r]=a,e[a+1]=a+1}},z.Rope.prototype.updateTransform=function(){var d=this.points;if(!(1>d.length)){var t=d[0],i={x:0,y:0},s;this.count-=.2;for(var e=this.vertices,p=d.length,l=0,c,n,o,r;l<p;l++)c=d[l],n=4*l,s=l<d.length-1?d[l+1]:c,i.y=-(s.x-t.x),i.x=s.y-t.y,1<10*(1-l/(p-1))&&1,o=F(i.x*i.x+i.y*i.y),r=this.texture.height/2,i.x/=o,i.y/=o,i.x*=r,i.y*=r,e[n]=c.x+i.x,e[n+1]=c.y+i.y,e[n+2]=c.x-i.x,e[n+3]=c.y-i.y,t=c;PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)}},z.Rope.prototype.setTexture=function(e){this.texture=e},z.Rope.prototype._renderWebGL=function(e){!this.visible||0>=this.alpha||(e.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(e),e.shaderManager.setShader(e.shaderManager.stripShader),this._renderStrip(e),e.spriteBatch.start())},z.Rope.prototype._initWebGL=function(a){var t=a.gl;this._vertexBuffer=t.createBuffer(),this._indexBuffer=t.createBuffer(),this._uvBuffer=t.createBuffer(),this._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},z.Rope.prototype._renderStrip=function(a){var t=a.gl,e=a.projection,i=a.offset,n=a.shaderManager.stripShader,o=this.drawMode===z.Rope.TRIANGLE_STRIP?t.TRIANGLE_STRIP:t.TRIANGLES;a.blendModeManager.setBlendMode(this.blendMode),t.uniformMatrix3fv(n.translationMatrix,!1,this.worldTransform.toArray(!0)),t.uniform2f(n.projectionVector,e.x,-e.y),t.uniform2f(n.offsetVector,-i.x,-i.y),t.uniform1f(n.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.STATIC_DRAW),t.vertexAttribPointer(n.aVertexPosition,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW),t.vertexAttribPointer(n.aTextureCoord,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),this.texture.baseTexture._dirty[t.id]?a.renderer.updateTexture(this.texture.baseTexture):t.bindTexture(t.TEXTURE_2D,this.texture.baseTexture._glTextures[t.id]),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)):(t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices),t.vertexAttribPointer(n.aVertexPosition,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.vertexAttribPointer(n.aTextureCoord,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),this.texture.baseTexture._dirty[t.id]?a.renderer.updateTexture(this.texture.baseTexture):t.bindTexture(t.TEXTURE_2D,this.texture.baseTexture._glTextures[t.id]),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),t.drawElements(o,this.indices.length,t.UNSIGNED_SHORT,0)},z.Rope.prototype._renderCanvas=function(a){var t=a.context,e=this.worldTransform,r=e.tx*a.resolution+a.shakeX,n=e.ty*a.resolution+a.shakeY;a.roundPixels?t.setTransform(e.a,e.b,e.c,e.d,0|r,0|n):t.setTransform(e.a,e.b,e.c,e.d,r,n),this.drawMode===z.Rope.TRIANGLE_STRIP?this._renderCanvasTriangleStrip(t):this._renderCanvasTriangles(t)},z.Rope.prototype._renderCanvasTriangleStrip=function(a){var t=this.vertices,e=this.uvs,r=t.length/2;this.count++;for(var i=0,n;i<r-2;i++)n=2*i,this._renderCanvasDrawTriangle(a,t,e,n,n+2,n+4)},z.Rope.prototype._renderCanvasTriangles=function(d){var t=this.vertices,e=this.uvs,i=this.indices,s=i.length;this.count++;for(var n=0;n<s;n+=3){var o=2*i[n],r=2*i[n+1],a=2*i[n+2];this._renderCanvasDrawTriangle(d,t,e,o,r,a)}},z.Rope.prototype._renderCanvasDrawTriangle=function(B,t,e,i,s,n){var o=this.texture.baseTexture.source,r=this.texture.width,a=this.texture.height,h=t[i],l=t[s],c=t[n],u=t[i+1],d=t[s+1],p=t[n+1],f=e[i]*r,g=e[s]*r,m=e[n]*r,y=e[i+1]*a,v=e[s+1]*a,x=e[n+1]*a;if(0<this.canvasPadding){var b=this.canvasPadding/this.worldTransform.a,_=this.canvasPadding/this.worldTransform.d,w=(h+l+c)/3,T=(u+d+p)/3,P=h-w,C=u-T,S=F(P*P+C*C);h=w+P/S*(S+b),u=T+C/S*(S+_),C=d-T,l=w+(P=l-w)/(S=F(P*P+C*C))*(S+b),d=T+C/S*(S+_),C=p-T,c=w+(P=c-w)/(S=F(P*P+C*C))*(S+b),p=T+C/S*(S+_)}B.save(),B.beginPath(),B.moveTo(h,u),B.lineTo(l,d),B.lineTo(c,p),B.closePath(),B.clip();var D=f*v+y*m+g*x-v*m-y*g-f*x,A=h*v+y*c+l*x-v*c-y*l-h*x,M=f*l+h*m+g*c-l*m-h*g-f*c,O=f*v*c+y*l*m+h*g*x-h*v*m-y*g*c-f*l*x,I=u*v+y*p+d*x-v*p-y*d-u*x,E=f*d+u*m+g*p-d*m-u*g-f*p,R=f*v*p+y*d*m+u*g*x-u*v*m-y*g*p-f*d*x;B.transform(A/D,I/D,M/D,E/D,O/D,R/D),B.drawImage(o,0,0),B.restore()},z.Rope.prototype.renderStripFlat=function(d){var t=this.context,e=d.vertices,i=e.length/2;this.count++,t.beginPath();for(var s=1;s<i-2;s++){var n=2*s,o=e[n],r=e[n+2],a=e[n+4],p=e[n+1],l=e[n+3],c=e[n+5];t.moveTo(o,p),t.lineTo(r,l),t.lineTo(a,c)}t.fillStyle="#FF0000",t.fill(),t.closePath()},z.Rope.prototype.getBounds=function(x){for(var t=x||this.worldTransform,e=t.a,i=t.b,s=t.c,n=t.d,o=t.tx,r=t.ty,a=-1/0,h=-1/0,l=1/0,c=1/0,u=this.vertices,d=0;d<u.length;d+=2){var p=u[d],f=u[d+1],g=e*p+s*f+o,m=n*f+i*p+r;l=g<l?g:l,c=m<c?m:c,a=g>a?g:a,h=m>h?m:h}if(l===-1/0||h===1/0)return PIXI.EmptyRectangle;var y=this._bounds;return y.x=l,y.width=a-l,y.y=c,y.height=h-c,this._currentBounds=y,y},Object.defineProperty(z.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(e){e&&"function"==typeof e?(this._hasUpdateAnimation=!0,this._updateAnimation=e):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}}),Object.defineProperty(z.Rope.prototype,"segments",{get:function(){for(var i=[],d=0,l,t,e,s,n,o,r,a;d<this.points.length;d++)l=4*d,t=this.vertices[l]*this.scale.x,e=this.vertices[l+1]*this.scale.y,s=this.vertices[l+4]*this.scale.x,n=this.vertices[l+3]*this.scale.y,o=z.Math.difference(t,s),r=z.Math.difference(e,n),t+=this.world.x,e+=this.world.y,a=new z.Rectangle(t,e,o,r),i.push(a);return i}}),z.TileSprite=function(i,t,e,s,n,o,r){t=t||0,e=e||0,s=s||256,n=n||256,o=o||null,r=r||null,PIXI.Sprite.call(this,new PIXI.Texture(z.Cache.DEFAULT.baseTexture),s,n),this.type=z.TILESPRITE,this.physicsType=z.SPRITE,this._scroll=new z.Point,this.tileScale=new z.Point(1,1),this.tileScaleOffset=new z.Point(1,1),this.tilePosition=new z.Point,this.textureDebug=!1,this.canvasBuffer=null,this.tilingTexture=null,this.tilePattern=null,this.refreshTexture=!0,this.frameWidth=0,this.frameHeight=0,this._width=s,this._height=n,z.Component.Core.init.call(this,i,t,e,o,r)},z.TileSprite.prototype=Object.create(PIXI.Sprite.prototype),z.TileSprite.prototype.constructor=z.TileSprite,z.Component.Core.install.call(z.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]),z.TileSprite.prototype.preUpdatePhysics=z.Component.PhysicsBody.preUpdate,z.TileSprite.prototype.preUpdateLifeSpan=z.Component.LifeSpan.preUpdate,z.TileSprite.prototype.preUpdateInWorld=z.Component.InWorld.preUpdate,z.TileSprite.prototype.preUpdateCore=z.Component.Core.preUpdate,z.TileSprite.prototype.preUpdate=function(){return 0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),!!(this.preUpdatePhysics()&&this.preUpdateLifeSpan()&&this.preUpdateInWorld())&&this.preUpdateCore()},z.TileSprite.prototype.autoScroll=function(a,t){return this._scroll.set(a,t),this},z.TileSprite.prototype.stopScroll=function(){return this._scroll.set(0,0),this},z.TileSprite.prototype.destroy=function(e){z.Component.Destroy.prototype.destroy.call(this,e),PIXI.Sprite.prototype.destroy.call(this),this.canvasBuffer&&(this.canvasBuffer.destroy(),this.canvasBuffer=null),this.tileScale=null,this.tileScaleOffset=null,this.tilePosition=null,this.tilingTexture&&(this.tilingTexture.destroy(!0),this.tilingTexture=null)},z.TileSprite.prototype.reset=function(a,t){return z.Component.Reset.prototype.reset.call(this,a,t),this.tilePosition.x=0,this.tilePosition.y=0,this},z.TileSprite.prototype.setTexture=function(e){return this.texture!==e&&(this.texture=e,this.refreshTexture=!0,this.cachedTint=16777215),this},z.TileSprite.prototype._renderWebGL=function(a){if(this.visible&&this.renderable&&0!==this.alpha){if(this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),this.refreshTexture){if(this.generateTilingTexture(!0,a),!this.tilingTexture)return;this.tilingTexture.needsUpdate&&(this.tilingTexture.baseTexture.textureIndex=this.texture.baseTexture.textureIndex,a.renderer.updateTexture(this.tilingTexture.baseTexture),this.tilingTexture.needsUpdate=!1)}a.spriteBatch.renderTilingSprite(this);for(var t=0;t<this.children.length;t++)this.children[t]._renderWebGL(a);var e=!1;this._filters&&(e=!0,a.spriteBatch.stop(),a.filterManager.popFilter()),this._mask&&(e||a.spriteBatch.stop(),a.maskManager.popMask(this._mask,a)),e&&a.spriteBatch.start()}},z.TileSprite.prototype._renderCanvas=function(d){if(this.visible&&this.renderable&&0!==this.alpha){var t=d.context;this._mask&&d.maskManager.pushMask(this._mask,d),t.globalAlpha=this.worldAlpha;var e=this.worldTransform,i=d.resolution,s=e.tx*i+d.shakeX,n=e.ty*i+d.shakeY;if(t.setTransform(e.a*i,e.b*i,e.c*i,e.d*i,s,n),16777215===this.tint||!this.texture.requiresReTint&&this.cachedTint===this.tint||(this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint),this.cachedTint=this.tint,this.texture.requiresReTint=!1,this.refreshTexture=!0),this.refreshTexture){if(this.generateTilingTexture(!1,d),!this.tilingTexture)return;this.tilePattern=t.createPattern(this.tilingTexture.baseTexture.source,"repeat")}var o=d.currentBlendMode;this.blendMode!==d.currentBlendMode&&(d.currentBlendMode=this.blendMode,t.globalCompositeOperation=PIXI.blendModesCanvas[d.currentBlendMode]);var r=this.tilePosition,a=this.tileScale;r.x%=this.tilingTexture.baseTexture.width,r.y%=this.tilingTexture.baseTexture.height,t.scale(a.x,a.y),t.translate(r.x+this.anchor.x*-this._width,r.y+this.anchor.y*-this._height),t.fillStyle=this.tilePattern,s=-r.x,n=-r.y;var p=this._width/a.x,l=this._height/a.y;d.roundPixels&&(s|=0,n|=0,p|=0,l|=0),t.fillRect(s,n,p,l),t.scale(1/a.x,1/a.y),t.translate(-r.x+this.anchor.x*this._width,-r.y+this.anchor.y*this._height),this._mask&&d.maskManager.popMask(d);for(var c=0;c<this.children.length;c++)this.children[c]._renderCanvas(d);o!==this.blendMode&&(d.currentBlendMode=o,t.globalCompositeOperation=PIXI.blendModesCanvas[o])}},z.TileSprite.prototype.onTextureUpdate=function(){},z.TileSprite.prototype.generateTilingTexture=function(i){if(this.texture.baseTexture.hasLoaded){var t=this.texture,e=t.frame,s=this._frame.sourceSizeW||this._frame.width,n=this._frame.sourceSizeH||this._frame.height,o=0,r=0;this._frame.trimmed&&(o=this._frame.spriteSourceSizeX,r=this._frame.spriteSourceSizeY),i&&(s=z.Math.getNextPowerOfTwo(s),n=z.Math.getNextPowerOfTwo(n)),this.canvasBuffer?(this.canvasBuffer.resize(s,n),this.tilingTexture.baseTexture.width=s,this.tilingTexture.baseTexture.height=n,this.tilingTexture.needsUpdate=!0):(this.canvasBuffer=new PIXI.CanvasBuffer(s,n),this.tilingTexture=PIXI.Texture.fromCanvas(this.canvasBuffer.canvas),this.tilingTexture.isTiling=!0,this.tilingTexture.needsUpdate=!0),this.textureDebug&&(this.canvasBuffer.context.strokeStyle="#00ff00",this.canvasBuffer.context.strokeRect(0,0,s,n));var a=t.crop.width,d=t.crop.height;a===s&&d===n||(a=s,d=n);var l=this.tintedTexture?this.tintedTexture:t.baseTexture.source;this.canvasBuffer.context.drawImage(l,t.crop.x,t.crop.y,t.crop.width,t.crop.height,o,r,a,d),this.tileScaleOffset.x=e.width/s,this.tileScaleOffset.y=e.height/n,this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0}},z.TileSprite.prototype.getBounds=function(){var S=this._width,t=this._height,e=S*(1-this.anchor.x),i=S*-this.anchor.x,s=t*(1-this.anchor.y),n=t*-this.anchor.y,o=this.worldTransform,r=o.a,a=o.b,h=o.c,l=o.d,c=o.tx,u=o.ty,d=r*i+h*n+c,p=l*n+a*i+u,f=r*e+h*n+c,g=l*n+a*e+u,m=r*e+h*s+c,y=l*s+a*e+u,v=r*i+h*s+c,x=l*s+a*i+u,b=-1/0,_=-1/0,E=1/0,T=1/0;E=v<(E=m<(E=f<(E=d<E?d:E)?f:E)?m:E)?v:E,T=x<(T=y<(T=g<(T=p<T?p:T)?g:T)?y:T)?x:T,b=v>(b=m>(b=f>(b=d>b?d:b)?f:b)?m:b)?v:b,_=x>(_=y>(_=g>(_=p>_?p:_)?g:_)?y:_)?x:_;var P=this._bounds;return P.x=E,P.width=b-E,P.y=T,P.height=_-T,this._currentBounds=P,P},Object.defineProperty(z.TileSprite.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e}}),Object.defineProperty(z.TileSprite.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e}}),z.CanvasPool={create:function(a,i,e){var s=z.CanvasPool.getFirst(),o;if(-1===s){var n={parent:a,canvas:document.createElement("canvas")};z.CanvasPool.pool.push(n),o=n.canvas}else z.CanvasPool.pool[s].parent=a,o=z.CanvasPool.pool[s].canvas;return void 0!==i&&(o.width=i,o.height=e),o},getFirst:function(){for(var a=z.CanvasPool.pool,t=0;t<a.length;t++)if(!a[t].parent)return t;return-1},remove:function(a){for(var t=z.CanvasPool.pool,e=0;e<t.length;e++)t[e].parent===a&&(t[e].parent=null,t[e].canvas.width=1,t[e].canvas.height=1)},removeByCanvas:function(a){for(var t=z.CanvasPool.pool,e=0;e<t.length;e++)t[e].canvas===a&&(t[e].parent=null,t[e].canvas.width=1,t[e].canvas.height=1)},getTotal:function(){for(var a=z.CanvasPool.pool,t=0,e=0;e<a.length;e++)a[e].parent&&t++;return t},getFree:function(){for(var a=z.CanvasPool.pool,t=0,e=0;e<a.length;e++)a[e].parent||t++;return t},log:function(){console.log("CanvasPool: %s used, %s free, %s total",this.getTotal(),this.getFree(),this.pool.length)}},z.CanvasPool.pool=[],Object.defineProperty(z.CanvasPool,"length",{get:function(){return this.pool.length}}),z.Device=function(){this.deviceReadyAt=0,this.initialized=!1,this.desktop=!1,this.iOS=!1,this.iOSVersion=0,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.electron=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.canvasBitBltShift=null,this.canHandleAlpha=!1,this.canUseMultiply=!1,this.webGL=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.worker=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!0,this.quirksMode=!1,this.touch=!1,this.mspointer=!1,this.wheelEvent=null,this.arora=!1,this.chrome=!1,this.chromeVersion=0,this.epiphany=!1,this.firefox=!1,this.firefoxVersion=0,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.edge=!1,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.safariVersion=0,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.dolby=!1,this.oggVideo=!1,this.h264Video=!1,this.mp4Video=!1,this.webmVideo=!1,this.vp9Video=!1,this.hlsVideo=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.LITTLE_ENDIAN=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1},z.Device=new z.Device,z.Device.onInitialized=new z.Signal,z.Device.whenReady=function(a,t,e){var r=this._readyCheck;if(this.deviceReadyAt||!r)a.call(t,this);else if(r._monitor||e)r._queue=r._queue||[],r._queue.push([a,t]);else{r._monitor=r.bind(this),r._queue=r._queue||[],r._queue.push([a,t]);var i=void 0!==window.cordova,n=navigator.isCocoonJS;"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(r._monitor,0):i&&!n?document.addEventListener("deviceready",r._monitor,!1):(document.addEventListener("DOMContentLoaded",r._monitor,!1),window.addEventListener("load",r._monitor,!1))}},z.Device._readyCheck=function(){var a=this._readyCheck;if(!document.body)window.setTimeout(a._monitor,20);else if(!this.deviceReadyAt){this.deviceReadyAt=Date.now(),document.removeEventListener("deviceready",a._monitor),document.removeEventListener("DOMContentLoaded",a._monitor),window.removeEventListener("load",a._monitor),this._initialize(),this.initialized=!0,this.onInitialized.dispatch(this);for(var t;t=a._queue.shift();){var e=t[0],r=t[1];e.call(r,this)}this._readyCheck=null,this._initialize=null,this.onInitialized=null}},z.Device._initialize=function(){function a(){var a=new ArrayBuffer(4),r=new Uint8Array(a),e=new Uint32Array(a);return r[0]=161,r[1]=178,r[2]=195,r[3]=212,3569595041===e[0]||2712847316!==e[0]&&null}function t(){if(void 0===Uint8ClampedArray)return!1;var a=z.CanvasPool.create(this,1,1).getContext("2d");if(!a)return!1;var r=a.createImageData(1,1);return z.CanvasPool.remove(this),r.data instanceof Uint8ClampedArray}var r=this;!function(){var a=navigator.userAgent;/Playstation Vita/.test(a)?r.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?r.kindle=!0:/Android/.test(a)?r.android=!0:/CrOS/.test(a)?r.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?(r.iOS=!0,navigator.appVersion.match(/OS (\d+)/),r.iOSVersion=parseInt(RegExp.$1,10)):/Linux/.test(a)?r.linux=!0:/Mac OS/.test(a)?r.macOS=!0:/Windows/.test(a)&&(r.windows=!0),(/Windows Phone/i.test(a)||/IEMobile/i.test(a))&&(r.android=!1,r.iOS=!1,r.macOS=!1,r.windows=!0,r.windowsPhone=!0);var t=/Silk/.test(a);(r.windows||r.macOS||r.linux&&!t||r.chromeOS)&&(r.desktop=!0),(r.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(r.desktop=!1)}(),function(){var a=navigator.userAgent;if(/Arora/.test(a)?r.arora=!0:/Edge\/\d+/.test(a)?r.edge=!0:/Chrome\/(\d+)/.test(a)&&!r.windowsPhone?(r.chrome=!0,r.chromeVersion=parseInt(RegExp.$1,10)):/Epiphany/.test(a)?r.epiphany=!0:/Firefox\D+(\d+)/.test(a)?(r.firefox=!0,r.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(a)&&r.iOS?r.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(a)?(r.ie=!0,r.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(a)?r.midori=!0:/Opera/.test(a)?r.opera=!0:/Safari\/(\d+)/.test(a)&&!r.windowsPhone?(r.safari=!0,/Version\/(\d+)\./.test(a)&&(r.safariVersion=parseInt(RegExp.$1,10))):/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(a)&&(r.ie=!0,r.trident=!0,r.tridentVersion=parseInt(RegExp.$1,10),r.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(a)&&(r.silk=!0),navigator.standalone&&(r.webApp=!0),void 0!==window.cordova&&(r.cordova=!0),"undefined"!=typeof e&&!0&&(r.node=!0),r.node&&"object"==typeof e.versions&&(r.nodeWebkit=!!e.versions["node-webkit"],r.electron=!!e.versions.electron),navigator.isCocoonJS&&(r.cocoonJS=!0),r.cocoonJS)try{r.cocoonJSApp="undefined"!=typeof CocoonJS}catch(e){r.cocoonJSApp=!1}void 0!==window.ejecta&&(r.ejecta=!0),/Crosswalk/.test(a)&&(r.crosswalk=!0)}(),function(){r.audioData=!!window.Audio,r.webAudio=window.AudioContext||window.webkitAudioContext;var a=document.createElement("audio");try{if(a.canPlayType&&(a.canPlayType("audio/ogg; codecs=\"vorbis\"").replace(/^no$/,"")&&(r.ogg=!0),(a.canPlayType("audio/ogg; codecs=\"opus\"").replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))&&(r.opus=!0),a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(r.mp3=!0),a.canPlayType("audio/wav; codecs=\"1\"").replace(/^no$/,"")&&(r.wav=!0),(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))&&(r.m4a=!0),a.canPlayType("audio/webm; codecs=\"vorbis\"").replace(/^no$/,"")&&(r.webm=!0),""!==a.canPlayType("audio/mp4;codecs=\"ec-3\"")))if(r.edge)r.dolby=!0;else if(r.safari&&9<=r.safariVersion&&/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)){var t=parseInt(RegExp.$1,10),e=parseInt(RegExp.$2,10);(10===t&&11<=e||10<t)&&(r.dolby=!0)}}catch(e){}}(),function(){var e=document.createElement("video");try{!e.canPlayType||(e.canPlayType("video/ogg; codecs=\"theora\"").replace(/^no$/,"")&&(r.oggVideo=!0),e.canPlayType("video/mp4; codecs=\"avc1.42E01E\"").replace(/^no$/,"")&&(r.h264Video=!0,r.mp4Video=!0),e.canPlayType("video/webm; codecs=\"vp8, vorbis\"").replace(/^no$/,"")&&(r.webmVideo=!0),e.canPlayType("video/webm; codecs=\"vp9\"").replace(/^no$/,"")&&(r.vp9Video=!0),e.canPlayType("application/x-mpegURL; codecs=\"avc1.42E01E\"").replace(/^no$/,"")&&(r.hlsVideo=!0))}catch(e){}}(),function(){var a=document.createElement("p"),e={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},o;for(var t in document.body.insertBefore(a,null),e)void 0!==a.style[t]&&(a.style[t]="translate3d(1px,1px,1px)",o=window.getComputedStyle(a).getPropertyValue(e[t]));document.body.removeChild(a),r.css3D=void 0!==o&&0<o.length&&"none"!==o}(),r.pixelRatio=window.devicePixelRatio||1,r.iPhone=-1!==navigator.userAgent.toLowerCase().indexOf("iphone"),r.iPhone4=2===r.pixelRatio&&r.iPhone,r.iPad=-1!==navigator.userAgent.toLowerCase().indexOf("ipad"),r.typedArray="undefined"!=typeof Int8Array,"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(r.littleEndian=a(),r.LITTLE_ENDIAN=r.littleEndian),r.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==r.littleEndian&&t(),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(r.vibration=!0),function(){r.canvas=!!window.CanvasRenderingContext2D||r.cocoonJS;try{r.localStorage=!!localStorage.getItem}catch(e){r.localStorage=!1}r.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),r.fileSystem=!!window.requestFileSystem,r.webGL=!!window.WebGLRenderingContext,r.worker=!!window.Worker,r.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,r.quirksMode="CSS1Compat"!==document.compatMode,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,r.getUserMedia=r.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,r.firefox&&21>r.firefoxVersion&&(r.getUserMedia=!1),!r.iOS&&(r.ie||r.firefox||r.chrome)&&(r.canvasBitBltShift=!0),(r.safari||r.mobileSafari)&&(r.canvasBitBltShift=!1)}(),function(){var a=z.CanvasPool.create(this,6,1),t=a.getContext("2d");t.fillStyle="rgba(10, 20, 30, 0.5)",t.fillRect(0,0,1,1);var e=t.getImageData(0,0,1,1);if(e){t.putImageData(e,1,0);var n=t.getImageData(1,0,1,1);r.canHandleAlpha=n.data[0]===e.data[0]&&n.data[1]===e.data[1]&&n.data[2]===e.data[2]&&n.data[3]===e.data[3]}t.globalCompositeOperation="multiply",r.canUseMultiply="multiply"===t.globalCompositeOperation,z.CanvasPool.removeByCanvas(a),PIXI.CanvasTinter.tintMethod=r.canUseMultiply?PIXI.CanvasTinter.tintWithMultiply:PIXI.CanvasTinter.tintWithPerPixel}(),function(){for(var a=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],t=document.createElement("div"),e=0;e<a.length;e++)if(t[a[e]]){r.fullscreen=!0,r.requestFullscreen=a[e];break}var o=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(r.fullscreen)for(e=0;e<o.length;e++)if(document[o[e]]){r.cancelFullscreen=o[e];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(r.fullscreenKeyboard=!0)}(),("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&1<=window.navigator.maxTouchPoints)&&(r.touch=!0),(window.PointerEvent||window.MSPointerEvent||window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(r.mspointer=!0),r.cocoonJS||("onwheel"in window||r.ie&&"WheelEvent"in window?r.wheelEvent="wheel":"onmousewheel"in window?r.wheelEvent="mousewheel":r.firefox&&"MouseScrollEvent"in window&&(r.wheelEvent="DOMMouseScroll"))},z.Device.canPlayAudio=function(e){return"mp3"===e&&this.mp3||"ogg"===e&&(this.ogg||this.opus)||"m4a"===e&&this.m4a||"opus"===e&&this.opus||"wav"===e&&this.wav||"webm"===e&&this.webm||"mp4"===e&&this.dolby},z.Device.canPlayVideo=function(e){return"webm"===e&&(this.webmVideo||this.vp9Video)||"mp4"===e&&(this.mp4Video||this.h264Video)||("ogg"===e||"ogv"===e)&&this.oggVideo||"mpeg"===e&&this.hlsVideo},z.Device.needsTouchUnlock=function(){return!!(!this.cocoonJS&&(this.iOS||this.android)||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)},z.Device.isAndroidStockBrowser=function(){var e=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return e&&537>e[1]},z.Canvas={create:function(a,t,e,i,s){t=t||256,e=e||256;var o=s?document.createElement("canvas"):z.CanvasPool.create(a,t,e);return"string"==typeof i&&""!==i&&(o.id=i),o.width=t,o.height=e,o.style.display="block",o},setBackgroundColor:function(a,t){return t=t||"rgb(0,0,0)",a.style.backgroundColor=t,a},setTouchAction:function(a,t){return t=t||"none",a.style.msTouchAction=t,a.style["ms-touch-action"]=t,a.style["touch-action"]=t,a},setUserSelect:function(a,t){return t=t||"none",a.style["-webkit-touch-callout"]=t,a.style["-webkit-user-select"]=t,a.style["-khtml-user-select"]=t,a.style["-moz-user-select"]=t,a.style["-ms-user-select"]=t,a.style["user-select"]=t,a.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",a},addToDOM:function(a,t,r){var o;return void 0===r&&(r=!0),t&&("string"==typeof t?o=document.getElementById(t):"object"==typeof t&&1===t.nodeType&&(o=t)),o||(o=document.body),r&&o.style&&(o.style.overflow="hidden"),o.appendChild(a),a},removeFromDOM:function(e){e.parentNode&&e.parentNode.removeChild(e)},setTransform:function(a,t,e,i,s,n,o){return a.setTransform(i,n,o,s,t,e),a},setSmoothingEnabled:function(a,t){var e=z.Canvas.getSmoothingPrefix(a);return e&&(a[e]=t),a},getSmoothingPrefix:function(a){var t=["i","webkitI","msI","mozI","oI"];for(var e in t){var r=t[e]+"mageSmoothingEnabled";if(r in a)return r}return null},getSmoothingEnabled:function(a){var t=z.Canvas.getSmoothingPrefix(a);if(t)return a[t]},setImageRenderingCrisp:function(a){for(var t=["-webkit-optimize-contrast","-moz-crisp-edges","crisp-edges","pixelated"],e=0;e<t.length;e++)a.style["image-rendering"]=t[e];return a.style.msInterpolationMode="nearest-neighbor",a},setImageRenderingBicubic:function(e){return e.style["image-rendering"]="auto",e.style.msInterpolationMode="bicubic",e}},z.RequestAnimationFrame=function(a,t){void 0===t&&(t=!1),this.game=a,this.isRunning=!1,this.forceSetTimeOut=t;for(var e=["ms","moz","webkit","o"],r=0;r<e.length&&!window.requestAnimationFrame;r++)window.requestAnimationFrame=window[e[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[r]+"CancelAnimationFrame"]||window[e[r]+"CancelRequestAnimationFrame"];this._isSetTimeOut=!1,this._onLoop=null,this._timeOutID=null},z.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var a=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return a.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(t){return a.updateRAF(t)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(e){this.isRunning&&(this.game.update(x(e)),this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateSetTimeout:function(){this.isRunning&&(this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall))},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID),this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return!1===this._isSetTimeOut}},z.RequestAnimationFrame.prototype.constructor=z.RequestAnimationFrame,z.Math={PI2:2*R,HALF_PI:.5*R,DEG_TO_RAD:R/180,RAD_TO_DEG:180/R,degToRad:function(e){return e*z.Math.DEG_TO_RAD},radToDeg:function(e){return e*z.Math.RAD_TO_DEG},getNextPowerOfTwo:function(a){if(0<a&&0==(a&a-1))return a;for(var t=1;t<a;)t<<=1;return t},isPowerOfTwo:function(a,t){return 0<a&&0==(a&a-1)&&0<t&&0==(t&t-1)},random:function(a,t){if(void 0===a&&(a=0),void 0===t&&(t=1),a===t)return a;if(a>t){var e=a;a=t,t=e}return Math.random()*(t-a)+a},between:function(a,t){if(void 0===a&&(a=0),void 0===t&&(t=1),a===t)return a;if(a>t){var e=a;a=t,t=e}return a=y(a),t=x(t),x(Math.random()*(t-a+1))+a},fuzzyEqual:function(a,t,e){return void 0===e&&(e=1e-4),E(a-t)<e},fuzzyLessThan:function(a,t,e){return void 0===e&&(e=1e-4),a<t+e},fuzzyGreaterThan:function(a,t,e){return void 0===e&&(e=1e-4),a>t-e},fuzzyCeil:function(a,t){return void 0===t&&(t=1e-4),y(a-t)},fuzzyFloor:function(a,t){return void 0===t&&(t=1e-4),x(a+t)},average:function(){for(var a=0,t=arguments.length,e=0;e<t;e++)a+=+arguments[e];return a/t},shear:function(e){return e%1},snapTo:function(a,t,e){return void 0===e&&(e=0),0===t?a:(a-=e,a=t*f(a/t),e+a)},snapToFloor:function(a,t,e){return void 0===e&&(e=0),0===t?a:(a-=e,a=t*x(a/t),e+a)},snapToCeil:function(a,t,e){return void 0===e&&(e=0),0===t?a:(a-=e,a=t*y(a/t),e+a)},roundTo:function(a,t,r){void 0===t&&(t=0),void 0===r&&(r=10);var o=l(r,-t);return f(a*o)/o},floorTo:function(a,t,r){void 0===t&&(t=0),void 0===r&&(r=10);var o=l(r,-t);return x(a*o)/o},ceilTo:function(a,t,r){void 0===t&&(t=0),void 0===r&&(r=10);var o=l(r,-t);return y(a*o)/o},rotateToAngle:function(a,t,e){return void 0===e&&(e=.05),a===t?a:(E(t-a)<=e||E(t-a)>=z.Math.PI2-e?a=t:(E(t-a)>R&&(t<a?t+=z.Math.PI2:t-=z.Math.PI2),t>a?a+=e:t<a&&(a-=e)),a)},getShortestAngle:function(a,t){var e=t-a;return 0==e?0:e-360*x((e- -180)/360)},angleBetween:function(a,t,e,r){return _(r-t,e-a)},angleBetweenY:function(a,t,e,r){return _(e-a,r-t)},angleBetweenPoints:function(a,t){return _(t.y-a.y,t.x-a.x)},angleBetweenPointsY:function(a,t){return _(t.x-a.x,t.y-a.y)},reverseAngle:function(e){return this.normalizeAngle(e+R,!0)},normalizeAngle:function(e){return 0<=(e%=2*R)?e:e+2*R},maxAdd:function(a,t,e){return A(a+t,e)},minSub:function(a,t,e){return C(a-t,e)},wrap:function(a,t,e){var r=e-t;if(0>=r)return 0;var o=(a-t)%r;return 0>o&&(o+=r),o+t},wrapValue:function(a,t,e){return a=E(a),t=E(t),e=E(e),(a+t)%e},isOdd:function(e){return!!(1&e)},isEven:function(e){return!(1&e)},min:function(){if(1===arguments.length&&"object"==typeof arguments[0])a=arguments[0];else var a=arguments;for(var t=1,e=0,r=a.length;t<r;t++)a[t]<a[e]&&(e=t);return a[e]},max:function(){if(1===arguments.length&&"object"==typeof arguments[0])a=arguments[0];else var a=arguments;for(var t=1,e=0,r=a.length;t<r;t++)a[t]>a[e]&&(e=t);return a[e]},minProperty:function(a){if(2===arguments.length&&"object"==typeof arguments[1])t=arguments[1];else var t=arguments.slice(1);for(var e=1,r=0,o=t.length;e<o;e++)t[e][a]<t[r][a]&&(r=e);return t[r][a]},maxProperty:function(a){if(2===arguments.length&&"object"==typeof arguments[1])t=arguments[1];else var t=arguments.slice(1);for(var e=1,r=0,o=t.length;e<o;e++)t[e][a]>t[r][a]&&(r=e);return t[r][a]},wrapAngle:function(a,t){return t?this.wrap(a,-R,Math.PI):this.wrap(a,-180,180)},linearInterpolation:function(a,t){var e=a.length-1,r=e*t,o=x(r);return 0>t?this.linear(a[0],a[1],r):1<t?this.linear(a[e],a[e-1],e-r):this.linear(a[o],a[o+1>e?e:o+1],r-o)},bezierInterpolation:function(a,t){for(var e=0,r=a.length-1,o=0;o<=r;o++)e+=l(1-t,r-o)*l(t,o)*a[o]*this.bernstein(r,o);return e},catmullRomInterpolation:function(a,t){var e=a.length-1,r=e*t,o=x(r);return a[0]===a[e]?(0>t&&(o=x(r=e*(1+t))),this.catmullRom(a[(o-1+e)%e],a[o],a[(o+1)%e],a[(o+2)%e],r-o)):0>t?a[0]-(this.catmullRom(a[0],a[0],a[1],a[1],-r)-a[0]):1<t?a[e]-(this.catmullRom(a[e],a[e],a[e-1],a[e-1],r-e)-a[e]):this.catmullRom(a[o?o-1:0],a[o],a[e<o+1?e:o+1],a[e<o+2?e:o+2],r-o)},linear:function(a,t,e){return(t-a)*e+a},bernstein:function(a,t){return this.factorial(a)/this.factorial(t)/this.factorial(a-t)},factorial:function(a){if(0===a)return 1;for(var t=a;--a;)t*=a;return t},catmullRom:function(d,t,e,i,s){var n=.5*(e-d),o=.5*(i-t),r=s*s;return(2*t-2*e+n+o)*(s*r)+(-3*t+3*e-2*n-o)*r+n*s+t},difference:function(a,t){return E(a-t)},roundAwayFromZero:function(e){return 0<e?y(e):x(e)},sinCosGenerator:function(d,p,e,i){void 0===p&&(p=1),void 0===e&&(e=1),void 0===i&&(i=1);for(var s=p,n=e,o=i*R/d,r=[],c=[],u=0;u<d;u++)s+=(n-=s*o)*o,r[u]=n,c[u]=s;return{sin:c,cos:r,length:d}},hypot:function(a,t){return F(a*a+t*t)},distance:function(a,t,e,r){var i=a-e,n=t-r;return F(i*i+n*n)},distanceSq:function(a,t,e,r){var i=a-e,n=t-r;return i*i+n*n},distancePow:function(a,t,e,r,o){return void 0===o&&(o=2),F(l(e-a,o)+l(r-t,o))},clamp:function(a,t,e){return a<t?t:e<a?e:a},clampBottom:function(a,t){return a<t?t:a},within:function(a,t,e){return E(a-t)<=e},mapLinear:function(a,t,e,r,o){return r+(a-t)*(o-r)/(e-t)},smoothstep:function(a,t,e){return(a=C(0,A(1,(a-t)/(e-t))))*a*(3-2*a)},smootherstep:function(a,t,e){return(a=C(0,A(1,(a-t)/(e-t))))*a*a*(a*(6*a-15)+10)},sign:function(e){return 0>e?-1:0<e?1:0},percent:function(a,t,e){return void 0===e&&(e=0),a>t||e>t?1:a<e||e>a?0:(a-e)/t}},z.RandomDataGenerator=function(e){void 0===e&&(e=[]),this.c=1,this.s0=0,this.s1=0,this.s2=0,"string"==typeof e?this.state(e):this.sow(e)},z.RandomDataGenerator.prototype={rnd:function(){var e=2091639*this.s0+23283064365386963e-26*this.c;return this.c=0|e,this.s0=this.s1,this.s1=this.s2,this.s2=e-this.c,this.s2},sow:function(a){if(this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,a)for(var t=0,e;t<a.length&&null!=a[t];t++)e=a[t],this.s0-=this.hash(e),this.s0+=~~(0>this.s0),this.s1-=this.hash(e),this.s1+=~~(0>this.s1),this.s2-=this.hash(e),this.s2+=~~(0>this.s2)},hash:function(a){var t,e,r;for(r=4022871197,a=a.toString(),e=0;e<a.length;e++)t=.02519603282416938*(r+=a.charCodeAt(e)),t-=r=t>>>0,r=(t*=r)>>>0,r+=4294967296*(t-=r);return 23283064365386963e-26*(r>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+11102230246251565e-32*(0|2097152*this.rnd.apply(this))},real:function(){return this.integer()+this.frac()},integerInRange:function(a,t){return x(this.realInRange(0,t-a+1)+a)},between:function(a,t){return this.integerInRange(a,t)},realInRange:function(a,t){return this.frac()*(t-a)+a},normal:function(){return 1-2*this.frac()},uuid:function(){var a="",r="";for(r=a="";36>a++;r+=~a%5|4&3*a?(15^a?8^this.frac()*(20^a?16:4):4).toString(16):"-");return r},pick:function(e){return e[this.integerInRange(0,e.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(e){return e[~~(l(this.frac(),2)*(e.length-1)+.5)]},timestamp:function(a,t){return this.realInRange(a||9466848e5,t||1577862e6)},angle:function(){return this.integerInRange(-180,180)},state:function(e){return"string"==typeof e&&e.match(/^!rnd/)&&(e=e.split(","),this.c=parseFloat(e[1]),this.s0=parseFloat(e[2]),this.s1=parseFloat(e[3]),this.s2=parseFloat(e[4])),["!rnd",this.c,this.s0,this.s1,this.s2].join(",")}},z.RandomDataGenerator.prototype.constructor=z.RandomDataGenerator,z.QuadTree=function(a,t,e,i,s,n,o){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(a,t,e,i,s,n,o)},z.QuadTree.prototype={reset:function(a,t,e,d,l,n,o){this.maxObjects=l||10,this.maxLevels=n||4,this.level=o||0,this.bounds={x:f(a),y:f(t),width:e,height:d,subWidth:x(e/2),subHeight:x(d/2),right:f(a)+x(e/2),bottom:f(t)+x(d/2)},this.objects.length=0,this.nodes.length=0},populate:function(e){e.forEach(this.populateHandler,this,!0)},populateHandler:function(e){e.body&&e.exists&&this.insert(e.body)},split:function(){this.nodes[0]=new z.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[1]=new z.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[2]=new z.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[3]=new z.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(a){var t=0,r;if(null!=this.nodes[0]&&-1!==(r=this.getIndex(a)))this.nodes[r].insert(a);else if(this.objects.push(a),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();t<this.objects.length;)-1===(r=this.getIndex(this.objects[t]))?t++:this.nodes[r].insert(this.objects.splice(t,1)[0])},getIndex:function(a){var t=-1;return a.x<this.bounds.right&&a.right<this.bounds.right?a.y<this.bounds.bottom&&a.bottom<this.bounds.bottom?t=1:a.y>this.bounds.bottom&&(t=2):a.x>this.bounds.right&&(a.y<this.bounds.bottom&&a.bottom<this.bounds.bottom?t=0:a.y>this.bounds.bottom&&(t=3)),t},retrieve:function(a){if(a instanceof z.Rectangle)var t=this.objects,e=this.getIndex(a);else{if(!a.body)return this._empty;var t=this.objects,e=this.getIndex(a.body)}return this.nodes[0]&&(t=-1===e?(t=(t=(t=t.concat(this.nodes[0].retrieve(a))).concat(this.nodes[1].retrieve(a))).concat(this.nodes[2].retrieve(a))).concat(this.nodes[3].retrieve(a)):t.concat(this.nodes[e].retrieve(a))),t},clear:function(){this.objects.length=0;for(var e=this.nodes.length;e--;)this.nodes[e].clear(),this.nodes.splice(e,1);this.nodes.length=0}},z.QuadTree.prototype.constructor=z.QuadTree,z.Net=function(e){this.game=e},z.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(e){return-1!==window.location.hostname.indexOf(e)},updateQueryString:function(d,t,e,i){void 0===e&&(e=!1),void 0!==i&&""!==i||(i=window.location.href);var s="",n=new RegExp("([?|&])"+d+"=.*?(&|#|$)(.*)","gi");if(n.test(i))s=void 0!==t&&null!==t?i.replace(n,"$1"+d+"="+t+"$2$3"):i.replace(n,"$1$3").replace(/(&|\?)$/,"");else if(void 0!==t&&null!==t){var o=-1===i.indexOf("?")?"?":"&",r=i.split("#");i=r[0]+o+d+"="+t,r[1]&&(i+="#"+r[1]),s=i}else s=i;return e?void(window.location.href=s):s},getQueryString:function(a){void 0===a&&(a="");var t={},e=location.search.substring(1).split("&");for(var r in e){var o=e[r].split("=");if(1<o.length){if(a&&a===this.decodeURI(o[0]))return this.decodeURI(o[1]);t[this.decodeURI(o[0])]=this.decodeURI(o[1])}}return t},decodeURI:function(e){return decodeURIComponent(e.replace(/\+/g," "))}},z.Net.prototype.constructor=z.Net,z.TweenManager=function(e){this.game=e,this.frameBased=!1,this._tweens=[],this._add=[],this.easeMap={Power0:z.Easing.Power0,Power1:z.Easing.Power1,Power2:z.Easing.Power2,Power3:z.Easing.Power3,Power4:z.Easing.Power4,Linear:z.Easing.Linear.None,Quad:z.Easing.Quadratic.Out,Cubic:z.Easing.Cubic.Out,Quart:z.Easing.Quartic.Out,Quint:z.Easing.Quintic.Out,Sine:z.Easing.Sinusoidal.Out,Expo:z.Easing.Exponential.Out,Circ:z.Easing.Circular.Out,Elastic:z.Easing.Elastic.Out,Back:z.Easing.Back.Out,Bounce:z.Easing.Bounce.Out,"Quad.easeIn":z.Easing.Quadratic.In,"Cubic.easeIn":z.Easing.Cubic.In,"Quart.easeIn":z.Easing.Quartic.In,"Quint.easeIn":z.Easing.Quintic.In,"Sine.easeIn":z.Easing.Sinusoidal.In,"Expo.easeIn":z.Easing.Exponential.In,"Circ.easeIn":z.Easing.Circular.In,"Elastic.easeIn":z.Easing.Elastic.In,"Back.easeIn":z.Easing.Back.In,"Bounce.easeIn":z.Easing.Bounce.In,"Quad.easeOut":z.Easing.Quadratic.Out,"Cubic.easeOut":z.Easing.Cubic.Out,"Quart.easeOut":z.Easing.Quartic.Out,"Quint.easeOut":z.Easing.Quintic.Out,"Sine.easeOut":z.Easing.Sinusoidal.Out,"Expo.easeOut":z.Easing.Exponential.Out,"Circ.easeOut":z.Easing.Circular.Out,"Elastic.easeOut":z.Easing.Elastic.Out,"Back.easeOut":z.Easing.Back.Out,"Bounce.easeOut":z.Easing.Bounce.Out,"Quad.easeInOut":z.Easing.Quadratic.InOut,"Cubic.easeInOut":z.Easing.Cubic.InOut,"Quart.easeInOut":z.Easing.Quartic.InOut,"Quint.easeInOut":z.Easing.Quintic.InOut,"Sine.easeInOut":z.Easing.Sinusoidal.InOut,"Expo.easeInOut":z.Easing.Exponential.InOut,"Circ.easeInOut":z.Easing.Circular.InOut,"Elastic.easeInOut":z.Easing.Elastic.InOut,"Back.easeInOut":z.Easing.Back.InOut,"Bounce.easeInOut":z.Easing.Bounce.InOut},this.game.onPause.add(this._pauseAll,this),this.game.onResume.add(this._resumeAll,this)},z.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var e=0;e<this._tweens.length;e++)this._tweens[e].pendingDelete=!0;this._add=[]},removeFrom:function(a,t){if(void 0===t&&(t=!0),Array.isArray(a))for(e=0,r=a.length;e<r;e++)this.removeFrom(a[e]);else if(a.type===z.GROUP&&t)for(var e=0,r=a.children.length;e<r;e++)this.removeFrom(a.children[e]);else{for(e=0,r=this._tweens.length;e<r;e++)a===this._tweens[e].target&&this.remove(this._tweens[e]);for(e=0,r=this._add.length;e<r;e++)a===this._add[e].target&&this.remove(this._add[e])}},add:function(e){e._manager=this,this._add.push(e)},create:function(e){return new z.Tween(e,this.game,this)},remove:function(a){var t=this._tweens.indexOf(a);-1===t?-1!==(t=this._add.indexOf(a))&&(this._add[t].pendingDelete=!0):this._tweens[t].pendingDelete=!0},update:function(){var a=this._add.length,t=this._tweens.length;if(0===t&&0===a)return!1;for(var e=0;e<t;)this._tweens[e].update(this.game.time.time)?e++:(this._tweens.splice(e,1),t--);return 0<a&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(a,t){return t||(t=!1),this._tweens.some(function(r){return r.target===a&&(!t||r.isRunning&&!r.pendingDelete)})},_pauseAll:function(){for(var e=this._tweens.length-1;0<=e;e--)this._tweens[e]._pause()},_resumeAll:function(){for(var e=this._tweens.length-1;0<=e;e--)this._tweens[e]._resume()},pauseAll:function(){for(var e=this._tweens.length-1;0<=e;e--)this._tweens[e].pause()},resumeAll:function(){for(var e=this._tweens.length-1;0<=e;e--)this._tweens[e].resume(!0)}},z.TweenManager.prototype.constructor=z.TweenManager,z.Tween=function(a,t,e){this.game=t,this.target=a,this.manager=e,this.timeline=[],this.reverse=!1,this.timeScale=1,this.repeatCounter=0,this.pendingDelete=!1,this.onStart=new z.Signal,this.onLoop=new z.Signal,this.onRepeat=new z.Signal,this.onChildComplete=new z.Signal,this.onComplete=new z.Signal,this.isRunning=!1,this.current=0,this.properties={},this.chainedTween=null,this.isPaused=!1,this.frameBased=e.frameBased,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,this._pausedTime=0,this._codePaused=!1,this._hasStarted=!1},z.Tween.updateColor=function(e){z.Color.updateColor(e.target)},z.Tween.prototype={to:function(i,t,e,d,n,o,r){return(void 0===t||0>=t)&&(t=1e3),void 0!==e&&null!==e||(e=z.Easing.Default),void 0===d&&(d=!1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===r&&(r=!1),"string"==typeof e&&this.manager.easeMap[e]&&(e=this.manager.easeMap[e]),this.isRunning?(console.warn("Phaser.Tween.to cannot be called after Tween.start"),this):(this.timeline.push(new z.TweenData(this).to(i,t,e,n,o,r)),d&&this.start(),this)},from:function(i,t,e,d,n,o,r){return void 0===t&&(t=1e3),void 0!==e&&null!==e||(e=z.Easing.Default),void 0===d&&(d=!1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===r&&(r=!1),"string"==typeof e&&this.manager.easeMap[e]&&(e=this.manager.easeMap[e]),this.isRunning?(console.warn("Phaser.Tween.from cannot be called after Tween.start"),this):(this.timeline.push(new z.TweenData(this).from(i,t,e,n,o,r)),d&&this.start(),this)},start:function(a){if(void 0===a&&(a=0),this.pendingDelete)return console.warn("Phaser.Tween.start cannot be called after Tween.stop"),this;if(null===this.game||null===this.target||0===this.timeline.length||this.isRunning)return this;for(e=0;e<this.timeline.length;e++)for(var t in this.timeline[e].vEnd)this.properties[t]=this.target[t]||0,Array.isArray(this.properties[t])||(this.properties[t]*=1);for(var e=0;e<this.timeline.length;e++)this.timeline[e].loadValues();return this.manager.add(this),this.isRunning=!0,(0>a||a>this.timeline.length-1)&&(a=0),this.current=a,this.timeline[this.current].start(),this},stop:function(e){return void 0===e&&(e=!1),this.isRunning=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,e&&(this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start()),this.manager.remove(this),this},updateTweenData:function(a,t,e){if(0===this.timeline.length)return this;if(void 0===e&&(e=0),-1===e)for(var r=0;r<this.timeline.length;r++)this.timeline[r][a]=t;else this.timeline[e][a]=t;return this},delay:function(a,t){return this.updateTweenData("delay",a,t)},repeat:function(a,t,e){return void 0===t&&(t=0),this.updateTweenData("repeatCounter",a,e),this.updateTweenData("repeatTotal",a,e),this.updateTweenData("repeatDelay",t,e)},repeatDelay:function(a,t){return this.updateTweenData("repeatDelay",a,t)},yoyo:function(a,t,e){return void 0===t&&(t=0),this.updateTweenData("yoyo",a,e),this.updateTweenData("yoyoDelay",t,e)},yoyoDelay:function(a,t){return this.updateTweenData("yoyoDelay",a,t)},easing:function(a,r){return"string"==typeof a&&this.manager.easeMap[a]&&(a=this.manager.easeMap[a]),this.updateTweenData("easingFunction",a,r)},interpolation:function(a,t,e){return void 0===t&&(t=z.Math),this.updateTweenData("interpolationFunction",a,e),this.updateTweenData("interpolationContext",t,e)},repeatAll:function(e){return void 0===e&&(e=0),this.repeatCounter=e,this},chain:function(){for(var e=arguments.length;e--;)0<e?arguments[e-1].chainedTween=arguments[e]:this.chainedTween=arguments[e];return this},loop:function(e){return void 0===e&&(e=!0),this.repeatCounter=e?-1:0,this},onUpdateCallback:function(a,t){return this._onUpdateCallback=a,this._onUpdateCallbackContext=t,this},pause:function(){this.isPaused=!0,this._codePaused=!0,this._pausedTime=this.game.time.time},_pause:function(){this._codePaused||(this.isPaused=!0,this._pausedTime=this.game.time.time)},resume:function(){if(this.isPaused){this.isPaused=!1,this._codePaused=!1;for(var e=0;e<this.timeline.length;e++)this.timeline[e].isRunning||(this.timeline[e].startTime+=this.game.time.time-this._pausedTime)}},_resume:function(){this._codePaused||this.resume()},update:function(a){if(this.pendingDelete||!this.target)return!1;if(this.isPaused)return!0;var t=this.timeline[this.current].update(a);if(t===z.TweenData.PENDING)return!0;if(t===z.TweenData.RUNNING)return this._hasStarted||(this.onStart.dispatch(this.target,this),this._hasStarted=!0),null!==this._onUpdateCallback&&this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current]),this.isRunning;if(t===z.TweenData.LOOPED)return-1===this.timeline[this.current].repeatCounter?this.onLoop.dispatch(this.target,this):this.onRepeat.dispatch(this.target,this),!0;if(t===z.TweenData.COMPLETE){var e=!1;return this.reverse?0>--this.current&&(this.current=this.timeline.length-1,e=!0):++this.current===this.timeline.length&&(this.current=0,e=!0),e?-1===this.repeatCounter?(this.timeline[this.current].start(),this.onLoop.dispatch(this.target,this),!0):0<this.repeatCounter?(this.repeatCounter--,this.timeline[this.current].start(),this.onRepeat.dispatch(this.target,this),!0):(this.isRunning=!1,this.onComplete.dispatch(this.target,this),this._hasStarted=!1,this.chainedTween&&this.chainedTween.start(),!1):(this.onChildComplete.dispatch(this.target,this),this.timeline[this.current].start(),!0)}},generateData:function(a,t){if(null===this.game||null===this.target)return null;for(void 0===a&&(a=60),void 0===t&&(t=[]),r=0;r<this.timeline.length;r++)for(var e in this.timeline[r].vEnd)this.properties[e]=this.target[e]||0,Array.isArray(this.properties[e])||(this.properties[e]*=1);for(r=0;r<this.timeline.length;r++)this.timeline[r].loadValues();for(var r=0;r<this.timeline.length;r++)t=t.concat(this.timeline[r].generateData(a));return t}},Object.defineProperty(z.Tween.prototype,"totalDuration",{get:function(){for(var a=0,t=0;t<this.timeline.length;t++)a+=this.timeline[t].duration;return a}}),z.Tween.prototype.constructor=z.Tween,z.TweenData=function(e){this.parent=e,this.game=e.game,this.vStart={},this.vStartCache={},this.vEnd={},this.vEndCache={},this.duration=1e3,this.percent=0,this.value=0,this.repeatCounter=0,this.repeatDelay=0,this.repeatTotal=0,this.interpolate=!1,this.yoyo=!1,this.yoyoDelay=0,this.inReverse=!1,this.delay=0,this.dt=0,this.startTime=null,this.easingFunction=z.Easing.Default,this.interpolationFunction=z.Math.linearInterpolation,this.interpolationContext=z.Math,this.isRunning=!1,this.isFrom=!1},z.TweenData.PENDING=0,z.TweenData.RUNNING=1,z.TweenData.LOOPED=2,z.TweenData.COMPLETE=3,z.TweenData.prototype={to:function(a,t,e,r,i,n){return this.vEnd=a,this.duration=t,this.easingFunction=e,this.delay=r,this.repeatTotal=i,this.yoyo=n,this.isFrom=!1,this},from:function(a,t,e,r,i,n){return this.vEnd=a,this.duration=t,this.easingFunction=e,this.delay=r,this.repeatTotal=i,this.yoyo=n,this.isFrom=!0,this},start:function(){if(this.startTime=this.game.time.time+this.delay,this.dt=this.parent.reverse?this.duration:0,this.isRunning=!(0<this.delay),this.isFrom)for(var e in this.vStartCache)this.vStart[e]=this.vEndCache[e],this.vEnd[e]=this.vStartCache[e],this.parent.target[e]=this.vStart[e];return this.value=0,this.repeatCounter=this.repeatTotal,this},loadValues:function(){for(var e in this.parent.properties){if(this.vStart[e]=this.parent.properties[e],Array.isArray(this.vEnd[e])){if(0===this.vEnd[e].length)continue;0===this.percent&&(this.vEnd[e]=[this.vStart[e]].concat(this.vEnd[e]))}void 0===this.vEnd[e]?this.vEnd[e]=this.vStart[e]:("string"==typeof this.vEnd[e]&&(this.vEnd[e]=this.vStart[e]+parseFloat(this.vEnd[e],10)),this.parent.properties[e]=this.vEnd[e]),this.vStartCache[e]=this.vStart[e],this.vEndCache[e]=this.vEnd[e]}return this},update:function(a){if(!this.isRunning){if(!(a>=this.startTime))return z.TweenData.PENDING;this.isRunning=!0}else if(a<this.startTime)return z.TweenData.RUNNING;var t=this.parent.frameBased?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;for(var e in this.parent.reverse?(this.dt-=t*this.parent.timeScale,this.dt=C(this.dt,0)):(this.dt+=t*this.parent.timeScale,this.dt=A(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent),this.vEnd){var r=this.vStart[e],n=this.vEnd[e];this.parent.target[e]=Array.isArray(n)?this.interpolationFunction.call(this.interpolationContext,n,this.value):r+(n-r)*this.value}return!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent?this.repeat():z.TweenData.RUNNING},generateData:function(d){this.dt=this.parent.reverse?this.duration:0;var t=[],e=!1,l=1e3*(1/d);do{this.parent.reverse?(this.dt-=l,this.dt=C(this.dt,0)):(this.dt+=l,this.dt=A(this.dt,this.duration)),this.percent=this.dt/this.duration,this.value=this.easingFunction(this.percent);var s={};for(var n in this.vEnd){var o=this.vStart[n],r=this.vEnd[n];s[n]=Array.isArray(r)?this.interpolationFunction.call(this.interpolationContext,r,this.value):o+(r-o)*this.value}t.push(s),(!this.parent.reverse&&1===this.percent||this.parent.reverse&&0===this.percent)&&(e=!0)}while(!e);if(this.yoyo){var a=t.slice();a.reverse(),t=t.concat(a)}return t},repeat:function(){if(this.yoyo){if(this.inReverse&&0===this.repeatCounter){for(var e in this.vStartCache)this.vStart[e]=this.vStartCache[e],this.vEnd[e]=this.vEndCache[e];return this.inReverse=!1,z.TweenData.COMPLETE}this.inReverse=!this.inReverse}else if(0===this.repeatCounter)return z.TweenData.COMPLETE;if(this.inReverse)for(var e in this.vStartCache)this.vStart[e]=this.vEndCache[e],this.vEnd[e]=this.vStartCache[e];else{for(var e in this.vStartCache)this.vStart[e]=this.vStartCache[e],this.vEnd[e]=this.vEndCache[e];0<this.repeatCounter&&this.repeatCounter--}return this.startTime=this.game.time.time,this.yoyo&&this.inReverse?this.startTime+=this.yoyoDelay:this.inReverse||(this.startTime+=this.repeatDelay),this.dt=this.parent.reverse?this.duration:0,z.TweenData.LOOPED}},z.TweenData.prototype.constructor=z.TweenData,z.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return 1>(e*=2)?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return 1>(e*=2)?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 0===e?0:1===e?1:1-S(e*R/2)},Out:function(e){return 0===e?0:1===e?1:T(e*R/2)},InOut:function(e){return 0===e?0:1===e?1:.5*(1-S(R*e))}},Exponential:{In:function(e){return 0===e?0:l(1024,e-1)},Out:function(e){return 1===e?1:1-l(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:1>(e*=2)?.5*l(1024,e-1):.5*(2-l(2,-10*(e-1)))}},Circular:{In:function(e){return 1-F(1-e*e)},Out:function(e){return F(1- --e*e)},InOut:function(e){return 1>(e*=2)?-.5*(F(1-e*e)-1):.5*(F(1-(e-=2)*e)+1)}},Elastic:{In:function(a){var t=.1,r;return 0===a?0:1===a?1:(!t||1>t?(t=1,r=.1):r=.4*o(1/t)/(2*R),-t*l(2,10*(a-=1))*T((a-r)*(2*R)/.4))},Out:function(a){var t=.1,r;return 0===a?0:1===a?1:(!t||1>t?(t=1,r=.1):r=.4*o(1/t)/(2*R),t*l(2,-10*a)*T((a-r)*(2*R)/.4)+1)},InOut:function(a){var t=.1,r;return 0===a?0:1===a?1:(!t||1>t?(t=1,r=.1):r=.4*o(1/t)/(2*R),1>(a*=2)?-.5*(t*l(2,10*(a-=1))*T((a-r)*(2*R)/.4)):.5*(t*l(2,-10*(a-=1))*T((a-r)*(2*R)/.4))+1)}},Back:{In:function(a){var t=1.70158;return a*a*((t+1)*a-t)},Out:function(a){var t=1.70158;return--a*a*((t+1)*a+t)+1},InOut:function(a){var t=2.5949095;return 1>(a*=2)?.5*(a*a*((t+1)*a-t)):.5*((a-=2)*a*((t+1)*a+t)+2)}},Bounce:{In:function(e){return 1-z.Easing.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return .5>e?.5*z.Easing.Bounce.In(2*e):.5*z.Easing.Bounce.Out(2*e-1)+.5}}},z.Easing.Default=z.Easing.Linear.None,z.Easing.Power0=z.Easing.Linear.None,z.Easing.Power1=z.Easing.Quadratic.Out,z.Easing.Power2=z.Easing.Cubic.Out,z.Easing.Power3=z.Easing.Quartic.Out,z.Easing.Power4=z.Easing.Quintic.Out,z.Time=function(e){this.game=e,this.time=0,this.prevTime=0,this.now=0,this.elapsed=0,this.elapsedMS=0,this.physicsElapsed=1/60,this.physicsElapsedMS=1e3*(1/60),this.desiredFpsMult=1/60,this._desiredFps=60,this.suggestedFps=this.desiredFps,this.slowMotion=1,this.advancedTiming=!1,this.frames=0,this.updates=0,this.renders=0,this.fps=0,this.ups=0,this.rps=0,this.fpsMin=1e3,this.fpsMax=0,this.msMin=1e3,this.msMax=0,this.pauseDuration=0,this.timeToCall=0,this.timeExpected=0,this.events=new z.Timer(this.game,!1),this._frameCount=0,this._elapsedAccumulator=0,this._started=0,this._timeLastSecond=0,this._pauseStarted=0,this._justResumed=!1,this._timers=[]},z.Time.prototype={boot:function(){this._started=Date.now(),this.time=Date.now(),this.events.start(),this.timeExpected=this.time},add:function(e){return this._timers.push(e),e},create:function(a){void 0===a&&(a=!0);var t=new z.Timer(this.game,a);return this._timers.push(t),t},removeAll:function(){for(var e=0;e<this._timers.length;e++)this._timers[e].destroy();this._timers=[],this.events.removeAll()},refresh:function(){var e=this.time;this.time=Date.now(),this.elapsedMS=this.time-e},update:function(a){var t=this.time;this.time=Date.now(),this.elapsedMS=this.time-t,this.prevTime=this.now,this.now=a,this.elapsed=this.now-this.prevTime,this.game.raf._isSetTimeOut&&(this.timeToCall=x(C(0,1e3/this._desiredFps-(this.timeExpected-a))),this.timeExpected=a+this.timeToCall),this.advancedTiming&&this.updateAdvancedTiming(),this.game.paused||(this.events.update(this.time),this._timers.length&&this.updateTimers())},updateTimers:function(){for(var a=0,t=this._timers.length;a<t;)this._timers[a].update(this.time)?a++:(this._timers.splice(a,1),t--)},updateAdvancedTiming:function(){if(this._frameCount++,this._elapsedAccumulator+=this.elapsed,this._frameCount>=2*this._desiredFps&&(this.suggestedFps=5*x(200/(this._elapsedAccumulator/this._frameCount)),this._frameCount=0,this._elapsedAccumulator=0),this.msMin=A(this.msMin,this.elapsed),this.msMax=C(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3){var e=this.now-this._timeLastSecond;this.fps=f(1e3*this.frames/e),this.ups=f(1e3*this.updates/e),this.rps=f(1e3*this.renders/e),this.fpsMin=A(this.fpsMin,this.fps),this.fpsMax=C(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0,this.updates=0,this.renders=0}},countUpdate:function(){this.advancedTiming&&this.updates++},countRender:function(){this.advancedTiming&&this.renders++},gamePaused:function(){this._pauseStarted=Date.now(),this.events.pause();for(var e=this._timers.length;e--;)this._timers[e]._pause()},gameResumed:function(){this.time=Date.now(),this.pauseDuration=this.time-this._pauseStarted,this.events.resume();for(var e=this._timers.length;e--;)this._timers[e]._resume()},totalElapsedSeconds:function(){return .001*(this.time-this._started)},elapsedSince:function(e){return this.time-e},elapsedSecondsSince:function(e){return .001*(this.time-e)},reset:function(){this._started=this.time,this.removeAll()}},Object.defineProperty(z.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(e){this._desiredFps=e,this.physicsElapsed=1/e,this.physicsElapsedMS=1e3*this.physicsElapsed,this.desiredFpsMult=1/e}}),z.Time.prototype.constructor=z.Time,z.Timer=function(a,t){void 0===t&&(t=!0),this.game=a,this.running=!1,this.autoDestroy=t,this.expired=!1,this.elapsed=0,this.events=[],this.onComplete=new z.Signal,this.nextTick=0,this.timeCap=1e3,this.paused=!1,this._codePaused=!1,this._started=0,this._pauseStarted=0,this._pauseTotal=0,this._now=Date.now(),this._len=0,this._marked=0,this._i=0,this._diff=0,this._newTick=0},z.Timer.MINUTE=6e4,z.Timer.SECOND=1e3,z.Timer.HALF=500,z.Timer.QUARTER=250,z.Timer.prototype={create:function(i,t,e,s,n,o){var r=i=f(i);r+=0===this._now?this.game.time.time:this._now;var a=new z.TimerEvent(this,i,r,e,t,s,n,o);return this.events.push(a),this.order(),this.expired=!1,a},add:function(a,t,e){return this.create(a,!1,0,t,e,Array.prototype.slice.call(arguments,3))},repeat:function(a,t,e,r){return this.create(a,!1,t,e,r,Array.prototype.slice.call(arguments,4))},loop:function(a,t,e){return this.create(a,!0,0,t,e,Array.prototype.slice.call(arguments,3))},start:function(a){if(!this.running){this._started=this.game.time.time+(a||0),this.running=!0;for(var t=0;t<this.events.length;t++)this.events[t].tick=this.events[t].delay+this._started}},stop:function(e){this.running=!1,void 0===e&&(e=!0),e&&(this.events.length=0)},remove:function(a){for(var t=0;t<this.events.length;t++)if(this.events[t]===a)return this.events[t].pendingDelete=!0,!0;return!1},order:function(){0<this.events.length&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(a,t){return a.tick<t.tick?-1:a.tick>t.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length,this._i=0},update:function(a){if(this.paused)return!0;if(this.elapsed=a-this._now,this._now=a,this.elapsed>this.timeCap&&this.adjustEvents(a-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&0<this._len){for(;this._i<this._len&&this.running;){var t=this.events[this._i];if(!(this._now>=t.tick)||t.pendingDelete)break;this._newTick=this._now+t.delay-(this._now-t.tick),0>this._newTick&&(this._newTick=this._now+t.delay),!0===t.loop?(t.tick=this._newTick,t.callback.apply(t.callbackContext,t.args)):0<t.repeatCount?(t.repeatCount--,t.tick=this._newTick,t.callback.apply(t.callbackContext,t.args)):(this._marked++,t.pendingDelete=!0,t.callback.apply(t.callbackContext,t.args)),this._i++}this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return!this.expired||!this.autoDestroy},pause:function(){this.running&&(this._codePaused=!0,this.paused||(this._pauseStarted=this.game.time.time,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.time,this.paused=!0)},adjustEvents:function(a){for(var t=0;t<this.events.length;t++)if(!this.events[t].pendingDelete){var e=this.events[t].tick-a;0>e&&(e=0),this.events[t].tick=this._now+e}var r=this.nextTick-a;this.nextTick=0>r?this._now:this._now+r},resume:function(){if(this.paused){var e=this.game.time.time;this._pauseTotal+=e-this._now,this._now=e,this.adjustEvents(this._pauseStarted),this.paused=!1,this._codePaused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll(),this.events.length=0,this._len=0,this._i=0},destroy:function(){this.onComplete.removeAll(),this.running=!1,this.expired=!0,this.events=[],this._len=0,this._i=0}},Object.defineProperty(z.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(z.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(z.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(z.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}}),Object.defineProperty(z.Timer.prototype,"seconds",{get:function(){return this.running?.001*this.ms:0}}),z.Timer.prototype.constructor=z.Timer,z.TimerEvent=function(d,t,e,i,s,n,o,r){this.timer=d,this.delay=t,this.tick=e,this.repeatCount=i-1,this.loop=s,this.callback=n,this.callbackContext=o,this.args=r,this.pendingDelete=!1},z.TimerEvent.prototype.constructor=z.TimerEvent,z.AnimationManager=function(e){this.sprite=e,this.game=e.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},z.AnimationManager.prototype={loadFrameData:function(a,t){if(void 0===a)return!1;if(this.isLoaded)for(var r in this._anims)this._anims[r].updateFrameData(a);return this._frameData=a,void 0===t||null===t?this.frame=0:"string"==typeof t?this.frameName=t:this.frame=t,this.isLoaded=!0,!0},copyFrameData:function(a,t){if(this._frameData=a.clone(),this.isLoaded)for(var r in this._anims)this._anims[r].updateFrameData(this._frameData);return void 0===t||null===t?this.frame=0:"string"==typeof t?this.frameName=t:this.frame=t,this.isLoaded=!0,!0},add:function(a,t,e,r,n){return t=t||[],e=e||60,void 0===r&&(r=!1),void 0===n&&(n=t&&"number"==typeof t[0]),this._outputFrames=[],this._frameData.getFrameIndexes(t,n,this._outputFrames),this._anims[a]=new z.Animation(this.game,this.sprite,a,this._frameData,this._outputFrames,e,r),this.currentAnim=this._anims[a],this.sprite.tilingTexture&&(this.sprite.refreshTexture=!0),this._anims[a]},validateFrames:function(a,t){void 0===t&&(t=!0);for(var e=0;e<a.length;e++)if(!0===t){if(a[e]>this._frameData.total)return!1;}else if(!1===this._frameData.checkFrameName(a[e]))return!1;return!0},play:function(a,t,e,r){if(this._anims[a])return this.currentAnim===this._anims[a]?!1===this.currentAnim.isPlaying?(this.currentAnim.paused=!1,this.currentAnim.play(t,e,r)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[a],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(t,e,r))},stop:function(a,r){void 0===r&&(r=!1),this.currentAnim&&("string"!=typeof a||a===this.currentAnim.name)&&this.currentAnim.stop(r)},update:function(){return(!this.updateIfVisible||this.sprite.visible)&&this.currentAnim&&this.currentAnim.update()&&(this.currentFrame=this.currentAnim.currentFrame,!0)},next:function(e){this.currentAnim&&(this.currentAnim.next(e),this.currentFrame=this.currentAnim.currentFrame)},previous:function(e){this.currentAnim&&(this.currentAnim.previous(e),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(e){return"string"==typeof e&&this._anims[e]?this._anims[e]:null},refreshFrame:function(){},destroy:function(){for(var e in e=null,this._anims)this._anims.hasOwnProperty(e)&&this._anims[e].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},z.AnimationManager.prototype.constructor=z.AnimationManager,Object.defineProperty(z.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(z.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(z.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(e){this.currentAnim.paused=e}}),Object.defineProperty(z.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim)return this.currentAnim.name}}),Object.defineProperty(z.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this.currentFrame.index},set:function(a){var r;"number"==typeof a&&this._frameData&&(r=this._frameData.getFrame(a))&&(this.currentFrame=r,this.sprite.setFrame(this.currentFrame))}}),Object.defineProperty(z.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(a){var r;"string"==typeof a&&this._frameData&&(r=this._frameData.getFrameByName(a))?(this.currentFrame=r,this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame)):console.warn("Cannot set frameName: "+a)}}),z.Animation=function(i,t,e,s,n,o,r){void 0===r&&(r=!1),this.game=i,this._parent=t,this._frameData=s,this.name=e,this._frames=[],this._frames=this._frames.concat(n),this.delay=1e3/o,this.loop=r,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.onStart=new z.Signal,this.onUpdate=null,this.onComplete=new z.Signal,this.onLoop=new z.Signal,this.isReversed=!1,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},z.Animation.prototype={play:function(a,r,o){return"number"==typeof a&&(this.delay=1e3/a),"boolean"==typeof r&&(this.loop=r),void 0!==o&&(this.killOnComplete=o),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=this.isReversed?this._frames.length-1:0,this.updateCurrentFrame(!1,!0),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},reverse:function(){return this.reversed=!this.reversed,this},reverseOnce:function(){return this.onComplete.addOnce(this.reverse,this),this.reverse()},setFrame:function(a,r){var e;if(void 0===r&&(r=!1),"string"==typeof a)for(o=0;o<this._frames.length;o++)this._frameData.getFrame(this._frames[o]).name===a&&(e=o);else if("number"==typeof a)if(r)e=a;else for(var o=0;o<this._frames.length;o++)this._frames[o]===a&&(e=o);if(e){var i=this.isReversed?-1:1;this._frameIndex=e-i,this._timeNextFrame=this.game.time.time,this.update()}},stop:function(a,t){void 0===a&&(a=!1),void 0===t&&(t=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,a&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),t&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return!this.isPaused&&!!(this.isPlaying&&this.game.time.time>=this._timeNextFrame)&&(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay?(this._frameSkip=x(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay):this._frameDiff=0,this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this.isReversed?this._frameIndex-=this._frameSkip:this._frameIndex+=this._frameSkip,!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&-1>=this._frameIndex?this.loop?(this._frameIndex=E(this._frameIndex)%this._frames.length,this.isReversed&&(this._frameIndex=this._frames.length-1-this._frameIndex),this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&this._parent.setFrame(this.currentFrame),this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),!this.onUpdate||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)):(this.complete(),!1):this.updateCurrentFrame(!0))},updateCurrentFrame:function(a,r){if(void 0===r&&(r=!1),!this._frameData)return!1;var o=this.currentFrame.index;return this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(r||!r&&o!==this.currentFrame.index)&&this._parent.setFrame(this.currentFrame),!this.onUpdate||!a||(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData)},next:function(a){void 0===a&&(a=1);var t=this._frameIndex+a;t>=this._frames.length&&(this.loop?t%=this._frames.length:t=this._frames.length-1),t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},previous:function(a){void 0===a&&(a=1);var t=this._frameIndex-a;0>t&&(this.loop?t=this._frames.length+t:t++),t!==this._frameIndex&&(this._frameIndex=t,this.updateCurrentFrame(!0))},updateFrameData:function(e){this._frameData=e,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this._frameData&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.updateCurrentFrame(!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},z.Animation.prototype.constructor=z.Animation,Object.defineProperty(z.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(e){this.isPaused=e,e?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),Object.defineProperty(z.Animation.prototype,"reversed",{get:function(){return this.isReversed},set:function(e){this.isReversed=e}}),Object.defineProperty(z.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(z.Animation.prototype,"frame",{get:function(){return null===this.currentFrame?this._frameIndex:this.currentFrame.index},set:function(e){this.currentFrame=this._frameData.getFrame(this._frames[e]),null!==this.currentFrame&&(this._frameIndex=e,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(z.Animation.prototype,"speed",{get:function(){return 1e3/this.delay},set:function(e){0<e&&(this.delay=1e3/e)}}),Object.defineProperty(z.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(e){e&&null===this.onUpdate?this.onUpdate=new z.Signal:e||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),z.Animation.generateFrameNames=function(i,t,e,s,n){void 0===s&&(s="");var d=[],r="";if(t<e)for(a=t;a<=e;a++)r=i+(r="number"==typeof n?z.Utils.pad(a.toString(),n,"0",1):a.toString())+s,d.push(r);else for(var a=t;a>=e;a--)r=i+(r="number"==typeof n?z.Utils.pad(a.toString(),n,"0",1):a.toString())+s,d.push(r);return d},z.Frame=function(a,t,e,i,n,o){this.index=a,this.x=t,this.y=e,this.width=i,this.height=n,0!==this.width&&0!==this.height||console.warn("Phaser.Frame: Frame \""+this.name+"\" has a width or height of zero"),this.name=o,this.centerX=x(i/2),this.centerY=x(n/2),this.distance=z.Math.distance(0,0,i,n),this.rotated=!1,this.trimmed=!1,this.sourceSizeW=i,this.sourceSizeH=n,this.spriteSourceSizeX=0,this.spriteSourceSizeY=0,this.spriteSourceSizeW=0,this.spriteSourceSizeH=0,this.right=this.x+this.width,this.bottom=this.y+this.height},z.Frame.prototype={resize:function(a,t){this.width=a,this.height=t,this.centerX=x(a/2),this.centerY=x(t/2),this.distance=z.Math.distance(0,0,a,t),this.sourceSizeW=a,this.sourceSizeH=t,this.right=this.x+a,this.bottom=this.y+t},setTrim:function(a,t,e,i,s,n,o){this.trimmed=a,a&&(this.sourceSizeW=t,this.sourceSizeH=e,this.centerX=x(t/2),this.centerY=x(e/2),this.spriteSourceSizeX=i,this.spriteSourceSizeY=s,this.spriteSourceSizeW=n,this.spriteSourceSizeH=o)},clone:function(){var a=new z.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(var t in this)this.hasOwnProperty(t)&&(a[t]=this[t]);return a},getRect:function(e){return void 0===e?e=new z.Rectangle(this.x,this.y,this.width,this.height):e.setTo(this.x,this.y,this.width,this.height),e}},z.Frame.prototype.constructor=z.Frame,z.FrameData=function(){this._frames=[],this._frameNames=[]},z.FrameData.prototype={addFrame:function(e){return e.index=this._frames.length,this._frames.push(e),""!==e.name&&(this._frameNames[e.name]=e.index),e},getFrame:function(e){return e>=this._frames.length&&(e=0),this._frames[e]},getFrameByName:function(e){return"number"==typeof this._frameNames[e]?this._frames[this._frameNames[e]]:null},checkFrameName:function(e){return null!=this._frameNames[e]},clone:function(){for(var a=new z.FrameData,t=0;t<this._frames.length;t++)a._frames.push(this._frames[t].clone());for(var e in this._frameNames)this._frameNames.hasOwnProperty(e)&&a._frameNames.push(this._frameNames[e]);return a},getFrameRange:function(a,t,e){void 0===e&&(e=[]);for(var r=a;r<=t;r++)e.push(this._frames[r]);return e},getFrames:function(a,t,e){if(void 0===t&&(t=!0),void 0===e&&(e=[]),void 0===a||0===a.length)for(r=0;r<this._frames.length;r++)e.push(this._frames[r]);else for(var r=0;r<a.length;r++)t?e.push(this.getFrame(a[r])):e.push(this.getFrameByName(a[r]));return e},getFrameIndexes:function(a,t,e){if(void 0===t&&(t=!0),void 0===e&&(e=[]),void 0===a||0===a.length)for(r=0;r<this._frames.length;r++)e.push(this._frames[r].index);else for(var r=0;r<a.length;r++)t&&this._frames[a[r]]?e.push(this._frames[a[r]].index):this.getFrameByName(a[r])&&e.push(this.getFrameByName(a[r]).index);return e},destroy:function(){this._frames=null,this._frameNames=null}},z.FrameData.prototype.constructor=z.FrameData,Object.defineProperty(z.FrameData.prototype,"total",{get:function(){return this._frames.length}}),z.AnimationParser={spriteSheet:function(i,t,y,s,n,o,r,a){void 0===n&&(n=-1),void 0===o&&(o=0),void 0===r&&(r=0),void 0===a&&(a=0);var h=t;if("string"==typeof t&&(h=i.cache.getImage(t)),null===h)return null;var l=h.width,v=h.height;if(0===l||0===v)return console.warn("Phaser.AnimationParser.spriteSheet: '%s' width (%f) or height (%f) is zero",t,l,v),null;if(0>=y&&(y=x(-l/A(-1,y))),0>=s&&(s=x(-v/A(-1,s))),l<y||v<s)return console.warn("Phaser.AnimationParser.spriteSheet: '%s' width (%f) or height (%f) is less than the given frameWidth (%f) or frameHeight (%f)",t,l,v,y,s),null;var _=x((l-o)/(y+r))*x((v-o)/(s+r));if(a>_||a<-_)return console.warn("Phaser.AnimationParser.spriteSheet: '%s' skipFrames = %f is larger than the frame total %f",t,a,_),null;if(0>a&&(a=_+a),-1!==n&&(_=a+n),0===_)return console.warn("Phaser.AnimationParser.spriteSheet: '%s' zero frames were produced",t),null;for(var b=new z.FrameData,p=o,f=o,g=0;g<_;g++)b.addFrame(new z.Frame(g,p,f,y,s,"")),(p+=y+r)+y>l&&(p=o,f+=s+r);return b},JSONData:function(a,t){if(!t.frames)return console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),void console.log(t);for(var e=new z.FrameData,n=t.frames,o=0,r;o<n.length;o++)r=e.addFrame(new z.Frame(o,n[o].frame.x,n[o].frame.y,n[o].frame.w,n[o].frame.h,n[o].filename)),n[o].trimmed&&r.setTrim(n[o].trimmed,n[o].sourceSize.w,n[o].sourceSize.h,n[o].spriteSourceSize.x,n[o].spriteSourceSize.y,n[o].spriteSourceSize.w,n[o].spriteSourceSize.h),n[o].rotated&&(r.rotated=!0);return e},JSONDataPyxel:function(i,d){if(["layers","tilewidth","tileheight","tileswide","tileshigh"].forEach(function(e){if(!d[e])return console.warn("Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing \""+e+"\" key."),void console.log(d)}),1!==d.layers.length)return console.warn("Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps."),void console.log(d);for(var e=new z.FrameData,t=d.tileheight,n=d.tilewidth,o=d.layers[0].tiles,r=0;r<o.length;r++)e.addFrame(new z.Frame(r,o[r].x,o[r].y,n,t,"frame_"+r)).setTrim(!1);return e},JSONDataHash:function(i,t){if(!t.frames)return console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),void console.log(t);var e=new z.FrameData,n=t.frames,o=0,r;for(var s in n)r=e.addFrame(new z.Frame(o,n[s].frame.x,n[s].frame.y,n[s].frame.w,n[s].frame.h,s)),n[s].trimmed&&r.setTrim(n[s].trimmed,n[s].sourceSize.w,n[s].sourceSize.h,n[s].spriteSourceSize.x,n[s].spriteSourceSize.y,n[s].spriteSourceSize.w,n[s].spriteSourceSize.h),n[s].rotated&&(r.rotated=!0),o++;return e},XMLData:function(i,t){if(t.getElementsByTagName("TextureAtlas")){for(var e=new z.FrameData,y=t.getElementsByTagName("SubTexture"),g=0,m,s,n,o,r,a,h,l,c,u,d;g<y.length;g++)s=(n=y[g].attributes).name.value,o=parseInt(n.x.value,10),r=parseInt(n.y.value,10),a=parseInt(n.width.value,10),h=parseInt(n.height.value,10),l=null,c=null,n.frameX&&(l=E(parseInt(n.frameX.value,10)),c=E(parseInt(n.frameY.value,10)),u=parseInt(n.frameWidth.value,10),d=parseInt(n.frameHeight.value,10)),m=e.addFrame(new z.Frame(g,o,r,a,h,s)),null===l&&null===c||m.setTrim(!0,a,h,l,c,u,d);return e}console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag")}},z.Cache=function(e){this.game=e,this.autoResolveURL=!1,this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{},compressedTexture:{}},this._urlMap={},this._urlResolver=new Image,this._urlTemp=null,this.onSoundUnlock=new z.Signal,this._cacheMap=[],this._cacheMap[z.Cache.CANVAS]=this._cache.canvas,this._cacheMap[z.Cache.IMAGE]=this._cache.image,this._cacheMap[z.Cache.TEXTURE]=this._cache.texture,this._cacheMap[z.Cache.SOUND]=this._cache.sound,this._cacheMap[z.Cache.TEXT]=this._cache.text,this._cacheMap[z.Cache.PHYSICS]=this._cache.physics,this._cacheMap[z.Cache.TILEMAP]=this._cache.tilemap,this._cacheMap[z.Cache.BINARY]=this._cache.binary,this._cacheMap[z.Cache.BITMAPDATA]=this._cache.bitmapData,this._cacheMap[z.Cache.BITMAPFONT]=this._cache.bitmapFont,this._cacheMap[z.Cache.JSON]=this._cache.json,this._cacheMap[z.Cache.XML]=this._cache.xml,this._cacheMap[z.Cache.VIDEO]=this._cache.video,this._cacheMap[z.Cache.SHADER]=this._cache.shader,this._cacheMap[z.Cache.RENDER_TEXTURE]=this._cache.renderTexture,this._pendingCount=0,this.onReady=new z.Signal,this._addImages()},z.Cache.CANVAS=1,z.Cache.IMAGE=2,z.Cache.TEXTURE=3,z.Cache.SOUND=4,z.Cache.TEXT=5,z.Cache.PHYSICS=6,z.Cache.TILEMAP=7,z.Cache.BINARY=8,z.Cache.BITMAPDATA=9,z.Cache.BITMAPFONT=10,z.Cache.JSON=11,z.Cache.XML=12,z.Cache.VIDEO=13,z.Cache.SHADER=14,z.Cache.RENDER_TEXTURE=15,z.Cache.DEFAULT=null,z.Cache.DEFAULT_KEY="__default",z.Cache.DEFAULT_SRC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==",z.Cache.MISSING=null,z.Cache.MISSING_KEY="__missing",z.Cache.MISSING_SRC="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==",z.Cache.READY_TIMEOUT=1e3,z.Cache.prototype={addCompressedTextureMetaData:function(a,i,d,l){this.checkImageKey(a)&&this.removeImage(a);var n=d in z.LoaderParser?z.LoaderParser[d](l):l,p={key:a,url:i,data:n,base:new PIXI.BaseTexture(n,null,this.game.resolution),frame:new z.Frame(0,0,0,n.width,n.height,a),frameData:new z.FrameData,fileFormat:d};return p.frameData.addFrame(new z.Frame(0,0,0,n.width,n.height,i)),this._cache.image[a]=p,this._resolveURL(i,p),p},addCanvas:function(a,t,r){void 0===r&&(r=t.getContext("2d")),this._cache.canvas[a]={canvas:t,context:r}},addImage:function(a,r,o){this.checkImageKey(a)&&this.removeImage(a),!1===o.complete&&console.warn("Phaser.Cache.addImage: Image \""+a+"\" hasn't been retrieved yet");var i={key:a,url:r,data:o,base:new PIXI.BaseTexture(o,null,this.game.resolution),frame:new z.Frame(0,0,0,o.width,o.height,a),frameData:new z.FrameData};return i.frameData.addFrame(new z.Frame(0,0,0,o.width,o.height,r)),this._cache.image[a]=i,this._resolveURL(r,i),"__default"===a?z.Cache.DEFAULT=new PIXI.Texture(i.base):"__missing"==a&&(z.Cache.MISSING=new PIXI.Texture(i.base)),i},addImageAsync:function(a,t,e){var r=this,o=new Image;o.onload=function(){e.call(this,r.addImage(a,null,o)),r._removePending(),o.onload=null},this._addPending(),o.src=t},addDefaultImage:function(){this.addImageAsync(z.Cache.DEFAULT_KEY,z.Cache.DEFAULT_SRC,function(e){e.base.skipRender=!0,z.Cache.DEFAULT=new PIXI.Texture(e.base)})},addMissingImage:function(){this.addImageAsync(z.Cache.MISSING_KEY,z.Cache.MISSING_SRC,function(e){z.Cache.MISSING=new PIXI.Texture(e.base)})},addSound:function(a,t,r,d,l){void 0===d&&(d=!0,l=!1),void 0===l&&(d=!1,l=!0);var p=!1;l&&(p=!0),this._cache.sound[a]={url:t,data:r,isDecoding:!1,decoded:p,webAudio:d,audioTag:l,locked:this.game.sound.touchLocked},this._resolveURL(t,this._cache.sound[a])},addText:function(a,t,r){this._cache.text[a]={url:t,data:r},this._resolveURL(t,this._cache.text[a])},addPhysicsData:function(a,t,r,o){this._cache.physics[a]={url:t,data:r,format:o},this._resolveURL(t,this._cache.physics[a])},addTilemap:function(a,t,r,o){this._cache.tilemap[a]={url:t,data:r,format:o},this._resolveURL(t,this._cache.tilemap[a])},addBinary:function(a,t){this._cache.binary[a]=t},addBitmapData:function(a,t,r){return t.key=a,void 0===r&&(r=new z.FrameData).addFrame(t.textureFrame),this._cache.bitmapData[a]={data:t,frameData:r},t},addBitmapFont:function(i,t,d,l,n,o,r){var a={url:t,data:d,font:null,base:new PIXI.BaseTexture(d,null,this.game.resolution)};void 0===o&&(o=0),void 0===r&&(r=0),a.font="json"===n?z.LoaderParser.jsonBitmapFont(l,a.base,o,r,!1,this.game.resolution):z.LoaderParser.xmlBitmapFont(l,a.base,o,r,!1,this.game.resolution),this._cache.bitmapFont[i]=a,this._resolveURL(t,a)},addBitmapFontFromAtlas:function(i,t,e,s,n,o,r){var a=this.getFrameByName(t,e);if(a){var d={font:null,base:this.getBaseTexture(t),frame:a};void 0===o&&(o=0),void 0===r&&(r=0);var l;"json"===n?(l=this.getJSON(s),d.font=z.LoaderParser.jsonBitmapFont(l,d.base,o,r,a,this.game.resolution)):(l=this.getXML(s),d.font=z.LoaderParser.xmlBitmapFont(l,d.base,o,r,a,this.game.resolution)),this._cache.bitmapFont[i]=d}},addJSON:function(a,t,r){this._cache.json[a]={url:t,data:r},this._resolveURL(t,this._cache.json[a])},addXML:function(a,t,r){this._cache.xml[a]={url:t,data:r},this._resolveURL(t,this._cache.xml[a])},addVideo:function(a,t,r,o){this._cache.video[a]={url:t,data:r,isBlob:o,locked:!0},this._resolveURL(t,this._cache.video[a])},addShader:function(a,t,r){this._cache.shader[a]={url:t,data:r},this._resolveURL(t,this._cache.shader[a])},addRenderTexture:function(a,t){this._cache.renderTexture[a]={texture:t,frame:new z.Frame(0,0,0,t.width,t.height,"","")}},addSpriteSheet:function(i,d,p,u,m,g,r,y,f){void 0===g&&(g=-1),void 0===r&&(r=0),void 0===y&&(y=0);var l={key:i,url:d,data:p,frameWidth:u,frameHeight:m,margin:r,spacing:y,base:new PIXI.BaseTexture(p,null,this.game.resolution),frameData:z.AnimationParser.spriteSheet(this.game,p,u,m,g,r,y,f)};this._cache.image[i]=l,this._resolveURL(d,l)},addTextureAtlas:function(a,i,d,l,n){var o={key:a,url:i,data:d,base:new PIXI.BaseTexture(d,null,this.game.resolution)};o.frameData=n===z.Loader.TEXTURE_ATLAS_XML_STARLING?z.AnimationParser.XMLData(this.game,l,a):n===z.Loader.TEXTURE_ATLAS_JSON_PYXEL?z.AnimationParser.JSONDataPyxel(this.game,l,a):Array.isArray(l.frames)?z.AnimationParser.JSONData(this.game,l,a):z.AnimationParser.JSONDataHash(this.game,l,a),this._cache.image[a]=o,this._resolveURL(i,o)},reloadSound:function(a){var t=this,e=this.getSound(a);e&&(e.data.src=e.url,e.data.addEventListener("canplaythrough",function(){return t.reloadSoundComplete(a)},!1),e.data.load())},reloadSoundComplete:function(a){var t=this.getSound(a);t&&(t.locked=!1,this.onSoundUnlock.dispatch(a))},updateSound:function(a,t,e){var r=this.getSound(a);r&&(r[t]=e)},decodedSound:function(a,t){var e=this.getSound(a);e.data=t,e.decoded=!0,e.isDecoding=!1},isSoundDecoded:function(a){var t=this.getItem(a,z.Cache.SOUND,"isSoundDecoded");if(t)return t.decoded},isSoundReady:function(a){var t=this.getItem(a,z.Cache.SOUND,"isSoundDecoded");if(t)return t.decoded&&!this.game.sound.touchLocked},checkKey:function(a,t){return!!this._cacheMap[a][t]},checkURL:function(e){return!!this._urlMap[this._resolveURL(e)]},checkCanvasKey:function(e){return this.checkKey(z.Cache.CANVAS,e)},checkImageKey:function(e){return this.checkKey(z.Cache.IMAGE,e)},checkTextureKey:function(e){return this.checkKey(z.Cache.TEXTURE,e)},checkSoundKey:function(e){return this.checkKey(z.Cache.SOUND,e)},checkTextKey:function(e){return this.checkKey(z.Cache.TEXT,e)},checkPhysicsKey:function(e){return this.checkKey(z.Cache.PHYSICS,e)},checkTilemapKey:function(e){return this.checkKey(z.Cache.TILEMAP,e)},checkBinaryKey:function(e){return this.checkKey(z.Cache.BINARY,e)},checkBitmapDataKey:function(e){return this.checkKey(z.Cache.BITMAPDATA,e)},checkBitmapFontKey:function(e){return this.checkKey(z.Cache.BITMAPFONT,e)},checkJSONKey:function(e){return this.checkKey(z.Cache.JSON,e)},checkXMLKey:function(e){return this.checkKey(z.Cache.XML,e)},checkVideoKey:function(e){return this.checkKey(z.Cache.VIDEO,e)},checkShaderKey:function(e){return this.checkKey(z.Cache.SHADER,e)},checkRenderTextureKey:function(e){return this.checkKey(z.Cache.RENDER_TEXTURE,e)},getItem:function(a,t,e,r){return this.checkKey(t,a)?void 0===r?this._cacheMap[t][a]:this._cacheMap[t][a][r]:(e&&console.warn("Phaser.Cache."+e+": Key \""+a+"\" not found in Cache."),null)},getCanvas:function(e){return this.getItem(e,z.Cache.CANVAS,"getCanvas","canvas")},getImage:function(a,t){void 0!==a&&null!==a||(a="__default"),void 0===t&&(t=!1);var e=this.getItem(a,z.Cache.IMAGE,"getImage");return null===e&&(e=this.getItem("__missing",z.Cache.IMAGE,"getImage")),t?e:e.data},getTextureFrame:function(e){return this.getItem(e,z.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(e){return this.getItem(e,z.Cache.SOUND,"getSound")},getSoundData:function(e){return this.getItem(e,z.Cache.SOUND,"getSoundData","data")},getText:function(e){return this.getItem(e,z.Cache.TEXT,"getText","data")},getPhysicsData:function(a,t,e){var i=this.getItem(a,z.Cache.PHYSICS,"getPhysicsData","data");if(null===i||void 0===t||null===t)return i;if(i[t]){var n=i[t];if(!n||!e)return n;for(var d in n)if((d=n[d]).fixtureKey===e)return d;console.warn("Phaser.Cache.getPhysicsData: Could not find given fixtureKey: \""+e+" in "+a+"\"")}else console.warn("Phaser.Cache.getPhysicsData: Invalid key/object: \""+a+" / "+t+"\"");return null},getTilemapData:function(e){return this.getItem(e,z.Cache.TILEMAP,"getTilemapData")},getBinary:function(e){return this.getItem(e,z.Cache.BINARY,"getBinary")},getBitmapData:function(e){return this.getItem(e,z.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(e){return this.getItem(e,z.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(a,t){var e=this.getItem(a,z.Cache.JSON,"getJSON","data");return e?t?z.Utils.extend(!0,Array.isArray(e)?[]:{},e):e:null},getXML:function(e){return this.getItem(e,z.Cache.XML,"getXML","data")},getVideo:function(e){return this.getItem(e,z.Cache.VIDEO,"getVideo")},getShader:function(e){return this.getItem(e,z.Cache.SHADER,"getShader","data")},getRenderTexture:function(e){return this.getItem(e,z.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(a,t){return void 0===t&&(t=z.Cache.IMAGE),this.getItem(a,t,"getBaseTexture","base")},getFrame:function(a,t){return void 0===t&&(t=z.Cache.IMAGE),this.getItem(a,t,"getFrame","frame")},getFrameCount:function(a,t){var e=this.getFrameData(a,t);return e?e.total:0},getFrameData:function(a,t){return void 0===t&&(t=z.Cache.IMAGE),this.getItem(a,t,"getFrameData","frameData")},hasFrameData:function(a,t){return void 0===t&&(t=z.Cache.IMAGE),null!==this.getItem(a,t,"","frameData")},updateFrameData:function(a,t,e){void 0===e&&(e=z.Cache.IMAGE),this._cacheMap[e][a]&&(this._cacheMap[e][a].frameData=t)},getFrameByIndex:function(a,t,e){var r=this.getFrameData(a,e);return r?r.getFrame(t):null},getFrameByName:function(a,t,e){var r=this.getFrameData(a,e);return r?r.getFrameByName(t):null},getURL:function(e){return(e=this._resolveURL(e))?this._urlMap[e]:(console.warn("Phaser.Cache.getUrl: Invalid url: \""+e+"\" or Cache.autoResolveURL was false"),null)},getKeys:function(a){void 0===a&&(a=z.Cache.IMAGE);var t=[];if(this._cacheMap[a])for(var e in this._cacheMap[a])"__default"!==e&&"__missing"!==e&&t.push(e);return t},removeCanvas:function(e){delete this._cache.canvas[e]},removeImage:function(a,t){void 0===t&&(t=!0);var e=this.getImage(a,!0);t&&e.base&&e.base.destroy(),delete this._cache.image[a]},removeSound:function(e){delete this._cache.sound[e]},removeText:function(e){delete this._cache.text[e]},removePhysics:function(e){delete this._cache.physics[e]},removeTilemap:function(e){delete this._cache.tilemap[e]},removeBinary:function(e){delete this._cache.binary[e]},removeBitmapData:function(e){delete this._cache.bitmapData[e]},removeBitmapFont:function(e){delete this._cache.bitmapFont[e]},removeJSON:function(e){delete this._cache.json[e]},removeXML:function(e){delete this._cache.xml[e]},removeVideo:function(e){delete this._cache.video[e]},removeShader:function(e){delete this._cache.shader[e]},removeRenderTexture:function(e){delete this._cache.renderTexture[e]},removeSpriteSheet:function(e){delete this._cache.spriteSheet[e]},removeTextureAtlas:function(e){delete this._cache.image[e]},clearGLTextures:function(){for(var e in this._cache.image)this._cache.image[e].base._glTextures=[]},_resolveURL:function(a,t){return this.autoResolveURL?(this._urlResolver.src=this.game.load.baseURL+a,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",t&&(this._urlMap[this._urlTemp]=t),this._urlTemp):null},destroy:function(){for(var a=0,t;a<this._cacheMap.length;a++)for(var e in t=this._cacheMap[a],t)"__default"!==e&&"__missing"!==e&&(this.destroyItem(t[e]),delete t[e]);this._urlMap=null,this._urlResolver=null,this._urlTemp=null},destroyItem:function(e){e.destroy?e.destroy():(e.base&&e.base.destroy&&e.base.destroy(),e.data&&e.data.destroy&&e.data.destroy(),e.frameData&&e.frameData.destroy&&e.frameData.destroy(),e.texture&&e.texture.destroy&&e.texture.destroy(!0))},_addImages:function(){this._pendingCount=0,this.addDefaultImage(),this.addMissingImage();var a=this,t=z.Cache.READY_TIMEOUT;0<z.Cache.READY_TIMEOUT?setTimeout(function(){a.isReady||(console.warn("Phaser.Cache: Still waiting for images after %s ms.",t),a._ready())},z.Cache.READY_TIMEOUT):this._ready()},_addPending:function(){this._pendingCount+=1},_removePending:function(){this._pendingCount-=1,this._checkReady()},_checkReady:function(){this.isReady&&this._ready()},_ready:function(){this._pendingCount=0,this.onReady.dispatch(this)}},z.Cache.prototype.constructor=z.Cache,Object.defineProperty(z.Cache.prototype,"isReady",{get:function(){return 0>=this._pendingCount}}),z.Loader=function(e){this.game=e,this.cache=e.cache,this.resetLocked=!1,this.isLoading=!1,this.hasLoaded=!1,this.preloadSprite=null,this.crossOrigin=!1,this.baseURL="",this.path="",this.headers={requestedWith:!1,json:"application/json",xml:"application/xml"},this.onLoadStart=new z.Signal,this.onBeforeLoadComplete=new z.Signal,this.onLoadComplete=new z.Signal,this.onPackComplete=new z.Signal,this.onFileStart=new z.Signal,this.onFileComplete=new z.Signal,this.onFileError=new z.Signal,this.enableParallel=!0,this.maxParallelDownloads=4,this._withSyncPointDepth=0,this._fileList=[],this._flightQueue=[],this._processingHead=0,this._fileLoadStarted=!1,this._totalPackCount=0,this._totalFileCount=0,this._loadedPackCount=0,this._loadedFileCount=0},z.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,z.Loader.TEXTURE_ATLAS_JSON_HASH=1,z.Loader.TEXTURE_ATLAS_XML_STARLING=2,z.Loader.PHYSICS_LIME_CORONA_JSON=3,z.Loader.PHYSICS_PHASER_JSON=4,z.Loader.TEXTURE_ATLAS_JSON_PYXEL=5,z.Loader.prototype={setPreloadSprite:function(a,r){r=r||0,this.preloadSprite={sprite:a,direction:r,width:a.width,height:a.height,rect:null},this.preloadSprite.rect=0===r?new z.Rectangle(0,0,1,a.height):new z.Rectangle(0,0,a.width,1),a.crop(this.preloadSprite.rect),a.visible=!0},resize:function(){this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height&&(this.preloadSprite.rect.height=this.preloadSprite.sprite.height)},checkKeyExists:function(a,t){return-1<this.getAssetIndex(a,t)},getAssetIndex:function(a,t){for(var e=-1,r=0,o;r<this._fileList.length&&(o=this._fileList[r],!(o.type===a&&o.key===t&&(e=r,!o.loaded&&!o.loading)));r++);return e},getAsset:function(a,t){var e=this.getAssetIndex(a,t);return-1<e&&{index:e,file:this._fileList[e]}},reset:function(a,t){void 0===t&&(t=!1),this.resetLocked||(a&&(this.preloadSprite=null),this.isLoading=!1,this._processingHead=0,this._fileList.length=0,this._flightQueue.length=0,this._fileLoadStarted=!1,this._totalFileCount=0,this._totalPackCount=0,this._loadedPackCount=0,this._loadedFileCount=0,t&&(this.onLoadStart.removeAll(),this.onLoadComplete.removeAll(),this.onPackComplete.removeAll(),this.onFileStart.removeAll(),this.onFileComplete.removeAll(),this.onFileError.removeAll()))},addToFileList:function(d,p,c,u,s,n){if(void 0===s&&(s=!1),void 0===p||""===p)return console.warn("Phaser.Loader: Invalid or no key given of type "+d),this;if(void 0===c||null===c){if(!n)return console.warn("Phaser.Loader: No URL given for file type: "+d+" key: "+p),this;c=p+n}var m={type:d,key:p,path:this.path,url:c,syncPoint:0<this._withSyncPointDepth,data:null,loading:!1,loaded:!1,error:!1};if(u)for(var r in u)m[r]=u[r];var a=this.getAssetIndex(d,p);if(s&&-1<a){var g=this._fileList[a];g.loading||g.loaded?(this._fileList.push(m),this._totalFileCount++):this._fileList[a]=m}else-1===a&&(this._fileList.push(m),this._totalFileCount++);return this},replaceInFileList:function(a,t,e,r){return this.addToFileList(a,t,e,r,!0)},pack:function(a,d,l,p){if(void 0===d&&(d=null),void 0===l&&(l=null),void 0===p&&(p=null),!d&&!l)return console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this;var c={type:"packfile",key:a,url:d,path:this.path,syncPoint:!0,data:null,loading:!1,loaded:!1,error:!1,callbackContext:p};l&&("string"==typeof l&&(l=JSON.parse(l)),c.data=l||{},c.loaded=!0);for(var n=0,o;n<this._fileList.length+1;n++)if(o=this._fileList[n],!o||!o.loaded&&!o.loading&&"packfile"!==o.type){this._fileList.splice(n,0,c),this._totalPackCount++;break}return this},image:function(a,t,r){return"object"==typeof t?this.texture(a,t,r):this.addToFileList("image",a,t,void 0,r,".png")},imageFromBitmapData:function(a,t,e){return this.image(a,t.canvas.toDataURL("image/png"),e)},imageFromGrid:function(a,t,e,r,i,n){return this.imageFromBitmapData(a,this.game.create.grid(a,t,e,r,i,n,!1))},imageFromTexture:function(a,t,e,r,o){return this.imageFromBitmapData(a,this.game.create.texture(a,t,e,r,o,!1))},texture:function(a,t,e){if(this.game.renderType===z.WEBGL){var r=this.game.renderer.extensions.compression,o;for(o in t)if(o.toUpperCase()in r)return this.addToFileList("texture",a,t[o],void 0,e,".pvr")}return t.truecolor&&this.addToFileList("image",a,t.truecolor,void 0,e,".png"),this},images:function(a,t){if(Array.isArray(t))for(e=0;e<a.length;e++)this.image(a[e],t[e]);else for(var e=0;e<a.length;e++)this.image(a[e]);return this},text:function(a,t,e){return this.addToFileList("text",a,t,void 0,e,".txt")},json:function(a,t,e){return this.addToFileList("json",a,t,void 0,e,".json")},shader:function(a,t,e){return this.addToFileList("shader",a,t,void 0,e,".frag")},xml:function(a,t,e){return this.addToFileList("xml",a,t,void 0,e,".xml")},script:function(a,t,e,r){return void 0===e&&(e=!1),!1!==e&&void 0===r&&(r=this),this.addToFileList("script",a,t,{syncPoint:!0,callback:e,callbackContext:r},!1,".js")},binary:function(a,t,e,r){return void 0===e&&(e=!1),!1!==e&&void 0===r&&(r=e),this.addToFileList("binary",a,t,{callback:e,callbackContext:r},!1,".bin")},spritesheet:function(d,t,e,l,p,c,u,m){return void 0===p&&(p=-1),void 0===c&&(c=0),void 0===u&&(u=0),void 0===m&&(m=0),this.addToFileList("spritesheet",d,t,{frameWidth:e,frameHeight:l,frameMax:p,margin:c,spacing:u,skipFrames:m},!1,".png")},audio:function(a,t,r){return this.game.sound.noAudio?this:(void 0===r&&(r=!0),"string"==typeof t&&(t=[t]),this.addToFileList("audio",a,t,{buffer:null,autoDecode:r}))},audioSprite:function(a,t,e,r,o){return this.game.sound.noAudio?this:(void 0===e&&(e=null),void 0===r&&(r=null),void 0===o&&(o=!0),this.audio(a,t,o),e?this.json(a+"-audioatlas",e):r?("string"==typeof r&&(r=JSON.parse(r)),this.cache.addJSON(a+"-audioatlas","",r)):console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object"),this)},audiosprite:function(a,t,e,r,o){return this.audioSprite(a,t,e,r,o)},video:function(a,t,r,o){return void 0===r&&(r=this.game.device.firefox?"loadeddata":"canplaythrough"),void 0===o&&(o=!1),"string"==typeof t&&(t=[t]),this.addToFileList("video",a,t,{buffer:null,asBlob:o,loadEvent:r})},tilemap:function(a,t,e,r){if(void 0===t&&(t=null),void 0===e&&(e=null),void 0===r&&(r=z.Tilemap.CSV),t||e||(t=r===z.Tilemap.CSV?a+".csv":a+".json"),e){switch(r){case z.Tilemap.CSV:break;case z.Tilemap.TILED_JSON:"string"==typeof e&&(e=JSON.parse(e));}this.cache.addTilemap(a,null,e,r)}else this.addToFileList("tilemap",a,t,{format:r});return this},physics:function(a,t,e,r){return void 0===t&&(t=null),void 0===e&&(e=null),void 0===r&&(r=z.Physics.LIME_CORONA_JSON),t||e||(t=a+".json"),e?("string"==typeof e&&(e=JSON.parse(e)),this.cache.addPhysicsData(a,null,e,r)):this.addToFileList("physics",a,t,{format:r}),this},bitmapFont:function(d,t,e,l,p,c){if(void 0!==t&&null!==t||(t=d+".png"),void 0===e&&(e=null),void 0===l&&(l=null),null===e&&null===l&&(e=d+".xml"),void 0===p&&(p=0),void 0===c&&(c=0),e)this.addToFileList("bitmapfont",d,t,{atlasURL:e,xSpacing:p,ySpacing:c});else if("string"==typeof l){var u,m;try{u=JSON.parse(l)}catch(e){m=this.parseXml(l)}if(!m&&!u)throw new Error("Phaser.Loader. Invalid Bitmap Font atlas given");this.addToFileList("bitmapfont",d,t,{atlasURL:null,atlasData:u||m,atlasType:u?"json":"xml",xSpacing:p,ySpacing:c})}return this},atlasJSONArray:function(a,t,e,r){return this.atlas(a,t,e,r,z.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(a,t,e,r){return this.atlas(a,t,e,r,z.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(a,t,e,r){return void 0===e&&(e=null),void 0===r&&(r=null),e||r||(e=a+".xml"),this.atlas(a,t,e,r,z.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(a,t,e,i,d){if(void 0!==t&&null!==t||(t=a+".png"),void 0===e&&(e=null),void 0===i&&(i=null),void 0===d&&(d=z.Loader.TEXTURE_ATLAS_JSON_ARRAY),e||i||(e=d===z.Loader.TEXTURE_ATLAS_XML_STARLING?a+".xml":a+".json"),e)this.addToFileList("textureatlas",a,t,{atlasURL:e,format:d});else{switch(d){case z.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==typeof i&&(i=JSON.parse(i));break;case z.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==typeof i){var l=this.parseXml(i);if(!l)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");i=l}}this.addToFileList("textureatlas",a,t,{atlasURL:null,atlasData:i,format:d})}return this},withSyncPoint:function(a,t){this._withSyncPointDepth++;try{a.call(t||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(a,t){var e=this.getAsset(a,t);return e&&(e.file.syncPoint=!0),this},removeFile:function(a,t){var e=this.getAsset(a,t);e&&(e.loaded||e.loading||this._fileList.splice(e.index,1))},removeAll:function(){this._fileList.length=0,this._flightQueue.length=0},start:function(){this.isLoading||(this.hasLoaded=!1,this.isLoading=!0,this.updateProgress(),this.processLoadQueue())},processLoadQueue:function(){if(!this.isLoading)return console.warn("Phaser.Loader - active loading canceled / reset"),void this.finishedLoading(!0);for(e=0;e<this._flightQueue.length;e++)((r=this._flightQueue[e]).loaded||r.error)&&(this._flightQueue.splice(e,1),e--,r.loading=!1,r.requestUrl=null,r.requestObject=null,r.error&&this.onFileError.dispatch(r.key,r),"packfile"===r.type?"packfile"===r.type&&r.error&&(this._loadedPackCount++,this.onPackComplete.dispatch(r.key,!r.error,this._loadedPackCount,this._totalPackCount)):(this._loadedFileCount++,this.onFileComplete.dispatch(this.progress,r.key,!r.error,this._loadedFileCount,this._totalFileCount)));for(var a=!1,t=this.enableParallel?C(1,this.maxParallelDownloads):1,e=this._processingHead,r;e<this._fileList.length&&(r=this._fileList[e],"packfile"===r.type&&!r.error&&r.loaded&&e===this._processingHead&&(this.processPack(r),this._loadedPackCount++,this.onPackComplete.dispatch(r.key,!r.error,this._loadedPackCount,this._totalPackCount)),r.loaded||r.error?e===this._processingHead&&(this._processingHead=e+1):!r.loading&&this._flightQueue.length<t&&("packfile"!==r.type||r.data?a||(this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this._flightQueue.push(r),r.loading=!0,this.onFileStart.dispatch(this.progress,r.key,r.url),this.loadFile(r)):(this._flightQueue.push(r),r.loading=!0,this.loadFile(r))),!r.loaded&&r.syncPoint&&(a=!0),!(this._flightQueue.length>=t||a&&this._loadedPackCount===this._totalPackCount));e++);if(this.updateProgress(),this._processingHead>=this._fileList.length)this.finishedLoading();else if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var o=this;setTimeout(function(){o.finishedLoading(!0)},2e3)}},finishedLoading:function(e){this.hasLoaded||(this.hasLoaded=!0,this.isLoading=!1,e||this._fileLoadStarted||(this._fileLoadStarted=!0,this.onLoadStart.dispatch()),this.game.state.loadUpdate(),this.onBeforeLoadComplete.dispatch(),this.reset(),this.onLoadComplete.dispatch(),this.game.state&&this.game.state.loadComplete())},asyncComplete:function(a,t){void 0===t&&(t=""),a.loaded=!0,a.error=!!t,t&&(a.errorMessage=t,console.warn("Phaser.Loader - "+a.type+"["+a.key+"]: "+t)),this.processLoadQueue()},processPack:function(a){var t=a.data[a.key];if(t)for(var e=0,r;e<t.length;e++)switch(r=t[e],r.type){case"image":this.image(r.key,r.url,r.overwrite);break;case"text":this.text(r.key,r.url,r.overwrite);break;case"json":this.json(r.key,r.url,r.overwrite);break;case"xml":this.xml(r.key,r.url,r.overwrite);break;case"script":this.script(r.key,r.url,r.callback,a.callbackContext||this);break;case"binary":this.binary(r.key,r.url,r.callback,a.callbackContext||this);break;case"spritesheet":this.spritesheet(r.key,r.url,r.frameWidth,r.frameHeight,r.frameMax,r.margin,r.spacing,r.skipFrames);break;case"video":this.video(r.key,r.urls);break;case"audio":this.audio(r.key,r.urls,r.autoDecode);break;case"audiosprite":this.audiosprite(r.key,r.urls,r.jsonURL,r.jsonData,r.autoDecode);break;case"tilemap":this.tilemap(r.key,r.url,r.data,z.Tilemap[r.format]);break;case"physics":this.physics(r.key,r.url,r.data,z.Loader[r.format]);break;case"bitmapFont":this.bitmapFont(r.key,r.textureURL,r.atlasURL,r.atlasData,r.xSpacing,r.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(r.key,r.textureURL,r.atlasURL,r.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(r.key,r.textureURL,r.atlasURL,r.atlasData);break;case"atlasXML":this.atlasXML(r.key,r.textureURL,r.atlasURL,r.atlasData);break;case"atlas":this.atlas(r.key,r.textureURL,r.atlasURL,r.atlasData,z.Loader[r.format]);break;case"shader":this.shader(r.key,r.url,r.overwrite);}else console.warn("Phaser.Loader - "+a.key+": pack has data, but not for pack key")},transformUrl:function(a,r){return!!a&&(a.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?a:this.baseURL+r.path+a)},loadFile:function(e){switch(e.type){case"packfile":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(e);break;case"audio":e.url=this.getAudioURL(e.url),e.url?this.game.sound.usingWebAudio?this.xhrLoad(e,this.transformUrl(e.url,e),"arraybuffer",this.fileComplete):this.game.sound.usingAudioTag&&this.loadAudioTag(e):this.fileError(e,null,"No supported audio URL specified or device does not have audio playback support");break;case"video":e.url=this.getVideoURL(e.url),e.url?e.asBlob?this.xhrLoad(e,this.transformUrl(e.url,e),"blob",this.fileComplete):this.loadVideoTag(e):this.fileError(e,null,"No supported video URL specified or device does not have video playback support");break;case"json":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.xmlLoadComplete);break;case"tilemap":e.format===z.Tilemap.TILED_JSON?this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.jsonLoadComplete):e.format===z.Tilemap.CSV?this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.csvLoadComplete):this.asyncComplete(e,"invalid Tilemap format: "+e.format);break;case"text":case"script":case"shader":case"physics":this.xhrLoad(e,this.transformUrl(e.url,e),"text",this.fileComplete);break;case"texture":"truecolor"===e.key.split("_").pop()?this.loadImageTag(e):this.xhrLoad(e,this.transformUrl(e.url,e),"arraybuffer",this.fileComplete);break;case"binary":this.xhrLoad(e,this.transformUrl(e.url,e),"arraybuffer",this.fileComplete);}},loadImageTag:function(a){var t=this;a.data=new Image,a.data.name=a.key,this.crossOrigin&&(a.data.crossOrigin=this.crossOrigin),a.data.onload=function(){a.data.onload&&(a.data.onload=null,a.data.onerror=null,t.fileComplete(a))},a.data.onerror=function(){a.data.onload&&(a.data.onload=null,a.data.onerror=null,t.fileError(a))},a.data.src=this.transformUrl(a.url,a),!this.game.device.firefox&&a.data.complete&&a.data.width&&a.data.height&&(a.data.onload=null,a.data.onerror=null,this.fileComplete(a))},loadVideoTag:function(a){var t=this;a.data=document.createElement("video"),a.data.name=a.key,a.data.controls=!1,a.data.autoplay=!1;var e=function(){a.data.removeEventListener(a.loadEvent,e,!1),a.data.onerror=null,a.data.canplay=!0,z.GAMES[t.game.id].load.fileComplete(a)};a.data.onerror=function(){a.data.removeEventListener(a.loadEvent,e,!1),a.data.onerror=null,a.data.canplay=!1,t.fileError(a)},a.data.addEventListener(a.loadEvent,e,!1),a.data.src=this.transformUrl(a.url,a),a.data.load()},loadAudioTag:function(a){var t=this;if(this.game.sound.touchLocked)a.data=new Audio,a.data.name=a.key,a.data.preload="auto",a.data.src=this.transformUrl(a.url,a),this.fileComplete(a);else{a.data=new Audio,a.data.name=a.key;var e=function(){a.data.removeEventListener("canplaythrough",e,!1),a.data.onerror=null,t.fileComplete(a)};a.data.onerror=function(){a.data.removeEventListener("canplaythrough",e,!1),a.data.onerror=null,t.fileError(a)},a.data.preload="auto",a.data.src=this.transformUrl(a.url,a),a.data.addEventListener("canplaythrough",e,!1),a.data.load()}},xhrLoad:function(a,t,e,i,s){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType=e,!1!==this.headers.requestedWith&&n.setRequestHeader("X-Requested-With",this.headers.requestedWith),this.headers[a.type]&&n.setRequestHeader("Accept",this.headers[a.type]),s=s||this.fileError;var o=this;n.onload=function(){try{return 4===n.readyState&&400<=n.status&&599>=n.status?s.call(o,a,n):i.call(o,a,n)}catch(t){o.hasLoaded?window.console&&console.error(t):o.asyncComplete(a,t.message||"Exception")}},n.onerror=function(){try{return s.call(o,a,n)}catch(t){o.hasLoaded?window.console&&console.error(t):o.asyncComplete(a,t.message||"Exception")}},a.requestObject=n,a.requestUrl=t,n.send()},getVideoURL:function(a){for(var t=0;t<a.length;t++){var e=a[t],r;if(!e.uri){if(0===e.indexOf("blob:")||0===e.indexOf("data:"))return e;if(0<=e.indexOf("?")&&(e=e.substr(0,e.indexOf("?"))),r=e.substr((C(0,e.lastIndexOf("."))||1/0)+1).toLowerCase(),this.game.device.canPlayVideo(r))return a[t]}else if(r=e.type,e=e.uri,this.game.device.canPlayVideo(r))return e}return null},getAudioURL:function(a){if(this.game.sound.noAudio)return null;for(var t=0;t<a.length;t++){var e=a[t],r;if(!e.uri){if(0===e.indexOf("blob:")||0===e.indexOf("data:"))return e;if(0<=e.indexOf("?")&&(e=e.substr(0,e.indexOf("?"))),r=e.substr((C(0,e.lastIndexOf("."))||1/0)+1).toLowerCase(),this.game.device.canPlayAudio(r))return a[t]}else if(r=e.type,e=e.uri,this.game.device.canPlayAudio(r))return e}return null},fileError:function(a,t,e){var r="error loading asset from URL "+(a.requestUrl||this.transformUrl(a.url,a));!e&&t&&(e=t.status),e&&(r=r+" ("+e+")"),this.asyncComplete(a,r)},fileComplete:function(a,t){var e=!0;switch(a.type){case"packfile":n=JSON.parse(t.responseText),a.data=n||{};break;case"texture":var r=/\.([^.]+)$/.exec(a.url.split("?",1)[0])[1].toLowerCase();null===a.data?this.cache.addCompressedTextureMetaData(a.key,a.url,r,t.response):this.cache.addCompressedTextureMetaData(a.key,a.url,r,a.data);break;case"image":this.cache.addImage(a.key,a.url,a.data);break;case"spritesheet":this.cache.addSpriteSheet(a.key,a.url,a.data,a.frameWidth,a.frameHeight,a.frameMax,a.margin,a.spacing,a.skipFrames);break;case"textureatlas":if(null==a.atlasURL)this.cache.addTextureAtlas(a.key,a.url,a.data,a.atlasData,a.format);else if(e=!1,a.format===z.Loader.TEXTURE_ATLAS_JSON_ARRAY||a.format===z.Loader.TEXTURE_ATLAS_JSON_HASH||a.format===z.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(a,this.transformUrl(a.atlasURL,a),"text",this.jsonLoadComplete);else{if(a.format!==z.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+a.format);this.xhrLoad(a,this.transformUrl(a.atlasURL,a),"text",this.xmlLoadComplete)}break;case"bitmapfont":a.atlasURL?(e=!1,this.xhrLoad(a,this.transformUrl(a.atlasURL,a),"text",function(a,t){var e;try{e=JSON.parse(t.responseText)}catch(e){}e?(a.atlasType="json",this.jsonLoadComplete(a,t)):(a.atlasType="xml",this.xmlLoadComplete(a,t))})):this.cache.addBitmapFont(a.key,a.url,a.data,a.atlasData,a.atlasType,a.xSpacing,a.ySpacing);break;case"video":if(a.asBlob)try{a.data=t.response}catch(t){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+a.key)}this.cache.addVideo(a.key,a.url,a.data,a.asBlob);break;case"audio":this.game.sound.usingWebAudio?(a.data=t.response,this.cache.addSound(a.key,a.url,a.data,!0,!1),a.autoDecode&&this.game.sound.decode(a.key)):this.cache.addSound(a.key,a.url,a.data,!1,!0);break;case"text":a.data=t.responseText,this.cache.addText(a.key,a.url,a.data);break;case"shader":a.data=t.responseText,this.cache.addShader(a.key,a.url,a.data);break;case"physics":var n=JSON.parse(t.responseText);this.cache.addPhysicsData(a.key,a.url,n,a.format);break;case"script":a.data=document.createElement("script"),a.data.language="javascript",a.data.type="text/javascript",a.data.defer=!1,a.data.text=t.responseText,document.head.appendChild(a.data),a.callback&&(a.data=a.callback.call(a.callbackContext,a.key,t.responseText));break;case"binary":a.data=a.callback?a.callback.call(a.callbackContext,a.key,t.response):t.response,this.cache.addBinary(a.key,a.data);}e&&this.asyncComplete(a)},jsonLoadComplete:function(a,t){var e=JSON.parse(t.responseText);"tilemap"===a.type?this.cache.addTilemap(a.key,a.url,e,a.format):"bitmapfont"===a.type?this.cache.addBitmapFont(a.key,a.url,a.data,e,a.atlasType,a.xSpacing,a.ySpacing):"json"===a.type?this.cache.addJSON(a.key,a.url,e):this.cache.addTextureAtlas(a.key,a.url,a.data,e,a.format),this.asyncComplete(a)},csvLoadComplete:function(a,t){var e=t.responseText;this.cache.addTilemap(a.key,a.url,e,a.format),this.asyncComplete(a)},xmlLoadComplete:function(a,t){var e=t.responseText,r=this.parseXml(e);if(!r){var o=t.responseType||t.contentType;return console.warn("Phaser.Loader - "+a.key+": invalid XML ("+o+")"),void this.asyncComplete(a,"invalid XML")}"bitmapfont"===a.type?this.cache.addBitmapFont(a.key,a.url,a.data,r,a.atlasType,a.xSpacing,a.ySpacing):"textureatlas"===a.type?this.cache.addTextureAtlas(a.key,a.url,a.data,r,a.format):"xml"===a.type&&this.cache.addXML(a.key,a.url,r),this.asyncComplete(a)},parseXml:function(a){var t;try{if(window.DOMParser){var e=new DOMParser;t=e.parseFromString(a,"text/xml")}else(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(a)}catch(e){t=null}return t&&t.documentElement&&!t.getElementsByTagName("parsererror").length?t:null},updateProgress:function(){this.preloadSprite&&(0===this.preloadSprite.direction?this.preloadSprite.rect.width=x(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=x(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite?this.preloadSprite.sprite.updateCrop():this.preloadSprite=null)},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}},Object.defineProperty(z.Loader.prototype,"progressFloat",{get:function(){var e=100*(this._loadedFileCount/this._totalFileCount);return z.Math.clamp(e||0,0,100)}}),Object.defineProperty(z.Loader.prototype,"progress",{get:function(){return f(this.progressFloat)}}),z.Loader.prototype.constructor=z.Loader,z.LoaderParser={bitmapFont:function(a,t,e,r,i,n){return this.xmlBitmapFont(a,t,e,r,i,n)},xmlBitmapFont:function(x,t,e,i,s,n){null==n&&(n=1);var o={},r=x.getElementsByTagName("info")[0],a=x.getElementsByTagName("common")[0];o.font=r.getAttribute("face"),o.size=parseInt(r.getAttribute("size"),10),o.lineHeight=parseInt(a.getAttribute("lineHeight"),10)+i,o.chars={};for(var h=x.getElementsByTagName("char"),l=s?s.x:0,c=s?s.y:0,u=0,d;u<h.length;u++)d=parseInt(h[u].getAttribute("id"),10),o.chars[d]={x:l+parseInt(h[u].getAttribute("x"),10),y:c+parseInt(h[u].getAttribute("y"),10),width:parseInt(h[u].getAttribute("width"),10),height:parseInt(h[u].getAttribute("height"),10),xOffset:parseInt(h[u].getAttribute("xoffset"),10)/n,yOffset:parseInt(h[u].getAttribute("yoffset"),10)/n,xAdvance:(parseInt(h[u].getAttribute("xadvance"),10)+e)/n,kerning:{}};var p=x.getElementsByTagName("kerning");for(u=0;u<p.length;u++){var f=parseInt(p[u].getAttribute("first"),10),g=parseInt(p[u].getAttribute("second"),10),m=parseInt(p[u].getAttribute("amount"),10)/n;o.chars[g].kerning[f]=m}return this.finalizeBitmapFont(t,o)},jsonBitmapFont:function(d,t,l,e,i,n){null==n&&(n=1);var o={font:d.font.info._face,size:parseInt(d.font.info._size,10),lineHeight:parseInt(d.font.common._lineHeight,10)+e,chars:{}},r=i?i.x:0,a=i?i.y:0;return d.font.chars.char.forEach(function(i){var t=parseInt(i._id,10);o.chars[t]={x:r+parseInt(i._x,10),y:a+parseInt(i._y,10),width:parseInt(i._width,10),height:parseInt(i._height,10),xOffset:parseInt(i._xoffset,10)/n,yOffset:parseInt(i._yoffset,10)/n,xAdvance:(parseInt(i._xadvance,10)+l)/n,kerning:{}}}),d.font.kernings&&d.font.kernings.kerning&&d.font.kernings.kerning.forEach(function(e){o.chars[e._second].kerning[e._first]=parseInt(e._amount,10)/n}),this.finalizeBitmapFont(t,o)},finalizeBitmapFont:function(a,t){return Object.keys(t.chars).forEach(function(e){var r=t.chars[e];r.texture=new PIXI.Texture(a,new z.Rectangle(r.x,r.y,r.width,r.height))}),t},pvr:function(a){var t=new Uint32Array(a.slice(0,52)),i=new Uint8Array(a),s=null,n=t[3]<<32|t[2],d=0,l;if(55727696===t[0]&&0<=[0,1,2,3,6,7,9,11].indexOf(n)){switch(0<=n&&3>=n?l="PVRTC":7<=n&&11>=n?l="S3TC":6==n&&(l="ETC1"),n){case 0:d=35841;break;case 1:d=35843;break;case 2:d=35840;break;case 3:d=35842;break;case 6:d=36196;break;case 7:d=33777;break;case 9:d=33778;break;case 11:d=33779;break;default:d=-1;}s={complete:!0,fileFormat:"PVR",compressionAlgorithm:l,flags:t[1],pixelFormat:n,colorSpace:t[4],channelType:t[5],height:t[6],width:t[7],depth:t[8],numberOfSurfaces:t[9],numberOfFaces:t[10],numberOfMipmaps:t[11],metaDataSize:t[12],textureData:i.subarray(52+t[12],i.byteLength),glExtensionFormat:d}}return s},dds:function(a){var t=new Uint8Array(a),e=new Uint32Array(a),r=null;return 68===t[0]&&68===t[1]&&83===t[2]&&32===t[3]&&"DX10"===(r={complete:!0,fileFormat:"DDS",compressionAlgorithm:"S3TC",size:e[1],flags:e[2],height:e[3],width:e[4],pitch:e[5],depth:e[6],mipmapCount:e[7],formatSize:e[19],formatFlag:e[19],formatFourCC:[c(t[84]),c(t[85]),c(t[86]),c(t[87])].join(""),formatBitCount:e[21],formatRBitMask:e[22],formatGBitMask:e[23],formatBBitMask:e[24],formatABitMask:e[25],caps1:e[26],caps2:e[27],caps3:e[28],caps4:e[29],reserved2:e[30],DXGIFormat:null,resourceDimension:null,miscFlag:null,arraySize:null,textureData:t.subarray(e[1]+4,t.byteLength)}).formatFourCC&&(r.DXGIFormat=e[31],r.resourceDimension=e[32],r.miscFlag=e[33],r.arraySize=e[34],r.miscFlag=e[35]),r},ktx:function(d){var t=new Uint8Array(d),e=new Uint32Array(d),i=null,s=0|16+e[15]/4,n=e[s],l=e[7],r=0;return 171===t[0]&&75===t[1]&&84===t[2]&&88===t[3]&&32===t[4]&&49===t[5]&&49===t[6]&&187===t[7]&&13===t[8]&&10===t[9]&&26===t[10]&&10===t[11]&&0<=[36196,35840,35841,35842,35843,33776,33777,33778,33779].indexOf(l)&&(36196===l?r="ETC1":35840===l||35841===l||35842===l||35843===l?r="PVRTC":33776===l||33777===l||33778===l||33779===l?r="S3TC":void 0,i={complete:!0,fileFormat:"KTX",compressionAlgorithm:r,endianness:e[3],glType:e[4],glTypeSize:e[5],glFormat:e[6],glInternalFormat:e[7],glBaseInternalFormat:e[8],width:e[9],height:e[10],pixelDepth:e[11],numberOfArrayElements:e[12],numberOfFaces:e[13],numberOfMipmapLevels:e[14],bytesOfKeyValueData:e[15],keyAndValueByteSize:e[16],imageSize:n,textureData:t.subarray(4*(s+1),n+100)}),i},pkm:function(a){var t=new Uint8Array(a),e=null;return 80===t[0]&&75===t[1]&&77===t[2]&&32===t[3]&&(e={complete:!0,fileFormat:"PKM",compressionAlgorithm:"ETC1",format:65535&(t[6]<<8|t[7]),width:65535&(t[8]<<8|t[9]),height:65535&(t[10]<<8|t[11]),originalWidth:65535&(t[12]<<8|t[13]),originalHeight:65535&(t[14]<<8|t[15]),textureData:t.subarray(16,t.length)}),e}},z.AudioSprite=function(a,t){for(var e in this.game=a,this.key=t,this.config=this.game.cache.getJSON(t+"-audioatlas"),this.autoplayKey=null,this.autoplay=!1,this.sounds={},this.config.spritemap){var r=this.config.spritemap[e],o=this.game.add.sound(this.key);o.addMarker(e,r.start,r.end-r.start,null,r.loop),this.sounds[e]=o}this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])},z.AudioSprite.prototype={play:function(a,t){return void 0===t&&(t=1),this.sounds[a].play(a,null,t)},stop:function(a){if(a)this.sounds[a].stop();else for(var t in this.sounds)this.sounds[t].stop()},get:function(e){return this.sounds[e]}},z.AudioSprite.prototype.constructor=z.AudioSprite,z.Sound=function(a,t,e,r,n){void 0===e&&(e=1),void 0===r&&(r=!1),void 0===n&&(n=a.sound.connectToMaster),this.game=a,this.name=t,this.key=t,this.loop=r,this.markers={},this.context=null,this.autoplay=!1,this.totalDuration=0,this.startTime=0,this.currentTime=0,this.duration=0,this.durationMS=0,this.position=0,this.stopTime=0,this.paused=!1,this.pausedPosition=0,this.pausedTime=0,this.isPlaying=!1,this.currentMarker="",this.fadeTween=null,this.pendingPlayback=!1,this.override=!1,this.allowMultiple=!1,this.playOnce=!1,this.usingWebAudio=this.game.sound.usingWebAudio,this.usingAudioTag=this.game.sound.usingAudioTag,this.externalNode=null,this.masterGainNode=null,this.gainNode=null,this._sound=null,this._globalVolume=1,this._markedToDelete=!1,this._removeFromSoundManager=!1,this._sourceId=0,this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.gainNode=void 0===this.context.createGain?this.context.createGainNode():this.context.createGain(),this.gainNode.gain.value=e,n&&this.gainNode.connect(this.masterGainNode)):this.usingAudioTag&&(this.game.cache.getSound(t)&&this.game.cache.isSoundReady(t)?(this._sound=this.game.cache.getSoundData(t),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)),this.onDecoded=new z.Signal,this.onPlay=new z.Signal,this.onPause=new z.Signal,this.onResume=new z.Signal,this.onLoop=new z.Signal,this.onStop=new z.Signal,this.onMute=new z.Signal,this.onMarkerComplete=new z.Signal,this.onFadeComplete=new z.Signal,this._volume=e,this._buffer=null,this._muted=!1,this._tempMarker=0,this._tempPosition=0,this._tempVolume=0,this._tempPause=0,this._muteVolume=0,this._tempLoop=0,this._paused=!1,this._onDecodedEventDispatched=!1},z.Sound.prototype={soundHasUnlocked:function(e){e===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(a,r,o,d,l){void 0!==o&&null!==o||(o=1),void 0!==d&&null!==d||(d=1),void 0===l&&(l=!1),this.markers[a]={name:a,start:r,stop:r+o,volume:d,duration:o,durationMS:1e3*o,loop:l}},removeMarker:function(e){delete this.markers[e]},onEndedHandler:function(){this._removeOnEndedHandler(),this.isPlaying=!1,this.currentTime=this.durationMS,this.stop(),this.playOnce&&(this._markedToDelete=!0,this._removeFromSoundManager=!0),this._markedToDelete&&(this._disconnectSource(),this._removeFromSoundManager?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose()))},update:function(){this.game.cache.checkSoundKey(this.key)?(this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),this.isPlaying&&(this.currentTime=this.game.time.time-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.isPlaying=!1,""===this.currentMarker?(this.currentTime=0,this.startTime=this.game.time.time,this.isPlaying=!0):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):""!==this.currentMarker&&this.stop():this.loop?(this.onLoop.dispatch(this),""===this.currentMarker&&(this.currentTime=0,this.startTime=this.game.time.time),this.isPlaying=!1,this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))):this.destroy()},loopFull:function(e){return this.play(null,0,e,!0)},play:function(a,t,e,r,o){if(void 0!==a&&!1!==a&&null!==a||(a=""),void 0===o&&(o=!0),this.isPlaying&&!this.allowMultiple&&!o&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||o)&&(this.usingWebAudio?this._stopSourceAndDisconnect():this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0),this.isPlaying=!1),""===a&&0<Object.keys(this.markers).length)return this;if(""!==a){if(!this.markers[a])return console.warn("Phaser.Sound.play: audio marker "+a+" doesn't exist"),this;this.currentMarker=a,this.position=this.markers[a].start,this.volume=this.markers[a].volume,this.loop=this.markers[a].loop,this.duration=this.markers[a].duration,this.durationMS=this.markers[a].durationMS,void 0!==e&&(this.volume=e),void 0!==r&&(this.loop=r),this._tempMarker=a,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else t=t||0,void 0===e&&(e=this._volume),void 0===r&&(r=this.loop),this.position=C(0,t),this.volume=e,this.loop=r,this.duration=0,this.durationMS=0,this._tempMarker=a,this._tempPosition=t,this._tempVolume=e,this._tempLoop=r;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._createSourceAndConnect(),this.loop&&""===a&&(this._sound.loop=!0),this.loop||""!==a||this._addOnEndedHandler(),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=y(1e3*this.totalDuration)),this.loop&&""===a?this._startSource(0,0):this._startSource(0,this.position,this.duration),this.isPlaying=!0,this.paused=!1,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&!1===this.game.cache.getSound(this.key).isDecoding&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this._sound.loop=this.loop,this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted||this.game.sound.mute?0:this._volume,this.isPlaying=!0,this.paused=!1,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this.playOnce&&(this.loop&&console.warn("Phaser.Sound.play: audio clip "+this.name+" cannot be deleted while looping."),this._markedToDelete=!0,this._removeFromSoundManager=!0),this},restart:function(a,t,e,r){a=a||"",t=t||0,e=e||1,void 0===r&&(r=!1),this.play(a,t,e,r,!0)},pause:function(){this.isPlaying&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.time,this._tempPause=this._sound.currentTime,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused){if(this.usingWebAudio){var a=C(0,this.position+this.pausedPosition/1e3);this._createSourceAndConnect(),""===this.currentMarker&&(this.loop?this._sound.loop=!0:this._addOnEndedHandler());var t=this.duration-this.pausedPosition/1e3;this.loop&&""===this.currentMarker?this._startSource(0,a):this._startSource(0,a,t)}else this._sound.currentTime=this._tempPause,this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound&&(this.usingWebAudio?this._stopSourceAndDisconnect():this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0)),this.pendingPlayback=!1,this.isPlaying=!1,!this.paused){var e=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",null!==this.fadeTween&&this.fadeTween.stop(),this.onStop.dispatch(this,e)}},fadeIn:function(a,t,e){void 0===t&&(t=!1),void 0===e&&(e=this.currentMarker),this.paused||(this.play(e,0,0,t),this.fadeTo(a,1))},fadeOut:function(e){this.fadeTo(e,0)},fadeTo:function(a,t){this.isPlaying&&!this.paused&&t!==this.volume&&(void 0===a&&(a=1e3),void 0===t?console.warn("Phaser.Sound.fadeTo: No Volume Specified."):(this.fadeTween=this.game.add.tween(this).to({volume:t},a,z.Easing.Linear.None,!0),this.fadeTween.onComplete.add(this.fadeComplete,this)))},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume),0===this.volume&&this.stop()},updateGlobalVolume:function(e){this.usingAudioTag&&this._sound&&(this._globalVolume=e,this._sound.volume=this._globalVolume*this._volume)},destroy:function(e){void 0===e&&(e=!0),this._markedToDelete=!0,this._removeFromSoundManager=e,this.stop(),e?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())},_createSourceAndConnect:function(){this._sound&&!this.allowMultiple&&console.warn("Phaser.Sound: Audio source already exists"),this._sound=this.context.createBufferSource(),this._sourceId++,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this._buffer=this.game.cache.getSoundData(this.key),this._sound.buffer=this._buffer},_disconnectSource:function(){this.externalNode?this._sound.disconnect(this.externalNode):this.gainNode&&this._sound.disconnect(this.gainNode)},_startSource:function(a,t,e){a||(a=0),void 0===this._sound.start?this._sound.noteGrainOn(a,t,e):this._sound.start(a,t,e)},_stopSourceAndDisconnect:function(){if(this._removeOnEndedHandler(),void 0===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(e){}this._disconnectSource(),this._sound=null},_addOnEndedHandler:function(){this._sound.onended=this.onEndedHandler.bind(this)},_removeOnEndedHandler:function(){this._sound.onended=null}},z.Sound.prototype.constructor=z.Sound,Object.defineProperty(z.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(z.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(z.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(e){(e=e||!1)!==this._muted&&(e?(this._muted=!0,this._muteVolume=this._tempVolume,this.usingWebAudio?this.gainNode.gain.value=0:this.usingAudioTag&&this._sound&&(this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this))}}),Object.defineProperty(z.Sound.prototype,"volume",{get:function(){return this._volume},set:function(e){this.usingAudioTag&&(e=this.game.math.clamp(e,0,1)),this._muted?this._muteVolume=e:(this._tempVolume=e,this._volume=e,this.usingWebAudio?this.gainNode.gain.value=e:this.usingAudioTag&&this._sound&&(this._sound.volume=this._globalVolume*e))}}),Object.defineProperty(z.Sound.prototype,"sourceId",{get:function(){return this._sound?this._sourceId:null}}),z.SoundManager=function(e){this.game=e,this.onSoundDecode=new z.Signal,this.onVolumeChange=new z.Signal,this.onMute=new z.Signal,this.onUnMute=new z.Signal,this.onTouchUnlock=new z.Signal,this.context=null,this.usingWebAudio=!1,this.usingAudioTag=!1,this.noAudio=!1,this.connectToMaster=!0,this.touchLocked=!1,this.channels=32,this.muteOnPause=!0,this._codeMuted=!1,this._muted=!1,this._unlockSource=null,this._volume=1,this._sounds=[],this._watchList=new z.ArraySet,this._watching=!1,this._watchCallback=null,this._watchContext=null,this._resumeWebAudioOnClick=this._resumeWebAudioOnClick.bind(this)},z.SoundManager.prototype={boot:function(){var a=this.game.device,t=window.PhaserGlobal;if(a.iOS&&!1===a.webAudio&&(this.channels=1),t){if(!0===t.disableAudio)return this.noAudio=!0,void(this.touchLocked=!1);if(!0===t.disableWebAudio)return this.usingAudioTag=!0,void(this.touchLocked=!1)}if(t&&t.audioContext)this.context=t.audioContext;else{var e=window.AudioContext||window.webkitAudioContext;if(e)try{this.context=new e}catch(e){this.context=null,this.usingWebAudio=!1,this.touchLocked=!1,console.warn(e)}}if(null===this.context){if(void 0===window.Audio)return void(this.noAudio=!0);this.usingAudioTag=!0}else this.usingWebAudio=!0,this.masterGain=void 0===this.context.createGain?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination),"suspended"===this.context.state&&this.game.canvas.addEventListener("click",this._resumeWebAudioOnClick);this.noAudio||a.needsTouchUnlock()&&this.setTouchLock(),this.usingWebAudio&&a.chrome&&65>=a.chromeVersion&&console.log("A \"GainNode.gain.value setter smoothing is deprecated\" notice in Chrome is normal. <https://github.com/photonstorm/phaser-ce/issues/385>")},setTouchLock:function(){this.noAudio||window.PhaserGlobal&&!0===window.PhaserGlobal.disableAudio||(this.game.input.addTouchLockCallback(this.unlock,this,!0),this.touchLocked=!0)},setTouchUnlock:function(){this.touchLocked=!1,this._unlockSource=null,this.onTouchUnlock.dispatch()},resumeWebAudio:function(){if(this.usingWebAudio&&"suspended"===this.context.state)return this.context.resume()},unlock:function(){if(this.noAudio||!this.touchLocked||null!==this._unlockSource)return!0;if(this.usingAudioTag)this.setTouchUnlock();else if(this.usingWebAudio){var a=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=a,this._unlockSource.connect(this.context.destination);var t=this;this._unlockSource.onended=function(){t.setTouchUnlock(),t.resumeWebAudio()},void 0===this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0),this.resumeWebAudio()}return!0},stopAll:function(){if(!this.noAudio)for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].stop()},pauseAll:function(){if(!this.noAudio)for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].pause()},resumeAll:function(){if(!this.noAudio)for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].resume()},decode:function(a,t){t=t||null;var e=this.game.cache.getSoundData(a);if(e&&!1===this.game.cache.isSoundDecoded(a)){this.game.cache.updateSound(a,"isDecoding",!0);var r=this;try{this.context.decodeAudioData(e,function(e){e&&(r.game.cache.decodedSound(a,e),r.onSoundDecode.dispatch(a,t))})}catch(e){}}},setDecodedCallback:function(a,r,e){"string"==typeof a&&(a=[a]),this._watchList.reset();for(var o=0;o<a.length;o++)a[o]instanceof z.Sound?this.game.cache.isSoundDecoded(a[o].key)||this._watchList.add(a[o].key):this.game.cache.isSoundDecoded(a[o])||this._watchList.add(a[o]);0===this._watchList.total?(this._watching=!1,r.call(e)):(this._watching=!0,this._watchCallback=r,this._watchContext=e)},update:function(){if(!this.noAudio){for(var a=0;a<this._sounds.length;a++)this._sounds[a].update();if(this._watching){for(var t=this._watchList.first;t;)this.game.cache.isSoundDecoded(t)&&this._watchList.remove(t),t=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}}},add:function(a,t,e,r){void 0===t&&(t=1),void 0===e&&(e=!1),void 0===r&&(r=this.connectToMaster);var n=new z.Sound(this.game,a,t,e,r);return this._sounds.push(n),n},addSprite:function(e){return new z.AudioSprite(this.game,e)},remove:function(a){for(var t=this._sounds.length;t--;)if(this._sounds[t]===a)return this._sounds[t].destroy(!1),this._sounds.splice(t,1),!0;return!1},removeAll:function(){this.stopAll();for(var e=0;e<this._sounds.length;e++)this._sounds[e]&&this._sounds[e].destroy();this._sounds.length=0},removeByKey:function(a){for(var t=this._sounds.length,e=0;t--;)this._sounds[t].key===a&&(this._sounds[t].destroy(!1),this._sounds.splice(t,1),e++);return e},play:function(a,t,e){if(!this.noAudio){var r=this.add(a,t,e);return r.play(),r}},setMute:function(){if(!this._muted){this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this._sounds[e].mute=!0);this.onMute.dispatch()}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this._sounds[e].mute=!1);this.onUnMute.dispatch()}},destroy:function(){this.removeAll(),this.onSoundDecode.dispose(),this.game.canvas.removeEventListener("click",this._resumeWebAudioOnClick),this.context&&(window.PhaserGlobal?window.PhaserGlobal.audioContext=this.context:this.context.close&&this.context.close())},_resumeWebAudioOnClick:function(){this.resumeWebAudio(),this.game.canvas.removeEventListener("click",this._resumeWebAudioOnClick)}},z.SoundManager.prototype.constructor=z.SoundManager,Object.defineProperty(z.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(e){if(e=e||!1){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(z.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(a){if(0>a?a=0:1<a&&(a=1),this._volume!==a){if(this._volume=a,this.usingWebAudio)this.masterGain.gain.value=a;else for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&this._sounds[t].updateGlobalVolume(a);this.onVolumeChange.dispatch(a)}}}),z.ScaleManager=function(a,t,e){this.game=a,this.dom=z.DOM,this.grid=null,this.width=0,this.height=0,this.minWidth=null,this.maxWidth=null,this.minHeight=null,this.maxHeight=null,this.offset=new z.Point,this.forceLandscape=!1,this.forcePortrait=!1,this.incorrectOrientation=!1,this._pageAlignHorizontally=!1,this._pageAlignVertically=!1,this.onOrientationChange=new z.Signal,this.enterIncorrectOrientation=new z.Signal,this.leaveIncorrectOrientation=new z.Signal,this.hasPhaserSetFullScreen=!1,this.fullScreenTarget=null,this._createdFullScreenTarget=null,this.onFullScreenInit=new z.Signal,this.onFullScreenChange=new z.Signal,this.onFullScreenError=new z.Signal,this.screenOrientation=this.dom.getScreenOrientation(),this.scaleFactor=new z.Point(1,1),this.scaleFactorInversed=new z.Point(1,1),this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0},this.bounds=new z.Rectangle,this.aspectRatio=0,this.sourceAspectRatio=0,this.event=null,this.windowConstraints={right:"layout",bottom:""},this.compatibility={supportsFullScreen:!1,orientationFallback:null,noMargins:!1,scrollTo:null,forceMinimumDocumentHeight:!1,canExpandParent:!0,clickTrampoline:""},this._scaleMode=z.ScaleManager.NO_SCALE,this._fullScreenScaleMode=z.ScaleManager.NO_SCALE,this.parentIsWindow=!1,this.parentNode=null,this.parentScaleFactor=new z.Point(1,1),this.trackParentInterval=2e3,this.onSizeChange=new z.Signal,this.onResize=null,this.onResizeContext=null,this._pendingScaleMode=null,this._fullScreenRestore=null,this._gameSize=new z.Rectangle,this._userScaleFactor=new z.Point(1,1),this._userScaleTrim=new z.Point(0,0),this._lastUpdate=0,this._updateThrottle=0,this._updateThrottleReset=100,this._parentBounds=new z.Rectangle,this._tempBounds=new z.Rectangle,this._lastReportedCanvasSize=new z.Rectangle,this._lastReportedGameSize=new z.Rectangle,this._booted=!1,a.config&&this.parseConfig(a.config),this.setupScale(t,e)},z.ScaleManager.EXACT_FIT=0,z.ScaleManager.NO_SCALE=1,z.ScaleManager.SHOW_ALL=2,z.ScaleManager.RESIZE=3,z.ScaleManager.USER_SCALE=4,z.ScaleManager.MODES=["EXACT_FIT","NO_SCALE","SHOW_ALL","RESIZE","USER_SCALE"],z.ScaleManager.prototype={boot:function(){var a=this.compatibility;a.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS,this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?a.scrollTo=new z.Point(0,1):a.scrollTo=new z.Point(0,0)),this.game.device.desktop?(a.orientationFallback="screen",a.clickTrampoline="when-not-mouse"):(a.orientationFallback="",a.clickTrampoline="");var r=this;this._orientationChange=function(e){return r.orientationChange(e)},this._windowResize=function(e){return r.windowResize(e)},window.addEventListener("orientationchange",this._orientationChange,!1),window.addEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(this._fullScreenChange=function(e){return r.fullScreenChange(e)},this._fullScreenError=function(e){return r.fullScreenError(e)},document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1),document.addEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.addEventListener("mozfullscreenerror",this._fullScreenError,!1),document.addEventListener("MSFullscreenError",this._fullScreenError,!1),document.addEventListener("fullscreenerror",this._fullScreenError,!1)),this.game.onResume.add(this._gameResumed,this),this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.setGameSize(this.game.width,this.game.height),this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),z.FlexGrid&&(this.grid=new z.FlexGrid(this,this.width,this.height)),this._booted=!0,null!==this._pendingScaleMode&&(this.scaleMode=this._pendingScaleMode,this._pendingScaleMode=null)},parseConfig:function(e){void 0!==e.scaleMode&&(this._booted?this.scaleMode=e.scaleMode:this._pendingScaleMode=e.scaleMode),void 0!==e.fullScreenScaleMode&&(this.fullScreenScaleMode=e.fullScreenScaleMode),e.fullScreenTarget&&(this.fullScreenTarget=e.fullScreenTarget),this.pageAlignHorizontally=e.alignH||!1,this.pageAlignVertically=e.alignV||!1,e.scaleH&&e.scaleV&&this.setUserScale(e.scaleH,e.scaleV,e.trimH,e.trimV)},setupScale:function(a,i){var d=new z.Rectangle,n;""!==this.game.parent&&("string"==typeof this.game.parent?n=document.getElementById(this.game.parent):this.game.parent&&1===this.game.parent.nodeType&&(n=this.game.parent)),n?(this.parentNode=n,this.parentIsWindow=!1,this.getParentBounds(this._parentBounds,this.parentNode),d.width=this._parentBounds.width,d.height=this._parentBounds.height,this.offset.set(this._parentBounds.x,this._parentBounds.y)):(this.parentNode=null,this.parentIsWindow=!0,d.width=this.dom.visualBounds.width,d.height=this.dom.visualBounds.height,this.offset.set(0,0));var s=0,o=0;"number"==typeof a?s=a:(this.parentScaleFactor.x=parseInt(a,10)/100,s=d.width*this.parentScaleFactor.x),"number"==typeof i?o=i:(this.parentScaleFactor.y=parseInt(i,10)/100,o=d.height*this.parentScaleFactor.y),s=x(s),o=x(o),this._gameSize.setTo(0,0,s,o),this.updateDimensions(s,o,!1)},_gameResumed:function(){this.queueUpdate(!0)},setGameSize:function(a,t){this._gameSize.setTo(0,0,a,t),this.currentScaleMode!==z.ScaleManager.RESIZE&&this.updateDimensions(a,t,!0),this.queueUpdate(!0)},setUserScale:function(a,t,e,r,i,n){this._userScaleFactor.setTo(a,t),this._userScaleTrim.setTo(0|e,0|r),void 0===i&&(i=!0),void 0===n&&(n=!0),i&&this.queueUpdate(n)},setResizeCallback:function(a,t){this.onResize=a,this.onResizeContext=t},signalSizeChange:function(){if(!z.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!z.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var a=this.width,t=this.height;this._lastReportedCanvasSize.setTo(0,0,a,t),this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height),this.grid&&this.grid.onResize(a,t),this.onSizeChange.dispatch(this,a,t),this.currentScaleMode===z.ScaleManager.RESIZE&&(this.game.state.resize(a,t),this.game.load.resize(a,t))}},setMinMax:function(a,t,e,r){this.minWidth=a,this.minHeight=t,void 0!==e&&(this.maxWidth=e),void 0!==r&&(this.maxHeight=r)},preUpdate:function(){if(!(this.game.time.time<this._lastUpdate+this._updateThrottle)){var i=this._updateThrottle;this._updateThrottleReset=400<=i?0:100,this.dom.getOffset(this.game.canvas,this.offset);var t=this._parentBounds.width,e=this._parentBounds.height,s=this.getParentBounds(this._parentBounds),n=s.width!==t||s.height!==e,o=this.updateOrientationState();(n||o)&&(this.onResize&&this.onResize.call(this.onResizeContext,this,s),this.updateLayout(),this.signalSizeChange());var r=2*this._updateThrottle;this._updateThrottle<i&&(r=A(i,this._updateThrottleReset)),this._updateThrottle=z.Math.clamp(r,25,this.trackParentInterval),this._lastUpdate=this.game.time.time}},pauseUpdate:function(){this.preUpdate(),this._updateThrottle=this.trackParentInterval},updateDimensions:function(a,t,e){this.width=a*this.parentScaleFactor.x,this.height=t*this.parentScaleFactor.y,this.game.width=this.width,this.game.height=this.height,this.sourceAspectRatio=this.width/this.height,this.updateScalingAndBounds(),e&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height))},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.scaleFactorInversed.x=this.width/this.game.width,this.scaleFactorInversed.y=this.height/this.game.height,this.aspectRatio=this.width/this.height,this.game.canvas&&this.dom.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.game.input&&this.game.input.scale&&this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)},forceOrientation:function(a,t){void 0===t&&(t=!1),!0!==a||!0!==t?(this.forceLandscape=a,this.forcePortrait=t,this.queueUpdate(!0)):console.warn("Phaser.ScaleManager: forceLandscape and forcePortrait cannot both be true.")},classifyOrientation:function(e){return"portrait-primary"===e||"portrait-secondary"===e?"portrait":"landscape-primary"===e||"landscape-secondary"===e?"landscape":null},updateOrientationState:function(){var a=this.screenOrientation,t=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback),this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var e=a!==this.screenOrientation,r=t!==this.incorrectOrientation;return r&&(this.incorrectOrientation?this.enterIncorrectOrientation.dispatch():this.leaveIncorrectOrientation.dispatch()),(e||r)&&this.onOrientationChange.dispatch(this,a,t),e||r},orientationChange:function(e){this.event=e,this.queueUpdate(!0)},windowResize:function(e){this.event=e,this.queueUpdate(!0)},scrollTop:function(){var e=this.compatibility.scrollTo;e&&window.scrollTo(e.x,e.y)},refresh:function(){this.scrollTop(),this.queueUpdate(!0)},updateLayout:function(){var a=this.currentScaleMode;if(a!==z.ScaleManager.RESIZE){if(this.scrollTop(),this.compatibility.forceMinimumDocumentHeight&&(document.documentElement.style.minHeight=window.innerHeight+"px"),this.incorrectOrientation?this.setMaximum():a===z.ScaleManager.EXACT_FIT?this.setExactFit():a===z.ScaleManager.SHOW_ALL?!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent?(this.setShowAll(!0),this.resetCanvas(),this.setShowAll()):this.setShowAll():a===z.ScaleManager.NO_SCALE?(this.width=this.game.width,this.height=this.game.height):a===z.ScaleManager.USER_SCALE&&(this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x,this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y),!this.compatibility.canExpandParent&&(a===z.ScaleManager.SHOW_ALL||a===z.ScaleManager.USER_SCALE)){var t=this.getParentBounds(this._tempBounds);this.width=A(this.width,t.width),this.height=A(this.height,t.height)}this.width=0|this.width,this.height=0|this.height,this.reflowCanvas()}else this.reflowGame()},getParentBounds:function(i,t){var e=i||new z.Rectangle,s=t||this.boundingParent,n=this.dom.visualBounds,o=this.dom.layoutBounds;if(s){var r=s.getBoundingClientRect(),a=s.offsetParent?s.offsetParent.getBoundingClientRect():s.getBoundingClientRect();e.setTo(r.left-a.left,r.top-a.top,r.width,r.height);var d=this.windowConstraints;if(d.right&&(l="layout"===d.right?o:n,e.right=A(e.right,l.width)),d.bottom){var l="layout"===d.bottom?o:n;e.bottom=A(e.bottom,l.height)}}else e.setTo(0,0,n.width,n.height);return e.setTo(f(e.x),f(e.y),f(e.width),f(e.height)),e},align:function(a,t){null!=a&&(this.pageAlignHorizontally=a),null!=t&&(this.pageAlignVertically=t)},alignCanvas:function(d,t){var e=this.getParentBounds(this._tempBounds),i=this.game.canvas,s=this.margin;if(d){if(s.left=s.right=0,a=i.getBoundingClientRect(),this.width<e.width&&!this.incorrectOrientation){var n=a.left-e.x,o=e.width/2-this.width/2,r=(o=C(o,0))-n;s.left=f(r)}i.style.marginLeft=s.left+"px",0!==s.left&&(s.right=-(e.width-a.width-s.left),i.style.marginRight=s.right+"px")}if(t){s.top=s.bottom=0;var a=i.getBoundingClientRect();if(this.height<e.height&&!this.incorrectOrientation){var n=a.top-e.y,o=e.height/2-this.height/2,r=(o=C(o,0))-n;s.top=f(r)}i.style.marginTop=s.top+"px",0!==s.top&&(s.bottom=-(e.height-a.height-s.top),i.style.marginBottom=s.bottom+"px")}s.x=s.left,s.y=s.top},reflowGame:function(){this.resetCanvas("","");var e=this.getParentBounds(this._tempBounds);this.updateDimensions(e.width,e.height,!0)},reflowCanvas:function(){this.incorrectOrientation||(this.width=z.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width),this.height=z.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)),this.resetCanvas(),this.compatibility.noMargins||(this.isFullScreen&&this._createdFullScreenTarget?this.alignCanvas(!0,!0):this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)),this.updateScalingAndBounds()},resetCanvas:function(a,t){void 0===a&&(a=this.width+"px"),void 0===t&&(t=this.height+"px");var e=this.game.canvas;this.compatibility.noMargins||(e.style.marginLeft="",e.style.marginTop="",e.style.marginRight="",e.style.marginBottom=""),e.style.width=a,e.style.height=t},queueUpdate:function(e){e&&(this._parentBounds.width=0,this._parentBounds.height=0),this._updateThrottle=this._updateThrottleReset},reset:function(e){e&&this.grid&&this.grid.reset()},setMaximum:function(){this.width=this.dom.visualBounds.width,this.height=this.dom.visualBounds.height},setShowAll:function(a){var t=this.getParentBounds(this._tempBounds),r=t.width,o=t.height,n;n=a?C(o/this.game.height,r/this.game.width):A(o/this.game.height,r/this.game.width),this.width=f(this.game.width*n),this.height=f(this.game.height*n)},setExactFit:function(){var e=this.getParentBounds(this._tempBounds);this.width=e.width,this.height=e.height,this.isFullScreen||(this.maxWidth&&(this.width=A(this.width,this.maxWidth)),this.maxHeight&&(this.height=A(this.height,this.maxHeight)))},createFullScreenTarget:function(){var e=document.createElement("div");return e.style.margin="0",e.style.padding="0",e.style.background="#000",e},startFullScreen:function(i,t){if(this.isFullScreen)return!1;{if(this.compatibility.supportsFullScreen){if("when-not-mouse"===this.compatibility.clickTrampoline){var e=this.game.input;if(e.activePointer&&e.activePointer!==e.mousePointer&&(t||!1!==t))return void e.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[i,!1])}void 0!==i&&this.game.renderType===z.CANVAS&&(this.game.stage.smoothed=i);var s=this.fullScreenTarget;s||(this.cleanupCreatedTarget(),this._createdFullScreenTarget=this.createFullScreenTarget(),s=this._createdFullScreenTarget);var d={targetElement:s};if(this.hasPhaserSetFullScreen=!0,this.onFullScreenInit.dispatch(this,d),this._createdFullScreenTarget){var o=this.game.canvas;o.parentNode.insertBefore(s,o),s.appendChild(o)}return this.game.device.fullscreenKeyboard?s[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):s[this.game.device.requestFullscreen](),!0}var r=this;setTimeout(function(){r.fullScreenError()},10)}},stopFullScreen:function(){return this.isFullScreen&&this.compatibility.supportsFullScreen&&(this.hasPhaserSetFullScreen=!1,document[this.game.device.cancelFullscreen](),!0)},cleanupCreatedTarget:function(){var a=this._createdFullScreenTarget;if(a&&a.parentNode){var t=a.parentNode;t.insertBefore(this.game.canvas,a),t.removeChild(a)}this._createdFullScreenTarget=null},prepScreenMode:function(a){var t=!!this._createdFullScreenTarget,e=this._createdFullScreenTarget||this.fullScreenTarget;a?(t||this.fullScreenScaleMode===z.ScaleManager.EXACT_FIT)&&e!==this.game.canvas&&(this._fullScreenRestore={targetWidth:e.style.width,targetHeight:e.style.height},e.style.width="100%",e.style.height="100%"):(this._fullScreenRestore&&(e.style.width=this._fullScreenRestore.targetWidth,e.style.height=this._fullScreenRestore.targetHeight,this._fullScreenRestore=null),this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.resetCanvas())},fullScreenChange:function(e){this.event=e,this.isFullScreen?(this.prepScreenMode(!0),this.updateLayout(),this.queueUpdate(!0)):(this.prepScreenMode(!1),this.cleanupCreatedTarget(),this.updateLayout(),this.queueUpdate(!0)),this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(e){this.event=e,this.cleanupCreatedTarget(),console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API"),this.onFullScreenError.dispatch(this)},scaleSprite:function(d,l,e,i){if(void 0===l&&(l=this.width),void 0===e&&(e=this.height),void 0===i&&(i=!1),!d||!d.scale)return d;if(d.scale.x=1,d.scale.y=1,0>=d.width||0>=d.height||0>=l||0>=e)return d;var p=l,n=d.height*l/d.width,o=d.width*e/d.height,r=e,a=o>l;return(a=a?i:!i)?(d.width=x(p),d.height=x(n)):(d.width=x(o),d.height=x(r)),d},destroy:function(){this.game.onResume.remove(this._gameResumed,this),window.removeEventListener("orientationchange",this._orientationChange,!1),window.removeEventListener("resize",this._windowResize,!1),this.compatibility.supportsFullScreen&&(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("MSFullscreenChange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1),document.removeEventListener("webkitfullscreenerror",this._fullScreenError,!1),document.removeEventListener("mozfullscreenerror",this._fullScreenError,!1),document.removeEventListener("MSFullscreenError",this._fullScreenError,!1),document.removeEventListener("fullscreenerror",this._fullScreenError,!1))}},z.ScaleManager.prototype.constructor=z.ScaleManager,Object.defineProperty(z.ScaleManager.prototype,"boundingParent",{get:function(){return this.parentIsWindow||this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget?null:this.game.canvas&&this.game.canvas.parentNode||null}}),Object.defineProperty(z.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(e){return e!==this._scaleMode&&(this.isFullScreen||(this.updateDimensions(this._gameSize.width,this._gameSize.height,!0),this.queueUpdate(!0)),this._scaleMode=e),this._scaleMode}}),Object.defineProperty(z.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(e){return e!==this._fullScreenScaleMode&&(this.isFullScreen?(this.prepScreenMode(!1),this._fullScreenScaleMode=e,this.prepScreenMode(!0),this.queueUpdate(!0)):this._fullScreenScaleMode=e),this._fullScreenScaleMode}}),Object.defineProperty(z.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}}),Object.defineProperty(z.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(e){e!==this._pageAlignHorizontally&&(this._pageAlignHorizontally=e,this.queueUpdate(!0))}}),Object.defineProperty(z.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(e){e!==this._pageAlignVertically&&(this._pageAlignVertically=e,this.queueUpdate(!0))}}),Object.defineProperty(z.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}}),Object.defineProperty(z.ScaleManager.prototype,"isPortrait",{get:function(){return"portrait"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(z.ScaleManager.prototype,"isLandscape",{get:function(){return"landscape"===this.classifyOrientation(this.screenOrientation)}}),Object.defineProperty(z.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}}),Object.defineProperty(z.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}}),z.Utils.Debug=function(e){this.game=e,this.sprite=null,this.bmd=null,this.canvas=null,this.context=null,this.font="14px Courier",this.columnWidth=100,this.lineHeight=16,this.lineWidth=1,this.renderShadow=!0,this.currentColor=null,this.currentX=0,this.currentY=0,this.currentAlpha=1,this.dirty=!1,this.isDisabled=!1,this._line=null,this._rect=null},z.Utils.Debug.GEOM_AUTO=0,z.Utils.Debug.GEOM_RECTANGLE=1,z.Utils.Debug.GEOM_CIRCLE=2,z.Utils.Debug.GEOM_POINT=3,z.Utils.Debug.GEOM_LINE=4,z.Utils.Debug.GEOM_ELLIPSE=5,z.Utils.Debug.prototype={boot:function(){this.game.renderType===z.CANVAS?this.context=this.game.context:(this.bmd=new z.BitmapData(this.game,"__DEBUG",this.game.width,this.game.height,!0),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.game.scale.onSizeChange.add(this.resize,this),this.canvas=z.CanvasPool.create(this,this.game.width,this.game.height),this.context=this.canvas.getContext("2d")),this._line=new z.Line,this._rect=new z.Rectangle},resize:function(){this.bmd.resize(this.game.width,this.game.height),this.canvas.width=this.game.width,this.canvas.height=this.game.height},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height),this.sprite&&this.bmd.clear()},start:function(a,r,o,n){"number"!=typeof a&&(a=0),"number"!=typeof r&&(r=0),o=o||"rgb(255,255,255)",void 0===n&&(n=0),this.currentX=a,this.currentY=r,this.currentColor=o,this.columnWidth=n,this.dirty=!0,this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.strokeStyle=o,this.context.fillStyle=o,this.context.font=this.font,this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){for(var a=this.currentX,t=0;t<arguments.length;t++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[t],a+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[t],a,this.currentY),a+=this.columnWidth;this.currentY+=this.lineHeight},sound:function(a,t,e){var r=this.game.sound;this.start(a,t,e),r.noAudio?this.line("Audio is disabled"):(this.line("Volume: "+r.volume.toFixed(2)+(r.mute?" (Mute)":"")),this.line("Mute on pause: "+r.muteOnPause),this.line("Using: "+(r.usingWebAudio?"Web Audio - "+r.context.state:"Audio Tag")),this.line("Touch locked: "+r.touchLocked),this.line("Sounds: "+r._sounds.length)),this.stop()},soundInfo:function(a,t,e,r){this.start(t,e,r),this.line("Sound: "+a.key+"  Touch locked: "+a.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(a.key)+"  Pending Playback: "+a.pendingPlayback),this.line("Decoded: "+a.isDecoded+"  Decoding: "+a.isDecoding),this.line("Playing: "+a.isPlaying+"  Loop: "+a.loop),this.line("Time: "+(.001*a.currentTime).toFixed(3)+"s  Total: "+a.totalDuration.toFixed(3)+"s"),this.line("Volume: "+a.volume.toFixed(2)+(a.mute?" (Mute)":"")),this.line("Using: "+(a.usingWebAudio?"Web Audio":"Audio Tag")+"  "+(a.usingWebAudio?"Source: "+(a.sourceId||"none"):"")),""!==a.currentMarker&&(this.line("Marker: "+a.currentMarker+"  Duration: "+a.duration.toFixed(3)+"s ("+a.durationMS+"ms)"),this.line("Start: "+a.markers[a.currentMarker].start+"  Stop: "+a.markers[a.currentMarker].stop),this.line("Position: "+a.position)),this.stop()},camera:function(a,t,e){var r=a.deadzone,i=a.target,n=a.view;r&&(this._rect.setTo(n.x+r.x,n.y+r.y,r.width,r.height),this.rectangle(this._rect,t,e)),i&&(this._line.setTo(n.centerX,n.centerY,i.x,i.y),this.geom(this._line,t,e),this.geom(i,t,!1,3))},cameraInfo:function(d,t,e,i){var s=d.bounds,n=d.deadzone,o=d.target,r=d.view;this.start(t,e,i),this.line("Camera ("+d.width+" x "+d.height+")"),this.line("x: "+d.x+" y: "+d.y),this.line("Bounds: "+(s?"x: "+s.x+" y: "+s.y+" w: "+s.width+" h: "+s.height:"none")),this.line("View: x: "+r.x+" y: "+r.y+" w: "+r.width+" h: "+r.height),this.line("Deadzone: "+(n?"x: "+n.x+" y: "+n.y+" w: "+n.width+" h: "+n.height:n)),this.line("Total in view: "+d.totalInView),this.line("At limit: x: "+d.atLimit.x+" y: "+d.atLimit.y),this.line("Target: "+(o?o.name||o:"none")),this.stop()},timer:function(a,t,e,r){this.start(t,e,r),this.line("Timer (running: "+a.running+" expired: "+a.expired+")"),this.line("Next Tick: "+a.next+" Duration: "+a.duration),this.line("Paused: "+a.paused+" Length: "+a.length),this.stop()},pointer:function(a,t,e,r,o){null!=a&&(void 0===t&&(t=!1),e=e||"rgba(0,255,0,0.5)",r=r||"rgba(255,0,0,0.5)",!0===t&&!0===a.isUp||(this.start(a.x,a.y-100,o),this.context.beginPath(),this.context.arc(a.x,a.y,a.circle.radius,0,2*R),this.context.fillStyle=a.active?e:r,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(a.positionDown.x,a.positionDown.y),this.context.lineTo(a.position.x,a.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+a.id+" Active: "+a.active),this.line("World X: "+a.worldX+" World Y: "+a.worldY),this.line("Screen X: "+a.x+" Screen Y: "+a.y+" In: "+a.withinGame),this.line("Duration: "+a.duration+" ms"),this.line("is Down: "+a.isDown+" is Up: "+a.isUp),this.stop()))},spriteInputInfo:function(a,t,e,r){this.start(t,e,r),this.line("Sprite Input: ("+a.width+" x "+a.height+")"),this.line("x: "+a.input.pointerX().toFixed(1)+" y: "+a.input.pointerY().toFixed(1)),this.line("over: "+a.input.pointerOver()+" duration: "+a.input.overDuration().toFixed(0)),this.line("down: "+a.input.pointerDown()+" duration: "+a.input.downDuration().toFixed(0)),this.line("just over: "+a.input.justOver()+" just out: "+a.input.justOut()),this.stop()},key:function(a,t,e,r){this.start(t,e,r,150),this.line("Key:",a.keyCode,"isDown:",a.isDown),this.line("justDown:",a.justDown,"justUp:",a.justUp),this.line("Time Down:",a.timeDown.toFixed(0),"duration:",a.duration.toFixed(0)),this.stop()},inputInfo:function(a,t,e){this.start(a,t,e),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop()},spriteBounds:function(a,t,e){var r=a.getBounds();r.x+=this.game.camera.x,r.y+=this.game.camera.y,this.rectangle(r,t,e)},ropeSegments:function(a,r,e){var o=this;a.segments.forEach(function(a){o.rectangle(a,r,e)},this)},spriteInfo:function(a,t,e,r){this.start(t,e,r),this.line("Sprite: "+(a.name||"")+" ("+a.width+" x "+a.height+") anchor: "+a.anchor.x+" x "+a.anchor.y),this.line("x: "+a.x.toFixed(1)+" y: "+a.y.toFixed(1)),this.line("angle: "+a.angle.toFixed(1)+" rotation: "+a.rotation.toFixed(1)),this.line("visible: "+a.visible+" in camera: "+a.inCamera),this.line("bounds x: "+a._bounds.x.toFixed(1)+" y: "+a._bounds.y.toFixed(1)+" w: "+a._bounds.width.toFixed(1)+" h: "+a._bounds.height.toFixed(1)),this.stop()},spriteCoords:function(a,t,e,r){this.start(t,e,r,100),a.name&&this.line(a.name),this.line("x:",a.x.toFixed(2),"y:",a.y.toFixed(2)),this.line("pos x:",a.position.x.toFixed(2),"pos y:",a.position.y.toFixed(2)),this.line("world x:",a.world.x.toFixed(2),"world y:",a.world.y.toFixed(2)),this.stop()},lineInfo:function(a,t,e,r){this.start(t,e,r,80),this.line("start.x:",a.start.x.toFixed(2),"start.y:",a.start.y.toFixed(2)),this.line("end.x:",a.end.x.toFixed(2),"end.y:",a.end.y.toFixed(2)),this.line("length:",a.length.toFixed(2),"angle:",a.angle),this.stop()},pixel:function(a,t,e,r){r=r||2,this.start(),this.context.fillStyle=e,this.context.fillRect(a,t,r,r),this.stop()},geom:function(a,t,e,r){void 0===e&&(e=!0),void 0===r&&(r=0),t=t||"rgba(0,255,0,0.4)",this.start(),this.context.fillStyle=t,this.context.strokeStyle=t,this.context.lineWidth=this.lineWidth;var n=z.Utils.Debug;r===n.GEOM_RECTANGLE||a instanceof z.Rectangle?e?this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height):this.context.strokeRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height):r===n.GEOM_CIRCLE||a instanceof z.Circle?(this.context.beginPath(),this.context.arc(a.x-this.game.camera.x,a.y-this.game.camera.y,a.radius,0,2*R,!1),this.context.closePath(),e?this.context.fill():this.context.stroke()):r===n.GEOM_POINT||a instanceof z.Point?this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,4,4):r===n.GEOM_LINE||a instanceof z.Line?(this.context.beginPath(),this.context.moveTo(a.start.x+.5-this.game.camera.x,a.start.y+.5-this.game.camera.y),this.context.lineTo(a.end.x+.5-this.game.camera.x,a.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke()):(r===n.GEOM_ELLIPSE||a instanceof z.Ellipse)&&(this.context.beginPath(),this.context.ellipse(a.centerX-this.game.camera.x,a.centerY-this.game.camera.y,a.width/2,a.height/2,0,2*R,!1),this.context.closePath(),e?this.context.fill():this.context.stroke()),this.stop()},rectangle:function(a,t,e){void 0===e&&(e=!0),t=t||"rgba(0, 255, 0, 0.4)",this.start(),e?(this.context.fillStyle=t,this.context.fillRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height)):(this.context.lineWidth=this.lineWidth,this.context.strokeStyle=t,this.context.strokeRect(a.x-this.game.camera.x,a.y-this.game.camera.y,a.width,a.height)),this.stop()},text:function(a,t,e,r,o){r=r||"rgb(255,255,255)",o=o||this.font,this.start(),this.context.font=o,this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(a,t+1,e+1)),this.context.fillStyle=r,this.context.fillText(a,t,e),this.stop()},quadTree:function(a,t){t=t||"rgba(255,0,0,0.3)",this.start();var e=a.bounds;if(0===a.nodes.length)for(this.context.strokeStyle=t,this.context.strokeRect(e.x,e.y,e.width,e.height),this.text("size: "+a.objects.length,e.x+4,e.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)",r=0;r<a.objects.length;r++)this.context.strokeRect(a.objects[r].x,a.objects[r].y,a.objects[r].width,a.objects[r].height);else for(var r=0;r<a.nodes.length;r++)this.quadTree(a.nodes[r]);this.stop()},body:function(a,t,e){a.body&&(this.start(),a.body.type===z.Physics.ARCADE?z.Physics.Arcade.Body.render(this.context,a.body,t,e,this.lineWidth):a.body.type===z.Physics.NINJA?z.Physics.Ninja.Body.render(this.context,a.body,t,e):a.body.type===z.Physics.BOX2D&&z.Physics.Box2D.renderBody(this.context,a.body,t),this.stop())},bodyInfo:function(a,t,e,r){a.body&&(this.start(t,e,r,210),a.body.type===z.Physics.ARCADE?z.Physics.Arcade.Body.renderBodyInfo(this,a.body):a.body.type===z.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,a.body),this.stop())},box2dWorld:function(){this.start(),this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0),this.game.physics.box2d.renderDebugDraw(this.context),this.stop()},box2dBody:function(a,t){this.start(),z.Physics.Box2D.renderBody(this.context,a,t),this.stop()},displayList:function(a){if(void 0===a&&(a=this.game.world),a.hasOwnProperty("renderOrderID")?console.log("["+a.renderOrderID+"]",a):console.log("[]",a),a.children&&0<a.children.length)for(var t=0;t<a.children.length;t++)this.game.debug.displayList(a.children[t])},renderer:function(a,t,e){var r=this.game.renderer,i=r.renderSession;if(this.start(a,t,e),this.line((r.gl?"WebGL":"Canvas")+" Renderer ("+r.width+" x "+r.height+")"),this.line("autoResize: "+r.autoResize),this.line("clearBeforeRender: "+r.clearBeforeRender),this.line("resolution: "+r.resolution),this.line("transparent: "+r.transparent),this.line("renderSession:"),r.gl){this.line("  currentBatchedTextures: ("+r.currentBatchedTextures.length+")");for(var n=0;n<r.currentBatchedTextures.length;n++)this.line("    "+r.currentBatchedTextures[n]);this.line("  drawCount: "+i.drawCount),this.line("  maxTextures: "+r.maxTextures),this.line("  maxTextureSize: "+r.maxTextureSize),this.line("  maxTextureAvailableSpace: "+i.maxTextureAvailableSpace),this.line("  roundPixels: "+i.roundPixels)}else this.line("  roundPixels: "+i.roundPixels),this.line("  scaleMode: "+(0===i.scaleMode?"LINEAR":1===i.scaleMode?"NEAREST":i.scaleMode));this.stop()},canvasPool:function(a,t,e,r){var n=z.CanvasPool;this.start(a,t,e,r||100),this.line("Canvas Pool"),this.line("Used:",n.getTotal()),this.line("Free:",n.getFree()),this.line("Total:",n.length),this.stop()},physicsGroup:function(a,t,e,r){a.forEach(this.body,this,r,t,e)},phaser:function(a,t,e){this.text("Phaser v"+z.VERSION+" "+(this.game.renderType===z.WEBGL?"WebGL":"Canvas")+" "+(this.game.device.webAudio?"WebAudio":"HTML Audio"),a,t,e,this.font)},scale:function(a,t,e){this.start(a,t,e);var i=this.game.scale,n=i.scaleFactorInversed,o=i._parentBounds,a=" x ";this.line("Game: "+this.game.width+a+this.game.height),this.line("Canvas: "+i.width+a+i.height+" ("+n.x.toFixed(2)+a+n.y.toFixed(2)+") ["+i.aspectRatio.toFixed(2)+"]"),this.line("Mode: "+z.ScaleManager.MODES[i.currentScaleMode]+(i.currentScaleMode===z.ScaleManager.USER_SCALE?" ("+i._userScaleFactor.x+a+i._userScaleFactor.y+")":"")),this.line("Parent: "+(i.parentIsWindow?"window":i.parentNode)+(o.empty?"":" ("+o.width+a+o.height+")")),this.line("Screen: "+i.classifyOrientation(i.screenOrientation)+(i.incorrectOrientation?" (incorrect)":"")),this.stop()},loader:function(a,t,e,r){var n=z.Utils.pad;this.start(t,e,r),a.hasLoaded?this.line("Complete"+(a.resetLocked?" [locked]":"")):a.isLoading?this.line("Loading"):this.line("Not started"),a.hasLoaded&&!a.resetLocked||(this.line("Progress: "+n(a.progress,3)+"%"),this.line("Files: "+a._loadedFileCount+" of "+a._totalFileCount),this.line("Packs: "+a._loadedPackCount+" of "+a._loadedPackCount)),this.stop()},destroy:function(){z.CanvasPool.remove(this)}},z.Utils.Debug.prototype.constructor=z.Utils.Debug,z.DOM={getOffset:function(i,t){t=t||new z.Point;var e=i.getBoundingClientRect(),s=z.DOM.scrollY,n=z.DOM.scrollX,o=document.documentElement.clientTop,r=document.documentElement.clientLeft;return t.x=e.left+n-r,t.y=e.top+s-o,t},getBounds:function(a,t){return void 0===t&&(t=0),(a=a&&!a.nodeType?a[0]:a)&&1===a.nodeType&&this.calibrate(a.getBoundingClientRect(),t)},calibrate:function(a,t){t=+t||0;var r={width:0,height:0,left:0,right:0,top:0,bottom:0};return r.width=(r.right=a.right+t)-(r.left=a.left-t),r.height=(r.bottom=a.bottom+t)-(r.top=a.top-t),r},getAspectRatio:function(a){var t=(a=null==a?this.visualBounds:1===a.nodeType?this.getBounds(a):a).width,r=a.height;return"function"==typeof t&&(t=t.call(a)),"function"==typeof r&&(r=r.call(a)),t/r},inLayoutViewport:function(a,t){var e=this.getBounds(a,t);return!!e&&0<=e.bottom&&0<=e.right&&e.top<=this.layoutBounds.width&&e.left<=this.layoutBounds.height},getScreenOrientation:function(a){var t=window.screen,e=t.orientation||t.mozOrientation||t.msOrientation;if(e&&"string"==typeof e.type)return e.type;if("string"==typeof e)return e;var r="portrait-primary",o="landscape-primary";if("screen"===a)return t.height>t.width?r:o;if("viewport"===a)return this.visualBounds.height>this.visualBounds.width?r:o;if("window.orientation"===a&&"number"==typeof window.orientation)return 0===window.orientation||180===window.orientation?r:o;if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches)return r;if(window.matchMedia("(orientation: landscape)").matches)return o}return this.visualBounds.height>this.visualBounds.width?r:o},visualBounds:new z.Rectangle,layoutBounds:new z.Rectangle,documentBounds:new z.Rectangle},z.Device.whenReady(function(a){var t=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft},r=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};if(Object.defineProperty(z.DOM,"scrollX",{get:t}),Object.defineProperty(z.DOM,"scrollY",{get:r}),Object.defineProperty(z.DOM.visualBounds,"x",{get:t}),Object.defineProperty(z.DOM.visualBounds,"y",{get:r}),Object.defineProperty(z.DOM.layoutBounds,"x",{value:0}),Object.defineProperty(z.DOM.layoutBounds,"y",{value:0}),a.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight){var i=function(){return C(window.innerWidth,document.documentElement.clientWidth)},d=function(){return C(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(z.DOM.visualBounds,"width",{get:i}),Object.defineProperty(z.DOM.visualBounds,"height",{get:d}),Object.defineProperty(z.DOM.layoutBounds,"width",{get:i}),Object.defineProperty(z.DOM.layoutBounds,"height",{get:d})}else Object.defineProperty(z.DOM.visualBounds,"width",{get:function(){return window.innerWidth}}),Object.defineProperty(z.DOM.visualBounds,"height",{get:function(){return window.innerHeight}}),Object.defineProperty(z.DOM.layoutBounds,"width",{get:function(){var a=document.documentElement.clientWidth,t=window.innerWidth;return a<t?t:a}}),Object.defineProperty(z.DOM.layoutBounds,"height",{get:function(){var a=document.documentElement.clientHeight,t=window.innerHeight;return a<t?t:a}});Object.defineProperty(z.DOM.documentBounds,"x",{value:0}),Object.defineProperty(z.DOM.documentBounds,"y",{value:0}),Object.defineProperty(z.DOM.documentBounds,"width",{get:function(){var e=document.documentElement;return C(e.clientWidth,e.offsetWidth,e.scrollWidth)}}),Object.defineProperty(z.DOM.documentBounds,"height",{get:function(){var e=document.documentElement;return C(e.clientHeight,e.offsetHeight,e.scrollHeight)}})},null,!0),z.ArraySet=function(e){this.position=0,this.list=e||[]},z.ArraySet.prototype={add:function(e){return this.exists(e)||this.list.push(e),e},getIndex:function(e){return this.list.indexOf(e)},getByKey:function(a,t){for(var e=this.list.length;e--;)if(this.list[e][a]===t)return this.list[e];return null},exists:function(e){return-1<this.list.indexOf(e)},reset:function(){this.list.length=0},remove:function(a){var t=this.list.indexOf(a);if(-1<t)return this.list.splice(t,1),a},setAll:function(a,t){for(var e=this.list.length;e--;)this.list[e]&&(this.list[e][a]=t)},callAll:function(a){for(var t=Array.prototype.slice.call(arguments,1),e=this.list.length;e--;)this.list[e]&&this.list[e][a]&&this.list[e][a].apply(this.list[e],t)},removeAll:function(a){void 0===a&&(a=!1);for(var t=this.list.length;t--;)if(this.list[t]){var e=this.remove(this.list[t]);a&&e.destroy()}this.position=0,this.list=[]}},Object.defineProperty(z.ArraySet.prototype,"total",{get:function(){return this.list.length}}),Object.defineProperty(z.ArraySet.prototype,"first",{get:function(){return this.position=0,0<this.list.length?this.list[0]:null}}),Object.defineProperty(z.ArraySet.prototype,"next",{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null}}),z.ArraySet.prototype.constructor=z.ArraySet,z.ArrayUtils={getRandomItem:function(a,t,e){if(null===a)return null;void 0===t&&(t=0),void 0===e&&(e=a.length);var r=t+x(Math.random()*e);return void 0===a[r]?null:a[r]},removeRandomItem:function(a,t,e){if(null==a)return null;void 0===t&&(t=0),void 0===e&&(e=a.length);var r=t+x(Math.random()*e);if(r<a.length){var o=a.splice(r,1);return void 0===o[0]?null:o[0]}return null},remove:function(a,t,e){var r=a.length;if(!(t>=r||0===e)){null==e&&(e=1);for(var i=r-e,n=t;n<i;++n)a[n]=a[n+e];a.length=i}},shuffle:function(a){for(var t=a.length-1;0<t;t--){var e=x(Math.random()*(t+1)),r=a[t];a[t]=a[e],a[e]=r}return a},transposeMatrix:function(a){for(var t=a.length,e=a[0].length,r=Array(e),i=0;i<e;i++){r[i]=Array(t);for(var n=t-1;-1<n;n--)r[i][n]=a[n][i]}return r},rotateMatrix:function(a,t){if("string"!=typeof t&&(t=(t%360+360)%360),90===t||-270===t||"rotateLeft"===t)a=(a=z.ArrayUtils.transposeMatrix(a)).reverse();else if(-90===t||270===t||"rotateRight"===t)a=a.reverse(),a=z.ArrayUtils.transposeMatrix(a);else if(180===E(t)||"rotate180"===t){for(var r=0;r<a.length;r++)a[r].reverse();a=a.reverse()}return a},findClosest:function(a,t){if(!t.length)return NaN;if(1===t.length||a<t[0])return t[0];for(var e=1;t[e]<a;)e++;var r=t[e-1],o=e<t.length?t[e]:u;return o-a<=a-r?o:r},rotateRight:function(a){var t=a.pop();return a.unshift(t),t},rotateLeft:function(a){var t=a.shift();return a.push(t),t},numberArray:function(a,t){void 0!==t&&null!==t||(t=a,a=0);for(var e=[],r=a;r<=t;r++)e.push(r);return e},numberArrayStep:function(a,t,e){void 0!==a&&null!==a||(a=0),void 0!==t&&null!==t||(t=a,a=0),void 0===e&&(e=1);for(var i=[],n=C(z.Math.roundAwayFromZero((t-a)/(e||1)),0),o=0;o<n;o++)i.push(a),a+=e;return i}},z.LinkedList=function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.total=0},z.LinkedList.prototype={add:function(e){return 0===this.total&&null===this.first&&null===this.last?(this.first=e,this.last=e,this.next=e,e.prev=this,this.total++,e):(this.last.next=e,e.prev=this.last,this.last=e,this.total++,e)},reset:function(){this.first=null,this.last=null,this.next=null,this.prev=null,this.total=0},remove:function(e){return 1===this.total?(this.reset(),void(e.next=e.prev=null)):void(e===this.first?this.first=this.first.next:e===this.last&&(this.last=this.last.prev),e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.next=e.prev=null,null===this.first&&(this.last=null),this.total--)},callAll:function(a){if(this.first&&this.last){var t=this.first;do t&&t[a]&&t[a].call(t),t=t.next;while(t!==this.last.next)}}},z.LinkedList.prototype.constructor=z.LinkedList,z.Create=function(e){this.game=e,this.bmd=null,this.canvas=null,this.ctx=null,this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]},z.Create.PALETTE_ARNE=0,z.Create.PALETTE_JMP=1,z.Create.PALETTE_CGA=2,z.Create.PALETTE_C64=3,z.Create.PALETTE_JAPANESE_MACHINE=4,z.Create.prototype={texture:function(m,t,e,i,s,n,o,r){void 0===e&&(e=8),void 0===i&&(i=e),void 0===s&&(s=0),void 0===n&&(n=!0);var a=t[0].length*e,g=t.length*i;null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(a,g),this.bmd.clear();for(var l=0;l<t.length;l++)for(var c=t[l],u=0,d;u<c.length;u++)d=c[u],"."!==d&&" "!==d&&(this.ctx.fillStyle=this.palettes[s][d],this.ctx.fillRect(u*e,l*i,e,i));return n?this.bmd.generateTexture(m,o,r):this.copy()},grid:function(d,t,e,i,s,n,o,r,a){void 0===o&&(o=!0),null===this.bmd&&(this.bmd=this.game.make.bitmapData(),this.canvas=this.bmd.canvas,this.ctx=this.bmd.context),this.bmd.resize(t,e),this.ctx.fillStyle=n;for(var p=0;p<e;p+=s)this.ctx.fillRect(0,p,t,1);for(var l=0;l<t;l+=i)this.ctx.fillRect(l,0,1,e);return o?this.bmd.generateTexture(d,r,a):this.copy()},copy:function(a,t,e,i,s,n,o){return null==a&&(a=this.game.make.bitmapData()),a.resize(this.bmd.width,this.bmd.height),a.draw(this.bmd,t,e,i,s,n,o)}},z.Create.prototype.constructor=z.Create,z.FlexGrid=function(a,t,e){this.game=a.game,this.manager=a,this.width=t,this.height=e,this.boundsCustom=new z.Rectangle(0,0,t,e),this.boundsFluid=new z.Rectangle(0,0,t,e),this.boundsFull=new z.Rectangle(0,0,t,e),this.boundsNone=new z.Rectangle(0,0,t,e),this.positionCustom=new z.Point(0,0),this.positionFluid=new z.Point(0,0),this.positionFull=new z.Point(0,0),this.positionNone=new z.Point(0,0),this.scaleCustom=new z.Point(1,1),this.scaleFluid=new z.Point(1,1),this.scaleFluidInversed=new z.Point(1,1),this.scaleFull=new z.Point(1,1),this.scaleNone=new z.Point(1,1),this.customWidth=0,this.customHeight=0,this.customOffsetX=0,this.customOffsetY=0,this.ratioH=t/e,this.ratioV=e/t,this.multiplier=0,this.layers=[]},z.FlexGrid.prototype={setSize:function(a,t){this.width=a,this.height=t,this.ratioH=a/t,this.ratioV=t/a,this.scaleNone=new z.Point(1,1),this.boundsNone.width=this.width,this.boundsNone.height=this.height,this.refresh()},createCustomLayer:function(a,t,e,r){void 0===r&&(r=!0),this.customWidth=a,this.customHeight=t,this.boundsCustom.width=a,this.boundsCustom.height=t;var n=new z.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return r&&this.game.world.add(n),this.layers.push(n),e&&n.addMultiple(e),n},createFluidLayer:function(a,t){void 0===t&&(t=!0);var e=new z.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return t&&this.game.world.add(e),this.layers.push(e),a&&e.addMultiple(a),e},createFullLayer:function(a){var t=new z.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(t),this.layers.push(t),void 0!==a&&t.addMultiple(a),t},createFixedLayer:function(a){var t=new z.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(t),this.layers.push(t),void 0!==a&&t.addMultiple(a),t},reset:function(){for(var e=this.layers.length;e--;)this.layers[e].persist||(this.layers[e].position=null,this.layers[e].scale=null,this.layers.slice(e,1))},onResize:function(a,t){this.ratioH=a/t,this.ratioV=t/a,this.refresh(a,t)},refresh:function(){this.multiplier=A(this.manager.height/this.height,this.manager.width/this.width),this.boundsFluid.width=f(this.width*this.multiplier),this.boundsFluid.height=f(this.height*this.multiplier),this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height),this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height),this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height),this.boundsFull.width=f(this.manager.width*this.scaleFluidInversed.x),this.boundsFull.height=f(this.manager.height*this.scaleFluidInversed.y),this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y),this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(e){this.manager.scaleSprite(e),e.x=this.manager.bounds.centerX,e.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16),this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}},z.FlexGrid.prototype.constructor=z.FlexGrid,z.FlexLayer=function(a,t,e,r){z.Group.call(this,a.game,null,"__flexLayer"+a.game.rnd.uuid(),!1),this.manager=a.manager,this.grid=a,this.persist=!1,this.position=t,this.bounds=e,this.scale=r,this.topLeft=e.topLeft,this.topMiddle=new z.Point(e.halfWidth,0),this.topRight=e.topRight,this.bottomLeft=e.bottomLeft,this.bottomMiddle=new z.Point(e.halfWidth,e.bottom),this.bottomRight=e.bottomRight},z.FlexLayer.prototype=Object.create(z.Group.prototype),z.FlexLayer.prototype.constructor=z.FlexLayer,z.FlexLayer.prototype.resize=function(){},z.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16),this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1),this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")},z.Color={RED:16711680,ORANGE:16750848,YELLOW:16776960,GREEN:65280,AQUA:65535,BLUE:255,VIOLET:16711935,WHITE:16777215,BLACK:0,GRAY:6710886,packPixel:function(a,t,e,r){return z.Device.LITTLE_ENDIAN?(r<<24|e<<16|t<<8|a)>>>0:(a<<24|t<<16|e<<8|r)>>>0},unpackPixel:function(a,t,e,r){return void 0!==t&&null!==t||(t=z.Color.createColor()),void 0!==e&&null!==e||(e=!1),void 0!==r&&null!==r||(r=!1),z.Device.LITTLE_ENDIAN?(t.a=(4278190080&a)>>>24,t.b=(16711680&a)>>>16,t.g=(65280&a)>>>8,t.r=255&a):(t.r=(4278190080&a)>>>24,t.g=(16711680&a)>>>16,t.b=(65280&a)>>>8,t.a=255&a),t.color=a,t.rgba="rgba("+t.r+","+t.g+","+t.b+","+t.a/255+")",e&&z.Color.RGBtoHSL(t.r,t.g,t.b,t),r&&z.Color.RGBtoHSV(t.r,t.g,t.b,t),t},fromRGBA:function(a,t){return t||(t=z.Color.createColor()),t.r=(4278190080&a)>>>24,t.g=(16711680&a)>>>16,t.b=(65280&a)>>>8,t.a=255&a,t.rgba="rgba("+t.r+","+t.g+","+t.b+","+t.a+")",t},toRGBA:function(a,t,e,r){return a<<24|t<<16|e<<8|r},toABGR:function(a,t,e,r){return(r<<24|e<<16|t<<8|a)>>>0},hexToRGBArray:function(e){return[(255&e>>16)/255,(255&e>>8)/255,(255&e)/255]},RGBArrayToHex:function(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]},RGBtoHSL:function(i,t,e,s){s||(s=z.Color.createColor(i,t,e,1)),i/=255,t/=255,e/=255;var n=A(i,t,e),o=C(i,t,e);if(s.h=0,s.s=0,s.l=(o+n)/2,o!==n){var r=o-n;s.s=.5<s.l?r/(2-o-n):r/(o+n),o===i?s.h=(t-e)/r+(t<e?6:0):o===t?s.h=(e-i)/r+2:o===e&&(s.h=(i-t)/r+4),s.h/=6}return s},HSLtoRGB:function(a,t,e,i){if(i?(i.r=e,i.g=e,i.b=e):i=z.Color.createColor(e,e,e),0!==t){var n=.5>e?e*(1+t):e+t-e*t,o=2*e-n;i.r=z.Color.hueToColor(o,n,a+1/3),i.g=z.Color.hueToColor(o,n,a),i.b=z.Color.hueToColor(o,n,a-1/3)}return i.r=x(0|255*i.r),i.g=x(0|255*i.g),i.b=x(0|255*i.b),z.Color.updateColor(i),i},RGBtoHSV:function(i,t,e,s){s||(s=z.Color.createColor(i,t,e,255)),i/=255,t/=255,e/=255;var n=A(i,t,e),o=C(i,t,e),r=o-n;return s.h=0,s.s=0===o?0:r/o,s.v=o,o!==n&&(o===i?s.h=(t-e)/r+(t<e?6:0):o===t?s.h=(e-i)/r+2:o===e&&(s.h=(i-t)/r+4),s.h/=6),s},HSVtoRGB:function(i,t,e,s){void 0===s&&(s=z.Color.createColor(0,0,0,1,i,t,0,e));var n=x(6*i),p=6*i-n,l=e*(1-t),c=e*(1-p*t),u=e*(1-(1-p)*t),d,o,r;switch(n%6){case 0:d=e,o=u,r=l;break;case 1:d=c,o=e,r=l;break;case 2:d=l,o=e,r=u;break;case 3:d=l,o=c,r=e;break;case 4:d=u,o=l,r=e;break;case 5:d=e,o=l,r=c;}return s.r=x(255*d),s.g=x(255*o),s.b=x(255*r),z.Color.updateColor(s),s},hueToColor:function(a,t,e){return 0>e&&(e+=1),1<e&&(e-=1),e<1/6?a+6*(t-a)*e:.5>e?t:e<2/3?a+6*((t-a)*(2/3-e)):a},createColor:function(i,t,e,s,n,o,r,a){return z.Color.updateColor({r:i||0,g:t||0,b:e||0,a:s||1,h:n||0,s:o||0,l:r||0,v:a||0,color:0,color32:0,rgba:""})},updateColor:function(e){return e.rgba="rgba("+e.r.toFixed()+","+e.g.toFixed()+","+e.b.toFixed()+","+e.a.toString()+")",e.color=z.Color.getColor(e.r,e.g,e.b),e.color32=z.Color.getColor32(255*e.a,e.r,e.g,e.b),e},getColor32:function(a,t,e,r){return a<<24|t<<16|e<<8|r},getColor:function(a,t,e){return a<<16|t<<8|e},RGBtoString:function(a,t,e,r,n){return void 0===r&&(r=255),void 0===n&&(n="#"),"#"===n?"#"+(16777216+(a<<16)+(t<<8)+e).toString(16).slice(1):"0x"+z.Color.componentToHex(r)+z.Color.componentToHex(a)+z.Color.componentToHex(t)+z.Color.componentToHex(e)},hexToRGB:function(a){var t=z.Color.hexToColor(a);if(t)return z.Color.getColor32(t.a,t.r,t.g,t.b)},hexToColor:function(a,t){a=a.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,t,e,r){return t+t+e+e+r+r});var e=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);if(e){var i=parseInt(e[1],16),n=parseInt(e[2],16),o=parseInt(e[3],16);t?(t.r=i,t.g=n,t.b=o):t=z.Color.createColor(i,n,o)}return t},webToColor:function(a,t){t||(t=z.Color.createColor());var e=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(a);return e&&(t.r=~~+e[1],t.g=~~+e[2],t.b=~~+e[3],t.a=void 0===e[4]?1:+e[4],z.Color.updateColor(t)),t},valueToColor:function(a,r){if(r||(r=z.Color.createColor()),"string"==typeof a)return 0===a.indexOf("rgb")?z.Color.webToColor(a,r):(r.a=1,z.Color.hexToColor(a,r));if("number"==typeof a){var e=z.Color.getRGB(a);return r.r=e.r,r.g=e.g,r.b=e.b,r.a=e.a/255,r}return r},componentToHex:function(a){var t=a.toString(16);return 1===t.length?"0"+t:t},HSVColorWheel:function(a,t){void 0===a&&(a=1),void 0===t&&(t=1);for(var e=[],r=0;359>=r;r++)e.push(z.Color.HSVtoRGB(r/359,a,t));return e},HSLColorWheel:function(a,t){void 0===a&&(a=.5),void 0===t&&(t=.5);for(var e=[],r=0;359>=r;r++)e.push(z.Color.HSLtoRGB(r/359,a,t));return e},interpolateColor:function(i,t,e,s,n,o){void 0===n&&(n=255),void 0===o&&(o=0);var r=z.Color.getRGB(i),a=z.Color.getRGB(t);if(0===o)var h=(a.red-r.red)*s/e+r.red,l=(a.green-r.green)*s/e+r.green,c=(a.blue-r.blue)*s/e+r.blue;if(1===o){var u=z.Color.RGBtoHSV(r.r,r.g,r.b),p=z.Color.RGBtoHSV(a.r,a.g,a.b),f=p.h-u.h,_;if(u.h>p.h){var d=p.h;p.h=u.h,u.h=d,f=-f,s=e-s}.5<f&&(++u.h,_=((p.h-u.h)*s/e+u.h)%1),.5>=f&&(_=(p.h-u.h)*s/e+u.h);var m=(p.s-u.s)*s/e+u.s,y=(p.v-u.v)*s/e+u.v,v=z.Color.HSVtoRGB(_,m,y,v),h=v.r,l=v.g,c=v.b}return z.Color.getColor32(n,h,l,c)},interpolateColorWithRGB:function(i,t,e,s,n,o){var r=z.Color.getRGB(i),a=(t-r.red)*o/n+r.red,d=(e-r.green)*o/n+r.green,l=(s-r.blue)*o/n+r.blue;return z.Color.getColor(a,d,l)},interpolateRGB:function(i,t,e,s,n,o,r,a){return z.Color.getColor((s-i)*a/r+i,(n-t)*a/r+t,(o-e)*a/r+e)},linear:function(a,t,e){return this.interpolateColor(a,t,1,e)},linearInterpolation:function(a,t){var e=z.Math.linear(0,a.length-1,t),r=a[x(e)],n=a[y(e)];return this.linear(r,n,e%1)},getRandomColor:function(a,t,e){if(void 0===a&&(a=0),void 0===t&&(t=255),void 0===e&&(e=255),255<t||a>t)return z.Color.getColor(255,255,255);var i=a+f(Math.random()*(t-a)),n=a+f(Math.random()*(t-a)),o=a+f(Math.random()*(t-a));return z.Color.getColor32(e,i,n,o)},getRGB:function(e){return 16777215<e?{alpha:e>>>24,red:255&e>>16,green:255&e>>8,blue:255&e,a:e>>>24,r:255&e>>16,g:255&e>>8,b:255&e}:{alpha:255,red:255&e>>16,green:255&e>>8,blue:255&e,a:255,r:255&e>>16,g:255&e>>8,b:255&e}},getWebRGB:function(a){if("object"==typeof a)return"rgba("+a.r.toString()+","+a.g.toString()+","+a.b.toString()+","+(a.a/255).toString()+")";var r=z.Color.getRGB(a);return"rgba("+r.r.toString()+","+r.g.toString()+","+r.b.toString()+","+(r.a/255).toString()+")"},getAlpha:function(e){return e>>>24},getAlphaFloat:function(e){return(e>>>24)/255},getRed:function(e){return 255&e>>16},getGreen:function(e){return 255&e>>8},getBlue:function(e){return 255&e},blendNormal:function(e){return e},blendLighten:function(a,t){return t>a?t:a},blendDarken:function(a,t){return t>a?a:t},blendMultiply:function(a,t){return a*t/255},blendAverage:function(a,t){return(a+t)/2},blendAdd:function(a,t){return A(255,a+t)},blendSubtract:function(a,t){return C(0,a+t-255)},blendDifference:function(a,t){return E(a-t)},blendNegation:function(a,t){return 255-E(255-a-t)},blendScreen:function(a,t){return 255-((255-a)*(255-t)>>8)},blendExclusion:function(a,t){return a+t-2*a*t/255},blendOverlay:function(a,t){return 128>t?2*a*t/255:255-2*(255-a)*(255-t)/255},blendSoftLight:function(a,t){return 128>t?2*(64+(a>>1))*(t/255):255-2*(255-(64+(a>>1)))*(255-t)/255},blendHardLight:function(a,t){return z.Color.blendOverlay(t,a)},blendColorDodge:function(a,t){return 255===t?t:A(255,(a<<8)/(255-t))},blendColorBurn:function(a,t){return 0===t?t:C(0,255-(255-a<<8)/t)},blendLinearDodge:function(a,t){return z.Color.blendAdd(a,t)},blendLinearBurn:function(a,t){return z.Color.blendSubtract(a,t)},blendLinearLight:function(a,t){return 128>t?z.Color.blendLinearBurn(a,2*t):z.Color.blendLinearDodge(a,2*(t-128))},blendVividLight:function(a,t){return 128>t?z.Color.blendColorBurn(a,2*t):z.Color.blendColorDodge(a,2*(t-128))},blendPinLight:function(a,t){return 128>t?z.Color.blendDarken(a,2*t):z.Color.blendLighten(a,2*(t-128))},blendHardMix:function(a,t){return 128>z.Color.blendVividLight(a,t)?0:255},blendReflect:function(a,t){return 255===t?t:A(255,a*a/(255-t))},blendGlow:function(a,t){return z.Color.blendReflect(t,a)},blendPhoenix:function(a,t){return A(a,t)-C(a,t)+255}},z.Physics=function(a,t){t=t||{},this.game=a,this.config=t,this.arcade=null,this.p2=null,this.ninja=null,this.box2d=null,this.chipmunk=null,this.matter=null,this.parseConfig()},z.Physics.ARCADE=0,z.Physics.P2JS=1,z.Physics.NINJA=2,z.Physics.BOX2D=3,z.Physics.CHIPMUNK=4,z.Physics.MATTERJS=5,z.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&!0!==this.config.arcade||!z.Physics.hasOwnProperty("Arcade")||(this.arcade=new z.Physics.Arcade(this.game)),this.config.hasOwnProperty("ninja")&&!0===this.config.ninja&&z.Physics.hasOwnProperty("Ninja")&&(this.ninja=new z.Physics.Ninja(this.game)),this.config.hasOwnProperty("p2")&&!0===this.config.p2&&z.Physics.hasOwnProperty("P2")&&(this.p2=new z.Physics.P2(this.game,this.config)),this.config.hasOwnProperty("box2d")&&!0===this.config.box2d&&z.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new z.Physics.BOX2D(this.game,this.config)),this.config.hasOwnProperty("matter")&&!0===this.config.matter&&z.Physics.hasOwnProperty("Matter")&&(this.matter=new z.Physics.Matter(this.game,this.config))},startSystem:function(e){e===z.Physics.ARCADE?this.arcade=new z.Physics.Arcade(this.game):e===z.Physics.P2JS?null===this.p2?this.p2=new z.Physics.P2(this.game,this.config):this.p2.reset():e===z.Physics.NINJA?this.ninja=new z.Physics.Ninja(this.game):e===z.Physics.BOX2D?null===this.box2d?this.box2d=new z.Physics.Box2D(this.game,this.config):this.box2d.reset():e===z.Physics.MATTERJS&&(null===this.matter?this.matter=new z.Physics.Matter(this.game,this.config):this.matter.reset())},enable:function(a,t,e){void 0===t&&(t=z.Physics.ARCADE),void 0===e&&(e=!1),t===z.Physics.ARCADE?this.arcade.enable(a):t===z.Physics.P2JS&&this.p2?this.p2.enable(a,e):t===z.Physics.NINJA&&this.ninja?this.ninja.enableAABB(a):t===z.Physics.BOX2D&&this.box2d?this.box2d.enable(a):t===z.Physics.MATTERJS&&this.matter?this.matter.enable(a):console.warn(a.key+" is attempting to enable a physics body using an unknown physics system.")},preUpdate:function(){this.p2&&this.p2.preUpdate(),this.box2d&&this.box2d.preUpdate(),this.matter&&this.matter.preUpdate()},update:function(){this.p2&&this.p2.update(),this.box2d&&this.box2d.update(),this.matter&&this.matter.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld(),this.ninja&&this.ninja.setBoundsToWorld(),this.p2&&this.p2.setBoundsToWorld(),this.box2d&&this.box2d.setBoundsToWorld(),this.matter&&this.matter.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear(),this.box2d&&this.box2d.clear(),this.matter&&this.matter.clear()},reset:function(){this.p2&&this.p2.reset(),this.box2d&&this.box2d.reset(),this.matter&&this.matter.reset()},destroy:function(){this.p2&&this.p2.destroy(),this.box2d&&this.box2d.destroy(),this.matter&&this.matter.destroy(),this.arcade=null,this.ninja=null,this.p2=null,this.box2d=null,this.matter=null}},z.Physics.prototype.constructor=z.Physics,z.Physics.Arcade=function(e){this.game=e,this.gravity=new z.Point,this.bounds=new z.Rectangle(0,0,e.world.width,e.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.forceX=!1,this.sortDirection=z.Physics.Arcade.LEFT_RIGHT,this.skipQuadTree=!0,this.isPaused=!1,this.quadTree=new z.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._total=0,this.setBoundsToWorld()},z.Physics.Arcade.prototype.constructor=z.Physics.Arcade,z.Physics.Arcade.SORT_NONE=0,z.Physics.Arcade.LEFT_RIGHT=1,z.Physics.Arcade.RIGHT_LEFT=2,z.Physics.Arcade.TOP_BOTTOM=3,z.Physics.Arcade.BOTTOM_TOP=4,z.Physics.Arcade.prototype={setBounds:function(a,t,e,r){this.bounds.setTo(a,t,e,r)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(a,t){void 0===t&&(t=!0);var e=1;if(Array.isArray(a))for(e=a.length;e--;)a[e]instanceof z.Group?this.enable(a[e].children,t):(this.enableBody(a[e]),t&&a[e].hasOwnProperty("children")&&0<a[e].children.length&&this.enable(a[e],!0));else a instanceof z.Group?this.enable(a.children,t):(this.enableBody(a),t&&a.hasOwnProperty("children")&&0<a.children.length&&this.enable(a.children,!0))},enableBody:function(e){e.hasOwnProperty("body")&&null===e.body&&(e.body=new z.Physics.Arcade.Body(e),e.parent&&e.parent instanceof z.Group&&e.parent.addToHash(e))},updateMotion:function(a){if(a.allowRotation){var t=this.computeVelocity(0,a,a.angularVelocity,a.angularAcceleration,a.angularDrag,a.maxAngular)-a.angularVelocity;a.angularVelocity+=t,a.rotation+=a.angularVelocity*this.game.time.physicsElapsed}a.velocity.x=this.computeVelocity(1,a,a.velocity.x,a.acceleration.x,a.drag.x,a.maxVelocity.x),a.velocity.y=this.computeVelocity(2,a,a.velocity.y,a.acceleration.y,a.drag.y,a.maxVelocity.y)},computeVelocity:function(a,t,e,r,i,n){return void 0===n&&(n=1e4),1===a&&t.allowGravity?e+=(this.gravity.x+t.gravity.x)*this.game.time.physicsElapsed:2==a&&t.allowGravity&&(e+=(this.gravity.y+t.gravity.y)*this.game.time.physicsElapsed),r?e+=r*this.game.time.physicsElapsed:i&&t.allowDrag&&(0<e-(i*=this.game.time.physicsElapsed)?e-=i:0>e+i?e+=i:e=0),e>n?e=n:e<-n&&(e=-n),e},overlap:function(a,t,e,r,o){return e=e||null,r=r||null,o=o||e,this._total=0,this.collideObjects(a,t,e,r,o,!0),0<this._total},collide:function(a,t,e,r,o){return e=e||null,r=r||null,o=o||e,this._total=0,this.collideObjects(a,t,e,r,o,!1),0<this._total},sortLeftRight:function(a,t){return a.body&&t.body?a.body.x-t.body.x:0},sortRightLeft:function(a,t){return a.body&&t.body?t.body.x-a.body.x:0},sortTopBottom:function(a,t){return a.body&&t.body?a.body.y-t.body.y:0},sortBottomTop:function(a,t){return a.body&&t.body?t.body.y-a.body.y:0},sort:function(a,t){null===a.physicsSortDirection?void 0===t&&(t=this.sortDirection):t=a.physicsSortDirection,t===z.Physics.Arcade.LEFT_RIGHT?a.hash.sort(this.sortLeftRight):t===z.Physics.Arcade.RIGHT_LEFT?a.hash.sort(this.sortRightLeft):t===z.Physics.Arcade.TOP_BOTTOM?a.hash.sort(this.sortTopBottom):t===z.Physics.Arcade.BOTTOM_TOP&&a.hash.sort(this.sortBottomTop)},collideObjects:function(d,t,e,i,s,n){if(!Array.isArray(d)&&Array.isArray(t))for(o=0;o<t.length;o++)t[o]&&this.collideHandler(d,t[o],e,i,s,n);else if(Array.isArray(d)&&!Array.isArray(t))for(o=0;o<d.length;o++)d[o]&&this.collideHandler(d[o],t,e,i,s,n);else if(Array.isArray(d)&&Array.isArray(t)){for(var o=0;o<d.length;o++)if(d[o])for(var r=0;r<t.length;r++)t[r]&&this.collideHandler(d[o],t[r],e,i,s,n);}else this.collideHandler(d,t,e,i,s,n)},collideHandler:function(a,t,e,i,n,o){return void 0===t&&a.physicsType===z.GROUP?(this.sort(a),void this.collideGroupVsSelf(a,e,i,n,o)):void(a&&t&&a.exists&&t.exists&&(this.sortDirection!==z.Physics.Arcade.SORT_NONE&&(a.physicsType===z.GROUP&&this.sort(a),t.physicsType===z.GROUP&&this.sort(t)),a.physicsType===z.SPRITE?t.physicsType===z.SPRITE?this.collideSpriteVsSprite(a,t,e,i,n,o):t.physicsType===z.GROUP?this.collideSpriteVsGroup(a,t,e,i,n,o):t.physicsType===z.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(a,t,e,i,n,o):a.physicsType===z.GROUP?t.physicsType===z.SPRITE?this.collideSpriteVsGroup(t,a,e,i,n,o):t.physicsType===z.GROUP?this.collideGroupVsGroup(a,t,e,i,n,o):t.physicsType===z.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(a,t,e,i,n,o):a.physicsType===z.TILEMAPLAYER&&(t.physicsType===z.SPRITE?this.collideSpriteVsTilemapLayer(t,a,e,i,n,o):t.physicsType===z.GROUP&&this.collideGroupVsTilemapLayer(t,a,e,i,n,o))))},collideSpriteVsSprite:function(a,t,e,r,i,n){return a.body&&t.body&&(this.separate(a.body,t.body,r,i,n)&&(e&&e.call(i,a,t),this._total++),!0)},collideSpriteVsGroup:function(i,t,e,s,n,o){if(0!==t.length&&i.body)if(this.skipQuadTree||i.body.skipQuadTree){for(var r={},a=0,d;a<t.hash.length;a++)if(d=t.hash[a],d&&d.exists&&d.body){if(r=d.body.getBounds(r),this.sortDirection===z.Physics.Arcade.LEFT_RIGHT){if(i.body.right<r.x)break;if(r.right<i.body.x)continue}else if(this.sortDirection===z.Physics.Arcade.RIGHT_LEFT){if(i.body.x>r.right)break;if(r.x>i.body.right)continue}else if(this.sortDirection===z.Physics.Arcade.TOP_BOTTOM){if(i.body.bottom<r.y)break;if(r.bottom<i.body.y)continue}else if(this.sortDirection===z.Physics.Arcade.BOTTOM_TOP){if(i.body.y>r.bottom)break;if(r.y>i.body.bottom)continue}this.collideSpriteVsSprite(i,d,e,s,n,o)}}else{this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(t);for(var l=this.quadTree.retrieve(i),a=0;a<l.length;a++)this.separate(i.body,l[a],s,n,o)&&(e&&e.call(n,i,l[a].sprite),this._total++)}},collideGroupVsSelf:function(i,t,e,s,n){if(0!==i.length)for(var o=0;o<i.hash.length;o++){var r={},a=i.hash[o];if(a&&a.exists&&a.body){r=a.body.getBounds(r);for(var d=o+1;d<i.hash.length;d++){var l={},p=i.hash[d];if(p&&p.exists&&p.body){if(l=p.body.getBounds(l),this.sortDirection===z.Physics.Arcade.LEFT_RIGHT){if(r.right<l.x)break;if(l.right<r.x)continue}else if(this.sortDirection===z.Physics.Arcade.RIGHT_LEFT){if(r.x>l.right)continue;if(l.x>r.right)break}else if(this.sortDirection===z.Physics.Arcade.TOP_BOTTOM){if(r.bottom<l.y)continue;if(l.bottom<r.y)break}else if(this.sortDirection===z.Physics.Arcade.BOTTOM_TOP){if(r.y>l.bottom)continue;if(l.y>a.body.bottom)break}this.collideSpriteVsSprite(a,p,t,e,s,n)}}}}},collideGroupVsGroup:function(i,t,e,s,n,o){if(0!==i.length&&0!==t.length)for(var r=0;r<i.children.length;r++)i.children[r].exists&&(i.children[r].physicsType===z.GROUP?this.collideGroupVsGroup(i.children[r],t,e,s,n,o):this.collideSpriteVsGroup(i.children[r],t,e,s,n,o))},separate:function(d,t,e,i,s){if(!d.enable||!t.enable||d.checkCollision.none||t.checkCollision.none||!this.intersects(d,t))return!1;if(e&&!1===e.call(i,d.sprite,t.sprite))return!1;if(d.isCircle&&t.isCircle)return this.separateCircle(d,t,s);if(d.isCircle!==t.isCircle){var n=d.isCircle?t:d,o=d.isCircle?d:t,r={x:n.x,y:n.y,right:n.right,bottom:n.bottom},a=o.center;if((a.y<r.y||a.y>r.bottom)&&(a.x<r.x||a.x>r.right))return this.separateCircle(d,t,s)}var p=!1,l=!1;this.forceX||E(this.gravity.y+d.gravity.y)<E(this.gravity.x+d.gravity.x)?(p=this.separateX(d,t,s),this.intersects(d,t)&&(l=this.separateY(d,t,s))):(l=this.separateY(d,t,s),this.intersects(d,t)&&(p=this.separateX(d,t,s)));var c=p||l;return c&&(s?(d.onOverlap&&d.onOverlap.dispatch(d.sprite,t.sprite),t.onOverlap&&t.onOverlap.dispatch(t.sprite,d.sprite)):(d.onCollide&&d.onCollide.dispatch(d.sprite,t.sprite),t.onCollide&&t.onCollide.dispatch(t.sprite,d.sprite))),c},intersects:function(a,t){return a!==t&&(a.isCircle?t.isCircle?z.Math.distance(a.center.x,a.center.y,t.center.x,t.center.y)<=a.halfWidth+t.halfWidth:this.circleBodyIntersects(a,t):t.isCircle?this.circleBodyIntersects(t,a):!(a.right<=t.position.x)&&!(a.bottom<=t.position.y)&&!(a.position.x>=t.right)&&!(a.position.y>=t.bottom))},circleBodyIntersects:function(a,t){var e=z.Math.clamp(a.center.x,t.left,t.right),r=z.Math.clamp(a.center.y,t.top,t.bottom);return(a.center.x-e)*(a.center.x-e)+(a.center.y-r)*(a.center.y-r)<=a.halfWidth*a.halfWidth},separateCircle:function(i,t,e){this.getOverlapX(i,t),this.getOverlapY(i,t);var s=t.center.x-i.center.x,n=t.center.y-i.center.y,o=_(n,s),r=0;if(i.isCircle!==t.isCircle){var a={x:t.isCircle?i.position.x:t.position.x,y:t.isCircle?i.position.y:t.position.y,right:t.isCircle?i.right:t.right,bottom:t.isCircle?i.bottom:t.bottom},m={x:i.isCircle?i.center.x:t.center.x,y:i.isCircle?i.center.y:t.center.y,radius:i.isCircle?i.halfWidth:t.halfWidth};m.y<a.y?m.x<a.x?r=z.Math.distance(m.x,m.y,a.x,a.y)-m.radius:m.x>a.right&&(r=z.Math.distance(m.x,m.y,a.right,a.y)-m.radius):m.y>a.bottom&&(m.x<a.x?r=z.Math.distance(m.x,m.y,a.x,a.bottom)-m.radius:m.x>a.right&&(r=z.Math.distance(m.x,m.y,a.right,a.bottom)-m.radius)),r*=-1}else r=i.halfWidth+t.halfWidth-z.Math.distance(i.center.x,i.center.y,t.center.x,t.center.y);if(e||0==r||i.immovable&&t.immovable||i.customSeparateX||t.customSeparateX)return 0!=r&&(i.onOverlap&&i.onOverlap.dispatch(i.sprite,t.sprite),t.onOverlap&&t.onOverlap.dispatch(t.sprite,i.sprite)),0!=r;var l={x:i.velocity.x*S(o)+i.velocity.y*T(o),y:-i.velocity.x*T(o)+i.velocity.y*S(o)},c={x:t.velocity.x*S(o)+t.velocity.y*T(o),y:-t.velocity.x*T(o)+t.velocity.y*S(o)},u=((i.mass-t.mass)*l.x+2*t.mass*c.x)/(i.mass+t.mass),d=(2*i.mass*l.x+(t.mass-i.mass)*c.x)/(i.mass+t.mass);return i.immovable||(i.velocity.x=(u*S(o)-l.y*T(o))*i.bounce.x,i.velocity.y=(l.y*S(o)+u*T(o))*i.bounce.y),t.immovable||(t.velocity.x=(d*S(o)-c.y*T(o))*t.bounce.x,t.velocity.y=(c.y*S(o)+d*T(o))*t.bounce.y),E(o)<R/2?0<i.velocity.x&&!i.immovable&&t.velocity.x>i.velocity.x?i.velocity.x*=-1:0>t.velocity.x&&!t.immovable&&i.velocity.x<t.velocity.x?t.velocity.x*=-1:0<i.velocity.y&&!i.immovable&&t.velocity.y>i.velocity.y?i.velocity.y*=-1:0>t.velocity.y&&!t.immovable&&i.velocity.y<t.velocity.y&&(t.velocity.y*=-1):E(o)>R/2&&(0>i.velocity.x&&!i.immovable&&t.velocity.x<i.velocity.x?i.velocity.x*=-1:0<t.velocity.x&&!t.immovable&&i.velocity.x>t.velocity.x?t.velocity.x*=-1:0>i.velocity.y&&!i.immovable&&t.velocity.y<i.velocity.y?i.velocity.y*=-1:0<t.velocity.y&&!t.immovable&&i.velocity.x>t.velocity.y&&(t.velocity.y*=-1)),i.immovable||(i.x+=i.velocity.x*this.game.time.physicsElapsed-r*S(o),i.y+=i.velocity.y*this.game.time.physicsElapsed-r*T(o)),t.immovable||(t.x+=t.velocity.x*this.game.time.physicsElapsed+r*S(o),t.y+=t.velocity.y*this.game.time.physicsElapsed+r*T(o)),i.onCollide&&i.onCollide.dispatch(i.sprite,t.sprite),t.onCollide&&t.onCollide.dispatch(t.sprite,i.sprite),!0},getOverlapX:function(a,t,e){var r=0,o=a.deltaAbsX()+t.deltaAbsX()+this.OVERLAP_BIAS;return 0===a.deltaX()&&0===t.deltaX()?(a.embedded=!0,t.embedded=!0):a.deltaX()>t.deltaX()?(r=a.right-t.x)>o&&!e||!1===a.checkCollision.right||!1===t.checkCollision.left?r=0:(a.touching.none=!1,a.touching.right=!0,t.touching.none=!1,t.touching.left=!0):a.deltaX()<t.deltaX()&&(-(r=a.x-t.width-t.x)>o&&!e||!1===a.checkCollision.left||!1===t.checkCollision.right?r=0:(a.touching.none=!1,a.touching.left=!0,t.touching.none=!1,t.touching.right=!0)),a.overlapX=r,t.overlapX=r,r},getOverlapY:function(a,t,e){var r=0,o=a.deltaAbsY()+t.deltaAbsY()+this.OVERLAP_BIAS;return 0===a.deltaY()&&0===t.deltaY()?(a.embedded=!0,t.embedded=!0):a.deltaY()>t.deltaY()?(r=a.bottom-t.y)>o&&!e||!1===a.checkCollision.down||!1===t.checkCollision.up?r=0:(a.touching.none=!1,a.touching.down=!0,t.touching.none=!1,t.touching.up=!0):a.deltaY()<t.deltaY()&&(-(r=a.y-t.bottom)>o&&!e||!1===a.checkCollision.up||!1===t.checkCollision.down?r=0:(a.touching.none=!1,a.touching.up=!0,t.touching.none=!1,t.touching.down=!0)),a.overlapY=r,t.overlapY=r,r},separateX:function(d,t,e){var i=this.getOverlapX(d,t,e);if(e||0===i||d.immovable&&t.immovable||d.customSeparateX||t.customSeparateX)return 0!=i||d.embedded&&t.embedded;var s=d.velocity.x,n=t.velocity.x;if(d.immovable||t.immovable)d.immovable?(t.x+=i,t.velocity.x=s-n*t.bounce.x,d.moves&&(t.y+=(d.y-d.prev.y)*d.friction.y)):(d.x-=i,d.velocity.x=n-s*d.bounce.x,t.moves&&(d.y+=(t.y-t.prev.y)*t.friction.y));else{i*=.5,d.x-=i,t.x+=i;var o=F(n*n*t.mass/d.mass)*(0<n?1:-1),r=F(s*s*d.mass/t.mass)*(0<s?1:-1),a=.5*(o+r);o-=a,r-=a,d.velocity.x=a+o*d.bounce.x,t.velocity.x=a+r*t.bounce.x}return!0},separateY:function(d,t,e){var i=this.getOverlapY(d,t,e);if(e||0===i||d.immovable&&t.immovable||d.customSeparateY||t.customSeparateY)return 0!=i||d.embedded&&t.embedded;var s=d.velocity.y,n=t.velocity.y;if(d.immovable||t.immovable)d.immovable?(t.y+=i,t.velocity.y=s-n*t.bounce.y,d.moves&&(t.x+=(d.x-d.prev.x)*d.friction.x)):(d.y-=i,d.velocity.y=n-s*d.bounce.y,t.moves&&(d.x+=(t.x-t.prev.x)*t.friction.x));else{i*=.5,d.y-=i,t.y+=i;var o=F(n*n*t.mass/d.mass)*(0<n?1:-1),r=F(s*s*d.mass/t.mass)*(0<s?1:-1),a=.5*(o+r);o-=a,r-=a,d.velocity.y=a+o*d.bounce.y,t.velocity.y=a+r*t.bounce.y}return!0},getObjectsUnderPointer:function(a,t,e,r){if(0!==t.length&&a.exists)return this.getObjectsAtLocation(a.x,a.y,t,e,r,a)},getObjectsAtLocation:function(i,t,e,s,n,o){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(e);for(var r=new z.Rectangle(i,t,1,1),a=[],d=this.quadTree.retrieve(r),l=0;l<d.length;l++)d[l].hitTest(i,t)&&(s&&s.call(n,o,d[l].sprite),a.push(d[l].sprite));return a},moveToObject:function(a,t,e,r){void 0===e&&(e=60),void 0===r&&(r=0);var n=z.Point.angle(t,a);return 0<r&&(e=this.distanceBetween(a,t)/(r/1e3)),a.body.velocity.setToPolar(n,e),n},moveToPointer:function(a,t,e,r){void 0===t&&(t=60),e=e||this.game.input.activePointer,void 0===r&&(r=0);var o=this.angleToPointer(a,e);return 0<r&&(t=this.distanceToPointer(a,e)/(r/1e3)),a.body.velocity.setToPolar(o,t),o},moveToXY:function(a,t,e,r,i){void 0===r&&(r=60),void 0===i&&(i=0);var n=_(e-a.y,t-a.x);return 0<i&&(r=this.distanceToXY(a,t,e)/(i/1e3)),a.body.velocity.setToPolar(n,r),n},velocityFromAngle:function(a,t,e){return void 0===t&&(t=60),(e=e||new z.Point).setToPolar(a,t,!0)},velocityFromRotation:function(a,t,e){return void 0===t&&(t=60),(e=e||new z.Point).setToPolar(a,t)},accelerationFromRotation:function(a,t,e){return void 0===t&&(t=60),(e=e||new z.Point).setToPolar(a,t)},accelerateToObject:function(a,t,e,r,i){void 0===e&&(e=60),void 0===r&&(r=1e3),void 0===i&&(i=1e3);var n=this.angleBetween(a,t);return a.body.acceleration.setToPolar(n,e),a.body.maxVelocity.setTo(r,i),n},accelerateToPointer:function(a,t,e,r,i){void 0===e&&(e=60),void 0===t&&(t=this.game.input.activePointer),void 0===r&&(r=1e3),void 0===i&&(i=1e3);var n=this.angleToPointer(a,t);return a.body.acceleration.setToPolar(n,e),a.body.maxVelocity.setTo(r,i),n},accelerateToXY:function(a,t,e,i,s,n){void 0===i&&(i=60),void 0===s&&(s=1e3),void 0===n&&(n=1e3);var o=this.angleToXY(a,t,e);return a.body.acceleration.setTo(o,i),a.body.maxVelocity.setTo(s,n),o},distanceBetween:function(a,t,e,r){void 0===e&&(e=!1);var i,n;return r?(i=a.centerX-t.centerX,n=a.centerY-t.centerY):e?(i=a.world.x-t.world.x,n=a.world.y-t.world.y):(i=a.x-t.x,n=a.y-t.y),F(i*i+n*n)},distanceToXY:function(a,t,e,r){void 0===r&&(r=!1);var i=r?a.world.x-t:a.x-t,n=r?a.world.y-e:a.y-e;return F(i*i+n*n)},distanceToPointer:function(a,t,e){void 0===t&&(t=this.game.input.activePointer),void 0===e&&(e=!1);var r=e?a.world.x-t.worldX:a.x-t.worldX,o=e?a.world.y-t.worldY:a.y-t.worldY;return F(r*r+o*o)},closest:function(d,t,e,i){for(var s=1/0,n=null,o=0,r=t.length;o<r;o++){var a=t[o],p=this.distanceBetween(d,a,e,i);p<s&&(n=a,s=p)}return n},farthest:function(d,t,e,i){for(var s=-1,n=null,o=0,r=t.length;o<r;o++){var a=t[o],p=this.distanceBetween(d,a,e,i);p>s&&(n=a,s=p)}return n},angleBetween:function(a,t,e){return void 0===e&&(e=!1),e?z.Point.angle(t.world,a.world):z.Point.angle(t,a)},angleBetweenCenters:function(a,t){var e=t.centerX-a.centerX,r=t.centerY-a.centerY;return _(r,e)},angleToXY:function(a,t,e,r){return void 0===r&&(r=!1),r?_(e-a.world.y,t-a.world.x):_(e-a.y,t-a.x)},angleToPointer:function(a,t,e){return void 0===t&&(t=this.game.input.activePointer),void 0===e&&(e=!1),e?_(t.worldY-a.world.y,t.worldX-a.world.x):_(t.worldY-a.y,t.worldX-a.x)},worldAngleToPointer:function(a,t){return this.angleToPointer(a,t,!0)}},z.Physics.Arcade.Body=function(e){this.sprite=e,this.game=e.game,this.type=z.Physics.ARCADE,this.enable=!0,this.isCircle=!1,this.radius=0,this.offset=new z.Point,this.position=new z.Point(e.x,e.y),this.prev=new z.Point(this.position.x,this.position.y),this.allowRotation=!0,this.rotation=e.angle,this.preRotation=e.angle,this.width=e.width,this.height=e.height,this.sourceWidth=e.width,this.sourceHeight=e.height,e.texture&&(this.sourceWidth=e.texture.frame.width,this.sourceHeight=e.texture.frame.height),this.halfWidth=E(e.width/2),this.halfHeight=E(e.height/2),this.center=new z.Point(e.x+this.halfWidth,e.y+this.halfHeight),this.velocity=new z.Point,this.newVelocity=new z.Point,this.deltaMax=new z.Point,this.acceleration=new z.Point,this.allowDrag=!0,this.drag=new z.Point,this.allowGravity=!0,this.gravity=new z.Point,this.bounce=new z.Point,this.worldBounce=null,this.onWorldBounds=null,this.onCollide=null,this.onOverlap=null,this.maxVelocity=new z.Point(1e4,1e4),this.friction=new z.Point(1,0),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=z.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.overlapR=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={none:!0,up:!1,down:!1,left:!1,right:!1},this.tilePadding=new z.Point,this.dirty=!1,this.skipQuadTree=!1,this.syncBounds=!1,this.isMoving=!1,this.stopVelocityOnCollide=!0,this.moveTimer=0,this.moveDistance=0,this.moveDuration=0,this.moveTarget=null,this.moveEnd=null,this.onMoveComplete=new z.Signal,this.movementCallback=null,this.movementCallbackContext=null,this._reset=!0,this._sx=e.scale.x,this._sy=e.scale.y,this._dx=0,this._dy=0},z.Physics.Arcade.Body.prototype={updateBounds:function(){if(this.syncBounds){var a=this.sprite.getBounds();a.ceilAll(),a.width===this.width&&a.height===this.height||(this.width=a.width,this.height=a.height,this._reset=!0)}else{var t=E(this.sprite.scale.x),e=E(this.sprite.scale.y);t===this._sx&&e===this._sy||(this.width=this.sourceWidth*t,this.height=this.sourceHeight*e,this._sx=t,this._sy=e,this._reset=!0)}this._reset&&(this.halfWidth=x(this.width/2),this.halfHeight=x(this.height/2),this.updateCenter())},updateCenter:function(){this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},preUpdate:function(){this.enable&&!this.game.physics.arcade.isPaused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.none=!0,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.overlapR=0,this.overlapX=0,this.overlapY=0,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=0>this.sprite.scale.x?this.width:0,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=0>this.sprite.scale.y?this.height:0,this.updateCenter(),this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.updateCenter(),this.position.x===this.prev.x&&this.position.y===this.prev.y||(this.angle=this.velocity.atan()),this.speed=F(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.collideWorldBounds&&this.checkWorldBounds()&&this.onWorldBounds&&this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},updateMovement:function(){var a=0,t=0!==this.overlapX||0!==this.overlapY;if(0<this.moveDuration?(this.moveTimer+=this.game.time.elapsedMS,a=this.moveTimer/this.moveDuration):(this.moveTarget.end.set(this.position.x,this.position.y),a=this.moveTarget.length/this.moveDistance),this.movementCallback)var e=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,a);return!(t||1<=a||void 0!==e&&!0!==e)||(this.stopMovement(1<=a||this.stopVelocityOnCollide&&t),!1)},stopMovement:function(e){this.isMoving&&(this.isMoving=!1,e&&this.velocity.set(0),this.onMoveComplete.dispatch(this.sprite,0!==this.overlapX||0!==this.overlapY))},postUpdate:function(){this.enable&&this.dirty&&(this.isMoving&&this.updateMovement(),this.dirty=!1,0>this.deltaX()?this.facing=z.LEFT:0<this.deltaX()&&(this.facing=z.RIGHT),0>this.deltaY()?this.facing=z.UP:0<this.deltaY()&&(this.facing=z.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&(0>this._dx&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:0<this._dx&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(0>this._dy&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:0<this._dy&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this._reset=!0),this.updateCenter(),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},checkWorldBounds:function(){var a=this.position,t=this.game.physics.arcade.bounds,e=this.game.physics.arcade.checkCollision,r=this.worldBounce?-this.worldBounce.x:-this.bounce.x,o=this.worldBounce?-this.worldBounce.y:-this.bounce.y;return a.x<t.x&&e.left?(a.x=t.x,this.velocity.x*=r,this.blocked.left=!0,this.blocked.none=!1):this.right>t.right&&e.right&&(a.x=t.right-this.width,this.velocity.x*=r,this.blocked.right=!0,this.blocked.none=!1),a.y<t.y&&e.up?(a.y=t.y,this.velocity.y*=o,this.blocked.up=!0,this.blocked.none=!1):this.bottom>t.bottom&&e.down&&(a.y=t.bottom-this.height,this.velocity.y*=o,this.blocked.down=!0,this.blocked.none=!1),!this.blocked.none},moveFrom:function(a,t,e){if(void 0===t&&(t=this.speed),0===t)return!1;var r;return void 0===e?(r=this.angle,e=this.game.math.radToDeg(r)):r=this.game.math.degToRad(e),this.moveTimer=0,this.moveDuration=a,0===e||180===e?this.velocity.set(S(r)*t,0):90===e||270===e?this.velocity.set(0,T(r)*t):this.velocity.setToPolar(r,t),this.isMoving=!0,!0},moveTo:function(a,t,e){var r=t/(a/1e3);if(0==r)return!1;var n;return void 0===e?(n=this.angle,e=this.game.math.radToDeg(n)):n=this.game.math.degToRad(e),t=E(t),this.moveDuration=0,this.moveDistance=t,null===this.moveTarget&&(this.moveTarget=new z.Line,this.moveEnd=new z.Point),this.moveTarget.fromAngle(this.x,this.y,n,t),this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y),this.moveTarget.setTo(this.x,this.y,this.x,this.y),0===e||180===e?this.velocity.set(S(n)*r,0):90===e||270===e?this.velocity.set(0,T(n)*r):this.velocity.setToPolar(n,r),this.isMoving=!0,!0},setSize:function(a,t,e,r){void 0===e&&(e=this.offset.x),void 0===r&&(r=this.offset.y),this.sourceWidth=a,this.sourceHeight=t,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=x(this.width/2),this.halfHeight=x(this.height/2),this.offset.setTo(e,r),this.updateCenter(),this.isCircle=!1,this.radius=0},setCircle:function(a,t,e){void 0===t&&(t=this.offset.x),void 0===e&&(e=this.offset.y),0<a?(this.isCircle=!0,this.radius=a,this.sourceWidth=2*a,this.sourceHeight=2*a,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=x(this.width/2),this.halfHeight=x(this.height/2),this.offset.setTo(t,e),this.updateCenter()):this.isCircle=!1},reset:function(a,t){this.stop(),this.position.x=a-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=0>this.sprite.scale.x?this.width:0,this.position.y=t-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=0>this.sprite.scale.y?this.height:0,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this.updateBounds(),this.updateCenter()},stop:function(){this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0},getBounds:function(e){return e.x=this.x,e.y=this.y,e.right=this.right,e.bottom=this.bottom,e},hitTest:function(a,t){return this.isCircle?z.Circle.contains(this,a,t):z.Rectangle.contains(this,a,t)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return 0<this.deltaX()?this.deltaX():-this.deltaX()},deltaAbsY:function(){return 0<this.deltaY()?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){this.sprite.parent&&this.sprite.parent instanceof z.Group&&this.sprite.parent.removeFromHash(this.sprite),this.sprite.body=null,this.sprite=null}},Object.defineProperty(z.Physics.Arcade.Body.prototype,"left",{get:function(){return this.position.x}}),Object.defineProperty(z.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}}),Object.defineProperty(z.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}}),Object.defineProperty(z.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}}),Object.defineProperty(z.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(z.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),z.Physics.Arcade.Body.render=function(a,t,e,r,o){void 0===r&&(r=!0),e=e||"rgba(0,255,0,0.4)",a.fillStyle=e,a.strokeStyle=e,a.lineWidth=o||1,t.isCircle?(a.beginPath(),a.arc(t.center.x-t.game.camera.x,t.center.y-t.game.camera.y,t.halfWidth,0,2*R),r?a.fill():a.stroke()):r?a.fillRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height):a.strokeRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height)},z.Physics.Arcade.Body.renderBodyInfo=function(a,t){a.line("x: "+t.x.toFixed(2),"y: "+t.y.toFixed(2),"width: "+t.width,"height: "+t.height),a.line("velocity x: "+t.velocity.x.toFixed(2),"y: "+t.velocity.y.toFixed(2),"deltaX: "+t._dx.toFixed(2),"deltaY: "+t._dy.toFixed(2)),a.line("acceleration x: "+t.acceleration.x.toFixed(2),"y: "+t.acceleration.y.toFixed(2),"speed: "+t.speed.toFixed(2),"angle: "+t.angle.toFixed(2)),a.line("gravity x: "+t.gravity.x,"y: "+t.gravity.y,"bounce x: "+t.bounce.x.toFixed(2),"y: "+t.bounce.y.toFixed(2)),a.line("touching left: "+t.touching.left,"right: "+t.touching.right,"up: "+t.touching.up,"down: "+t.touching.down),a.line("blocked left: "+t.blocked.left,"right: "+t.blocked.right,"up: "+t.blocked.up,"down: "+t.blocked.down)},z.Physics.Arcade.Body.prototype.constructor=z.Physics.Arcade.Body,z.Physics.Arcade.TilemapCollision=function(){},z.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(d,t,e,i,s,n){if(d.body){var o=t.getTiles(d.body.position.x-d.body.tilePadding.x-t.getTileOffsetX(),d.body.position.y-d.body.tilePadding.y-t.getTileOffsetY(),d.body.width+d.body.tilePadding.x,d.body.height+d.body.tilePadding.y,!1,!1);if(0!==o.length)for(var r=0;r<o.length;r++)i?i.call(s,d,o[r])&&this.separateTile(r,d.body,o[r],t,n)&&(this._total++,e&&e.call(s,d,o[r])):this.separateTile(r,d.body,o[r],t,n)&&(this._total++,e&&e.call(s,d,o[r]))}},collideGroupVsTilemapLayer:function(a,t,e,i,s,n){if(0!==a.length)for(var o=0;o<a.children.length;o++)a.children[o].exists&&this.collideSpriteVsTilemapLayer(a.children[o],t,e,i,s,n)},separateTile:function(d,t,e,i,s){if(!t.enable)return!1;var n=i.getTileOffsetX(),o=i.getTileOffsetY();if(!e.intersects(t.position.x-n,t.position.y-o,t.right-n,t.bottom-o))return!1;if(s)return!0;if(e.collisionCallback&&!e.collisionCallback.call(e.collisionCallbackContext,t.sprite,e))return!1;if(void 0!==e.layer.callbacks&&e.layer.callbacks[e.index]&&!e.layer.callbacks[e.index].callback.call(e.layer.callbacks[e.index].callbackContext,t.sprite,e))return!1;if(!(e.faceLeft||e.faceRight||e.faceTop||e.faceBottom))return!1;var r=0,a=0,p=0,l=1;if(t.deltaAbsX()>t.deltaAbsY()?p=-1:t.deltaAbsX()<t.deltaAbsY()&&(l=-1),0!==t.deltaX()&&0!==t.deltaY()&&(e.faceLeft||e.faceRight)&&(e.faceTop||e.faceBottom)&&(p=A(E(t.position.x-n-e.right),E(t.right-n-e.left)),l=A(E(t.position.y-o-e.bottom),E(t.bottom-o-e.top))),p<l){if((e.faceLeft||e.faceRight)&&0!==(r=this.tileCheckX(t,e,i))&&!e.intersects(t.position.x-n,t.position.y-o,t.right-n,t.bottom-o))return!0;(e.faceTop||e.faceBottom)&&(a=this.tileCheckY(t,e,i))}else{if((e.faceTop||e.faceBottom)&&0!==(a=this.tileCheckY(t,e,i))&&!e.intersects(t.position.x-n,t.position.y-o,t.right-n,t.bottom-o))return!0;(e.faceLeft||e.faceRight)&&(r=this.tileCheckX(t,e,i))}return 0!==r||0!==a},tileCheckX:function(a,t,e){var r=0,o=e.getTileOffsetX();return 0>a.deltaX()&&!a.blocked.left&&t.collideRight&&a.checkCollision.left?t.faceRight&&a.x-o<t.right&&(r=a.x-o-t.right)<-this.TILE_BIAS&&(r=0):0<a.deltaX()&&!a.blocked.right&&t.collideLeft&&a.checkCollision.right&&t.faceLeft&&a.right-o>t.left&&(r=a.right-o-t.left)>this.TILE_BIAS&&(r=0),0!=r&&(a.customSeparateX?a.overlapX=r:this.processTileSeparationX(a,r)),r},tileCheckY:function(a,t,e){var r=0,o=e.getTileOffsetY();return 0>a.deltaY()&&!a.blocked.up&&t.collideDown&&a.checkCollision.up?t.faceBottom&&a.y-o<t.bottom&&(r=a.y-o-t.bottom)<-this.TILE_BIAS&&(r=0):0<a.deltaY()&&!a.blocked.down&&t.collideUp&&a.checkCollision.down&&t.faceTop&&a.bottom-o>t.top&&(r=a.bottom-o-t.top)>this.TILE_BIAS&&(r=0),0!=r&&(a.customSeparateY?a.overlapY=r:this.processTileSeparationY(a,r)),r},processTileSeparationX:function(a,t){0>t?(a.blocked.left=!0,a.blocked.none=!1):0<t&&(a.blocked.right=!0,a.blocked.none=!1),a.position.x-=t,a.velocity.x=0===a.bounce.x?0:-a.velocity.x*a.bounce.x},processTileSeparationY:function(a,t){0>t?(a.blocked.up=!0,a.blocked.none=!1):0<t&&(a.blocked.down=!0,a.blocked.none=!1),a.position.y-=t,a.velocity.y=0===a.bounce.y?0:-a.velocity.y*a.bounce.y}},z.Utils.mixinPrototype(z.Physics.Arcade.prototype,z.Physics.Arcade.TilemapCollision.prototype),p2.Body.prototype.parent=null,p2.Spring.prototype.parent=null,z.Physics.P2=function(a,t){this.game=a,void 0===t?t={gravity:[0,0],broadphase:new p2.SAPBroadphase}:(t.hasOwnProperty("gravity")||(t.gravity=[0,0]),t.hasOwnProperty("broadphase")||(t.broadphase=new p2.SAPBroadphase)),this.config=t,this.world=new p2.World(this.config),this.frameRate=1/60,this.useElapsedTime=!1,this.paused=!1,this.materials=[],this.gravity=new z.Physics.P2.InversePointProxy(this,this.world.gravity),this.walls={left:null,right:null,top:null,bottom:null},this.onBodyAdded=new z.Signal,this.onBodyRemoved=new z.Signal,this.onSpringAdded=new z.Signal,this.onSpringRemoved=new z.Signal,this.onConstraintAdded=new z.Signal,this.onConstraintRemoved=new z.Signal,this.onContactMaterialAdded=new z.Signal,this.onContactMaterialRemoved=new z.Signal,this.postBroadphaseCallback=null,this.callbackContext=null,this.onBeginContact=new z.Signal,this.onEndContact=new z.Signal,t.hasOwnProperty("mpx")&&t.hasOwnProperty("pxm")&&t.hasOwnProperty("mpxi")&&t.hasOwnProperty("pxmi")&&(this.mpx=t.mpx,this.mpxi=t.mpxi,this.pxm=t.pxm,this.pxmi=t.pxmi),this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.collisionGroups=[],this.nothingCollisionGroup=new z.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new z.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new z.Physics.P2.CollisionGroup(2147483648),this.boundsCollidesWith=[],this._toRemove=[],this._collisionGroupID=2,this._boundsLeft=!0,this._boundsRight=!0,this._boundsTop=!0,this._boundsBottom=!0,this._boundsOwnGroup=!1,this.setBoundsToWorld(!0,!0,!0,!0,!1)},z.Physics.P2.prototype={removeBodyNextStep:function(e){this._toRemove.push(e)},preUpdate:function(){for(var e=this._toRemove.length;e--;)this.removeBody(this._toRemove[e]);this._toRemove.length=0},enable:function(a,t,e){void 0===t&&(t=!1),void 0===e&&(e=!0);var r=1;if(Array.isArray(a))for(r=a.length;r--;)a[r]instanceof z.Group?this.enable(a[r].children,t,e):(this.enableBody(a[r],t),e&&a[r].hasOwnProperty("children")&&0<a[r].children.length&&this.enable(a[r],t,!0));else a instanceof z.Group?this.enable(a.children,t,e):(this.enableBody(a,t),e&&a.hasOwnProperty("children")&&0<a.children.length&&this.enable(a.children,t,!0))},enableBody:function(a,t){a.hasOwnProperty("body")&&null===a.body&&(a.body=new z.Physics.P2.Body(this.game,a,a.x,a.y,1),a.body.debug=t,void 0!==a.anchor&&a.anchor.set(.5))},setImpactEvents:function(e){e?this.world.on("impact",this.impactHandler,this):this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(a,t){this.postBroadphaseCallback=a,this.callbackContext=t,null===a?this.world.off("postBroadphase",this.postBroadphaseHandler,this):this.world.on("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(a){if(this.postBroadphaseCallback&&0!==a.pairs.length)for(var t=a.pairs.length-2;0<=t;t-=2)a.pairs[t].parent&&a.pairs[t+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,a.pairs[t].parent,a.pairs[t+1].parent)&&a.pairs.splice(t,2)},impactHandler:function(a){if(a.bodyA.parent&&a.bodyB.parent){var t=a.bodyA.parent,e=a.bodyB.parent;t._bodyCallbacks[a.bodyB.id]&&t._bodyCallbacks[a.bodyB.id].call(t._bodyCallbackContext[a.bodyB.id],t,e,a.shapeA,a.shapeB),e._bodyCallbacks[a.bodyA.id]&&e._bodyCallbacks[a.bodyA.id].call(e._bodyCallbackContext[a.bodyA.id],e,t,a.shapeB,a.shapeA),t._groupCallbacks[a.shapeB.collisionGroup]&&t._groupCallbacks[a.shapeB.collisionGroup].call(t._groupCallbackContext[a.shapeB.collisionGroup],t,e,a.shapeA,a.shapeB),e._groupCallbacks[a.shapeA.collisionGroup]&&e._groupCallbacks[a.shapeA.collisionGroup].call(e._groupCallbackContext[a.shapeA.collisionGroup],e,t,a.shapeB,a.shapeA)}},beginContactHandler:function(e){e.bodyA&&e.bodyB&&(this.onBeginContact.dispatch(e.bodyA,e.bodyB,e.shapeA,e.shapeB,e.contactEquations),e.bodyA.parent&&e.bodyA.parent.onBeginContact.dispatch(e.bodyB.parent,e.bodyB,e.shapeA,e.shapeB,e.contactEquations),e.bodyB.parent&&e.bodyB.parent.onBeginContact.dispatch(e.bodyA.parent,e.bodyA,e.shapeB,e.shapeA,e.contactEquations))},endContactHandler:function(e){e.bodyA&&e.bodyB&&(this.onEndContact.dispatch(e.bodyA,e.bodyB,e.shapeA,e.shapeB),e.bodyA.parent&&e.bodyA.parent.onEndContact.dispatch(e.bodyB.parent,e.bodyB,e.shapeA,e.shapeB),e.bodyB.parent&&e.bodyB.parent.onEndContact.dispatch(e.bodyA.parent,e.bodyA,e.shapeB,e.shapeA))},setBoundsToWorld:function(a,t,e,r,o){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,a,t,e,r,o)},setWorldMaterial:function(a,t,e,r,o){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===r&&(r=!0),void 0===o&&(o=!0),t&&this.walls.left&&(this.walls.left.shapes[0].material=a),e&&this.walls.right&&(this.walls.right.shapes[0].material=a),r&&this.walls.top&&(this.walls.top.shapes[0].material=a),o&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=a)},updateBoundsCollisionGroup:function(a){void 0===a&&(a=!0);var t=a?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;this.walls.left&&(this.walls.left.shapes[0].collisionGroup=t),this.walls.right&&(this.walls.right.shapes[0].collisionGroup=t),this.walls.top&&(this.walls.top.shapes[0].collisionGroup=t),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=t),this._boundsOwnGroup=a},setBounds:function(d,t,e,i,s,n,o,r,a){void 0===s&&(s=this._boundsLeft),void 0===n&&(n=this._boundsRight),void 0===o&&(o=this._boundsTop),void 0===r&&(r=this._boundsBottom),void 0===a&&(a=this._boundsOwnGroup),this.setupWall(s,"left",d,t,1.5707963267948966,a),this.setupWall(n,"right",d+e,t,-1.5707963267948966,a),this.setupWall(o,"top",d,t,-3.141592653589793,a),this.setupWall(r,"bottom",d,t+i,0,a),this._boundsLeft=s,this._boundsRight=n,this._boundsTop=o,this._boundsBottom=r,this._boundsOwnGroup=a},setupWall:function(a,t,e,r,i,s){a?(this.walls[t]?this.walls[t].position=[this.pxmi(e),this.pxmi(r)]:(this.walls[t]=new p2.Body({mass:0,position:[this.pxmi(e),this.pxmi(r)],angle:i}),this.walls[t].addShape(new p2.Plane),this.world.addBody(this.walls[t])),s&&(this.walls[t].shapes[0].collisionGroup=this.boundsCollisionGroup.mask)):this.walls[t]&&(this.world.removeBody(this.walls[t]),this.walls[t]=null)},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||(this.useElapsedTime?this.world.step(this.game.time.physicsElapsed):this.world.step(this.frameRate))},reset:function(){this.world.on("beginContact",this.beginContactHandler,this),this.world.on("endContact",this.endContactHandler,this),this.nothingCollisionGroup=new z.Physics.P2.CollisionGroup(1),this.boundsCollisionGroup=new z.Physics.P2.CollisionGroup(2),this.everythingCollisionGroup=new z.Physics.P2.CollisionGroup(2147483648),this._collisionGroupID=2,this.setBoundsToWorld(!0,!0,!0,!0,!1)},clear:function(){this.world.time=0,this.world.fixedStepTime=0,this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();for(var a=this.world.constraints,t=a.length-1;0<=t;t--)this.world.removeConstraint(a[t]);for(var e=this.world.bodies,t=e.length-1;0<=t;t--)this.world.removeBody(e[t]);for(var r=this.world.springs,t=r.length-1;0<=t;t--)this.world.removeSpring(r[t]);for(var o=this.world.contactMaterials,t=o.length-1;0<=t;t--)this.world.removeContactMaterial(o[t]);this.world.off("beginContact",this.beginContactHandler,this),this.world.off("endContact",this.endContactHandler,this),this.postBroadphaseCallback=null,this.callbackContext=null,this.impactCallback=null,this.collisionGroups=[],this._toRemove=[],this.boundsCollidesWith=[],this.walls={left:null,right:null,top:null,bottom:null}},destroy:function(){this.clear(),this.game=null},addBody:function(e){return!e.data.world&&(this.world.addBody(e.data),this.onBodyAdded.dispatch(e),!0)},removeBody:function(e){return e.data.world===this.world&&(this.world.removeBody(e.data),this.onBodyRemoved.dispatch(e)),e},addSpring:function(e){return e instanceof z.Physics.P2.Spring||e instanceof z.Physics.P2.RotationalSpring?this.world.addSpring(e.data):this.world.addSpring(e),this.onSpringAdded.dispatch(e),e},removeSpring:function(e){return e instanceof z.Physics.P2.Spring||e instanceof z.Physics.P2.RotationalSpring?this.world.removeSpring(e.data):this.world.removeSpring(e),this.onSpringRemoved.dispatch(e),e},createDistanceConstraint:function(a,t,e,i,n,o){return(a=this.getBody(a),t=this.getBody(t),a&&t)?this.addConstraint(new z.Physics.P2.DistanceConstraint(this,a,t,e,i,n,o)):void console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(a,t,e,r){return(a=this.getBody(a),t=this.getBody(t),a&&t)?this.addConstraint(new z.Physics.P2.GearConstraint(this,a,t,e,r)):void console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(a,t,e,i,n,o){return(a=this.getBody(a),e=this.getBody(e),a&&e)?this.addConstraint(new z.Physics.P2.RevoluteConstraint(this,a,t,e,i,n,o)):void console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(a,t,e,r,n){return(a=this.getBody(a),t=this.getBody(t),a&&t)?this.addConstraint(new z.Physics.P2.LockConstraint(this,a,t,e,r,n)):void console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(i,t,e,s,n,o,r){return(i=this.getBody(i),t=this.getBody(t),i&&t)?this.addConstraint(new z.Physics.P2.PrismaticConstraint(this,i,t,e,s,n,o,r)):void console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(e){return this.world.addConstraint(e),this.onConstraintAdded.dispatch(e),e},removeConstraint:function(e){return this.world.removeConstraint(e),this.onConstraintRemoved.dispatch(e),e},addContactMaterial:function(e){return this.world.addContactMaterial(e),this.onContactMaterialAdded.dispatch(e),e},removeContactMaterial:function(e){return this.world.removeContactMaterial(e),this.onContactMaterialRemoved.dispatch(e),e},getContactMaterial:function(a,t){return this.world.getContactMaterial(a,t)},setMaterial:function(a,t){for(var e=t.length;e--;)t[e].setMaterial(a)},createMaterial:function(a,t){a=a||"";var e=new z.Physics.P2.Material(a);return this.materials.push(e),void 0!==t&&t.setMaterial(e),e},createContactMaterial:function(a,t,e){void 0===a&&(a=this.createMaterial()),void 0===t&&(t=this.createMaterial());var r=new z.Physics.P2.ContactMaterial(a,t,e);return this.addContactMaterial(r)},getBodies:function(){for(var a=[],t=this.world.bodies.length;t--;)a.push(this.world.bodies[t].parent);return a},getBody:function(e){return e instanceof p2.Body?e:e instanceof z.Physics.P2.Body?e.data:e.body&&e.body.type===z.Physics.P2JS?e.body.data:null},getSprings:function(){for(var a=[],t=this.world.springs.length;t--;)a.push(this.world.springs[t].parent);return a},getConstraints:function(){for(var a=[],t=this.world.constraints.length;t--;)a.push(this.world.constraints[t]);return a},hitTest:function(i,t,e,s){void 0===t&&(t=this.world.bodies),void 0===e&&(e=5),void 0===s&&(s=!1);for(var d=[this.pxmi(i.x),this.pxmi(i.y)],o=[],r=t.length;r--;)t[r]instanceof z.Physics.P2.Body&&(!s||t[r].data.type!==p2.Body.STATIC)?o.push(t[r].data):t[r]instanceof p2.Body&&t[r].parent&&(!s||t[r].type!==p2.Body.STATIC)?o.push(t[r]):t[r]instanceof z.Sprite&&t[r].hasOwnProperty("body")&&(!s||t[r].body.data.type!==p2.Body.STATIC)&&o.push(t[r].body.data);return this.world.hitTest(d,o,e)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(a){var t=l(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask|=t),this.walls.right&&(this.walls.right.shapes[0].collisionMask|=t),this.walls.top&&(this.walls.top.shapes[0].collisionMask|=t),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask|=t),this._collisionGroupID++;var e=new z.Physics.P2.CollisionGroup(t);return this.collisionGroups.push(e),a&&this.setCollisionGroup(a,e),e},setCollisionGroup:function(a,t){if(a instanceof z.Group)for(var e=0;e<a.total;e++)a.children[e].body&&a.children[e].body.type===z.Physics.P2JS&&a.children[e].body.setCollisionGroup(t);else a.body.setCollisionGroup(t)},createSpring:function(i,t,e,s,n,o,r,a,d){return(i=this.getBody(i),t=this.getBody(t),i&&t)?this.addSpring(new z.Physics.P2.Spring(this,i,t,e,s,n,o,r,a,d)):void console.warn("Cannot create Spring, invalid body objects given")},createRotationalSpring:function(a,t,e,r,n){return(a=this.getBody(a),t=this.getBody(t),a&&t)?this.addSpring(new z.Physics.P2.RotationalSpring(this,a,t,e,r,n)):void console.warn("Cannot create Rotational Spring, invalid body objects given")},createBody:function(i,t,e,s,n,o){void 0===s&&(s=!1);var d=new z.Physics.P2.Body(this.game,null,i,t,e);return(!o||d.addPolygon(n,o))&&(s&&this.world.addBody(d.data),d)},createParticle:function(i,t,e,s,n,o){void 0===s&&(s=!1);var d=new z.Physics.P2.Body(this.game,null,i,t,e);return(!o||d.addPolygon(n,o))&&(s&&this.world.addBody(d.data),d)},convertCollisionObjects:function(d,t,e){void 0===e&&(e=!0);for(var i=[],s=0,n=d.collision[t].length;s<n;s++){var o=d.collision[t][s],r=o.polyline||o.polygon;if(r)var a=this.createBody(o.x,o.y,0,e,{},r);else o.rectangle&&(a=this.createBody(o.x,o.y,0,e)).addRectangle(o.width,o.height,o.width/2,o.height/2);a&&i.push(a)}return i},clearTilemapLayerBodies:function(a,t){t=a.getLayer(t);for(var e=a.layers[t].bodies.length;e--;)a.layers[t].bodies[e].destroy();a.layers[t].bodies.length=0},convertTilemap:function(m,t,e,i){t=m.getLayer(t),void 0===e&&(e=!0),void 0===i&&(i=!0),this.clearTilemapLayerBodies(m,t);for(var s=0,n=0,o=0,r=0,a=m.layers[t].height;r<a;r++){s=0;for(var g=0,l=m.layers[t].width,c;g<l;g++)if(c=m.layers[t].data[r][g],c&&-1<c.index&&c.collides)if(i){var u=m.getTileRight(t,g,r);0===s&&(n=c.x*c.width,o=c.y*c.height,s=c.width),u&&u.collides?s+=c.width:((d=this.createBody(n,o,0,!1)).addRectangle(s,c.height,s/2,c.height/2,0),e&&this.addBody(d),m.layers[t].bodies.push(d),s=0)}else{var d=this.createBody(c.x*c.width,c.y*c.height,0,!1);d.addRectangle(c.width,c.height,c.width/2,c.height/2,0),e&&this.addBody(d),m.layers[t].bodies.push(d)}}return m.layers[t].bodies},mpx:function(e){return e*=20},pxm:function(e){return .05*e},mpxi:function(e){return e*=-20},pxmi:function(e){return-.05*e}},Object.defineProperty(z.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(e){this.world.defaultContactMaterial.friction=e}}),Object.defineProperty(z.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(e){this.world.defaultContactMaterial.restitution=e}}),Object.defineProperty(z.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(e){this.world.defaultContactMaterial=e}}),Object.defineProperty(z.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(e){this.world.applySpringForces=e}}),Object.defineProperty(z.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(e){this.world.applyDamping=e}}),Object.defineProperty(z.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(e){this.world.applyGravity=e}}),Object.defineProperty(z.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(e){this.world.solveConstraints=e}}),Object.defineProperty(z.Physics.P2.prototype,"time",{get:function(){return this.world.time}}),Object.defineProperty(z.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(e){this.world.emitImpactEvent=e}}),Object.defineProperty(z.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(e){this.world.sleepMode=e}}),Object.defineProperty(z.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}}),z.Physics.P2.FixtureList=function(e){Array.isArray(e)||(e=[e]),this.rawList=e,this.init(),this.parse(this.rawList)},z.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={},this.groupedFixtures=[],this.allFixtures=[]},setCategory:function(a,t){this.getFixtures(t).forEach(function(t){t.collisionGroup=a})},setMask:function(a,t){this.getFixtures(t).forEach(function(t){t.collisionMask=a})},setSensor:function(a,t){this.getFixtures(t).forEach(function(t){t.sensor=a})},setMaterial:function(a,t){this.getFixtures(t).forEach(function(t){t.material=a})},getFixtures:function(a){var r=[];if(a){a instanceof Array||(a=[a]);var e=this;return a.forEach(function(a){e.namedFixtures[a]&&r.push(e.namedFixtures[a])}),this.flatten(r)}return this.allFixtures},getFixtureByKey:function(e){return this.namedFixtures[e]},getGroup:function(e){return this.groupedFixtures[e]},parse:function(){var a,t,e,r;for(a in e=this.rawList,r=[],e)t=e[a],isNaN(a-0)?this.namedFixtures[a]=this.flatten(t):(this.groupedFixtures[a]=this.groupedFixtures[a]||[],this.groupedFixtures[a]=this.groupedFixtures[a].concat(t)),r.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(a){var r,e;return r=[],e=arguments.callee,a.forEach(function(a){return Array.prototype.push.apply(r,Array.isArray(a)?e(a):[a])}),r}},z.Physics.P2.PointProxy=function(a,t){this.world=a,this.destination=t},z.Physics.P2.PointProxy.prototype.constructor=z.Physics.P2.PointProxy,Object.defineProperty(z.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(e){this.destination[0]=this.world.pxm(e)}}),Object.defineProperty(z.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(e){this.destination[1]=this.world.pxm(e)}}),Object.defineProperty(z.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(e){this.destination[0]=e}}),Object.defineProperty(z.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(e){this.destination[1]=e}}),z.Physics.P2.InversePointProxy=function(a,t){this.world=a,this.destination=t},z.Physics.P2.InversePointProxy.prototype.constructor=z.Physics.P2.InversePointProxy,Object.defineProperty(z.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(e){this.destination[0]=this.world.pxmi(e)}}),Object.defineProperty(z.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(e){this.destination[1]=this.world.pxmi(e)}}),Object.defineProperty(z.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(e){this.destination[0]=-e}}),Object.defineProperty(z.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(e){this.destination[1]=-e}}),z.Physics.P2.Body=function(a,t,e,r,n){t=t||null,e=e||0,r=r||0,void 0===n&&(n=1),this.game=a,this.world=a.physics.p2,this.sprite=t,this.type=z.Physics.P2JS,this.offset=new z.Point,this.data=new p2.Body({position:[this.world.pxmi(e),this.world.pxmi(r)],mass:n}),this.data.parent=this,this.velocity=new z.Physics.P2.InversePointProxy(this.world,this.data.velocity),this.force=new z.Physics.P2.InversePointProxy(this.world,this.data.force),this.gravity=new z.Point,this.onBeginContact=new z.Signal,this.onEndContact=new z.Signal,this.collidesWith=[],this.removeNextStep=!1,this.debugBody=null,this.dirty=!1,this._collideWorldBounds=!0,this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this._reset=!1,t&&(this.setRectangleFromSprite(t),t.exists&&this.game.physics.p2.addBody(this))},z.Physics.P2.Body.prototype={createBodyCallback:function(a,t,e){var r=-1;a.id?r=a.id:a.body&&(r=a.body.id),-1<r&&(null===t?(delete this._bodyCallbacks[r],delete this._bodyCallbackContext[r]):(this._bodyCallbacks[r]=t,this._bodyCallbackContext[r]=e))},createGroupCallback:function(a,t,e){null===t?(delete this._groupCallbacks[a.mask],delete this._groupCallbackContext[a.mask]):(this._groupCallbacks[a.mask]=t,this._groupCallbackContext[a.mask]=e)},getCollisionMask:function(){var a=0;this._collideWorldBounds&&(a=this.game.physics.p2.boundsCollisionGroup.mask);for(var t=0;t<this.collidesWith.length;t++)a|=this.collidesWith[t].mask;return a},updateCollisionMask:function(a){var t=this.getCollisionMask();if(void 0===a)for(var e=this.data.shapes.length-1;0<=e;e--)this.data.shapes[e].collisionMask=t;else a.collisionMask=t},setCollisionGroup:function(a,t){var e=this.getCollisionMask();if(void 0===t)for(var r=this.data.shapes.length-1;0<=r;r--)this.data.shapes[r].collisionGroup=a.mask,this.data.shapes[r].collisionMask=e;else t.collisionGroup=a.mask,t.collisionMask=e},clearCollision:function(a,t,e){if(void 0===a&&(a=!0),void 0===t&&(t=!0),void 0===e)for(var r=this.data.shapes.length-1;0<=r;r--)a&&(this.data.shapes[r].collisionGroup=null),t&&(this.data.shapes[r].collisionMask=null);else a&&(e.collisionGroup=null),t&&(e.collisionMask=null);a&&(this.collidesWith.length=0)},removeCollisionGroup:function(a,t,e){void 0===t&&(t=!0);var r;if(Array.isArray(a))for(n=0;n<a.length;n++)-1<(r=this.collidesWith.indexOf(a[n]))&&(this.collidesWith.splice(r,1),t&&(delete this._groupCallbacks[a.mask],delete this._groupCallbackContext[a.mask]));else-1<(r=this.collidesWith.indexOf(a))&&(this.collidesWith.splice(r,1),t&&(delete this._groupCallbacks[a.mask],delete this._groupCallbackContext[a.mask]));var i=this.getCollisionMask();if(void 0===e)for(var n=this.data.shapes.length-1;0<=n;n--)this.data.shapes[n].collisionMask=i;else e.collisionMask=i},collides:function(a,t,e,r){if(Array.isArray(a))for(n=0;n<a.length;n++)-1===this.collidesWith.indexOf(a[n])&&(this.collidesWith.push(a[n]),t&&this.createGroupCallback(a[n],t,e));else-1===this.collidesWith.indexOf(a)&&(this.collidesWith.push(a),t&&this.createGroupCallback(a,t,e));var i=this.getCollisionMask();if(void 0===r)for(var n=this.data.shapes.length-1;0<=n;n--)this.data.shapes[n].collisionMask=i;else r.collisionMask=i},adjustCenterOfMass:function(){this.data.adjustCenterOfMass(),this.shapeChanged()},getVelocityAtPoint:function(a,t){return this.data.getVelocityAtPoint(a,t)},applyDamping:function(e){this.data.applyDamping(e)},applyImpulse:function(a,t,e){this.data.applyImpulse(a,[this.world.pxmi(t),this.world.pxmi(e)])},applyImpulseLocal:function(a,t,e){this.data.applyImpulseLocal(a,[this.world.pxmi(t),this.world.pxmi(e)])},applyForce:function(a,t,e){this.data.applyForce(a,[this.world.pxmi(t),this.world.pxmi(e)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0,this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0,this.data.angularDamping=0},toLocalFrame:function(a,t){return this.data.toLocalFrame(a,t)},toWorldFrame:function(a,t){return this.data.toWorldFrame(a,t)},rotateLeft:function(e){this.data.angularVelocity=this.world.pxm(-e)},rotateRight:function(e){this.data.angularVelocity=this.world.pxm(e)},moveForward:function(a){var r=this.world.pxmi(-a),e=this.data.angle+R/2;this.data.velocity[0]=r*S(e),this.data.velocity[1]=r*T(e)},moveBackward:function(a){var r=this.world.pxmi(-a),o=this.data.angle+R/2;this.data.velocity[0]=-r*S(o),this.data.velocity[1]=-r*T(o)},thrust:function(a){var r=this.world.pxmi(-a),e=this.data.angle+R/2;this.data.force[0]+=r*S(e),this.data.force[1]+=r*T(e)},thrustLeft:function(a){var r=this.world.pxmi(-a),e=this.data.angle;this.data.force[0]+=r*S(e),this.data.force[1]+=r*T(e)},thrustRight:function(a){var r=this.world.pxmi(-a),e=this.data.angle;this.data.force[0]-=r*S(e),this.data.force[1]-=r*T(e)},reverse:function(a){var r=this.world.pxmi(-a),e=this.data.angle+R/2;this.data.force[0]-=r*S(e),this.data.force[1]-=r*T(e)},moveLeft:function(e){this.data.velocity[0]=this.world.pxmi(-e)},moveRight:function(e){this.data.velocity[0]=this.world.pxmi(e)},moveUp:function(e){this.data.velocity[1]=this.world.pxmi(-e)},moveDown:function(e){this.data.velocity[1]=this.world.pxmi(e)},preUpdate:function(){this.dirty=!0,this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x,this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y,this.fixedRotation||(this.sprite.rotation=this.data.angle),this.debugBody&&this.debugBody.updateSpriteTransform(),this.dirty=!1},reset:function(a,t,e,r){void 0===e&&(e=!1),void 0===r&&(r=!1),this.setZeroForce(),this.setZeroVelocity(),this.setZeroRotation(),e&&this.setZeroDamping(),r&&(this.mass=1),this.x=a,this.y=t},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var e=0;e<this.game.physics.p2._toRemove.length;e++)this.game.physics.p2._toRemove[e]===this&&this.game.physics.p2._toRemove.splice(e,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld(),this.clearShapes(),this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this.debugBody&&this.debugBody.destroy(!0,!0),this.debugBody=null,this.sprite&&(this.sprite.body=null,this.sprite=null)},clearShapes:function(){for(var e=this.data.shapes.length;e--;)this.data.removeShape(this.data.shapes[e]);this.shapeChanged()},addShape:function(a,t,e,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this.data.addShape(a,[this.world.pxmi(t),this.world.pxmi(e)],r),this.shapeChanged(),a},addCircle:function(a,t,e,r){var o=new p2.Circle({radius:this.world.pxm(a)});return this.addShape(o,t,e,r)},addRectangle:function(a,t,e,r,i){var n=new p2.Box({width:this.world.pxm(a),height:this.world.pxm(t)});return this.addShape(n,e,r,i)},addPlane:function(a,t,e){var r=new p2.Plane;return this.addShape(r,a,t,e)},addParticle:function(a,t,e){var r=new p2.Particle;return this.addShape(r,a,t,e)},addLine:function(a,t,e,r){var o=new p2.Line({length:this.world.pxm(a)});return this.addShape(o,t,e,r)},addCapsule:function(a,t,e,r,i){var n=new p2.Capsule({length:this.world.pxm(a),radius:this.world.pxm(t)});return this.addShape(n,e,r,i)},addPolygon:function(d,t){d=d||{},Array.isArray(t)||(t=Array.prototype.slice.call(arguments,1));var e=[];if(1===t.length&&Array.isArray(t[0]))e=t[0].slice(0);else if(Array.isArray(t[0]))e=t.slice();else if("number"==typeof t[0])for(var i=0,s=t.length;i<s;i+=2)e.push([t[i],t[i+1]]);var n=e.length-1;e[n][0]===e[0][0]&&e[n][1]===e[0][1]&&e.pop();for(var o=0;o<e.length;o++)e[o][0]=this.world.pxmi(e[o][0]),e[o][1]=this.world.pxmi(e[o][1]);var r=this.data.fromPolygon(e,d);return this.shapeChanged(),r},removeShape:function(a){var t=this.data.removeShape(a);return this.shapeChanged(),t},setCircle:function(a,t,e,r){return this.clearShapes(),this.addCircle(a,t,e,r)},setRectangle:function(a,t,e,r,o){return void 0===a&&(a=16),void 0===t&&(t=16),this.clearShapes(),this.addRectangle(a,t,e,r,o)},setRectangleFromSprite:function(e){return void 0===e&&(e=this.sprite),this.clearShapes(),this.addRectangle(e.width,e.height,0,0,e.rotation)},setMaterial:function(a,t){if(void 0===t)for(var e=this.data.shapes.length-1;0<=e;e--)this.data.shapes[e].material=a;else t.material=a},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(a,t){for(var e=this.game.cache.getPhysicsData(a,t),i=[],s=0;s<e.length;s++){var n=e[s],o=this.addFixture(n);i[n.filter.group]=i[n.filter.group]||[],i[n.filter.group]=i[n.filter.group].concat(o),n.fixtureKey&&(i[n.fixtureKey]=o)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),i},addFixture:function(d){var t=[];if(d.circle){(m=new p2.Circle({radius:this.world.pxm(d.circle.radius)})).collisionGroup=d.filter.categoryBits,m.collisionMask=d.filter.maskBits,m.sensor=d.isSensor;var e=p2.vec2.create();e[0]=this.world.pxmi(d.circle.position[0]-this.sprite.width/2),e[1]=this.world.pxmi(d.circle.position[1]-this.sprite.height/2),this.data.addShape(m,e),t.push(m)}else for(var i=d.polygons,s=p2.vec2.create(),n=0;n<i.length;n++){for(var o=i[n],r=[],p=0;p<o.length;p+=2)r.push([this.world.pxmi(o[p]),this.world.pxmi(o[p+1])]);for(var m=new p2.Convex({vertices:r}),l=0,c;l!==m.vertices.length;l++)c=m.vertices[l],p2.vec2.sub(c,c,m.centerOfMass);p2.vec2.scale(s,m.centerOfMass,1),s[0]-=this.world.pxmi(this.sprite.width/2),s[1]-=this.world.pxmi(this.sprite.height/2),m.updateTriangles(),m.updateCenterOfMass(),m.updateBoundingRadius(),m.collisionGroup=d.filter.categoryBits,m.collisionMask=d.filter.maskBits,m.sensor=d.isSensor,this.data.addShape(m,s),t.push(m)}return t},loadPolygon:function(d,t,e){if(null===d)p=t;else var p=this.game.cache.getPhysicsData(d,t);"number"!=typeof e&&(e=1);for(var s=p2.vec2.create(),n=0;n<p.length;n++){for(var o=[],u=0;u<p[n].shape.length;u+=2)o.push([this.world.pxmi(p[n].shape[u]*e),this.world.pxmi(p[n].shape[u+1]*e)]);for(var a=new p2.Convex({vertices:o}),m=0,l;m!==a.vertices.length;m++)l=a.vertices[m],p2.vec2.sub(l,l,a.centerOfMass);p2.vec2.scale(s,a.centerOfMass,1),s[0]-=this.world.pxmi(this.sprite.width/2),s[1]-=this.world.pxmi(this.sprite.height/2),a.updateTriangles(),a.updateCenterOfMass(),a.updateBoundingRadius(),this.data.addShape(a,s)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}},z.Physics.P2.Body.prototype.constructor=z.Physics.P2.Body,z.Physics.P2.Body.DYNAMIC=1,z.Physics.P2.Body.STATIC=2,z.Physics.P2.Body.KINEMATIC=4,Object.defineProperty(z.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===z.Physics.P2.Body.STATIC},set:function(e){e&&this.data.type!==z.Physics.P2.Body.STATIC?(this.data.type=z.Physics.P2.Body.STATIC,this.mass=0):e||this.data.type!==z.Physics.P2.Body.STATIC||(this.data.type=z.Physics.P2.Body.DYNAMIC,this.mass=1)}}),Object.defineProperty(z.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===z.Physics.P2.Body.DYNAMIC},set:function(e){e&&this.data.type!==z.Physics.P2.Body.DYNAMIC?(this.data.type=z.Physics.P2.Body.DYNAMIC,this.mass=1):e||this.data.type!==z.Physics.P2.Body.DYNAMIC||(this.data.type=z.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(z.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===z.Physics.P2.Body.KINEMATIC},set:function(e){e&&this.data.type!==z.Physics.P2.Body.KINEMATIC?(this.data.type=z.Physics.P2.Body.KINEMATIC,this.mass=4):e||this.data.type!==z.Physics.P2.Body.KINEMATIC||(this.data.type=z.Physics.P2.Body.STATIC,this.mass=0)}}),Object.defineProperty(z.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(e){e!==this.data.allowSleep&&(this.data.allowSleep=e)}}),Object.defineProperty(z.Physics.P2.Body.prototype,"angle",{get:function(){return z.Math.wrapAngle(z.Math.radToDeg(this.data.angle))},set:function(e){this.data.angle=z.Math.degToRad(z.Math.wrapAngle(e))}}),Object.defineProperty(z.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(e){this.data.angularDamping=e}}),Object.defineProperty(z.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(e){this.data.angularForce=e}}),Object.defineProperty(z.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(e){this.data.angularVelocity=e}}),Object.defineProperty(z.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(e){this.data.damping=e}}),Object.defineProperty(z.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(e){e!==this.data.fixedRotation&&(this.data.fixedRotation=e)}}),Object.defineProperty(z.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(e){this.data.inertia=e}}),Object.defineProperty(z.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(e){e!==this.data.mass&&(this.data.mass=e,this.data.updateMassProperties())}}),Object.defineProperty(z.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(e){e!==this.data.type&&(this.data.type=e)}}),Object.defineProperty(z.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(e){this.data.angle=e}}),Object.defineProperty(z.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(e){this.data.sleepSpeedLimit=e}}),Object.defineProperty(z.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(e){this.data.position[0]=this.world.pxmi(e)}}),Object.defineProperty(z.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(e){this.data.position[1]=this.world.pxmi(e)}}),Object.defineProperty(z.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}}),Object.defineProperty(z.Physics.P2.Body.prototype,"debug",{get:function(){return null!==this.debugBody},set:function(e){e&&!this.debugBody?this.debugBody=new z.Physics.P2.BodyDebug(this.game,this.data):!e&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}}),Object.defineProperty(z.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(e){e&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!e&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}}),z.Physics.P2.BodyDebug=function(a,t,e){z.Group.call(this,a);var r={pixelsPerLengthUnit:a.physics.p2.mpx(1),debugPolygons:!1,lineWidth:1,alpha:.5};this.settings=Object.assign(r,e),this.ppu=this.settings.pixelsPerLengthUnit,this.ppu=-1*this.ppu,this.body=t,this.canvas=new z.Graphics(a),this.canvas.alpha=this.settings.alpha,this.add(this.canvas),this.draw(),this.updateSpriteTransform()},z.Physics.P2.BodyDebug.prototype=Object.create(z.Group.prototype),z.Physics.P2.BodyDebug.prototype.constructor=z.Physics.P2.BodyDebug,Object.assign(z.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu,this.position.y=this.body.position[1]*this.ppu,this.rotation=this.body.angle},draw:function(){var m,t,e,i,s,n,o,r,a,g,l,c,u,d;if(o=this.body,(a=this.canvas).clear(),e=parseInt(this.randomPastelHex(),16),16711680,n=this.lineWidth,o instanceof p2.Body&&o.shapes.length){var p=o.shapes.length;for(i=0;i!==p;){if(t=o.shapes[i],r=t.position||0,m=t.angle||0,t instanceof p2.Circle)this.drawCircle(a,r[0]*this.ppu,r[1]*this.ppu,m,t.radius*this.ppu,e,n);else if(t instanceof p2.Capsule)this.drawCapsule(a,r[0]*this.ppu,r[1]*this.ppu,m,t.length*this.ppu,t.radius*this.ppu,16711680,e,n);else if(t instanceof p2.Plane)this.drawPlane(a,r[0]*this.ppu,-r[1]*this.ppu,e,16711680,5*n,10*n,10*n,100*this.ppu,m);else if(t instanceof p2.Line)this.drawLine(a,t.length*this.ppu,16711680,n);else if(t instanceof p2.Box)this.drawRectangle(a,r[0]*this.ppu,r[1]*this.ppu,m,t.width*this.ppu,t.height*this.ppu,16711680,e,n);else if(t instanceof p2.Convex){for(l=[],c=p2.vec2.create(),s=u=0,d=t.vertices.length;0<=d?u<d:u>d;s=0<=d?++u:--u)g=t.vertices[s],p2.vec2.rotate(c,g,m),l.push([(c[0]+r[0])*this.ppu,-(c[1]+r[1])*this.ppu]);this.drawConvex(a,l,t.triangles,16711680,e,n,this.settings.debugPolygons,[r[0]*this.ppu,-r[1]*this.ppu])}i++}}},drawRectangle:function(d,t,e,i,s,n,o,r,a){void 0===a&&(a=1),void 0===o&&(o=0),d.lineStyle(a,o,1),d.beginFill(r),d.drawRect(t-s/2,e-n/2,s,n)},drawCircle:function(a,t,e,i,d,l,o){void 0===o&&(o=1),void 0===l&&(l=16777215),a.lineStyle(o,0,1),a.beginFill(l,1),a.drawCircle(t,e,2*-d),a.endFill(),a.moveTo(t,e),a.lineTo(t+d*S(-i),e+d*T(-i))},drawLine:function(a,t,r,o){void 0===o&&(o=1),void 0===r&&(r=0),a.lineStyle(5*o,r,1),a.moveTo(-t/2,0),a.lineTo(t/2,0)},drawConvex:function(x,t,e,i,s,n,o,r){var a,h,l,c,u,d,p,f,g,_,b;if(void 0===n&&(n=1),void 0===i&&(i=0),o){for(a=[16711680,65280,255],h=0;h!==t.length+1;)c=t[h%t.length],u=t[(h+1)%t.length],p=c[0],_=c[1],f=u[0],b=u[1],x.lineStyle(n,a[h%a.length],1),x.moveTo(p,-_),x.lineTo(f,-b),x.drawCircle(p,-_,2*n),h++;return x.lineStyle(n,0,1),x.drawCircle(r[0],r[1],2*n)}for(x.lineStyle(n,i,1),x.beginFill(s),h=0;h!==t.length;)d=(l=t[h])[0],g=l[1],0===h?x.moveTo(d,-g):x.lineTo(d,-g),h++;if(x.endFill(),2<t.length)return x.moveTo(t[t.length-1][0],-t[t.length-1][1]),x.lineTo(t[0][0],-t[0][1])},drawPath:function(m,t,e,i,y){var n,o,r,a,h,l,c,u,d,p,f;for(void 0===y&&(y=1),void 0===e&&(e=0),m.lineStyle(y,e,1),"number"==typeof i&&m.beginFill(i),o=null,r=null,n=0;n<t.length;)p=(d=t[n])[0],f=d[1],p===o&&f===r||(0===n?m.moveTo(p,f):(a=o,h=r,l=p,c=f,u=t[(n+1)%t.length][0],0!=(l-a)*(t[(n+1)%t.length][1]-h)-(u-a)*(c-h)&&m.lineTo(p,f)),o=p,r=f),n++;"number"==typeof i&&m.endFill(),2<t.length&&"number"==typeof i&&(m.moveTo(t[t.length-1][0],t[t.length-1][1]),m.lineTo(t[0][0],t[0][1]))},drawPlane:function(d,t,e,p,s,n,o,r,a,m){var l,c;void 0===n&&(n=1),void 0===p&&(p=16777215),d.lineStyle(n,s,11),d.beginFill(p),d.moveTo(t,-e),l=t+S(m)*this.game.width,c=e+T(m)*this.game.height,d.lineTo(l,-c),d.moveTo(t,-e),l=t+S(m)*-this.game.width,c=e+T(m)*-this.game.height,d.lineTo(l,-c)},drawCapsule:function(d,t,e,i,s,p,u,r,a){void 0===a&&(a=1),void 0===u&&(u=0),d.lineStyle(a,u,1);var m=S(i),l=T(i);d.beginFill(r,1),d.drawCircle(-s/2*m+t,-s/2*l+e,2*-p),d.drawCircle(s/2*m+t,s/2*l+e,2*-p),d.endFill(),d.lineStyle(a,u,0),d.beginFill(r,1),d.moveTo(-s/2*m+p*l+t,-s/2*l+p*m+e),d.lineTo(s/2*m+p*l+t,s/2*l+p*m+e),d.lineTo(s/2*m-p*l+t,s/2*l-p*m+e),d.lineTo(-s/2*m-p*l+t,-s/2*l-p*m+e),d.endFill(),d.lineStyle(a,u,1),d.moveTo(-s/2*m+p*l+t,-s/2*l+p*m+e),d.lineTo(s/2*m+p*l+t,s/2*l+p*m+e),d.moveTo(-s/2*m-p*l+t,-s/2*l-p*m+e),d.lineTo(s/2*m-p*l+t,s/2*l-p*m+e)},randomPastelHex:function(){var a,t,e,r;return e=[255,255,255],r=x(256*Math.random()),t=x(256*Math.random()),a=x(256*Math.random()),r=x((r+3*e[0])/4),t=x((t+3*e[1])/4),a=x((a+3*e[2])/4),this.rgbToHex(r,t,a)},rgbToHex:function(a,t,e){return this.componentToHex(a)+this.componentToHex(t)+this.componentToHex(e)},componentToHex:function(a){var t;return 2===(t=a.toString(16)).length?t:t+"0"}}),z.Physics.P2.Spring=function(d,t,e,i,s,p,u,r,a,m){this.game=d.game,this.world=d,void 0===i&&(i=1),void 0===s&&(s=100),void 0===p&&(p=1);var l={restLength:i=d.pxm(i),stiffness:s,damping:p};void 0!==u&&null!==u&&(l.worldAnchorA=[d.pxm(u[0]),d.pxm(u[1])]),void 0!==r&&null!==r&&(l.worldAnchorB=[d.pxm(r[0]),d.pxm(r[1])]),void 0!==a&&null!==a&&(l.localAnchorA=[d.pxm(a[0]),d.pxm(a[1])]),void 0!==m&&null!==m&&(l.localAnchorB=[d.pxm(m[0]),d.pxm(m[1])]),this.data=new p2.LinearSpring(t,e,l),this.data.parent=this},z.Physics.P2.Spring.prototype.constructor=z.Physics.P2.Spring,z.Physics.P2.RotationalSpring=function(a,t,e,i,d,l){this.game=a.game,this.world=a,void 0===i&&(i=null),void 0===d&&(d=100),void 0===l&&(l=1),i&&(i=a.pxm(i));var p={restAngle:i,stiffness:d,damping:l};this.data=new p2.RotationalSpring(t,e,p),this.data.parent=this},z.Physics.P2.Spring.prototype.constructor=z.Physics.P2.Spring,z.Physics.P2.Material=function(e){this.name=e,p2.Material.call(this)},z.Physics.P2.Material.prototype=Object.create(p2.Material.prototype),z.Physics.P2.Material.prototype.constructor=z.Physics.P2.Material,z.Physics.P2.ContactMaterial=function(a,t,e){p2.ContactMaterial.call(this,a,t,e)},z.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype),z.Physics.P2.ContactMaterial.prototype.constructor=z.Physics.P2.ContactMaterial,z.Physics.P2.CollisionGroup=function(e){this.mask=e},z.Physics.P2.DistanceConstraint=function(l,t,e,i,s,n,o){void 0===i&&(i=100),void 0===s&&(s=[0,0]),void 0===n&&(n=[0,0]),void 0===o&&(o=d),this.game=l.game,this.world=l;var p={distance:i=l.pxm(i),localAnchorA:s=[l.pxmi(s[0]),l.pxmi(s[1])],localAnchorB:n=[l.pxmi(n[0]),l.pxmi(n[1])],maxForce:o};p2.DistanceConstraint.call(this,t,e,p)},z.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype),z.Physics.P2.DistanceConstraint.prototype.constructor=z.Physics.P2.DistanceConstraint,z.Physics.P2.GearConstraint=function(a,t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=1),this.game=a.game,this.world=a;var d={angle:r,ratio:i};p2.GearConstraint.call(this,t,e,d)},z.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype),z.Physics.P2.GearConstraint.prototype.constructor=z.Physics.P2.GearConstraint,z.Physics.P2.LockConstraint=function(a,t,e,i,s,l){void 0===i&&(i=[0,0]),void 0===s&&(s=0),void 0===l&&(l=d),this.game=a.game,this.world=a;var p={localOffsetB:i=[a.pxm(i[0]),a.pxm(i[1])],localAngleB:s,maxForce:l};p2.LockConstraint.call(this,t,e,p)},z.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype),z.Physics.P2.LockConstraint.prototype.constructor=z.Physics.P2.LockConstraint,z.Physics.P2.PrismaticConstraint=function(l,t,e,i,p,n,o,c){void 0===i&&(i=!0),void 0===p&&(p=[0,0]),void 0===n&&(n=[0,0]),void 0===o&&(o=[0,0]),void 0===c&&(c=d),this.game=l.game,this.world=l;var u={localAnchorA:p=[l.pxmi(p[0]),l.pxmi(p[1])],localAnchorB:n=[l.pxmi(n[0]),l.pxmi(n[1])],localAxisA:o,maxForce:c,disableRotationalLock:!i};p2.PrismaticConstraint.call(this,t,e,u)},z.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype),z.Physics.P2.PrismaticConstraint.prototype.constructor=z.Physics.P2.PrismaticConstraint,z.Physics.P2.RevoluteConstraint=function(l,t,e,p,s,c,u){void 0===c&&(c=d),void 0===u&&(u=null),this.game=l.game,this.world=l,e=[l.pxmi(e[0]),l.pxmi(e[1])],s=[l.pxmi(s[0]),l.pxmi(s[1])],u&&(u=[l.pxmi(u[0]),l.pxmi(u[1])]);var m={worldPivot:u,localPivotA:e,localPivotB:s,maxForce:c};p2.RevoluteConstraint.call(this,t,p,m)},z.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype),z.Physics.P2.RevoluteConstraint.prototype.constructor=z.Physics.P2.RevoluteConstraint,z.ImageCollection=function(a,t,e,i,s,n,o){(void 0===e||0>=e)&&(e=32),(void 0===i||0>=i)&&(i=32),void 0===s&&(s=0),void 0===n&&(n=0),this.name=a,this.firstgid=0|t,this.imageWidth=0|e,this.imageHeight=0|i,this.imageMargin=0|s,this.imageSpacing=0|n,this.properties=o||{},this.images=[],this.total=0},z.ImageCollection.prototype={containsImageIndex:function(e){return e>=this.firstgid&&e<this.firstgid+this.total},addImage:function(a,r){this.images.push({gid:a,image:r}),this.total++}},z.ImageCollection.prototype.constructor=z.ImageCollection,z.Tile=function(a,t,e,r,i,n){this.layer=a,this.index=t,this.x=e,this.y=r,this.rotation=0,this.flipped=!1,this.worldX=e*i,this.worldY=r*n,this.width=i,this.height=n,this.centerX=E(i/2),this.centerY=E(n/2),this.alpha=1,this.properties={},this.scanned=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.collisionCallback=null,this.collisionCallbackContext=this,this.debug=!1},z.Tile.prototype={containsPoint:function(a,t){return!(a<this.worldX||t<this.worldY||a>this.right||t>this.bottom)},intersects:function(a,t,e,r){return!(e<=this.worldX)&&!(r<=this.worldY)&&!(a>=this.worldX+this.width)&&!(t>=this.worldY+this.height)},setCollisionCallback:function(a,t){this.collisionCallback=a,this.collisionCallbackContext=t},destroy:function(){this.collisionCallback=null,this.collisionCallbackContext=null,this.properties=null},setCollision:function(a,t,e,r){this.collideLeft=a,this.collideRight=t,this.collideUp=e,this.collideDown=r,this.faceLeft=a,this.faceRight=t,this.faceTop=e,this.faceBottom=r},resetCollision:function(){this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1},isInteresting:function(a,t){return a&&t?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:a?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:!!t&&(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)},copy:function(e){this.index=e.index,this.alpha=e.alpha,this.properties=e.properties,this.collideUp=e.collideUp,this.collideDown=e.collideDown,this.collideLeft=e.collideLeft,this.collideRight=e.collideRight,this.collisionCallback=e.collisionCallback,this.collisionCallbackContext=e.collisionCallbackContext}},z.Tile.prototype.constructor=z.Tile,Object.defineProperty(z.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}}),Object.defineProperty(z.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}}),Object.defineProperty(z.Tile.prototype,"left",{get:function(){return this.worldX}}),Object.defineProperty(z.Tile.prototype,"right",{get:function(){return this.worldX+this.width}}),Object.defineProperty(z.Tile.prototype,"top",{get:function(){return this.worldY}}),Object.defineProperty(z.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}}),z.Tilemap=function(i,t,e,s,n,o){this.game=i,this.key=t;var r=z.TilemapParser.parse(this.game,t,e,s,n,o);null!==r&&(this.width=r.width,this.height=r.height,this.tileWidth=r.tileWidth,this.tileHeight=r.tileHeight,this.orientation=r.orientation,this.format=r.format,this.version=r.version,this.properties=r.properties,this.widthInPixels=r.widthInPixels,this.heightInPixels=r.heightInPixels,this.layers=r.layers,this.tilesets=r.tilesets,this.imagecollections=r.imagecollections,this.tiles=r.tiles,this.objects=r.objects,this.collideIndexes=[],this.collision=r.collision,this.images=r.images,this.enableDebug=!1,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)},z.Tilemap.CSV=0,z.Tilemap.TILED_JSON=1,z.Tilemap.NORTH=0,z.Tilemap.EAST=1,z.Tilemap.SOUTH=2,z.Tilemap.WEST=3,z.Tilemap.prototype={create:function(a,t,e,r,i,n){return void 0===n&&(n=this.game.world),this.width=t,this.height=e,this.setTileSize(r,i),this.layers.length=0,this.createBlankLayer(a,t,e,r,i,n)},setTileSize:function(a,t){this.tileWidth=a,this.tileHeight=t,this.widthInPixels=this.width*a,this.heightInPixels=this.height*t},addTilesetImage:function(i,t,e,s,n,o,r){if(void 0===i)return null;void 0===e&&(e=this.tileWidth),void 0===s&&(s=this.tileHeight),void 0===n&&(n=0),void 0===o&&(o=0),void 0===r&&(r=0),0===e&&(e=32),0===s&&(s=32);var a=null;if(void 0!==t&&null!==t||(t=i),t instanceof z.BitmapData)a=t.canvas;else{if(!this.game.cache.checkImageKey(t))return console.warn("Phaser.Tilemap.addTilesetImage: Invalid image key given: \""+t+"\""),null;a=this.game.cache.getImage(t)}var h=this.getTilesetIndex(i);if(null===h&&this.format===z.Tilemap.TILED_JSON)return console.warn("Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: \""+i+"\""),console.log("Tilesets: ",this.tilesets),null;if(this.tilesets[h])return this.tilesets[h].setImage(a),this.tilesets[h];var l=new z.Tileset(i,r,e,s,n,o,{});l.setImage(a),this.tilesets.push(l);for(var c=this.tilesets.length-1,u=n,d=n,p=0,f=0,g=0,m=r;m<r+l.total&&(this.tiles[m]=[u,d,c],u+=e+o,++p!==l.total)&&(++f!==l.columns||(u=n,d+=s+o,f=0,++g!==l.rows));m++);return l},createFromObjects:function(i,t,m,s,n,o,r,a,h,l){if(void 0===n&&(n=!0),void 0===o&&(o=!1),void 0===r&&(r=this.game.world),void 0===a&&(a=z.Sprite),void 0===h&&(h=!0),void 0===l&&(l=!0),!this.objects[i])return console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+i),void console.log("Objects: ",this.objects);for(var c=0;c<this.objects[i].length;c++){var u=!1,d=this.objects[i][c];if(void 0!==d.gid&&"number"==typeof t&&d.gid===t?u=!0:void 0!==d.id&&"number"==typeof t&&d.id===t?u=!0:void 0!==d.name&&"string"==typeof t&&d.name===t&&(u=!0),u){var p=new a(this.game,parseFloat(d.x,10),parseFloat(d.y,10),m,s);for(var y in p.name=d.name,p.autoCull=o,p.exists=n,p.visible=d.visible,l&&(d.width&&(p.width=d.width),d.height&&(p.height=d.height)),d.rotation&&(p.angle=d.rotation),h&&(p.y-=p.height),r.add(p),d.properties)r.set(p,y,d.properties[y],!1,!1,0,!0)}}},createFromTiles:function(i,m,g,s,n,o){"number"==typeof i&&(i=[i]),void 0===m||null===m?m=[]:"number"==typeof m&&(m=[m]),s=this.getLayer(s),void 0===n&&(n=this.game.world),void 0===o&&(o={}),void 0===o.customClass&&(o.customClass=z.Sprite),void 0===o.adjustY&&(o.adjustY=!0);var r=this.layers[s].width,a=this.layers[s].height;if(this.copy(0,0,r,a,s),2>this._results.length)return 0;for(var h=0,c=1,u=this._results.length,d;c<u;c++)if(-1!==i.indexOf(this._results[c].index)){for(var l in d=new o.customClass(this.game,this._results[c].worldX,this._results[c].worldY,g),o)d[l]=o[l];n.add(d),h++}if(1===m.length)for(c=0;c<i.length;c++)this.replace(i[c],m[0],0,0,r,a,s);else if(1<m.length)for(c=0;c<i.length;c++)this.replace(i[c],m[c],0,0,r,a,s);return h},createLayer:function(a,i,e,s){void 0===i&&(i=this.game.width),void 0===e&&(e=this.game.height),void 0===s&&(s=this.game.world);var n=a;if("string"==typeof a&&(n=this.getLayerIndex(a)),null===n||n>this.layers.length)return console.warn("Tilemap.createLayer: Invalid layer ID given: \""+a+"\""),void console.log("Layers: ",this.layers);void 0===i||0>=i?i=A(this.game.width,this.layers[n].widthInPixels):i>this.game.width&&(i=this.game.width),void 0===e||0>=e?e=A(this.game.height,this.layers[n].heightInPixels):e>this.game.height&&(e=this.game.height),this.enableDebug&&(console.group("Tilemap.createLayer"),console.log("Name:",this.layers[n].name),console.log("Size:",i,"x",e),console.log("Tileset:",this.tilesets[0].name,"index:",n));var o=s.add(new z.TilemapLayer(this.game,this,n,i,e));return this.enableDebug&&console.groupEnd(),o},createBlankLayer:function(i,m,g,y,n,o){void 0===o&&(o=this.game.world);{if(null===this.getLayerIndex(i)){for(var r={name:i,x:0,y:0,width:m,height:g,widthInPixels:m*y,heightInPixels:g*n,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},h=[],l=0,c;l<g;l++){c=[];for(var a=0;a<m;a++)c.push(new z.Tile(r,-1,a,l,y,n));h.push(c)}r.data=h,this.layers.push(r),this.currentLayer=this.layers.length-1;var u=r.widthInPixels,d=r.heightInPixels;return u>this.game.width&&(u=this.game.width),d>this.game.height&&(d=this.game.height),(h=new z.TilemapLayer(this.game,this,this.layers.length-1,u,d)).name=i,o.add(h)}console.warn("Tilemap.createBlankLayer: Layer with matching name already exists: "+i)}},getIndex:function(a,t){for(var e=0;e<a.length;e++)if(a[e].name===t)return e;return null},getLayerIndex:function(e){return this.getIndex(this.layers,e)},getTilesetIndex:function(e){return this.getIndex(this.tilesets,e)},getImageIndex:function(e){return this.getIndex(this.images,e)},setTileIndexCallback:function(a,r,d,l){if(l=this.getLayer(l),"number"==typeof a)null===r?delete this.layers[l].callbacks[a]:this.layers[l].callbacks[a]={callback:r,callbackContext:d};else for(var s=0,n=a.length;s<n;s++)null===r?delete this.layers[l].callbacks[a[s]]:this.layers[l].callbacks[a[s]]={callback:r,callbackContext:d}},setTileLocationCallback:function(d,t,e,i,s,n,o){if(o=this.getLayer(o),this.copy(d,t,e,i,o),!(2>this._results.length))for(var r=1;r<this._results.length;r++)this._results[r].setCollisionCallback(s,n)},setCollision:function(a,r,e,o){if(void 0===r&&(r=!0),void 0===o&&(o=!0),e=this.getLayer(e),"number"==typeof a)return this.setCollisionByIndex(a,r,e,!0);if(Array.isArray(a)){for(var i=0;i<a.length;i++)this.setCollisionByIndex(a[i],r,e,!1);o&&this.calculateFaces(e)}},setCollisionBetween:function(a,t,e,r,i){if(void 0===e&&(e=!0),void 0===i&&(i=!0),r=this.getLayer(r),!(a>t)){for(var n=a;n<=t;n++)this.setCollisionByIndex(n,e,r,!1);i&&this.calculateFaces(r)}},setCollisionByExclusion:function(a,t,e,r){void 0===t&&(t=!0),void 0===r&&(r=!0),e=this.getLayer(e);for(var i=0,n=this.tiles.length;i<n;i++)-1===a.indexOf(i)&&this.setCollisionByIndex(i,t,e,!1);r&&this.calculateFaces(e)},setCollisionByIndex:function(d,t,e,i){if(void 0===t&&(t=!0),void 0===e&&(e=this.currentLayer),void 0===i&&(i=!0),t)this.collideIndexes.push(d);else{var s=this.collideIndexes.indexOf(d);-1<s&&this.collideIndexes.splice(s,1)}for(var n=0;n<this.layers[e].height;n++)for(var o=0,r;o<this.layers[e].width;o++)r=this.layers[e].data[n][o],r&&r.index===d&&(t?r.setCollision(!0,!0,!0,!0):r.resetCollision(),r.faceTop=t,r.faceBottom=t,r.faceLeft=t,r.faceRight=t);return i&&this.calculateFaces(e),e},getLayer:function(a){if(void 0===a)a=this.currentLayer;else if("string"==typeof a){var r=a;null===(a=this.getLayerIndex(a))&&console.warn("No such layer name: "+r)}else a instanceof z.TilemapLayer&&(a=a.index);return a},setPreventRecalculate:function(a){if(!0===a&&!0!==this.preventingRecalculate&&(this.preventingRecalculate=!0,this.needToRecalculate={}),!1===a&&!0===this.preventingRecalculate){for(var t in this.preventingRecalculate=!1,this.needToRecalculate)this.calculateFaces(t);this.needToRecalculate=!1}},calculateFaces:function(d){if(this.preventingRecalculate)this.needToRecalculate[d]=!0;else for(var t=null,e=null,i=null,s=null,n=0,o=this.layers[d].height;n<o;n++)for(var r=0,a=this.layers[d].width,p;r<a;r++)p=this.layers[d].data[n][r],p&&(t=this.getTileAbove(d,r,n),e=this.getTileBelow(d,r,n),i=this.getTileLeft(d,r,n),s=this.getTileRight(d,r,n),p.collides&&(p.faceTop=!0,p.faceBottom=!0,p.faceLeft=!0,p.faceRight=!0),t&&t.collides&&(p.faceTop=!1),e&&e.collides&&(p.faceBottom=!1),i&&i.collides&&(p.faceLeft=!1),s&&s.collides&&(p.faceRight=!1))},getTileAbove:function(a,t,e){return 0<e?this.layers[a].data[e-1][t]:null},getTileBelow:function(a,t,e){return e<this.layers[a].height-1?this.layers[a].data[e+1][t]:null},getTileLeft:function(a,t,e){return 0<t?this.layers[a].data[e][t-1]:null},getTileRight:function(a,t,e){return t<this.layers[a].width-1?this.layers[a].data[e][t+1]:null},setLayer:function(e){e=this.getLayer(e),this.layers[e]&&(this.currentLayer=e)},hasTile:function(a,t,e){return e=this.getLayer(e),void 0!==this.layers[e].data[t]&&void 0!==this.layers[e].data[t][a]&&-1<this.layers[e].data[t][a].index},removeTile:function(a,t,e){if(e=this.getLayer(e),0<=a&&a<this.layers[e].width&&0<=t&&t<this.layers[e].height&&this.hasTile(a,t,e)){var r=this.layers[e].data[t][a];return this.layers[e].data[t][a]=new z.Tile(this.layers[e],-1,a,t,this.tileWidth,this.tileHeight),this.layers[e].dirty=!0,this.calculateFaces(e),r}},removeTileWorldXY:function(a,t,e,r,o){return o=this.getLayer(o),a=this.game.math.snapToFloor(a,e)/e,t=this.game.math.snapToFloor(t,r)/r,this.removeTile(a,t,o)},putTile:function(a,t,e,r){if(null===a)return this.removeTile(t,e,r);if(r=this.getLayer(r),0<=t&&t<this.layers[r].width&&0<=e&&e<this.layers[r].height){var n;return a instanceof z.Tile?(n=a.index,this.hasTile(t,e,r)?this.layers[r].data[e][t].copy(a):this.layers[r].data[e][t]=new z.Tile(r,n,t,e,a.width,a.height)):(n=a,this.hasTile(t,e,r)?this.layers[r].data[e][t].index=n:this.layers[r].data[e][t]=new z.Tile(this.layers[r],n,t,e,this.tileWidth,this.tileHeight)),-1<this.collideIndexes.indexOf(n)?this.layers[r].data[e][t].setCollision(!0,!0,!0,!0):this.layers[r].data[e][t].resetCollision(),this.layers[r].dirty=!0,this.calculateFaces(r),this.layers[r].data[e][t]}return null},putTileWorldXY:function(a,t,e,r,i,n){return n=this.getLayer(n),t=this.game.math.snapToFloor(t,r)/r,e=this.game.math.snapToFloor(e,i)/i,this.putTile(a,t,e,n)},searchTileIndex:function(a,t,e,i){void 0===t&&(t=0),void 0===e&&(e=!1),i=this.getLayer(i);var s=0;if(e){for(n=this.layers[i].height-1;0<=n;n--)for(o=this.layers[i].width-1;0<=o;o--)if(this.layers[i].data[n][o].index===a){if(s===t)return this.layers[i].data[n][o];s++}}else for(var n=0;n<this.layers[i].height;n++)for(var o=0;o<this.layers[i].width;o++)if(this.layers[i].data[n][o].index===a){if(s===t)return this.layers[i].data[n][o];s++}return null},getTile:function(a,t,e,r){return void 0===r&&(r=!1),e=this.getLayer(e),0<=a&&a<this.layers[e].width&&0<=t&&t<this.layers[e].height?-1===this.layers[e].data[t][a].index?r?this.layers[e].data[t][a]:null:this.layers[e].data[t][a]:null},getTileWorldXY:function(a,t,e,r,i,n){return void 0===e&&(e=this.tileWidth),void 0===r&&(r=this.tileHeight),i=this.getLayer(i),a=this.game.math.snapToFloor(a,e)/e,t=this.game.math.snapToFloor(t,r)/r,this.getTile(a,t,i,n)},copy:function(a,d,l,p,c){c=this.getLayer(c);{if(this.layers[c]){void 0===a&&(a=0),void 0===d&&(d=0),void 0===l&&(l=this.layers[c].width),void 0===p&&(p=this.layers[c].height),0>a&&(a=0),0>d&&(d=0),l>this.layers[c].width&&(l=this.layers[c].width),p>this.layers[c].height&&(p=this.layers[c].height),this._results.length=0,this._results.push({x:a,y:d,width:l,height:p,layer:c});for(var u=d;u<d+p;u++)for(var o=a;o<a+l;o++)this._results.push(this.layers[c].data[u][o]);return this._results}this._results.length=0}},paste:function(a,t,e,i){if(void 0===a&&(a=0),void 0===t&&(t=0),i=this.getLayer(i),e&&!(2>e.length)){for(var s=a-e[1].x,n=t-e[1].y,o=1;o<e.length;o++)this.layers[i].data[n+e[o].y][s+e[o].x].copy(e[o]);this.layers[i].dirty=!0,this.calculateFaces(i)}},swap:function(a,t,e,i,s,n,o){o=this.getLayer(o),this.copy(e,i,s,n,o),2>this._results.length||(this._tempA=a,this._tempB=t,this._results.forEach(this.swapHandler,this),this.paste(e,i,this._results,o))},swapHandler:function(e){e.index===this._tempA?e.index=this._tempB:e.index===this._tempB&&(e.index=this._tempA)},forEach:function(a,t,e,i,s,n,o){o=this.getLayer(o),this.copy(e,i,s,n,o),2>this._results.length||(this._results.forEach(a,t),this.paste(e,i,this._results,o))},replace:function(d,t,e,i,s,n,o){if(o=this.getLayer(o),this.copy(e,i,s,n,o),!(2>this._results.length)){for(var r=1;r<this._results.length;r++)this._results[r].index===d&&(this._results[r].index=t);this.paste(e,i,this._results,o)}},random:function(d,t,e,i,s){if(s=this.getLayer(s),this.copy(d,t,e,i,s),!(2>this._results.length)){for(var n=[],o=1;o<this._results.length;o++)if(this._results[o].index){var r=this._results[o].index;-1===n.indexOf(r)&&n.push(r)}for(var a=1;a<this._results.length;a++)this._results[a].index=this.game.rnd.pick(n);this.paste(d,t,this._results,s)}},shuffle:function(i,t,e,s,n){if(n=this.getLayer(n),this.copy(i,t,e,s,n),!(2>this._results.length)){for(var o=[],r=1;r<this._results.length;r++)this._results[r].index&&o.push(this._results[r].index);z.ArrayUtils.shuffle(o);for(var a=1;a<this._results.length;a++)this._results[a].index=o[a-1];this.paste(i,t,this._results,n)}},fill:function(a,t,e,i,s,n){if(n=this.getLayer(n),this.copy(t,e,i,s,n),!(2>this._results.length)){for(var o=1;o<this._results.length;o++)this._results[o].index=a;this.paste(t,e,this._results,n)}},removeAllLayers:function(){this.layers.length=0,this.currentLayer=0},dump:function(){for(var a="",t=[""],e=0;e<this.layers[this.currentLayer].height;e++){for(var r=0;r<this.layers[this.currentLayer].width;r++)a+="%c  ",1<this.layers[this.currentLayer].data[e][r]?this.debugMap[this.layers[this.currentLayer].data[e][r]]?t.push("background: "+this.debugMap[this.layers[this.currentLayer].data[e][r]]):t.push("background: #ffffff"):t.push("background: rgb(0, 0, 0)");a+="\n"}t[0]=a,console.log.apply(console,t)},destroy:function(){this.removeAllLayers(),this.data=[],this.game=null}},z.Tilemap.prototype.constructor=z.Tilemap,Object.defineProperty(z.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(e){e!==this.currentLayer&&this.setLayer(e)}}),z.TilemapLayer=function(a,t,e,r,n){r|=0,n|=0,z.Sprite.call(this,a,0,0),this.map=t,this.index=e,this.layer=t.layers[e],this.canvas=z.CanvasPool.create(this,r,n),this.context=this.canvas.getContext("2d"),this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas,null,this.game.resolution))),this.type=z.TILEMAPLAYER,this.physicsType=z.TILEMAPLAYER,this.renderSettings={enableScrollDelta:!0,overdrawRatio:.2,copyCanvas:null},this.debug=!1,this.exists=!0,this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:!0,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"},this.scrollFactorX=1,this.scrollFactorY=1,this.dirty=!0,this.rayStepRate=4,this._wrap=!1,this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:t.tileWidth,tileHeight:t.tileHeight,cw:t.tileWidth,ch:t.tileHeight,tilesets:[]},this._scrollX=0,this._scrollY=0,this.tileOffset=new z.Point(this.layer.offsetX||0,this.layer.offsetY||0),this._results=[],a.device.canvasBitBltShift||(this.renderSettings.copyCanvas=z.TilemapLayer.ensureSharedCopyCanvas()),this.fixedToCamera=!0},z.TilemapLayer.prototype=Object.create(z.Sprite.prototype),z.TilemapLayer.prototype.constructor=z.TilemapLayer,z.TilemapLayer.prototype.preUpdateCore=z.Component.Core.preUpdate,z.TilemapLayer.sharedCopyCanvas=null,z.TilemapLayer.ensureSharedCopyCanvas=function(){return this.sharedCopyCanvas||(this.sharedCopyCanvas=z.CanvasPool.create(this,2,2)),this.sharedCopyCanvas},z.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()},z.TilemapLayer.prototype.postUpdate=function(){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x,this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y},z.TilemapLayer.prototype._renderCanvas=function(e){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x,this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y,this.render(),PIXI.Sprite.prototype._renderCanvas.call(this,e)},z.TilemapLayer.prototype._renderWebGL=function(e){this.fixedToCamera&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y),this._scrollX=(this.game.camera.view.x-this.tileOffset.x)*this.scrollFactorX/this.scale.x,this._scrollY=(this.game.camera.view.y-this.tileOffset.y)*this.scrollFactorY/this.scale.y,this.render(),PIXI.Sprite.prototype._renderWebGL.call(this,e)},z.TilemapLayer.prototype.destroy=function(){z.CanvasPool.remove(this),z.Component.Destroy.prototype.destroy.call(this)},z.TilemapLayer.prototype.resize=function(a,t){this.canvas.width=a,this.canvas.height=t,this.texture.frame.resize(a,t),this.texture.width=a,this.texture.height=t,this.texture.crop.width=a,this.texture.crop.height=t,this.texture.baseTexture.width=a,this.texture.baseTexture.height=t,this.texture.baseTexture.dirty(),this.texture.requiresUpdate=!0,this.texture._updateUvs(),this.dirty=!0},z.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)},z.TilemapLayer.prototype.getTileOffsetX=function(){return this.tileOffset.x||(this.fixedToCamera?0:this.position.x)},z.TilemapLayer.prototype.getTileOffsetY=function(){return this.tileOffset.y||(this.fixedToCamera?0:this.position.y)},z.TilemapLayer.prototype._fixX=function(e){return 1===this.scrollFactorX||0===this.scrollFactorX&&0===this.position.x?e:0===this.scrollFactorX&&0!==this.position.x?e-this.position.x:this._scrollX+(e-this._scrollX/this.scrollFactorX)},z.TilemapLayer.prototype._unfixX=function(e){return 1===this.scrollFactorX?e:this._scrollX/this.scrollFactorX+(e-this._scrollX)},z.TilemapLayer.prototype._fixY=function(e){return 1===this.scrollFactorY||0===this.scrollFactorY&&0===this.position.y?e:0===this.scrollFactorY&&0!==this.position.y?e-this.position.y:this._scrollY+(e-this._scrollY/this.scrollFactorY)},z.TilemapLayer.prototype._unfixY=function(e){return 1===this.scrollFactorY?e:this._scrollY/this.scrollFactorY+(e-this._scrollY)},z.TilemapLayer.prototype.getTileX=function(e){return x(this._fixX(e)/this._mc.tileWidth)},z.TilemapLayer.prototype.getTileY=function(e){return x(this._fixY(e)/this._mc.tileHeight)},z.TilemapLayer.prototype.getTileXY=function(a,t,e){return e.x=this.getTileX(a),e.y=this.getTileY(t),e},z.TilemapLayer.prototype.getRayCastTiles=function(d,t,e,i){t||(t=this.rayStepRate),void 0===e&&(e=!1),void 0===i&&(i=!1);var s=this.getTiles(d.x,d.y,d.width,d.height,e,i);if(0===s.length)return[];for(var n=d.coordinatesOnLine(t),o=[],r=0;r<s.length;r++)for(var a=0;a<n.length;a++){var p=s[r],l=n[a];if(p.containsPoint(l[0],l[1])){o.push(p);break}}return o},z.TilemapLayer.prototype.getTiles=function(m,t,e,i,s,n){void 0===s&&(s=!1),void 0===n&&(n=!1);var o=!(s||n);m=this._fixX(m),t=this._fixY(t);for(var r=x(m/(this._mc.cw*this.scale.x)),a=x(t/(this._mc.ch*this.scale.y)),g=y((m+e)/(this._mc.cw*this.scale.x))-r,l=y((t+i)/(this._mc.ch*this.scale.y))-a;this._results.length;)this._results.pop();for(var c=a;c<a+l;c++)for(var u=r,d;u<r+g;u++)d=this.layer.data[c],d&&d[u]&&(o||d[u].isInteresting(s,n))&&this._results.push(d[u]);return this._results.slice()},z.TilemapLayer.prototype.resolveTileset=function(a){var t=this._mc.tilesets;if(2e3>a)for(;t.length<a;)t.push(void 0);var e=this.map.tiles[a]&&this.map.tiles[a][2];if(null!==e){var r=this.map.tilesets[e];if(r&&r.containsTileIndex(a))return t[a]=r}return t[a]=null},z.TilemapLayer.prototype.resetTilesetCache=function(){for(var e=this._mc.tilesets;e.length;)e.pop()},z.TilemapLayer.prototype.setScale=function(a,t){a=a||1,t=t||a;for(var e=0;e<this.layer.data.length;e++)for(var r=this.layer.data[e],i=0,n;i<r.length;i++)n=r[i],n.width=this.map.tileWidth*a,n.height=this.map.tileHeight*t,n.worldX=n.x*n.width,n.worldY=n.y*n.height;this.scale.setTo(a,t)},z.TilemapLayer.prototype.shiftCanvas=function(d,t,p){var m=d.canvas,s=m.width-E(t),n=m.height-E(p),o=0,r=0,a=t,g=p;0>t&&(o=-t,a=0),0>p&&(r=-p,g=0);var l=this.renderSettings.copyCanvas;if(l){(l.width<s||l.height<n)&&(l.width=s,l.height=n);var c=l.getContext("2d");c.clearRect(0,0,s,n),c.drawImage(m,o,r,s,n,0,0,s,n),d.clearRect(a,g,s,n),d.drawImage(l,0,0,s,n,a,g,s,n)}else d.save(),d.globalCompositeOperation="copy",d.drawImage(m,o,r,s,n,a,g,s,n),d.restore()},z.TilemapLayer.prototype.renderRegion=function(S,t,e,i,s,n){var o=this.context,r=this.layer.width,a=this.layer.height,h=this._mc.tileWidth,l=this._mc.tileHeight,c=this._mc.tilesets,u=NaN;this._wrap||(e<=s&&(e=C(0,e),s=A(r-1,s)),i<=n&&(i=C(0,i),n=A(a-1,n)));var d=e*h-S,x=(e+1048576*r)%r,b,p,f,g,m,y;for(g=(i+1048576*a)%a,y=n-i,p=i*l-t;0<=y;g++,y--,p+=l){g>=a&&(g-=a);var v=this.layer.data[g];for(f=x,m=s-e,b=d;0<=m;f++,m--,b+=h){f>=r&&(f-=r);var _=v[f];if(_&&!(0>_.index)){var E=_.index,T=c[E];void 0===T&&(T=this.resolveTileset(E)),_.alpha===u||this.debug||(o.globalAlpha=_.alpha,u=_.alpha),T?_.rotation||_.flipped?(o.save(),o.translate(b+_.centerX,p+_.centerY),o.rotate(_.rotation),_.flipped&&o.scale(-1,1),T.draw(o,-_.centerX,-_.centerY,E),o.restore()):T.draw(o,b,p,E):this.debugSettings.missingImageFill&&(o.fillStyle=this.debugSettings.missingImageFill,o.fillRect(b,p,h,l)),_.debug&&this.debugSettings.debuggedTileOverfill&&(o.fillStyle=this.debugSettings.debuggedTileOverfill,o.fillRect(b,p,h,l))}}}},z.TilemapLayer.prototype.renderDeltaScroll=function(m,t){var e=this._mc.scrollX,i=this._mc.scrollY,s=this.canvas.width,n=this.canvas.height,o=this._mc.tileWidth,y=this._mc.tileHeight,v=0,h=-o,l=0,c=-y;if(0>m?(v=s+m,h=s-1):0<m&&(h=m),0>t?(l=n+t,c=n-1):0<t&&(c=t),this.shiftCanvas(this.context,m,t),v=x((v+e)/o),h=x((h+e)/o),l=x((l+i)/y),c=x((c+i)/y),v<=h){this.context.clearRect(v*o-e,0,(h-v+1)*o,n);var u=x((0+i)/y),d=x((n-1+i)/y);this.renderRegion(e,i,v,u,h,d)}if(l<=c){this.context.clearRect(0,l*y-i,s,(c-l+1)*y);var p=x((0+e)/o),f=x((s-1+e)/o);this.renderRegion(e,i,p,l,f,c)}},z.TilemapLayer.prototype.renderFull=function(){var d=this._mc.scrollX,t=this._mc.scrollY,e=this.canvas.width,i=this.canvas.height,s=this._mc.tileWidth,n=this._mc.tileHeight,o=x(d/s),r=x((e-1+d)/s),a=x(t/n),p=x((i-1+t)/n);this.context.clearRect(0,0,e,i),this.renderRegion(d,t,o,a,r,p)},z.TilemapLayer.prototype.render=function(){var d=!1;if(this.visible){(this.dirty||this.layer.dirty)&&(this.layer.dirty=!1,d=!0);var l=this.canvas.width,e=this.canvas.height,i=0|this._scrollX,s=0|this._scrollY,n=this._mc,o=n.scrollX-i,r=n.scrollY-s;if(d||0!=o||0!=r||n.renderWidth!==l||n.renderHeight!==e)return this.context.save(),n.scrollX=i,n.scrollY=s,n.renderWidth===l&&n.renderHeight===e||(n.renderWidth=l,n.renderHeight=e),this.debug&&(this.context.globalAlpha=this.debugSettings.debugAlpha,this.debugSettings.forceFullRedraw&&(d=!0)),!d&&this.renderSettings.enableScrollDelta&&E(o)+E(r)<A(l,e)?this.renderDeltaScroll(o,r):this.renderFull(),this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.texture.baseTexture.dirty(),this.dirty=!1,this.context.restore(),!0}},z.TilemapLayer.prototype.renderDebug=function(){var _=this._mc.scrollX,r=this._mc.scrollY,a=this.context,h=this.canvas.width,l=this.canvas.height,c=this.layer.width,u=this.layer.height,d=this._mc.tileWidth,p=this._mc.tileHeight,f=x(_/d),g=x((h-1+_)/d),m=x(r/p),y=x((l-1+r)/p),v,t,e,i,s,n;for(a.strokeStyle=this.debugSettings.facingEdgeStroke,i=(m+1048576*u)%u,n=y-m,t=m*p-r;0<=n;i++,n--,t+=p){i>=u&&(i-=u);var o=this.layer.data[i];for(e=(f+1048576*c)%c,s=g-f,v=f*d-_;0<=s;e++,s--,v+=d){e>=c&&(e-=c);var b=o[e];b&&!(0>b.index)&&b.collides&&(this.debugSettings.collidingTileOverfill&&(a.fillStyle=this.debugSettings.collidingTileOverfill,a.fillRect(v,t,this._mc.cw,this._mc.ch)),this.debugSettings.facingEdgeStroke&&(a.beginPath(),b.faceTop&&(a.moveTo(v,t),a.lineTo(v+this._mc.cw,t)),b.faceBottom&&(a.moveTo(v,t+this._mc.ch),a.lineTo(v+this._mc.cw,t+this._mc.ch)),b.faceLeft&&(a.moveTo(v,t),a.lineTo(v,t+this._mc.ch)),b.faceRight&&(a.moveTo(v+this._mc.cw,t),a.lineTo(v+this._mc.cw,t+this._mc.ch)),a.closePath(),a.stroke()))}}},Object.defineProperty(z.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(e){this._wrap=e,this.dirty=!0}}),Object.defineProperty(z.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(e){this._scrollX=e}}),Object.defineProperty(z.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(e){this._scrollY=e}}),Object.defineProperty(z.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(e){this._mc.cw=0|e,this.dirty=!0}}),Object.defineProperty(z.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(e){this._mc.ch=0|e,this.dirty=!0}}),z.TilemapParser={INSERT_NULL:!1,parse:function(i,t,e,s,n,o){if(void 0===e&&(e=32),void 0===s&&(s=32),void 0===n&&(n=10),void 0===o&&(o=10),void 0===t)return this.getEmptyData();if(null===t)return this.getEmptyData(e,s,n,o);var r=i.cache.getTilemapData(t);if(r){if(r.format===z.Tilemap.CSV)return this.parseCSV(t,r.data,e,s);if(!r.format||r.format===z.Tilemap.TILED_JSON)return this.parseTiledJSON(r.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+t)},parseCSV:function(i,t,e,s){for(var n=this.getEmptyData(),o=[],r=(t=t.trim()).split("\n"),a=r.length,p=0,l=0;l<r.length;l++){o[l]=[];for(var c=r[l].split(","),u=0;u<c.length;u++)o[l][u]=new z.Tile(n.layers[0],parseInt(c[u],10),u,l,e,s);0===p&&(p=c.length)}return n.format=z.Tilemap.CSV,n.name=i,n.width=p,n.height=a,n.tileWidth=e,n.tileHeight=s,n.widthInPixels=p*e,n.heightInPixels=a*s,n.layers[0].width=p,n.layers[0].height=a,n.layers[0].widthInPixels=n.widthInPixels,n.layers[0].heightInPixels=n.heightInPixels,n.layers[0].data=o,n},getEmptyData:function(a,t,e,r){return{width:void 0!==e&&null!==e?e:0,height:void 0!==r&&null!==r?r:0,tileWidth:void 0!==a&&null!==a?a:0,tileHeight:void 0!==t&&null!==t?t:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},_slice:function(a,t){var e={};for(var r in t){var o=t[r];void 0!==a[o]&&(e[o]=a[o])}return e},parseObjectGroup:function(d,t,p,u,s){var u=u||d.name,s=s||{x:0,y:0},n=this._slice;u||console.warn("No name found for objectGroup",d),void 0!==s.x&&void 0!==s.y||console.warn("Malformed xy properties in relativePosition",s),t[u]=t[u]||[],p[u]=p[u]||[];for(var o=0,r=d.objects.length,a;o<r;o++)if(a=d.objects[o],a.gid)m={gid:a.gid,name:a.name,type:a.type||"",x:a.x+s.x,y:a.y+s.y,width:a.width,height:a.height,visible:a.visible,properties:a.properties},a.rotation&&(m.rotation=a.rotation),t[u].push(m);else if(a.polyline){var m={name:a.name,type:a.type,x:a.x+s.x,y:a.y+s.y,width:a.width,height:a.height,visible:a.visible,properties:a.properties};for(a.rotation&&(m.rotation=a.rotation),m.polyline=[],l=0;l<a.polyline.length;l++)m.polyline.push([a.polyline[l].x,a.polyline[l].y]);p[u].push(m),t[u].push(m)}else if(a.polygon){(m=n(a,["name","type","x","y","visible","rotation","properties"])).x+=s.x,m.y+=s.y,m.polygon=[];for(var l=0;l<a.polygon.length;l++)m.polygon.push([a.polygon[l].x,a.polygon[l].y]);p[u].push(m),t[u].push(m)}else a.ellipse?((m=n(a,["name","type","ellipse","x","y","width","height","visible","rotation","properties"])).x+=s.x,m.y+=s.y,p[u].push(m),t[u].push(m)):((m=n(a,["name","type","x","y","width","height","visible","rotation","properties"])).x+=s.x,m.y+=s.y,m.rectangle=!0,p[u].push(m),t[u].push(m));return{objectsCollection:t,collisionCollection:p}},parseTiledJSON:function(i){if("orthogonal"!==i.orientation)return console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser"),null;for(var t={width:i.width,height:i.height,tileWidth:i.tilewidth,tileHeight:i.tileheight,orientation:i.orientation,format:z.Tilemap.TILED_JSON,version:i.version,properties:i.properties,widthInPixels:i.width*i.tilewidth,heightInPixels:i.height*i.tileheight},e=[],s=0;s<i.layers.length;s++)if("tilelayer"===i.layers[s].type){var n=i.layers[s];if(!n.compression&&n.encoding&&"base64"===n.encoding){for(var o=window.atob(n.data),r=o.length,a=Array(r),h=0;h<r;h+=4)a[h/4]=(o.charCodeAt(h)|o.charCodeAt(h+1)<<8|o.charCodeAt(h+2)<<16|o.charCodeAt(h+3)<<24)>>>0;n.data=a,delete n.encoding}else if(n.compression){console.warn("TilemapParser.parseTiledJSON - Layer compression is unsupported, skipping layer '"+n.name+"'");continue}L={name:n.name,x:n.x,y:n.y,width:n.width,height:n.height,widthInPixels:n.width*i.tilewidth,heightInPixels:n.height*i.tileheight,alpha:n.opacity,offsetX:n.offsetx,offsetY:n.offsety,visible:n.visible,properties:{},indexes:[],callbacks:[],bodies:[]},n.properties&&(L.properties=n.properties);for(var l=0,p=[],f=[],g=0,r=n.data.length,m,c,u;g<r;g++){if(m=0,c=!1,S=n.data[g],u=0,536870912<S)switch(2147483648<S&&(S-=2147483648,u+=4),1073741824<S&&(S-=1073741824,u+=2),536870912<S&&(S-=536870912,u+=1),u){case 5:m=R/2;break;case 6:m=R;break;case 3:m=3*R/2;break;case 4:m=0,c=!0;break;case 7:m=R/2,c=!0;break;case 2:m=R,c=!0;break;case 1:m=3*R/2,c=!0;}0<S?((D=new z.Tile(L,S,l,f.length,i.tilewidth,i.tileheight)).rotation=m,D.flipped=c,0!==u&&(D.flippedVal=u),p.push(D)):z.TilemapParser.INSERT_NULL?p.push(null):p.push(new z.Tile(L,-1,l,f.length,i.tilewidth,i.tileheight)),++l===n.width&&(f.push(p),l=0,p=[])}L.data=f,e.push(L)}t.layers=e;for(var d=[],s=0;s<i.layers.length;s++)if("imagelayer"===i.layers[s].type){var y=i.layers[s],v={name:y.name,image:y.image,x:y.x,y:y.y,alpha:y.opacity,visible:y.visible,properties:{}};y.properties&&(v.properties=y.properties),d.push(v)}t.images=d;for(var x=[],b={},_=[],w=null,s=0;s<i.tilesets.length;s++){if((F=i.tilesets[s]).source)console.warn("Phaser.TilemapParser - Phaser can't load external tilesets (%s). Use the Embed Tileset button and then export the map again.",F.source);else if(F.image){var T=new z.Tileset(F.name,F.firstgid,F.tilewidth,F.tileheight,F.margin,F.spacing,F.properties);F.tileproperties&&(T.tileProperties=F.tileproperties),T.updateTileData(F.imagewidth,F.imageheight),x.push(T)}else{if(!F.tiles)throw new Error("Tileset "+F.name+" has no `image` or `tiles` property.");var P=new z.ImageCollection(F.name,F.firstgid,F.tilewidth,F.tileheight,F.margin,F.spacing,F.properties);for(var C in F.tiles){var v=F.tiles[C].image,S=F.firstgid+parseInt(C,10);P.addImage(S,v)}_.push(P)}for(var C in F.tiles)(M=F.tiles[C].objectgroup)&&(b[parseInt(C,10)+F.firstgid]=M);w&&(w.lastgid=F.firstgid-1),w=F}if(0===x.length&&0===_.length)throw new Error("This tilemap has no tilesets.");t.tilesets=x,t.imagecollections=_;for(var k={},A={},s=0;s<i.layers.length;s++)if("objectgroup"===i.layers[s].type){var M=i.layers[s];this.parseObjectGroup(M,k,A)}for(t.objects=k,t.collision=A,t.tiles=[],s=0;s<t.tilesets.length;s++)for(var l=(F=t.tilesets[s]).tileMargin,O=F.tileMargin,I=0,E=0,N=0,g=F.firstgid;g<F.firstgid+F.total&&(t.tiles[g]=[l,O,s],l+=F.tileWidth+F.tileSpacing,++I!==F.total)&&(++E!==F.columns||(l=F.tileMargin,O+=F.tileHeight+F.tileSpacing,E=0,++N!==F.rows));g++);for(var s=0,L,D,B,F;s<t.layers.length;s++)for(A[(L=t.layers[s]).name]=[],F=null,h=0;h<L.data.length;h++){p=L.data[h];for(var U=0;U<p.length;U++)null===(D=p[U])||0>D.index||(B=t.tiles[D.index][2],(F=t.tilesets[B]).tileProperties&&F.tileProperties[D.index-F.firstgid]&&(D.properties=z.Utils.mixin(F.tileProperties[D.index-F.firstgid],D.properties)),(M=b[D.index])&&this.parseObjectGroup(M,t.objects,t.collision,D.layer.name,{x:D.worldX+M.x,y:D.worldY+M.y}))}return t}},z.Tileset=function(a,t,e,i,s,n,o){(void 0===e||0>=e)&&(e=32),(void 0===i||0>=i)&&(i=32),void 0===s&&(s=0),void 0===n&&(n=0),this.name=a,this.firstgid=0|t,this.tileWidth=0|e,this.tileHeight=0|i,this.tileMargin=0|s,this.tileSpacing=0|n,this.properties=o||{},this.image=null,this.rows=0,this.columns=0,this.total=0,this.drawCoords=[]},z.Tileset.prototype={draw:function(a,t,e,r){var o=r-this.firstgid<<1;0<=o&&o+1<this.drawCoords.length&&a.drawImage(this.image,this.drawCoords[o],this.drawCoords[o+1],this.tileWidth,this.tileHeight,t,e,this.tileWidth,this.tileHeight)},containsTileIndex:function(e){return e>=this.firstgid&&e<this.firstgid+this.total},setImage:function(e){this.image=e,this.updateTileData(e.width,e.height)},setSpacing:function(a,t){this.tileMargin=0|a,this.tileSpacing=0|t,this.image&&this.updateTileData(this.image.width,this.image.height)},updateTileData:function(d,t){var e=(t-2*this.tileMargin+this.tileSpacing)/(this.tileHeight+this.tileSpacing),i=(d-2*this.tileMargin+this.tileSpacing)/(this.tileWidth+this.tileSpacing);0==e%1&&0==i%1||console.warn("Phaser.Tileset - '%s' image tile area (%s x %s) is not a whole multiple of tile size (%s x %s + %s + %s)",this.name,d,t,this.tileWidth,this.tileHeight,this.tileMargin,this.tileSpacing),e=x(e),i=x(i),(this.rows&&this.rows!==e||this.columns&&this.columns!==i)&&console.warn("Phaser.Tileset - Tile layout from image '%s' (%s rows by %s columns) differs from tileset '%s' (%s rows by %s columns)",this.image.name,i,e,this.name,this.columns,this.rows),this.rows=e,this.columns=i,this.total=e*i,this.drawCoords.length=0;for(var s=this.tileMargin,n=this.tileMargin,o=0;o<this.rows;o++){for(var r=0;r<this.columns;r++)this.drawCoords.push(s),this.drawCoords.push(n),s+=this.tileWidth+this.tileSpacing;s=this.tileMargin,n+=this.tileHeight+this.tileSpacing}}},z.Tileset.prototype.constructor=z.Tileset,z.Particle=function(a,t,e,r,n){z.Sprite.call(this,a,t,e,r,n),this.autoScale=!1,this.scaleData=null,this._s=0,this.autoAlpha=!1,this.alphaData=null,this._a=0},z.Particle.prototype=Object.create(z.Sprite.prototype),z.Particle.prototype.constructor=z.Particle,z.Particle.prototype.update=function(){this.autoScale&&(--this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1),this.autoAlpha&&(--this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)},z.Particle.prototype.onEmit=function(){},z.Particle.prototype.setAlphaData=function(e){this.alphaData=e,this._a=e.length-1,this.alpha=this.alphaData[this._a].v,this.autoAlpha=!0},z.Particle.prototype.setScaleData=function(e){this.scaleData=e,this._s=e.length-1,this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y),this.autoScale=!0},z.Particle.prototype.reset=function(a,t,e){return z.Component.Reset.prototype.reset.call(this,a,t,e),this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this},z.Particles=function(e){this.game=e,this.emitters={},this.ID=0},z.Particles.prototype={add:function(e){return this.emitters[e.id]=e,e},remove:function(e){delete this.emitters[e.id]}},z.Particles.prototype.constructor=z.Particles,z.Particles.Arcade={},z.Particles.Arcade.Emitter=function(a,t,e,r){this.maxParticles=r||50,z.Group.call(this,a),this._id=this.game.particles.ID++,this.name="emitter"+this.id,this.type=z.EMITTER,this.physicsType=z.GROUP,this.area=new z.Rectangle(t,e,1,1),this.minAngle=null,this.maxAngle=null,this.minSpeed=0,this.maxSpeed=100,this.minParticleSpeed=new z.Point(-100,-100),this.maxParticleSpeed=new z.Point(100,100),this.minParticleScale=1,this.maxParticleScale=1,this.scaleData=null,this.minRotation=-360,this.maxRotation=360,this.minParticleAlpha=1,this.maxParticleAlpha=1,this.alphaData=null,this.particleClass=z.Particle,this.particleDrag=new z.Point,this.angularDrag=0,this.frequency=100,this.lifespan=2e3,this.bounce=new z.Point,this.on=!1,this.particleAnchor=new z.Point(.5,.5),this.blendMode=z.blendModes.NORMAL,this.emitX=t,this.emitY=e,this.autoScale=!1,this.autoAlpha=!1,this.particleBringToTop=!1,this.particleSendToBack=!1,this.counts={emitted:0,failed:0,totalEmitted:0,totalFailed:0},this._gravity=new z.Point(0,100),this._minParticleScale=new z.Point(1,1),this._maxParticleScale=new z.Point(1,1),this._total=0,this._timer=0,this._counter=0,this._flowQuantity=0,this._flowTotal=0,this._explode=!0,this._frames=null},z.Particles.Arcade.Emitter.prototype=Object.create(z.Group.prototype),z.Particles.Arcade.Emitter.prototype.constructor=z.Particles.Arcade.Emitter,z.Particles.Arcade.Emitter.prototype.update=function(){if(this.counts.emitted=0,this.counts.failed=0,this.on&&this.game.time.time>=this._timer)if(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,0===this._flowTotal)this.emitParticle()&&(this._counter++,0<this._total&&this._counter>=this._total&&(this.on=!1));else if(0<this._flowQuantity){for(e=0;e<this._flowQuantity;e++)if(this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal)){this.on=!1;break}}else this.emitParticle()&&(this._counter++,-1!==this._flowTotal&&this._counter>=this._flowTotal&&(this.on=!1));for(var e=this.children.length;e--;)this.children[e].exists&&this.children[e].update()},z.Particles.Arcade.Emitter.prototype.makeParticles=function(d,t,e,i,p,n){void 0===t&&(t=0),void 0===e&&(e=this.maxParticles),void 0===i&&(i=!1),void 0===p&&(p=!1),void 0===n&&(n=null);var o=0,a=d,c=t,l;for(this._frames=t,e>this.maxParticles&&(this.maxParticles=e);o<e;)Array.isArray(d)&&(a=this.game.rnd.pick(d)),Array.isArray(t)&&(c=this.game.rnd.pick(t)),l=new this.particleClass(this.game,0,0,a,c,n),this.game.physics.arcade.enable(l,!1),l.body.checkCollision.none=!i,l.body.collideWorldBounds=p,l.body.skipQuadTree=!0,l.exists=!1,l.visible=!1,l.anchor.copyFrom(this.particleAnchor),this.add(l),o++;return this},z.Particles.Arcade.Emitter.prototype.kill=function(){return this.on=!1,this.alive=!1,this.exists=!1,this},z.Particles.Arcade.Emitter.prototype.revive=function(){return this.alive=!0,this.exists=!0,this},z.Particles.Arcade.Emitter.prototype.explode=function(a,t){return void 0===t&&(t=this.maxParticles),this._flowTotal=0,this.start(!0,a,0,t,!1),this},z.Particles.Arcade.Emitter.prototype.flow=function(a,t,e,r,o){return void 0!==t&&null!==t||(t=250),void 0!==e&&0!==e||(e=1),void 0===r&&(r=-1),void 0===o&&(o=!0),e>this.maxParticles&&(e=this.maxParticles),this._counter=0,this._flowQuantity=e,this._flowTotal=r,o?(this.start(!0,a,t,e),this._counter+=e,this.on=!0,this._timer=this.game.time.time+t*this.game.time.slowMotion):this.start(!1,a,t,e),this},z.Particles.Arcade.Emitter.prototype.start=function(a,t,e,r,i){if(void 0===a&&(a=!0),void 0===t&&(t=0),void 0!==e&&null!==e||(e=250),void 0===r&&(r=0),void 0===i&&(i=!1),r>this.maxParticles&&(r=this.maxParticles),this.revive(),this.visible=!0,this.lifespan=t,this.frequency=e,a||i)for(var n=0;n<r;n++)this.emitParticle();else this.on=!0,this._total=r,this._counter=0,this._timer=this.game.time.time+e*this.game.time.slowMotion;return this},z.Particles.Arcade.Emitter.prototype.emitParticle=function(d,t,e,i){void 0===d&&(d=null),void 0===t&&(t=null);var s=this.getNextParticle();if(null===s)return this.counts.failed++,this.counts.totalFailed++,!1;this.counts.emitted++,this.counts.totalEmitted++;var n=this.game.rnd;void 0!==e&&void 0!==i?s.loadTexture(e,i):void 0!==e&&(s.loadTexture(e),s.frame=Array.isArray(this._frames)?n.pick(this._frames):this._frames);var o=this.emitX,r=this.emitY;return null===d?1<this.width&&(o=n.between(this.left,this.right)):o=d,null===t?1<this.height&&(r=n.between(this.top,this.bottom)):r=t,this.resetParticle(s,o,r),!0},z.Particles.Arcade.Emitter.prototype.getNextParticle=function(){for(var a=this.length,t;a--;)if(t=this.next(),!t.exists)return t;return null},z.Particles.Arcade.Emitter.prototype.resetParticle=function(a,t,e){var r=this.game.rnd;a.reset(t,e),a.angle=0,a.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(a):this.particleSendToBack&&this.sendToBack(a),this.autoScale?a.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?a.scale.set(r.realInRange(this.minParticleScale,this.maxParticleScale)):this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y?a.scale.set(r.realInRange(this._minParticleScale.x,this._maxParticleScale.x),r.realInRange(this._minParticleScale.y,this._maxParticleScale.y)):a.scale.set(this._minParticleScale.x,this._minParticleScale.y),this.autoAlpha?a.setAlphaData(this.alphaData):a.alpha=r.realInRange(this.minParticleAlpha,this.maxParticleAlpha),a.blendMode=this.blendMode;var o=a.body;o.updateBounds(),o.bounce.copyFrom(this.bounce),o.drag.copyFrom(this.particleDrag),null!=this.minAngle&&null!=this.maxAngle?this.game.physics.arcade.velocityFromAngle(this.minAngle===this.maxAngle?this.minAngle:r.between(this.minAngle,this.maxAngle),this.minSpeed===this.maxSpeed?this.minSpeed:r.between(this.minSpeed,this.maxSpeed),o.velocity):(o.velocity.x=r.between(this.minParticleSpeed.x,this.maxParticleSpeed.x),o.velocity.y=r.between(this.minParticleSpeed.y,this.maxParticleSpeed.y)),o.angularVelocity=r.between(this.minRotation,this.maxRotation),o.gravity.copyFrom(this.gravity),o.angularDrag=this.angularDrag,a.onEmit()},z.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this),z.Group.prototype.destroy.call(this,!0,!1)},z.Particles.Arcade.Emitter.prototype.setSize=function(a,t){return this.area.width=a,this.area.height=t,this},z.Particles.Arcade.Emitter.prototype.setXSpeed=function(a,t){return a=a||0,t=t||0,this.minParticleSpeed.x=a,this.maxParticleSpeed.x=t,this},z.Particles.Arcade.Emitter.prototype.setYSpeed=function(a,t){return a=a||0,t=t||0,this.minParticleSpeed.y=a,this.maxParticleSpeed.y=t,this},z.Particles.Arcade.Emitter.prototype.setRotation=function(a,t){return a=a||0,t=t||0,this.minRotation=a,this.maxRotation=t,this},z.Particles.Arcade.Emitter.prototype.setAlpha=function(i,d,l,s,n){if(void 0===i&&(i=1),void 0===d&&(d=1),void 0===l&&(l=0),void 0===s&&(s=z.Easing.Linear.None),void 0===n&&(n=!1),this.minParticleAlpha=i,this.maxParticleAlpha=d,this.autoAlpha=!1,0<l&&i!==d){var o={v:i},r=this.game.make.tween(o).to({v:d},l,s);r.yoyo(n),this.alphaData=r.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0}return this},z.Particles.Arcade.Emitter.prototype.setScale=function(i,d,p,c,u,o,r){if(void 0===i&&(i=1),void 0===d&&(d=1),void 0===p&&(p=1),void 0===c&&(c=1),void 0===u&&(u=0),void 0===o&&(o=z.Easing.Linear.None),void 0===r&&(r=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(i,p),this._maxParticleScale.set(d,c),this.autoScale=!1,0<u&&(i!==d||p!==c)){var a={x:i,y:p},m=this.game.make.tween(a).to({x:d,y:c},u,o);m.yoyo(r),this.scaleData=m.generateData(60),this.scaleData.reverse(),this.autoScale=!0}return this},z.Particles.Arcade.Emitter.prototype.setAngle=function(a,t,e,r){return this.minAngle=a,this.maxAngle=t,null!=e&&(this.minSpeed=e),null!=r&&(this.maxSpeed=r),this},z.Particles.Arcade.Emitter.prototype.at=function(e){return e.center?(this.emitX=e.center.x,this.emitY=e.center.y):(this.emitX=e.world.x+e.anchor.x*e.width,this.emitY=e.world.y+e.anchor.y*e.height),this},Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"gravity",{get:function(){return this._gravity},set:function(e){"number"==typeof e?this._gravity.y=e:this._gravity=e}}),Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"id",{get:function(){return this._id}}),Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(e){this.area.width=e}}),Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(e){this.area.height=e}}),Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(e){this.emitX=e}}),Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(e){this.emitY=e}}),Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"left",{get:function(){return x(this.x-this.area.width/2)}}),Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"right",{get:function(){return x(this.x+this.area.width/2)}}),Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"top",{get:function(){return x(this.y-this.area.height/2)}}),Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return x(this.y+this.area.height/2)}}),Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"output",{get:function(){return 1e3*this._flowQuantity/this.frequency}}),Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"lifespanOutput",{get:function(){return(0===this.lifespan?1/0:this.lifespan)*this._flowQuantity/this.frequency}}),Object.defineProperty(z.Particles.Arcade.Emitter.prototype,"remainder",{get:function(){return this.maxParticles-this.lifespanOutput}}),z.Weapon=function(a,t){z.Plugin.call(this,a,t),this.bullets=null,this.autoExpandBulletsGroup=!1,this.autofire=!1,this.shots=0,this.fireLimit=0,this.fireRate=100,this.fireRateVariance=0,this.fireFrom=new z.Rectangle(0,0,1,1),this.fireAngle=z.ANGLE_UP,this.bulletInheritSpriteSpeed=!1,this.bulletAnimation="",this.bulletFrameRandom=!1,this.bulletFrameCycle=!1,this.bulletWorldWrap=!1,this.bulletWorldWrapPadding=0,this.bulletAngleOffset=0,this.bulletAngleVariance=0,this.bulletSpeed=200,this.bulletSpeedVariance=0,this.bulletLifespan=0,this.bulletKillDistance=0,this.bulletGravity=new z.Point(0,0),this.bulletRotateToVelocity=!1,this.bulletKey="",this.bulletFrame="",this._bulletClass=z.Bullet,this._bulletCollideWorldBounds=!1,this._bulletKillType=z.Weapon.KILL_WORLD_BOUNDS,this._data={customBody:!1,width:0,height:0,offsetX:0,offsetY:0},this.bounds=new z.Rectangle,this.bulletBounds=a.world.bounds,this.bulletFrames=[],this.bulletFrameIndex=0,this.anims={},this.onFire=new z.Signal,this.onKill=new z.Signal,this.onFireLimit=new z.Signal,this.trackedSprite=null,this.trackedPointer=null,this.multiFire=!1,this._hasFired=!1,this.trackRotation=!1,this.trackOffset=new z.Point,this._nextFire=0,this._tempNextFire=0,this._rotatedPoint=new z.Point},z.Weapon.prototype=Object.create(z.Plugin.prototype),z.Weapon.prototype.constructor=z.Weapon,z.Weapon.KILL_NEVER=0,z.Weapon.KILL_LIFESPAN=1,z.Weapon.KILL_DISTANCE=2,z.Weapon.KILL_WEAPON_BOUNDS=3,z.Weapon.KILL_CAMERA_BOUNDS=4,z.Weapon.KILL_WORLD_BOUNDS=5,z.Weapon.KILL_STATIC_BOUNDS=6,z.Weapon.prototype.createBullets=function(a,t,e,r){return void 0===a&&(a=1),void 0===r&&(r=this.game.world),this.bullets&&!this.bullets.game&&(this.bullets=null),this.bullets||(this.bullets=this.game.add.physicsGroup(z.Physics.ARCADE,r),this.bullets.classType=this._bulletClass),0!==a&&(-1===a&&(this.autoExpandBulletsGroup=!0,a=1),this.bullets.createMultiple(a,t,e),this.bullets.setAll("data.bulletManager",this),this.bulletKey=t,this.bulletFrame=e),this},z.Weapon.prototype.forEach=function(a,t){return this.bullets.forEachExists(a,t,arguments),this},z.Weapon.prototype.pauseAll=function(){return this.bullets.setAll("body.enable",!1),this},z.Weapon.prototype.resumeAll=function(){return this.bullets.setAll("body.enable",!0),this},z.Weapon.prototype.killAll=function(){return this.bullets.callAllExists("kill",!0),this.bullets.setAll("body.enable",!0),this},z.Weapon.prototype.resetShots=function(e){return this.shots=0,void 0!==e&&(this.fireLimit=e),this},z.Weapon.prototype.destroy=function(){this.parent.remove(this,!1),this.bullets.destroy(),this.game=null,this.parent=null,this.active=!1,this.visible=!1},z.Weapon.prototype.update=function(){this._bulletKillType===z.Weapon.KILL_WEAPON_BOUNDS&&(this.trackedSprite?(this.trackedSprite.updateTransform(),this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)):this.trackedPointer&&this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY)),this.autofire&&this.fire()},z.Weapon.prototype.postRender=function(){this.multiFire&&this._hasFired&&(this._hasFired=!1,this._nextFire=this._tempNextFire)},z.Weapon.prototype.trackSprite=function(a,t,e,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=!1),this.trackedPointer=null,this.trackedSprite=a,this.trackRotation=r,this.trackOffset.set(t,e),this},z.Weapon.prototype.trackPointer=function(a,t,e){return void 0===a&&(a=this.game.input.activePointer),void 0===t&&(t=0),void 0===e&&(e=0),this.trackedPointer=a,this.trackedSprite=null,this.trackRotation=!1,this.trackOffset.set(t,e),this},z.Weapon.prototype.fireMany=function(a,r){this.multiFire=!0;var e=[],o=this;return r||this.trackedSprite||this.trackedPointer?a.forEach(function(a){e.push(o.fire(r,null,null,a.x,a.y))}):a.forEach(function(a){e.push(o.fire(a))}),e},z.Weapon.prototype.fireOffset=function(a,t){return void 0===a&&(a=0),void 0===t&&(t=0),this.fire(null,null,null,a,t)},z.Weapon.prototype.fire=function(i,t,e,s,n){if(void 0===t&&(t=null),void 0===e&&(e=null),this.game.time.now<this._nextFire||0<this.fireLimit&&this.shots===this.fireLimit)return null;var o=this.bulletSpeed;0!==this.bulletSpeedVariance&&(o+=z.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance)),i?1<this.fireFrom.width?this.fireFrom.centerOn(i.x,i.y):(this.fireFrom.x=i.x,this.fireFrom.y=i.y):this.trackedSprite?(this.trackRotation?(this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y),this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.worldRotation),1<this.fireFrom.width?this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y):(this.fireFrom.x=this._rotatedPoint.x,this.fireFrom.y=this._rotatedPoint.y)):1<this.fireFrom.width?this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y),this.bulletInheritSpriteSpeed&&(o+=this.trackedSprite.body.speed)):this.trackedPointer&&(1<this.fireFrom.width?this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y):(this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x,this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y)),void 0!==s&&(this.fireFrom.x+=s),void 0!==n&&(this.fireFrom.y+=n);var r=1<this.fireFrom.width?this.fireFrom.randomX:this.fireFrom.x,a=1<this.fireFrom.height?this.fireFrom.randomY:this.fireFrom.y,m=this.trackRotation?this.trackedSprite.angle:this.fireAngle;null!==t&&null!==e&&(m=this.game.math.radToDeg(_(e-a,t-r))),0!==this.bulletAngleVariance&&(m+=z.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance));var l=0,c=0;0===m||180===m?l=S(this.game.math.degToRad(m))*o:90===m||270===m?c=T(this.game.math.degToRad(m))*o:(l=S(this.game.math.degToRad(m))*o,c=T(this.game.math.degToRad(m))*o);var u=null;if(this.autoExpandBulletsGroup?(u=this.bullets.getFirstExists(!1,!0,r,a,this.bulletKey,this.bulletFrame)).data.bulletManager=this:u=this.bullets.getFirstExists(!1),u){if(u.reset(r,a),u.data.fromX=r,u.data.fromY=a,u.data.killType=this.bulletKillType,u.data.killDistance=this.bulletKillDistance,u.data.rotateToVelocity=this.bulletRotateToVelocity,this.bulletKillType===z.Weapon.KILL_LIFESPAN&&(u.lifespan=this.bulletLifespan),u.angle=m+this.bulletAngleOffset,""!==this.bulletAnimation){if(null===u.animations.getAnimation(this.bulletAnimation)){var d=this.anims[this.bulletAnimation];u.animations.add(d.name,d.frames,d.frameRate,d.loop,d.useNumericIndex)}u.animations.play(this.bulletAnimation)}else this.bulletFrameCycle?(u.frame=this.bulletFrames[this.bulletFrameIndex],++this.bulletFrameIndex>=this.bulletFrames.length&&(this.bulletFrameIndex=0)):this.bulletFrameRandom&&(u.frame=this.bulletFrames[x(Math.random()*this.bulletFrames.length)]);u.data.bodyDirty&&(this._data.customBody&&u.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY),u.body.collideWorldBounds=this.bulletCollideWorldBounds,u.data.bodyDirty=!1),u.body.velocity.set(l,c),u.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y);var p=0;if(0!==this.bulletSpeedVariance){var h=this.fireRate;0>(h+=z.Math.between(-this.fireRateVariance,this.fireRateVariance))&&(h=0),p=this.game.time.now+h}else p=this.game.time.now+this.fireRate;this.multiFire?this._hasFired||(this._hasFired=!0,this._tempNextFire=p,this.shots++):(this._nextFire=p,this.shots++),this.onFire.dispatch(u,this,o),0<this.fireLimit&&this.shots===this.fireLimit&&this.onFireLimit.dispatch(this,this.fireLimit)}return u},z.Weapon.prototype.fireAtPointer=function(e){return void 0===e&&(e=this.game.input.activePointer),this.fire(null,e.worldX,e.worldY)},z.Weapon.prototype.fireAtSprite=function(e){return this.fire(null,e.world.x,e.world.y)},z.Weapon.prototype.fireAtXY=function(a,t){return this.fire(null,a,t)},z.Weapon.prototype.setBulletBodyOffset=function(a,t,e,r){return void 0===e&&(e=0),void 0===r&&(r=0),this._data.customBody=!0,this._data.width=a,this._data.height=t,this._data.offsetX=e,this._data.offsetY=r,this.bullets.callAll("body.setSize","body",a,t,e,r),this.bullets.setAll("data.bodyDirty",!1),this},z.Weapon.prototype.setBulletFrames=function(a,t,e,r){return void 0===e&&(e=!0),void 0===r&&(r=!1),this.bulletFrames=z.ArrayUtils.numberArray(a,t),this.bulletFrameIndex=0,this.bulletFrameCycle=e,this.bulletFrameRandom=r,this},z.Weapon.prototype.addBulletAnimation=function(a,r,o,d,l){return this.anims[a]={name:a,frames:r,frameRate:o,loop:d,useNumericIndex:l},this.bullets.callAll("animations.add","animations",a,r,o,d,l),this.bulletAnimation=a,this},z.Weapon.prototype.debug=function(a,t,e){void 0===a&&(a=16),void 0===t&&(t=32),void 0===e&&(e=!1),this.game.debug.text("Weapon Plugin",a,t),this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,a,t+24),e&&this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")},Object.defineProperty(z.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(e){this._bulletClass=e,this.bullets&&(this.bullets.classType=this._bulletClass)}}),Object.defineProperty(z.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(e){e===z.Weapon.KILL_STATIC_BOUNDS||e===z.Weapon.KILL_WEAPON_BOUNDS?this.bulletBounds=this.bounds:e===z.Weapon.KILL_CAMERA_BOUNDS?this.bulletBounds=this.game.camera.view:e===z.Weapon.KILL_WORLD_BOUNDS?this.bulletBounds=this.game.world.bounds:void 0,this._bulletKillType=e}}),Object.defineProperty(z.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(e){this._bulletCollideWorldBounds=e,this.bullets.setAll("body.collideWorldBounds",e),this.bullets.setAll("data.bodyDirty",!1)}}),Object.defineProperty(z.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(e){this.fireFrom.x=e}}),Object.defineProperty(z.Weapon.prototype,"y",{get:function(){return this.fireFrom.y},set:function(e){this.fireFrom.y=e}}),z.Bullet=function(a,t,e,r,n){z.Sprite.call(this,a,t,e,r,n),this.anchor.set(.5),this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:!0,rotateToVelocity:!1,killType:0,killDistance:0}},z.Bullet.prototype=Object.create(z.Sprite.prototype),z.Bullet.prototype.constructor=z.Bullet,z.Bullet.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.data.bulletManager.onKill.dispatch(this),this},z.Bullet.prototype.update=function(){this.exists&&(this.data.killType>z.Weapon.KILL_LIFESPAN&&(this.data.killType===z.Weapon.KILL_DISTANCE?this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,!0)>this.data.killDistance&&this.kill():this.data.bulletManager.bulletBounds.intersects(this)||this.kill()),this.data.rotateToVelocity&&(this.rotation=this.body.velocity.atan()),this.data.bulletManager.bulletWorldWrap&&this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding))},z.Video=function(a,t,e){if(void 0===t&&(t=null),void 0===e&&(e=null),this.game=a,this.key=t,this.width=0,this.height=0,this.type=z.VIDEO,this.disableTextureUpload=!1,this.touchLocked=!1,this.onPlay=new z.Signal,this.onChangeSource=new z.Signal,this.onComplete=new z.Signal,this.onAccess=new z.Signal,this.onError=new z.Signal,this.onTimeout=new z.Signal,this.onTouchUnlock=new z.Signal,this.playWhenUnlocked=!0,this.timeout=15e3,this._timeOutID=null,this.video=null,this.videoStream=null,this.isStreaming=!1,this.retryLimit=20,this.retry=0,this.retryInterval=500,this._retryID=null,this._codeMuted=!1,this._muted=!1,this._codePaused=!1,this._paused=!1,this._pending=!1,this._pendingChangeSource=!1,this._autoplay=!1,this._endCallback=null,this._playCallback=null,t&&this.game.cache.checkVideoKey(t)){var r=this.game.cache.getVideo(t);r.isBlob?this.createVideoFromBlob(r.data):this.video=r.data,this.width=this.video.videoWidth,this.height=this.video.videoHeight}else e&&this.createVideoFromURL(e,!1);this.video&&!e?(this.baseTexture=new PIXI.BaseTexture(this.video,null,this.game.resolution),this.baseTexture.forceLoaded(this.width,this.height)):(this.baseTexture=new PIXI.BaseTexture(z.Cache.DEFAULT.baseTexture.source,null,this.game.resolution),this.baseTexture.forceLoaded(this.width,this.height)),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new z.Frame(0,0,0,this.width,this.height,"video"),this.texture.setFrame(this.textureFrame),this.texture.valid=!1,null!==t&&this.video&&(this.texture.valid=this.video.canplay),this.snapshot=null,z.BitmapData&&(this.snapshot=new z.BitmapData(this.game,"",this.width,this.height)),this.game.device.needsTouchUnlock()?this.setTouchLock():r&&(r.locked=!1)},z.Video.prototype={connectToMediaStream:function(a,t){return a&&t&&(this.video=a,this.videoStream=t,this.isStreaming=!0,this.baseTexture.source=this.video,this.updateTexture(null,this.video.videoWidth,this.video.videoHeight),this.onAccess.dispatch(this)),this},startMediaStream:function(a,r,e){if(void 0===a&&(a=!1),void 0===r&&(r=null),void 0===e&&(e=null),!this.game.device.getUserMedia)return this.onError.dispatch(this,"No getUserMedia"),!1;null!==this.videoStream&&(this.videoStream.active?this.videoStream.active=!1:this.videoStream.stop()),this.removeVideoElement(),this.video=document.createElement("video"),this.video.setAttribute("autoplay","autoplay"),null!==r&&(this.video.width=r),null!==e&&(this.video.height=e),this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:a,video:!0},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(e){this.getUserMediaError(e)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID),this.onTimeout.dispatch(this)},getUserMediaError:function(e){clearTimeout(this._timeOutID),this.onError.dispatch(this,e)},getUserMediaSuccess:function(a){clearTimeout(this._timeOutID),this.videoStream=a,void 0===this.video.mozSrcObject?this.video.src=window.URL&&window.URL.createObjectURL(a)||a:this.video.mozSrcObject=a;var r=this;this.video.onloadeddata=function(){function e(){if(!(0<t))console.warn("Unable to connect to video stream. Webcam error?");else if(0<r.video.videoWidth){var a=r.video.videoWidth,o=r.video.videoHeight;isNaN(r.video.videoHeight)&&(o=a/(4/3)),r.video.play(),r.isStreaming=!0,r.baseTexture.source=r.video,r.updateTexture(null,a,o),r.onAccess.dispatch(r)}else window.setTimeout(e,500);t--}var t=10;e()}},createVideoFromBlob:function(a){var r=this;return this.video=document.createElement("video"),this.video.controls=!1,this.video.setAttribute("autoplay","autoplay"),this.video.addEventListener("loadeddata",function(e){r.updateTexture(e)},!0),this.video.src=window.URL.createObjectURL(a),this.video.canplay=!0,this},createVideoFromURL:function(a,t){return void 0===t&&(t=!1),this.texture&&(this.texture.valid=!1),this.video=document.createElement("video"),this.video.controls=!1,t&&this.video.setAttribute("autoplay","autoplay"),this.video.src=a,this.video.canplay=!0,this.video.load(),this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.key=a,this},updateTexture:function(a,t,e){var r=!1;void 0!==t&&null!==t||(t=this.video.videoWidth,r=!0),void 0!==e&&null!==e||(e=this.video.videoHeight),this.width=t,this.height=e,this.baseTexture.source!==this.video&&(this.baseTexture.source=this.video),this.baseTexture.forceLoaded(t,e),this.texture.frame.resize(t,e),this.texture.width=t,this.texture.height=e,this.texture.valid=!0,this.snapshot&&this.snapshot.resize(t,e),r&&null!==this.key&&(this.onChangeSource.dispatch(this,t,e),this._autoplay&&(this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate)))},complete:function(){this.onComplete.dispatch(this)},play:function(a,t){return this._pendingChangeSource?this:(void 0===a&&(a=!1),void 0===t&&(t=1),this.game.sound.onMute&&(this.game.sound.onMute.add(this.setMute,this),this.game.sound.onUnMute.add(this.unsetMute,this),this.game.sound.mute&&this.setMute()),this.game.onPause.add(this.setPause,this),this.game.onResume.add(this.setResume,this),this._endCallback=this.complete.bind(this),this.video.addEventListener("ended",this._endCallback,!0),this.video.addEventListener("webkitendfullscreen",this._endCallback,!0),this.video.loop=a?"loop":"",this.video.playbackRate=t,this.touchLocked?this._pending=!0:(this._pending=!1,null!==this.key&&(4===this.video.readyState?(this._playCallback=this.playHandler.bind(this),this.video.addEventListener("playing",this._playCallback,!0)):(this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval))),this.video.play(),this.onPlay.dispatch(this,a,t)),this)},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,!0),this.updateTexture()},stop:function(){return this.game.sound.onMute&&(this.game.sound.onMute.remove(this.setMute,this),this.game.sound.onUnMute.remove(this.unsetMute,this)),this.game.onPause.remove(this.setPause,this),this.game.onResume.remove(this.setResume,this),this.isStreaming?(this.video.mozSrcObject?(this.video.mozSrcObject.stop(),this.video.src=null):(this.video.src="",this.videoStream.active?this.videoStream.active=!1:this.videoStream.getTracks?this.videoStream.getTracks().forEach(function(e){e.stop()}):this.videoStream.stop()),this.videoStream=null,this.isStreaming=!1):(this.video.removeEventListener("ended",this._endCallback,!0),this.video.removeEventListener("webkitendfullscreen",this._endCallback,!0),this.video.removeEventListener("playing",this._playCallback,!0),this.touchLocked?this._pending=!1:this.video.pause()),this},add:function(a){if(Array.isArray(a))for(var t=0;t<a.length;t++)a[t].loadTexture&&a[t].loadTexture(this);else a.loadTexture(this);return this},addToWorld:function(a,t,e,i,s,n){s=s||1,n=n||1;var o=this.game.add.image(a,t,this);return o.anchor.set(e,i),o.scale.set(s,n),o},render:function(){!this.disableTextureUpload&&this.playing&&this.baseTexture.dirty()},setMute:function(){this._muted||(this._muted=!0,this.video.muted=!0)},unsetMute:function(){this._muted&&!this._codeMuted&&(this._muted=!1,this.video.muted=!1)},setPause:function(){this._paused||this.touchLocked||(this._paused=!0,this.video.pause())},setResume:function(){!this._paused||this._codePaused||this.touchLocked||(this._paused=!1,this.video.ended||this.video.play())},changeSource:function(a,t){return void 0===t&&(t=!0),this.texture.valid=!1,this.video.pause(),this._pendingChangeSource=!0,this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval),this.video.src=a,this.video.load(),this._autoplay=t,t||(this.paused=!0),this},checkVideoProgress:function(){4===this.video.readyState?(this._pendingChangeSource=!1,this.updateTexture()):0<--this.retry?this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval):console.warn("Phaser.Video: Unable to start downloading video in time",this.isStreaming)},setTouchLock:function(){this.game.input.addTouchLockCallback(this.unlock,this,!0),this.touchLocked=!0},unlock:function(){if(this.touchLocked=!1,this.playWhenUnlocked&&(this.video.play(),this.onPlay.dispatch(this,this.loop,this.playbackRate)),this.key){var e=this.game.cache.getVideo(this.key);e&&!e.isBlob&&(e.locked=!1)}return this.onTouchUnlock.dispatch(this),!0},grab:function(a,t,e){return(void 0===a&&(a=!1),void 0===t&&(t=1),void 0===e&&(e=null),null!==this.snapshot)?(a&&this.snapshot.cls(),this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,t,e),this.snapshot):void console.warn("Video.grab cannot run because Phaser.BitmapData is unavailable")},removeVideoElement:function(){if(this.video){for(this.video.parentNode&&this.video.parentNode.removeChild(this.video);this.video.hasChildNodes();)this.video.removeChild(this.video.firstChild);this.video.removeAttribute("autoplay"),this.video.removeAttribute("src"),this.video=null}},destroy:function(){this.stop(),this.removeVideoElement(),this.touchLocked&&this.game.input.touch.removeTouchLockCallback(this.unlock,this),this._retryID&&window.clearTimeout(this._retryID)}},Object.defineProperty(z.Video.prototype,"currentTime",{get:function(){return this.video?this.video.currentTime:0},set:function(e){this.video.currentTime=e}}),Object.defineProperty(z.Video.prototype,"duration",{get:function(){return this.video?this.video.duration:0}}),Object.defineProperty(z.Video.prototype,"progress",{get:function(){return this.video?this.video.currentTime/this.video.duration:0}}),Object.defineProperty(z.Video.prototype,"mute",{get:function(){return this._muted},set:function(e){if(e=e||null){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(z.Video.prototype,"paused",{get:function(){return this._paused},set:function(e){if(e=e||null,!this.touchLocked)if(e){if(this._paused)return;this._codePaused=!0,this.setPause()}else{if(!this._paused)return;this._codePaused=!1,this.setResume()}}}),Object.defineProperty(z.Video.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(e){0>e?e=0:1<e&&(e=1),this.video&&(this.video.volume=e)}}),Object.defineProperty(z.Video.prototype,"playbackRate",{get:function(){return this.video?this.video.playbackRate:1},set:function(e){this.video&&(this.video.playbackRate=e)}}),Object.defineProperty(z.Video.prototype,"loop",{get:function(){return!!this.video&&this.video.loop},set:function(e){e&&this.video?this.video.loop="loop":this.video&&(this.video.loop="")}}),Object.defineProperty(z.Video.prototype,"playing",{get:function(){return!!this.video&&!(this.video.paused&&this.video.ended)}}),z.Video.prototype.constructor=z.Video,void 0===PIXI.blendModes&&(PIXI.blendModes=z.blendModes),void 0===PIXI.scaleModes&&(PIXI.scaleModes=z.scaleModes),void 0===PIXI.Texture.emptyTexture&&(PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture())),void 0===PIXI.DisplayObject._tempMatrix&&(PIXI.DisplayObject._tempMatrix=new z.Matrix),PIXI.TextureSilentFail=!0,PIXI.canUseNewCanvasBlendModes=function(){return z.Device.canUseMultiply},("undefined"!=typeof a&&a.exports&&(r=a.exports=z),r.Phaser=z),z)}).call(this)}).call(r,e(523))},523:function(e){function t(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function r(e){if(p===setTimeout)return setTimeout(e,0);if((p===t||!p)&&setTimeout)return p=setTimeout,setTimeout(e,0);try{return p(e,0)}catch(t){try{return p.call(null,e,0)}catch(t){return p.call(this,e,0)}}}function o(e){if(c===clearTimeout)return clearTimeout(e);if((c===a||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{return c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}function n(){m&&h&&(m=!1,h.length?u=h.concat(u):g=-1,u.length&&s())}function s(){if(!m){var e=r(n);m=!0;for(var t=u.length;t;){for(h=u,u=[];++g<t;)h&&h[g].run();g=-1,t=u.length}h=null,m=!1,o(e)}}function d(e,t){this.fun=e,this.array=t}function i(){}var l=e.exports={},p,c;(function(){try{p="function"==typeof setTimeout?setTimeout:t}catch(a){p=t}try{c="function"==typeof clearTimeout?clearTimeout:a}catch(t){c=a}})();var u=[],m=!1,g=-1,h;l.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];u.push(new d(e,t)),1!==u.length||m||r(s)},d.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=i,l.addListener=i,l.once=i,l.off=i,l.removeListener=i,l.removeAllListeners=i,l.emit=i,l.prependListener=i,l.prependOnceListener=i,l.listeners=function(){return[]},l.binding=function(){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},524:function(e,t,a){(function(t){e.exports=t.PhaserInput=a(525)}).call(t,a(45))},525:function(e){var t=Math.max,r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function r(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}(),a;/*!
 * phaser-input - version 2.0.5 
 * Adds input boxes to Phaser like CanvasInput, but also works for WebGL and Mobile, made for Phaser only.
 *
 * OrangeGames
 * Build at 02-06-2017
 * Released under MIT License 
 */!function(e){var t;!function(e){e[e.text=0]="text",e[e.password=1]="password",e[e.number=2]="number"}(t=e.InputType||(e.InputType={}));var a=function(){function e(r,o,n,s,e,d){void 0===n&&(n=t.text),void 0===s&&(s="");var l=this;this.id=o,this.type=n,this.game=r,this.focusIn=e,this.focusOut=d;var p=this.game.canvas.getBoundingClientRect().top+document.body.scrollTop;this.element=document.createElement("input"),this.element.id=o,this.element.style.position="absolute",this.element.style.top=p+"px",this.element.style.left=(-40).toString()+"px",this.element.style.width=10 .toString()+"px",this.element.style.height=10 .toString()+"px",this.element.style.border="0px",this.element.value=this.value,this.element.type=t[n],this.element.addEventListener("focusin",function(){l.focusIn instanceof Phaser.Signal&&l.focusIn.dispatch()}),this.element.addEventListener("focusout",function(){l.focusOut instanceof Phaser.Signal&&l.focusOut.dispatch()}),document.body.appendChild(this.element)}return e.prototype.addKeyUpListener=function(e){this.keyUpCallback=e,document.addEventListener("keyup",this.keyUpCallback),this.element.addEventListener("input",this.keyUpCallback)},e.prototype.blockKeyDownEvents=function(){document.addEventListener("keydown",this.preventKeyPropagation)},e.prototype.preventKeyPropagation=function(e){e.stopPropagation?e.stopPropagation():event.cancelBubble=!0},e.prototype.unblockKeyDownEvents=function(){document.removeEventListener("keydown",this.preventKeyPropagation)},e.prototype.removeEventListener=function(){document.removeEventListener("keyup",this.keyUpCallback),this.element.removeEventListener("input",this.keyUpCallback)},e.prototype.destroy=function(){document.body.removeChild(this.element)},e.prototype.setMax=function(e,a){if(void 0!==e)if(this.type===t.text||this.type===t.password)this.element.maxLength=parseInt(e,10);else if(this.type===t.number){if(this.element.max=e,void 0===a)return;this.element.min=a}},Object.defineProperty(e.prototype,"value",{get:function(){return this.element.value},set:function(e){this.element.value=e},enumerable:!0,configurable:!0}),e.prototype.focus=function(){var t=this;if(this.element.focus(),!this.game.device.desktop&&this.game.device.chrome)var a=window.innerWidth,r=window.innerHeight,o=!1,n=setInterval(function(){(a>window.innerWidth||r>window.innerHeight)&&(o=!0),o&&a===window.innerWidth&&r===window.innerHeight&&(t.focusOut instanceof Phaser.Signal&&t.focusOut.dispatch(),clearInterval(n))},50)},e.prototype.blur=function(){this.element.blur()},Object.defineProperty(e.prototype,"hasSelection",{get:function(){return this.type!==t.number&&this.element.selectionStart!==this.element.selectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"caretStart",{get:function(){return this.element.selectionEnd},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"caretEnd",{get:function(){return this.element.selectionStart},enumerable:!0,configurable:!0}),e.prototype.getCaretPosition=function(){return this.type===t.number?-1:this.element.selectionStart},e.prototype.setCaretPosition=function(e){this.type!==t.number&&this.element.setSelectionRange(e,e)},e}();e.InputElement=a}(a||(a={}));var a;!function(t){var o;!function(e){e[e.none=0]="none",e[e.lower=1]="lower",e[e.upper=2]="upper"}(o=t.ForceCase||(t.ForceCase={}));var e=function(n){function e(a,r,e,i){void 0===i&&(i={});var s=n.call(this,a,r,e)||this;return s.focusOutOnEnter=!0,s.placeHolder=null,s.box=null,s.focus=!1,s.value="",s.windowScale=1,s.blockInput=!0,s.focusIn=new Phaser.Signal,s.focusOut=new Phaser.Signal,s.blink=!0,s.cnt=0,s.inputOptions=i,s.inputOptions.width="number"==typeof i.width?i.width:150,s.inputOptions.padding="number"==typeof i.padding?i.padding:0,s.inputOptions.textAlign=i.textAlign||"left",s.inputOptions.type=i.type||t.InputType.text,s.inputOptions.forceCase=i.forceCase?i.forceCase:o.none,s.inputOptions.borderRadius="number"==typeof i.borderRadius?i.borderRadius:0,s.inputOptions.height="number"==typeof i.height?i.height:14,s.inputOptions.fillAlpha=void 0===i.fillAlpha?1:i.fillAlpha,s.inputOptions.selectionColor=i.selectionColor||"rgba(179, 212, 253, 0.8)",s.inputOptions.zoom=!a.device.desktop&&(i.zoom||!1),s.box=new t.InputBox(s.game,i),s.setTexture(s.box.generateTexture()),s.textMask=new t.TextMask(s.game,i),s.addChild(s.textMask),s.domElement=new t.InputElement(s.game,"phaser-input-"+(0|1e4*Math.random()).toString(),s.inputOptions.type,s.value,s.focusIn,s.focusOut),s.domElement.setMax(s.inputOptions.max,s.inputOptions.min),s.selection=new t.SelectionHighlight(s.game,s.inputOptions),s.selection.mask=s.textMask,s.addChild(s.selection),i.placeHolder&&0<i.placeHolder.length&&(s.placeHolder=new Phaser.Text(a,s.inputOptions.padding,s.inputOptions.padding,i.placeHolder,{font:i.font||"14px Arial",fontWeight:i.fontWeight||"normal",fill:i.placeHolderColor||"#bfbebd"}),s.placeHolder.mask=s.textMask,s.addChild(s.placeHolder)),s.cursor=new Phaser.Text(a,s.inputOptions.padding,s.inputOptions.padding-2,"|",{font:i.font||"14px Arial",fontWeight:i.fontWeight||"normal",fill:i.cursorColor||"#000000"}),s.cursor.visible=!1,s.addChild(s.cursor),s.text=new Phaser.Text(a,s.inputOptions.padding,s.inputOptions.padding,"",{font:i.font||"14px Arial",fontWeight:i.fontWeight||"normal",fill:i.fill||"#000000"}),s.text.mask=s.textMask,s.addChild(s.text),s.offscreenText=new Phaser.Text(a,s.inputOptions.padding,s.inputOptions.padding,"",{font:i.font||"14px Arial",fontWeight:i.fontWeight||"normal",fill:i.fill||"#000000"}),s.updateTextAlignment(),s.inputEnabled=!0,s.input.useHandCursor=!0,s.game.input.onDown.add(s.checkDown,s),s.focusOut.add(function(){t.KeyboardOpen&&(s.endFocus(),s.inputOptions.zoom&&s.zoomOut())}),s}return r(e,n),Object.defineProperty(e.prototype,"width",{get:function(){return this.inputOptions.width},set:function(e){this.inputOptions.width=e,this.box.resize(e),this.textMask.resize(e),this.updateTextAlignment()},enumerable:!0,configurable:!0}),e.prototype.updateTextAlignment=function(){switch(this.inputOptions.textAlign){case"left":this.text.anchor.set(0,0),this.text.x=this.inputOptions.padding,null!==this.placeHolder&&this.placeHolder.anchor.set(0,0),this.cursor.x=this.inputOptions.padding+this.getCaretPosition();break;case"center":this.text.anchor.set(.5,0),this.text.x=this.inputOptions.padding+this.inputOptions.width/2,null!==this.placeHolder&&(this.placeHolder.anchor.set(.5,0),this.placeHolder.x=this.inputOptions.padding+this.inputOptions.width/2),this.cursor.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2+this.getCaretPosition();break;case"right":this.text.anchor.set(1,0),this.text.x=this.inputOptions.padding+this.inputOptions.width,null!==this.placeHolder&&(this.placeHolder.anchor.set(1,0),this.placeHolder.x=this.inputOptions.padding+this.inputOptions.width),this.cursor.x=this.inputOptions.padding+this.inputOptions.width;}},e.prototype.checkDown=function(e){if(this.value||this.resetText(),this.input.checkPointerOver(e)){if(this.focus)return void this.setCaretOnclick(e);this.inputOptions.zoom&&!t.Zoomed&&this.zoomIn(),this.startFocus()}else!0===this.focus&&(this.endFocus(),this.inputOptions.zoom&&this.zoomOut())},e.prototype.update=function(){if(this.text.update(),this.placeHolder&&this.placeHolder.update(),this.focus){if(30!==this.cnt)return this.cnt++;this.cursor.visible=this.blink,this.blink=!this.blink,this.cnt=0}},e.prototype.endFocus=function(){var e=this;this.focus&&(this.domElement.removeEventListener(),!0===this.blockInput&&this.domElement.unblockKeyDownEvents(),this.focus=!1,0===this.value.length&&null!==this.placeHolder&&(this.placeHolder.visible=!0),this.cursor.visible=!1,this.game.device.desktop?setTimeout(function(){e.domElement.blur()},0):this.domElement.blur(),this.game.device.desktop||(t.KeyboardOpen=!1,t.onKeyboardClose.dispatch()))},e.prototype.startFocus=function(){var e=this;this.focus=!0,null!==this.placeHolder&&(this.placeHolder.visible=!1),this.game.device.desktop?setTimeout(function(){e.keyUpProcessor()},0):this.keyUpProcessor(),this.game.device.desktop||(t.KeyboardOpen=!0,t.onKeyboardOpen.dispatch())},e.prototype.keyUpProcessor=function(){this.domElement.addKeyUpListener(this.keyListener.bind(this)),this.domElement.focus(),!0===this.blockInput&&this.domElement.blockKeyDownEvents()},e.prototype.updateText=function(){var e="";if(this.inputOptions.type===t.InputType.password)for(var a=0;a<this.value.length;a++)e+="*";else if(this.inputOptions.type===t.InputType.number){var r=parseInt(this.value);e=r<parseInt(this.inputOptions.min)?this.value=this.domElement.value=this.inputOptions.min:r>parseInt(this.inputOptions.max)?this.value=this.domElement.value=this.inputOptions.max:this.value}else e=this.value;if(this.text.setText(e),this.text.width>this.inputOptions.width)this.text.anchor.x=1,this.text.x=this.inputOptions.padding+this.inputOptions.width;else switch(this.inputOptions.textAlign){case"left":this.text.anchor.set(0,0),this.text.x=this.inputOptions.padding;break;case"center":this.text.anchor.set(.5,0),this.text.x=this.inputOptions.padding+this.inputOptions.width/2;break;case"right":this.text.anchor.set(1,0),this.text.x=this.inputOptions.padding+this.inputOptions.width;}},e.prototype.updateCursor=function(){if(this.text.width>this.inputOptions.width||"right"===this.inputOptions.textAlign)this.cursor.x=this.inputOptions.padding+this.inputOptions.width;else switch(this.inputOptions.textAlign){case"left":this.cursor.x=this.inputOptions.padding+this.getCaretPosition();break;case"center":this.cursor.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2+this.getCaretPosition();}},e.prototype.getCaretPosition=function(){var e=this.domElement.getCaretPosition();if(-1===e)return this.text.width;var a=this.value;if(this.inputOptions.type===t.InputType.password){a="";for(var r=0;r<this.value.length;r++)a+="*"}return this.offscreenText.setText(a.slice(0,e)),this.offscreenText.width},e.prototype.setCaretOnclick=function(t){var a=this.text.toLocal(new PIXI.Point(t.x,t.y),this.game.world).x;this.inputOptions.textAlign&&"center"===this.inputOptions.textAlign&&(a+=this.text.width/2);for(var r=this.text.width/this.value.length,o=0,n=0;n<this.value.length;n++)if(a>=n*r&&(n+1)*r>=a){o=n;break}a>(this.value.length-1)*r&&(o=this.value.length),this.startFocus(),this.domElement.setCaretPosition(o),this.updateCursor()},e.prototype.updateSelection=function(){if(this.domElement.hasSelection){var e=this.value;if(this.inputOptions.type===t.InputType.password){e="";for(var a=0;a<this.value.length;a++)e+="*"}switch(e=e.substring(this.domElement.caretStart,this.domElement.caretEnd),this.offscreenText.setText(e),this.selection.updateSelection(this.offscreenText.getBounds()),this.inputOptions.textAlign){case"left":this.selection.x=this.inputOptions.padding;break;case"center":this.selection.x=this.inputOptions.padding+this.inputOptions.width/2-this.text.width/2;}}else this.selection.clear()},e.prototype.zoomIn=function(){if(!t.Zoomed){var e=this.getBounds();this.windowScale=window.innerHeight>window.innerWidth?this.game.width/(1.5*e.width):this.game.width/2/(1.5*e.width);var a=(this.game.width-1.5*e.width)/2/this.windowScale;this.game.world.scale.set(this.game.world.scale.x*this.windowScale,this.game.world.scale.y*this.windowScale),this.game.world.pivot.set(e.x-a,e.y-2*this.inputOptions.padding),t.Zoomed=!0}},e.prototype.zoomOut=function(){t.Zoomed&&(this.game.world.scale.set(this.game.world.scale.x/this.windowScale,this.game.world.scale.y/this.windowScale),this.game.world.pivot.set(0,0),t.Zoomed=!1)},e.prototype.keyListener=function(e){return this.value=this.getFormattedText(this.domElement.value),13===e.keyCode?void(this.focusOutOnEnter&&this.endFocus()):(this.updateText(),this.updateCursor(),this.updateSelection(),void e.preventDefault())},e.prototype.destroy=function(e){this.game.input.onDown.remove(this.checkDown,this),this.focusIn.removeAll(),this.focusOut.removeAll(),this.domElement.destroy(),n.prototype.destroy.call(this,e)},e.prototype.resetText=function(){this.setText()},e.prototype.setText=function(e){void 0===e&&(e=""),null!==this.placeHolder&&(0<e.length?this.placeHolder.visible=!1:this.placeHolder.visible=!0),this.value=this.getFormattedText(e),this.domElement.value=this.value,this.updateText(),this.updateCursor(),this.endFocus()},e.prototype.getFormattedText=function(e){switch(this.inputOptions.forceCase){default:case o.none:return e;case o.lower:return e.toLowerCase();case o.upper:return e.toUpperCase();}},e}(Phaser.Sprite);t.InputField=e}(a||(a={}));var a;!function(e){var a=function(o){function e(a,r){var n=o.call(this,a,0,0)||this;n.bgColor=r.backgroundColor?parseInt(r.backgroundColor.slice(1),16):16777215,n.borderRadius=r.borderRadius||0,n.borderWidth=r.borderWidth||1,n.borderColor=r.borderColor?parseInt(r.borderColor.slice(1),16):9803157,n.boxAlpha=r.fillAlpha,n.padding=r.padding;var i=r.height,e=r.width,i;r.font&&(i=t(parseInt(r.font.substr(0,r.font.indexOf("px")),10),i)),n.boxHeight=2*n.padding+i;var e=r.width;return n.boxWidth=2*n.padding+e,n.drawBox(),n}return r(e,o),e.prototype.resize=function(e){this.boxWidth=2*this.padding+e,this.drawBox()},e.prototype.drawBox=function(){this.clear().beginFill(this.bgColor,this.boxAlpha).lineStyle(this.borderWidth,this.borderColor,this.boxAlpha),0<this.borderRadius?this.drawRoundedRect(0,0,this.boxWidth,this.boxHeight,this.borderRadius):this.drawRect(0,0,this.boxWidth,this.boxHeight)},e}(Phaser.Graphics);e.InputBox=a}(a||(a={}));var a;!function(e){var t=function(e){function t(t,a){var r=e.call(this,t,a.padding,a.padding)||this;return r.inputOptions=a,r}return r(t,e),t.prototype.updateSelection=function(e){var a=Phaser.Color.webToColor(this.inputOptions.selectionColor);this.clear(),this.beginFill(t.rgb2hex(a),a.a),this.drawRect(e.x,e.y,e.width,e.height-this.inputOptions.padding)},t.rgb2hex=function(e){return parseInt(("0"+e.r.toString(16)).slice(-2)+("0"+e.g.toString(16)).slice(-2)+("0"+e.b.toString(16)).slice(-2),16)},t}(Phaser.Graphics);e.SelectionHighlight=t}(a||(a={}));var a;!function(e){var a=function(o){function e(a,r){var n=o.call(this,a,r.padding,r.padding)||this,i=r.height;return r.font&&(i=t(parseInt(r.font.substr(0,r.font.indexOf("px")),10),i)),n.maskWidth=r.width,n.maskHeight=1.3*i,n.drawMask(),n}return r(e,o),e.prototype.resize=function(e){this.maskWidth=e,this.drawMask()},e.prototype.drawMask=function(){this.clear().beginFill(0).drawRect(0,0,this.maskWidth,this.maskHeight).endFill()},e}(Phaser.Graphics);e.TextMask=a}(a||(a={}));var a;!function(t){t.Zoomed=!1,t.KeyboardOpen=!1,t.onKeyboardOpen=new Phaser.Signal,t.onKeyboardClose=new Phaser.Signal;var e=function(e){function a(t,a){var r=e.call(this,t,a)||this;return r.addInputFieldFactory(),r}return r(a,e),a.prototype.addInputFieldFactory=function(){Phaser.GameObjectFactory.prototype.inputField=function(a,r,o,n){void 0===n&&(n=this.world);var e=new t.InputField(this.game,a,r,o);return n.add(e)},Phaser.GameObjectCreator.prototype.inputField=function(e,a,r){return new t.InputField(this.game,e,a,r)}},a}(Phaser.Plugin);e.Zoomed=!1,e.KeyboardOpen=!1,e.onKeyboardOpen=new Phaser.Signal,e.onKeyboardClose=new Phaser.Signal,t.Plugin=e}(a||(a={})),e.exports=a}},[516]);